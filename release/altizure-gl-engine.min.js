!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("three"),require("axios")):"function"==typeof define&&define.amd?define([,"axios"],t):"object"==typeof exports?exports.engine=t(require("three"),require("axios")):e.engine=t(e.THREE,e.axios)}(window,function(e,t){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=16)}([function(t,r){t.exports=e},function(e,t,r){var n;e.exports=(n=n||function(e,t){var r=Object.create||function(){function e(){}return function(t){var r;return e.prototype=t,r=new e,e.prototype=null,r}}(),n={},i=n.lib={},o=i.Base={extend:function(e){var t=r(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},a=i.WordArray=o.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||u).stringify(this)},concat:function(e){var t=this.words,r=e.words,n=this.sigBytes,i=e.sigBytes;if(this.clamp(),n%4)for(var o=0;o<i;o++){var a=r[o>>>2]>>>24-o%4*8&255;t[n+o>>>2]|=a<<24-(n+o)%4*8}else for(var o=0;o<i;o+=4)t[n+o>>>2]=r[o>>>2];return this.sigBytes+=i,this},clamp:function(){var t=this.words,r=this.sigBytes;t[r>>>2]&=4294967295<<32-r%4*8,t.length=e.ceil(r/4)},clone:function(){var e=o.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var r,n=[],i=function(t){var t=t,r=987654321,n=4294967295;return function(){var i=((r=36969*(65535&r)+(r>>16)&n)<<16)+(t=18e3*(65535&t)+(t>>16)&n)&n;return i/=4294967296,(i+=.5)*(e.random()>.5?1:-1)}},o=0;o<t;o+=4){var s=i(4294967296*(r||e.random()));r=987654071*s(),n.push(4294967296*s()|0)}return new a.init(n,t)}}),s=n.enc={},u=s.Hex={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],i=0;i<r;i++){var o=t[i>>>2]>>>24-i%4*8&255;n.push((o>>>4).toString(16)),n.push((15&o).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n+=2)r[n>>>3]|=parseInt(e.substr(n,2),16)<<24-n%8*4;return new a.init(r,t/2)}},c=s.Latin1={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],i=0;i<r;i++){var o=t[i>>>2]>>>24-i%4*8&255;n.push(String.fromCharCode(o))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n++)r[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new a.init(r,t)}},l=s.Utf8={stringify:function(e){try{return decodeURIComponent(escape(c.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return c.parse(unescape(encodeURIComponent(e)))}},f=i.BufferedBlockAlgorithm=o.extend({reset:function(){this._data=new a.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=l.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var r=this._data,n=r.words,i=r.sigBytes,o=this.blockSize,s=4*o,u=i/s,c=(u=t?e.ceil(u):e.max((0|u)-this._minBufferSize,0))*o,l=e.min(4*c,i);if(c){for(var f=0;f<c;f+=o)this._doProcessBlock(n,f);var h=n.splice(0,c);r.sigBytes-=l}return new a.init(h,l)},clone:function(){var e=o.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),h=(i.Hasher=f.extend({cfg:o.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){f.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){e&&this._append(e);var t=this._doFinalize();return t},blockSize:16,_createHelper:function(e){return function(t,r){return new e.init(r).finalize(t)}},_createHmacHelper:function(e){return function(t,r){return new h.HMAC.init(e,r).finalize(t)}}}),n.algo={});return n}(Math),n)},function(e,t,r){var n;e.exports=(n=r(1),function(e){var t=n,r=t.lib,i=r.WordArray,o=r.Hasher,a=t.algo,s=[];!function(){for(var t=0;t<64;t++)s[t]=4294967296*e.abs(e.sin(t+1))|0}();var u=a.MD5=o.extend({_doReset:function(){this._hash=new i.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var r=0;r<16;r++){var n=t+r,i=e[n];e[n]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8)}var o=this._hash.words,a=e[t+0],u=e[t+1],p=e[t+2],d=e[t+3],v=e[t+4],y=e[t+5],m=e[t+6],g=e[t+7],b=e[t+8],_=e[t+9],w=e[t+10],x=e[t+11],A=e[t+12],k=e[t+13],O=e[t+14],S=e[t+15],P=o[0],T=o[1],E=o[2],M=o[3];P=c(P,T,E,M,a,7,s[0]),M=c(M,P,T,E,u,12,s[1]),E=c(E,M,P,T,p,17,s[2]),T=c(T,E,M,P,d,22,s[3]),P=c(P,T,E,M,v,7,s[4]),M=c(M,P,T,E,y,12,s[5]),E=c(E,M,P,T,m,17,s[6]),T=c(T,E,M,P,g,22,s[7]),P=c(P,T,E,M,b,7,s[8]),M=c(M,P,T,E,_,12,s[9]),E=c(E,M,P,T,w,17,s[10]),T=c(T,E,M,P,x,22,s[11]),P=c(P,T,E,M,A,7,s[12]),M=c(M,P,T,E,k,12,s[13]),E=c(E,M,P,T,O,17,s[14]),P=l(P,T=c(T,E,M,P,S,22,s[15]),E,M,u,5,s[16]),M=l(M,P,T,E,m,9,s[17]),E=l(E,M,P,T,x,14,s[18]),T=l(T,E,M,P,a,20,s[19]),P=l(P,T,E,M,y,5,s[20]),M=l(M,P,T,E,w,9,s[21]),E=l(E,M,P,T,S,14,s[22]),T=l(T,E,M,P,v,20,s[23]),P=l(P,T,E,M,_,5,s[24]),M=l(M,P,T,E,O,9,s[25]),E=l(E,M,P,T,d,14,s[26]),T=l(T,E,M,P,b,20,s[27]),P=l(P,T,E,M,k,5,s[28]),M=l(M,P,T,E,p,9,s[29]),E=l(E,M,P,T,g,14,s[30]),P=f(P,T=l(T,E,M,P,A,20,s[31]),E,M,y,4,s[32]),M=f(M,P,T,E,b,11,s[33]),E=f(E,M,P,T,x,16,s[34]),T=f(T,E,M,P,O,23,s[35]),P=f(P,T,E,M,u,4,s[36]),M=f(M,P,T,E,v,11,s[37]),E=f(E,M,P,T,g,16,s[38]),T=f(T,E,M,P,w,23,s[39]),P=f(P,T,E,M,k,4,s[40]),M=f(M,P,T,E,a,11,s[41]),E=f(E,M,P,T,d,16,s[42]),T=f(T,E,M,P,m,23,s[43]),P=f(P,T,E,M,_,4,s[44]),M=f(M,P,T,E,A,11,s[45]),E=f(E,M,P,T,S,16,s[46]),P=h(P,T=f(T,E,M,P,p,23,s[47]),E,M,a,6,s[48]),M=h(M,P,T,E,g,10,s[49]),E=h(E,M,P,T,O,15,s[50]),T=h(T,E,M,P,y,21,s[51]),P=h(P,T,E,M,A,6,s[52]),M=h(M,P,T,E,d,10,s[53]),E=h(E,M,P,T,w,15,s[54]),T=h(T,E,M,P,u,21,s[55]),P=h(P,T,E,M,b,6,s[56]),M=h(M,P,T,E,S,10,s[57]),E=h(E,M,P,T,m,15,s[58]),T=h(T,E,M,P,k,21,s[59]),P=h(P,T,E,M,v,6,s[60]),M=h(M,P,T,E,x,10,s[61]),E=h(E,M,P,T,p,15,s[62]),T=h(T,E,M,P,_,21,s[63]),o[0]=o[0]+P|0,o[1]=o[1]+T|0,o[2]=o[2]+E|0,o[3]=o[3]+M|0},_doFinalize:function(){var t=this._data,r=t.words,n=8*this._nDataBytes,i=8*t.sigBytes;r[i>>>5]|=128<<24-i%32;var o=e.floor(n/4294967296),a=n;r[15+(i+64>>>9<<4)]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),r[14+(i+64>>>9<<4)]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),t.sigBytes=4*(r.length+1),this._process();for(var s=this._hash,u=s.words,c=0;c<4;c++){var l=u[c];u[c]=16711935&(l<<8|l>>>24)|4278255360&(l<<24|l>>>8)}return s},clone:function(){var e=o.clone.call(this);return e._hash=this._hash.clone(),e}});function c(e,t,r,n,i,o,a){var s=e+(t&r|~t&n)+i+a;return(s<<o|s>>>32-o)+t}function l(e,t,r,n,i,o,a){var s=e+(t&n|r&~n)+i+a;return(s<<o|s>>>32-o)+t}function f(e,t,r,n,i,o,a){var s=e+(t^r^n)+i+a;return(s<<o|s>>>32-o)+t}function h(e,t,r,n,i,o,a){var s=e+(r^(t|~n))+i+a;return(s<<o|s>>>32-o)+t}t.MD5=o._createHelper(u),t.HmacMD5=o._createHmacHelper(u)}(Math),n.MD5)},function(e,t,r){var n;e.exports=(n=r(1),n.enc.Hex)},function(e,r){e.exports=t},function(e,t,r){e.exports=function(){return r(6)('!function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=2)}([function(t,e,r){(function(e){t.exports=function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=2)}([function(t,e,r){var n;t.exports=function t(e,r,i){function o(s,u){if(!r[s]){if(!e[s]){if(!u&&("function"==typeof n&&n))return n(s,!0);if(a)return a(s,!0);var f=new Error("Cannot find module \'"+s+"\'");throw f.code="MODULE_NOT_FOUND",f}var c=r[s]={exports:{}};e[s][0].call(c.exports,function(t){return o(e[s][1][t]||t)},c,c.exports,t,e,r,i)}return r[s].exports}for(var a="function"==typeof n&&n,s=0;s<i.length;s++)o(i[s]);return o}({1:[function(t,e,r){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;r.assign=function(t){for(var e,r,n=Array.prototype.slice.call(arguments,1);n.length;){var i=n.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(var o in i)e=i,r=o,Object.prototype.hasOwnProperty.call(e,r)&&(t[o]=i[o])}}return t},r.shrinkBuf=function(t,e){return t.length===e?t:t.subarray?t.subarray(0,e):(t.length=e,t)};var i={arraySet:function(t,e,r,n,i){if(e.subarray&&t.subarray)t.set(e.subarray(r,r+n),i);else for(var o=0;o<n;o++)t[i+o]=e[r+o]},flattenChunks:function(t){var e,r,n,i,o,a;for(e=n=0,r=t.length;e<r;e++)n+=t[e].length;for(a=new Uint8Array(n),e=i=0,r=t.length;e<r;e++)o=t[e],a.set(o,i),i+=o.length;return a}},o={arraySet:function(t,e,r,n,i){for(var o=0;o<n;o++)t[i+o]=e[r+o]},flattenChunks:function(t){return[].concat.apply([],t)}};r.setTyped=function(t){t?(r.Buf8=Uint8Array,r.Buf16=Uint16Array,r.Buf32=Int32Array,r.assign(r,i)):(r.Buf8=Array,r.Buf16=Array,r.Buf32=Array,r.assign(r,o))},r.setTyped(n)},{}],2:[function(t,e,r){"use strict";var n=t("./common"),i=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch(t){i=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){o=!1}for(var a=new n.Buf8(256),s=0;s<256;s++)a[s]=252<=s?6:248<=s?5:240<=s?4:224<=s?3:192<=s?2:1;function u(t,e){if(e<65534&&(t.subarray&&o||!t.subarray&&i))return String.fromCharCode.apply(null,n.shrinkBuf(t,e));for(var r="",a=0;a<e;a++)r+=String.fromCharCode(t[a]);return r}a[254]=a[254]=1,r.string2buf=function(t){var e,r,i,o,a,s=t.length,u=0;for(o=0;o<s;o++)55296==(64512&(r=t.charCodeAt(o)))&&o+1<s&&56320==(64512&(i=t.charCodeAt(o+1)))&&(r=65536+(r-55296<<10)+(i-56320),o++),u+=r<128?1:r<2048?2:r<65536?3:4;for(e=new n.Buf8(u),o=a=0;a<u;o++)55296==(64512&(r=t.charCodeAt(o)))&&o+1<s&&56320==(64512&(i=t.charCodeAt(o+1)))&&(r=65536+(r-55296<<10)+(i-56320),o++),r<128?e[a++]=r:(r<2048?e[a++]=192|r>>>6:(r<65536?e[a++]=224|r>>>12:(e[a++]=240|r>>>18,e[a++]=128|r>>>12&63),e[a++]=128|r>>>6&63),e[a++]=128|63&r);return e},r.buf2binstring=function(t){return u(t,t.length)},r.binstring2buf=function(t){for(var e=new n.Buf8(t.length),r=0,i=e.length;r<i;r++)e[r]=t.charCodeAt(r);return e},r.buf2string=function(t,e){var r,n,i,o,s=e||t.length,f=new Array(2*s);for(r=n=0;r<s;)if((i=t[r++])<128)f[n++]=i;else if(4<(o=a[i]))f[n++]=65533,r+=o-1;else{for(i&=2===o?31:3===o?15:7;1<o&&r<s;)i=i<<6|63&t[r++],o--;1<o?f[n++]=65533:i<65536?f[n++]=i:(i-=65536,f[n++]=55296|i>>10&1023,f[n++]=56320|1023&i)}return u(f,n)},r.utf8border=function(t,e){var r;for((e=e||t.length)>t.length&&(e=t.length),r=e-1;0<=r&&128==(192&t[r]);)r--;return r<0?e:0===r?e:r+a[t[r]]>e?r:e}},{"./common":1}],3:[function(t,e,r){"use strict";e.exports=function(t,e,r,n){for(var i=65535&t|0,o=t>>>16&65535|0,a=0;0!==r;){for(r-=a=2e3<r?2e3:r;o=o+(i=i+e[n++]|0)|0,--a;);i%=65521,o%=65521}return i|o<<16|0}},{}],4:[function(t,e,r){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],5:[function(t,e,r){"use strict";var n=function(){for(var t,e=[],r=0;r<256;r++){t=r;for(var n=0;n<8;n++)t=1&t?3988292384^t>>>1:t>>>1;e[r]=t}return e}();e.exports=function(t,e,r,i){var o=n,a=i+r;t^=-1;for(var s=i;s<a;s++)t=t>>>8^o[255&(t^e[s])];return-1^t}},{}],6:[function(t,e,r){"use strict";e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],7:[function(t,e,r){"use strict";e.exports=function(t,e){var r,n,i,o,a,s,u,f,c,h,l,d,p,g,y,m,v,b,w,_,A,k,E,x,S;r=t.state,n=t.next_in,x=t.input,i=n+(t.avail_in-5),o=t.next_out,S=t.output,a=o-(e-t.avail_out),s=o+(t.avail_out-257),u=r.dmax,f=r.wsize,c=r.whave,h=r.wnext,l=r.window,d=r.hold,p=r.bits,g=r.lencode,y=r.distcode,m=(1<<r.lenbits)-1,v=(1<<r.distbits)-1;t:do{p<15&&(d+=x[n++]<<p,p+=8,d+=x[n++]<<p,p+=8),b=g[d&m];e:for(;;){if(d>>>=w=b>>>24,p-=w,0==(w=b>>>16&255))S[o++]=65535&b;else{if(!(16&w)){if(0==(64&w)){b=g[(65535&b)+(d&(1<<w)-1)];continue e}if(32&w){r.mode=12;break t}t.msg="invalid literal/length code",r.mode=30;break t}_=65535&b,(w&=15)&&(p<w&&(d+=x[n++]<<p,p+=8),_+=d&(1<<w)-1,d>>>=w,p-=w),p<15&&(d+=x[n++]<<p,p+=8,d+=x[n++]<<p,p+=8),b=y[d&v];r:for(;;){if(d>>>=w=b>>>24,p-=w,!(16&(w=b>>>16&255))){if(0==(64&w)){b=y[(65535&b)+(d&(1<<w)-1)];continue r}t.msg="invalid distance code",r.mode=30;break t}if(A=65535&b,p<(w&=15)&&(d+=x[n++]<<p,(p+=8)<w&&(d+=x[n++]<<p,p+=8)),u<(A+=d&(1<<w)-1)){t.msg="invalid distance too far back",r.mode=30;break t}if(d>>>=w,p-=w,(w=o-a)<A){if(c<(w=A-w)&&r.sane){t.msg="invalid distance too far back",r.mode=30;break t}if(E=l,(k=0)===h){if(k+=f-w,w<_){for(_-=w;S[o++]=l[k++],--w;);k=o-A,E=S}}else if(h<w){if(k+=f+h-w,(w-=h)<_){for(_-=w;S[o++]=l[k++],--w;);if(k=0,h<_){for(_-=w=h;S[o++]=l[k++],--w;);k=o-A,E=S}}}else if(k+=h-w,w<_){for(_-=w;S[o++]=l[k++],--w;);k=o-A,E=S}for(;2<_;)S[o++]=E[k++],S[o++]=E[k++],S[o++]=E[k++],_-=3;_&&(S[o++]=E[k++],1<_&&(S[o++]=E[k++]))}else{for(k=o-A;S[o++]=S[k++],S[o++]=S[k++],S[o++]=S[k++],2<(_-=3););_&&(S[o++]=S[k++],1<_&&(S[o++]=S[k++]))}break}}break}}while(n<i&&o<s);n-=_=p>>3,d&=(1<<(p-=_<<3))-1,t.next_in=n,t.next_out=o,t.avail_in=n<i?i-n+5:5-(n-i),t.avail_out=o<s?s-o+257:257-(o-s),r.hold=d,r.bits=p}},{}],8:[function(t,e,r){"use strict";var n=t("../utils/common"),i=t("./adler32"),o=t("./crc32"),a=t("./inffast"),s=t("./inftrees"),u=1,f=2,c=0,h=-2,l=1,d=852,p=592;function g(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function y(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new n.Buf16(320),this.work=new n.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function m(t){var e;return t&&t.state?(e=t.state,t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=l,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new n.Buf32(d),e.distcode=e.distdyn=new n.Buf32(p),e.sane=1,e.back=-1,c):h}function v(t){var e;return t&&t.state?((e=t.state).wsize=0,e.whave=0,e.wnext=0,m(t)):h}function b(t,e){var r,n;return t&&t.state?(n=t.state,e<0?(r=0,e=-e):(r=1+(e>>4),e<48&&(e&=15)),e&&(e<8||15<e)?h:(null!==n.window&&n.wbits!==e&&(n.window=null),n.wrap=r,n.wbits=e,v(t))):h}function w(t,e){var r,n;return t?(n=new y,(t.state=n).window=null,(r=b(t,e))!==c&&(t.state=null),r):h}var _,A,k=!0;function E(t){if(k){var e;for(_=new n.Buf32(512),A=new n.Buf32(32),e=0;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(s(u,t.lens,0,288,_,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;s(f,t.lens,0,32,A,0,t.work,{bits:5}),k=!1}t.lencode=_,t.lenbits=9,t.distcode=A,t.distbits=5}function x(t,e,r,i){var o,a=t.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new n.Buf8(a.wsize)),i>=a.wsize?(n.arraySet(a.window,e,r-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):(i<(o=a.wsize-a.wnext)&&(o=i),n.arraySet(a.window,e,r-i,o,a.wnext),(i-=o)?(n.arraySet(a.window,e,r-i,i,0),a.wnext=i,a.whave=a.wsize):(a.wnext+=o,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=o))),0}r.inflateReset=v,r.inflateReset2=b,r.inflateResetKeep=m,r.inflateInit=function(t){return w(t,15)},r.inflateInit2=w,r.inflate=function(t,e){var r,d,p,y,m,v,b,w,_,A,k,S,T,P,B,R,U,O,C,L,I,D,M,N,F=0,j=new n.Buf8(4),Y=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return h;12===(r=t.state).mode&&(r.mode=13),m=t.next_out,p=t.output,b=t.avail_out,y=t.next_in,d=t.input,v=t.avail_in,w=r.hold,_=r.bits,A=v,k=b,D=c;t:for(;;)switch(r.mode){case l:if(0===r.wrap){r.mode=13;break}for(;_<16;){if(0===v)break t;v--,w+=d[y++]<<_,_+=8}if(2&r.wrap&&35615===w){j[r.check=0]=255&w,j[1]=w>>>8&255,r.check=o(r.check,j,2,0),_=w=0,r.mode=2;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&w)<<8)+(w>>8))%31){t.msg="incorrect header check",r.mode=30;break}if(8!=(15&w)){t.msg="unknown compression method",r.mode=30;break}if(_-=4,I=8+(15&(w>>>=4)),0===r.wbits)r.wbits=I;else if(I>r.wbits){t.msg="invalid window size",r.mode=30;break}r.dmax=1<<I,t.adler=r.check=1,r.mode=512&w?10:12,_=w=0;break;case 2:for(;_<16;){if(0===v)break t;v--,w+=d[y++]<<_,_+=8}if(r.flags=w,8!=(255&r.flags)){t.msg="unknown compression method",r.mode=30;break}if(57344&r.flags){t.msg="unknown header flags set",r.mode=30;break}r.head&&(r.head.text=w>>8&1),512&r.flags&&(j[0]=255&w,j[1]=w>>>8&255,r.check=o(r.check,j,2,0)),_=w=0,r.mode=3;case 3:for(;_<32;){if(0===v)break t;v--,w+=d[y++]<<_,_+=8}r.head&&(r.head.time=w),512&r.flags&&(j[0]=255&w,j[1]=w>>>8&255,j[2]=w>>>16&255,j[3]=w>>>24&255,r.check=o(r.check,j,4,0)),_=w=0,r.mode=4;case 4:for(;_<16;){if(0===v)break t;v--,w+=d[y++]<<_,_+=8}r.head&&(r.head.xflags=255&w,r.head.os=w>>8),512&r.flags&&(j[0]=255&w,j[1]=w>>>8&255,r.check=o(r.check,j,2,0)),_=w=0,r.mode=5;case 5:if(1024&r.flags){for(;_<16;){if(0===v)break t;v--,w+=d[y++]<<_,_+=8}r.length=w,r.head&&(r.head.extra_len=w),512&r.flags&&(j[0]=255&w,j[1]=w>>>8&255,r.check=o(r.check,j,2,0)),_=w=0}else r.head&&(r.head.extra=null);r.mode=6;case 6:if(1024&r.flags&&(v<(S=r.length)&&(S=v),S&&(r.head&&(I=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),n.arraySet(r.head.extra,d,y,S,I)),512&r.flags&&(r.check=o(r.check,d,S,y)),v-=S,y+=S,r.length-=S),r.length))break t;r.length=0,r.mode=7;case 7:if(2048&r.flags){if(0===v)break t;for(S=0;I=d[y+S++],r.head&&I&&r.length<65536&&(r.head.name+=String.fromCharCode(I)),I&&S<v;);if(512&r.flags&&(r.check=o(r.check,d,S,y)),v-=S,y+=S,I)break t}else r.head&&(r.head.name=null);r.length=0,r.mode=8;case 8:if(4096&r.flags){if(0===v)break t;for(S=0;I=d[y+S++],r.head&&I&&r.length<65536&&(r.head.comment+=String.fromCharCode(I)),I&&S<v;);if(512&r.flags&&(r.check=o(r.check,d,S,y)),v-=S,y+=S,I)break t}else r.head&&(r.head.comment=null);r.mode=9;case 9:if(512&r.flags){for(;_<16;){if(0===v)break t;v--,w+=d[y++]<<_,_+=8}if(w!==(65535&r.check)){t.msg="header crc mismatch",r.mode=30;break}_=w=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),t.adler=r.check=0,r.mode=12;break;case 10:for(;_<32;){if(0===v)break t;v--,w+=d[y++]<<_,_+=8}t.adler=r.check=g(w),_=w=0,r.mode=11;case 11:if(0===r.havedict)return t.next_out=m,t.avail_out=b,t.next_in=y,t.avail_in=v,r.hold=w,r.bits=_,2;t.adler=r.check=1,r.mode=12;case 12:if(5===e||6===e)break t;case 13:if(r.last){w>>>=7&_,_-=7&_,r.mode=27;break}for(;_<3;){if(0===v)break t;v--,w+=d[y++]<<_,_+=8}switch(r.last=1&w,_-=1,3&(w>>>=1)){case 0:r.mode=14;break;case 1:if(E(r),r.mode=20,6!==e)break;w>>>=2,_-=2;break t;case 2:r.mode=17;break;case 3:t.msg="invalid block type",r.mode=30}w>>>=2,_-=2;break;case 14:for(w>>>=7&_,_-=7&_;_<32;){if(0===v)break t;v--,w+=d[y++]<<_,_+=8}if((65535&w)!=(w>>>16^65535)){t.msg="invalid stored block lengths",r.mode=30;break}if(r.length=65535&w,_=w=0,r.mode=15,6===e)break t;case 15:r.mode=16;case 16:if(S=r.length){if(v<S&&(S=v),b<S&&(S=b),0===S)break t;n.arraySet(p,d,y,S,m),v-=S,y+=S,b-=S,m+=S,r.length-=S;break}r.mode=12;break;case 17:for(;_<14;){if(0===v)break t;v--,w+=d[y++]<<_,_+=8}if(r.nlen=257+(31&w),w>>>=5,_-=5,r.ndist=1+(31&w),w>>>=5,_-=5,r.ncode=4+(15&w),w>>>=4,_-=4,286<r.nlen||30<r.ndist){t.msg="too many length or distance symbols",r.mode=30;break}r.have=0,r.mode=18;case 18:for(;r.have<r.ncode;){for(;_<3;){if(0===v)break t;v--,w+=d[y++]<<_,_+=8}r.lens[Y[r.have++]]=7&w,w>>>=3,_-=3}for(;r.have<19;)r.lens[Y[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,M={bits:r.lenbits},D=s(0,r.lens,0,19,r.lencode,0,r.work,M),r.lenbits=M.bits,D){t.msg="invalid code lengths set",r.mode=30;break}r.have=0,r.mode=19;case 19:for(;r.have<r.nlen+r.ndist;){for(;R=(F=r.lencode[w&(1<<r.lenbits)-1])>>>16&255,U=65535&F,!((B=F>>>24)<=_);){if(0===v)break t;v--,w+=d[y++]<<_,_+=8}if(U<16)w>>>=B,_-=B,r.lens[r.have++]=U;else{if(16===U){for(N=B+2;_<N;){if(0===v)break t;v--,w+=d[y++]<<_,_+=8}if(w>>>=B,_-=B,0===r.have){t.msg="invalid bit length repeat",r.mode=30;break}I=r.lens[r.have-1],S=3+(3&w),w>>>=2,_-=2}else if(17===U){for(N=B+3;_<N;){if(0===v)break t;v--,w+=d[y++]<<_,_+=8}_-=B,I=0,S=3+(7&(w>>>=B)),w>>>=3,_-=3}else{for(N=B+7;_<N;){if(0===v)break t;v--,w+=d[y++]<<_,_+=8}_-=B,I=0,S=11+(127&(w>>>=B)),w>>>=7,_-=7}if(r.have+S>r.nlen+r.ndist){t.msg="invalid bit length repeat",r.mode=30;break}for(;S--;)r.lens[r.have++]=I}}if(30===r.mode)break;if(0===r.lens[256]){t.msg="invalid code -- missing end-of-block",r.mode=30;break}if(r.lenbits=9,M={bits:r.lenbits},D=s(u,r.lens,0,r.nlen,r.lencode,0,r.work,M),r.lenbits=M.bits,D){t.msg="invalid literal/lengths set",r.mode=30;break}if(r.distbits=6,r.distcode=r.distdyn,M={bits:r.distbits},D=s(f,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,M),r.distbits=M.bits,D){t.msg="invalid distances set",r.mode=30;break}if(r.mode=20,6===e)break t;case 20:r.mode=21;case 21:if(6<=v&&258<=b){t.next_out=m,t.avail_out=b,t.next_in=y,t.avail_in=v,r.hold=w,r.bits=_,a(t,k),m=t.next_out,p=t.output,b=t.avail_out,y=t.next_in,d=t.input,v=t.avail_in,w=r.hold,_=r.bits,12===r.mode&&(r.back=-1);break}for(r.back=0;R=(F=r.lencode[w&(1<<r.lenbits)-1])>>>16&255,U=65535&F,!((B=F>>>24)<=_);){if(0===v)break t;v--,w+=d[y++]<<_,_+=8}if(R&&0==(240&R)){for(O=B,C=R,L=U;R=(F=r.lencode[L+((w&(1<<O+C)-1)>>O)])>>>16&255,U=65535&F,!(O+(B=F>>>24)<=_);){if(0===v)break t;v--,w+=d[y++]<<_,_+=8}w>>>=O,_-=O,r.back+=O}if(w>>>=B,_-=B,r.back+=B,r.length=U,0===R){r.mode=26;break}if(32&R){r.back=-1,r.mode=12;break}if(64&R){t.msg="invalid literal/length code",r.mode=30;break}r.extra=15&R,r.mode=22;case 22:if(r.extra){for(N=r.extra;_<N;){if(0===v)break t;v--,w+=d[y++]<<_,_+=8}r.length+=w&(1<<r.extra)-1,w>>>=r.extra,_-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=23;case 23:for(;R=(F=r.distcode[w&(1<<r.distbits)-1])>>>16&255,U=65535&F,!((B=F>>>24)<=_);){if(0===v)break t;v--,w+=d[y++]<<_,_+=8}if(0==(240&R)){for(O=B,C=R,L=U;R=(F=r.distcode[L+((w&(1<<O+C)-1)>>O)])>>>16&255,U=65535&F,!(O+(B=F>>>24)<=_);){if(0===v)break t;v--,w+=d[y++]<<_,_+=8}w>>>=O,_-=O,r.back+=O}if(w>>>=B,_-=B,r.back+=B,64&R){t.msg="invalid distance code",r.mode=30;break}r.offset=U,r.extra=15&R,r.mode=24;case 24:if(r.extra){for(N=r.extra;_<N;){if(0===v)break t;v--,w+=d[y++]<<_,_+=8}r.offset+=w&(1<<r.extra)-1,w>>>=r.extra,_-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){t.msg="invalid distance too far back",r.mode=30;break}r.mode=25;case 25:if(0===b)break t;if(S=k-b,r.offset>S){if((S=r.offset-S)>r.whave&&r.sane){t.msg="invalid distance too far back",r.mode=30;break}S>r.wnext?(S-=r.wnext,T=r.wsize-S):T=r.wnext-S,S>r.length&&(S=r.length),P=r.window}else P=p,T=m-r.offset,S=r.length;for(b<S&&(S=b),b-=S,r.length-=S;p[m++]=P[T++],--S;);0===r.length&&(r.mode=21);break;case 26:if(0===b)break t;p[m++]=r.length,b--,r.mode=21;break;case 27:if(r.wrap){for(;_<32;){if(0===v)break t;v--,w|=d[y++]<<_,_+=8}if(k-=b,t.total_out+=k,r.total+=k,k&&(t.adler=r.check=r.flags?o(r.check,p,k,m-k):i(r.check,p,k,m-k)),k=b,(r.flags?w:g(w))!==r.check){t.msg="incorrect data check",r.mode=30;break}_=w=0}r.mode=28;case 28:if(r.wrap&&r.flags){for(;_<32;){if(0===v)break t;v--,w+=d[y++]<<_,_+=8}if(w!==(4294967295&r.total)){t.msg="incorrect length check",r.mode=30;break}_=w=0}r.mode=29;case 29:D=1;break t;case 30:D=-3;break t;case 31:return-4;case 32:default:return h}return t.next_out=m,t.avail_out=b,t.next_in=y,t.avail_in=v,r.hold=w,r.bits=_,(r.wsize||k!==t.avail_out&&r.mode<30&&(r.mode<27||4!==e))&&x(t,t.output,t.next_out,k-t.avail_out)?(r.mode=31,-4):(A-=t.avail_in,k-=t.avail_out,t.total_in+=A,t.total_out+=k,r.total+=k,r.wrap&&k&&(t.adler=r.check=r.flags?o(r.check,p,k,t.next_out-k):i(r.check,p,k,t.next_out-k)),t.data_type=r.bits+(r.last?64:0)+(12===r.mode?128:0)+(20===r.mode||15===r.mode?256:0),(0===A&&0===k||4===e)&&D===c&&(D=-5),D)},r.inflateEnd=function(t){if(!t||!t.state)return h;var e=t.state;return e.window&&(e.window=null),t.state=null,c},r.inflateGetHeader=function(t,e){var r;return t&&t.state?0==(2&(r=t.state).wrap)?h:((r.head=e).done=!1,c):h},r.inflateSetDictionary=function(t,e){var r,n=e.length;return t&&t.state?0!==(r=t.state).wrap&&11!==r.mode?h:11===r.mode&&i(1,e,n,0)!==r.check?-3:x(t,e,n,n)?(r.mode=31,-4):(r.havedict=1,c):h},r.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":1,"./adler32":3,"./crc32":5,"./inffast":7,"./inftrees":9}],9:[function(t,e,r){"use strict";var n=t("../utils/common"),i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],a=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],s=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(t,e,r,u,f,c,h,l){var d,p,g,y,m,v,b,w,_,A=l.bits,k=0,E=0,x=0,S=0,T=0,P=0,B=0,R=0,U=0,O=0,C=null,L=0,I=new n.Buf16(16),D=new n.Buf16(16),M=null,N=0;for(k=0;k<=15;k++)I[k]=0;for(E=0;E<u;E++)I[e[r+E]]++;for(T=A,S=15;1<=S&&0===I[S];S--);if(S<T&&(T=S),0===S)return f[c++]=20971520,f[c++]=20971520,l.bits=1,0;for(x=1;x<S&&0===I[x];x++);for(T<x&&(T=x),k=R=1;k<=15;k++)if(R<<=1,(R-=I[k])<0)return-1;if(0<R&&(0===t||1!==S))return-1;for(D[1]=0,k=1;k<15;k++)D[k+1]=D[k]+I[k];for(E=0;E<u;E++)0!==e[r+E]&&(h[D[e[r+E]]++]=E);if(0===t?(C=M=h,v=19):1===t?(C=i,L-=257,M=o,N-=257,v=256):(C=a,M=s,v=-1),k=x,m=c,B=E=O=0,g=-1,y=(U=1<<(P=T))-1,1===t&&852<U||2===t&&592<U)return 1;for(;;){for(b=k-B,h[E]<v?(w=0,_=h[E]):h[E]>v?(w=M[N+h[E]],_=C[L+h[E]]):(w=96,_=0),d=1<<k-B,x=p=1<<P;f[m+(O>>B)+(p-=d)]=b<<24|w<<16|_|0,0!==p;);for(d=1<<k-1;O&d;)d>>=1;if(0!==d?(O&=d-1,O+=d):O=0,E++,0==--I[k]){if(k===S)break;k=e[r+h[E]]}if(T<k&&(O&y)!==g){for(0===B&&(B=T),m+=x,R=1<<(P=k-B);P+B<S&&!((R-=I[P+B])<=0);)P++,R<<=1;if(U+=1<<P,1===t&&852<U||2===t&&592<U)return 1;f[g=O&y]=T<<24|P<<16|m-c|0}}return 0!==O&&(f[m+O]=k-B<<24|64<<16|0),l.bits=T,0}},{"../utils/common":1}],10:[function(t,e,r){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],11:[function(t,e,r){"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],"/lib/inflate.js":[function(t,e,r){"use strict";var n=t("./zlib/inflate"),i=t("./utils/common"),o=t("./utils/strings"),a=t("./zlib/constants"),s=t("./zlib/messages"),u=t("./zlib/zstream"),f=t("./zlib/gzheader"),c=Object.prototype.toString;function h(t){if(!(this instanceof h))return new h(t);this.options=i.assign({chunkSize:16384,windowBits:0,to:""},t||{});var e=this.options;e.raw&&0<=e.windowBits&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(0<=e.windowBits&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),15<e.windowBits&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var r=n.inflateInit2(this.strm,e.windowBits);if(r!==a.Z_OK)throw new Error(s[r]);if(this.header=new f,n.inflateGetHeader(this.strm,this.header),e.dictionary&&("string"==typeof e.dictionary?e.dictionary=o.string2buf(e.dictionary):"[object ArrayBuffer]"===c.call(e.dictionary)&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(r=n.inflateSetDictionary(this.strm,e.dictionary))!==a.Z_OK))throw new Error(s[r])}function l(t,e){var r=new h(e);if(r.push(t,!0),r.err)throw r.msg||s[r.err];return r.result}h.prototype.push=function(t,e){var r,s,u,f,h,l=this.strm,d=this.options.chunkSize,p=this.options.dictionary,g=!1;if(this.ended)return!1;s=e===~~e?e:!0===e?a.Z_FINISH:a.Z_NO_FLUSH,"string"==typeof t?l.input=o.binstring2buf(t):"[object ArrayBuffer]"===c.call(t)?l.input=new Uint8Array(t):l.input=t,l.next_in=0,l.avail_in=l.input.length;do{if(0===l.avail_out&&(l.output=new i.Buf8(d),l.next_out=0,l.avail_out=d),(r=n.inflate(l,a.Z_NO_FLUSH))===a.Z_NEED_DICT&&p&&(r=n.inflateSetDictionary(this.strm,p)),r===a.Z_BUF_ERROR&&!0===g&&(r=a.Z_OK,g=!1),r!==a.Z_STREAM_END&&r!==a.Z_OK)return this.onEnd(r),!(this.ended=!0);l.next_out&&(0!==l.avail_out&&r!==a.Z_STREAM_END&&(0!==l.avail_in||s!==a.Z_FINISH&&s!==a.Z_SYNC_FLUSH)||("string"===this.options.to?(u=o.utf8border(l.output,l.next_out),f=l.next_out-u,h=o.buf2string(l.output,u),l.next_out=f,l.avail_out=d-f,f&&i.arraySet(l.output,l.output,u,f,0),this.onData(h)):this.onData(i.shrinkBuf(l.output,l.next_out)))),0===l.avail_in&&0===l.avail_out&&(g=!0)}while((0<l.avail_in||0===l.avail_out)&&r!==a.Z_STREAM_END);return r===a.Z_STREAM_END&&(s=a.Z_FINISH),s===a.Z_FINISH?(r=n.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===a.Z_OK):s!==a.Z_SYNC_FLUSH||(this.onEnd(a.Z_OK),!(l.avail_out=0))},h.prototype.onData=function(t){this.chunks.push(t)},h.prototype.onEnd=function(t){t===a.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},r.Inflate=h,r.inflate=l,r.inflateRaw=function(t,e){return(e=e||{}).raw=!0,l(t,e)},r.ungzip=l},{"./utils/common":1,"./utils/strings":2,"./zlib/constants":4,"./zlib/gzheader":6,"./zlib/inflate":8,"./zlib/messages":10,"./zlib/zstream":11}]},{},[])("/lib/inflate.js")},function(t,r){!function(){"use strict";t.exports=function(t){return(t instanceof e?t:e.from(t.toString(),"binary")).toString("base64")}}()},function(t,r,n){"use strict";n.r(r);var i=n(0),o=function(){this.width=0,this.height=0,this.bitDepth=0,this.colorType=0,this.compressionMethod=0,this.filterMethod=0,this.interlaceMethod=0,this.colors=0,this.alpha=!1,this.pixelBits=0,this.palette=null,this.pixels=null};o.prototype.getWidth=function(){return this.width},o.prototype.setWidth=function(t){this.width=t},o.prototype.getHeight=function(){return this.height},o.prototype.setHeight=function(t){this.height=t},o.prototype.getBitDepth=function(){return this.bitDepth},o.prototype.setBitDepth=function(t){if(-1===[2,4,8,16].indexOf(t))throw new Error("invalid bith depth "+t);this.bitDepth=t},o.prototype.getColorType=function(){return this.colorType},o.prototype.setColorType=function(t){var e=0,r=!1;switch(t){case 0:e=1;break;case 2:e=3;break;case 3:e=1;break;case 4:e=2,r=!0;break;case 6:e=4,r=!0;break;default:throw new Error("invalid color type")}this.colors=e,this.alpha=r,this.colorType=t},o.prototype.getCompressionMethod=function(){return this.compressionMethod},o.prototype.setCompressionMethod=function(t){if(0!==t)throw new Error("invalid compression method "+t);this.compressionMethod=t},o.prototype.getFilterMethod=function(){return this.filterMethod},o.prototype.setFilterMethod=function(t){if(0!==t)throw new Error("invalid filter method "+t);this.filterMethod=t},o.prototype.getInterlaceMethod=function(){return this.interlaceMethod},o.prototype.setInterlaceMethod=function(t){if(0!==t&&1!==t)throw new Error("invalid interlace method "+t);this.interlaceMethod=t},o.prototype.setPalette=function(t){if(t.length%3!=0)throw new Error("incorrect PLTE chunk length");if(t.length>3*Math.pow(2,this.bitDepth))throw new Error("palette has more colors than 2^bitdepth");this.palette=t},o.prototype.getPalette=function(){return this.palette},o.prototype.getPixel=function(t,e){if(!this.pixels)throw new Error("pixel data is empty");if(t>=this.width||e>=this.height)throw new Error("x,y position out of bound");var r=this.colors*this.bitDepth/8*(e*this.width+t),n=this.pixels;switch(this.colorType){case 0:return[n[r],n[r],n[r],255];case 2:return[n[r],n[r+1],n[r+2],255];case 3:return[this.palette[3*n[r]+0],this.palette[3*n[r]+1],this.palette[3*n[r]+2],255];case 4:return[n[r],n[r],n[r],n[r+1]];case 6:return[n[r],n[r+1],n[r+2],n[r+3]]}};var a=o;function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}Uint8Array.prototype.slice||Object.defineProperty(Uint8Array.prototype,"slice",{value:function(t,e){return new Uint8Array(Array.prototype.slice.call(this,t,e))}});var u=Object.prototype.toString;function f(t,e){return(t[e]<<24)+(t[e+1]<<16)+(t[e+2]<<8)+(t[e+3]<<0)}function c(t,e){return t[e]<<0}function h(t){if("string"==typeof t){var e=t;t=new Array(e.length);for(var r=0,n=e.length;r<n;r++)t[r]=e[r].charCodeAt(0)}else"ArrayBuffer"===u.call(t).slice(8,-1)&&(t=new Uint8Array(t));this.i=0,this.bytes=t,this.png=new a,this.dataChunks=[]}h.prototype.readBytes=function(t){var e=this.i+t;if(e>this.bytes.length)throw new Error("Unexpectedly reached end of file");var r=this.bytes.slice(this.i,e);return this.i=e,r},h.prototype.decodeHeader=function(){if(0!==this.i)throw new Error("file pointer should be at 0 to read the header");var t=this.readBytes(8);if(!function(t,e){if(t.length!==e.length)return!1;for(var r=t.length;r--;)if(t[r]!==e[r])return!1;return!0}(t,[137,80,78,71,13,10,26,10]))throw new Error("invalid PNGReader file (bad signature)");this.header=t},h.prototype.decodeChunk=function(){var t=f(this.readBytes(4),0);if(t<0)throw new Error("Bad chunk length "+(4294967295&t));var e=function(t){for(var e="",r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e}(this.readBytes(4)),r=this.readBytes(t);switch(this.readBytes(4),e){case"IHDR":this.decodeIHDR(r);break;case"PLTE":this.decodePLTE(r);break;case"IDAT":this.decodeIDAT(r);break;case"IEND":this.decodeIEND(r)}return e},h.prototype.decodeIHDR=function(t){var e=this.png;e.setWidth(f(t,0)),e.setHeight(f(t,4)),e.setBitDepth(c(t,8)),e.setColorType(c(t,9)),e.setCompressionMethod(c(t,10)),e.setFilterMethod(c(t,11)),e.setInterlaceMethod(c(t,12))},h.prototype.decodePLTE=function(t){this.png.setPalette(t)},h.prototype.decodeIDAT=function(t){this.dataChunks.push(t)},h.prototype.decodeIEND=function(){},h.prototype.decodePixels=function(t){var r,n=this.png,o=this,a=0;for(r=this.dataChunks.length;r--;)a+=this.dataChunks[r].length;var s=e.allocUnsafe(a);for(r=0,a=0;r<this.dataChunks.length;r++)s.set(this.dataChunks[r],a),a+=this.dataChunks[r].length;!function(t,e){try{e(null,Object(i.inflate)(t))}catch(t){e(t)}}(s,function(e,r){if(e)return t(e);try{0===n.getInterlaceMethod()?o.interlaceNone(r):o.interlaceAdam7(r)}catch(e){return t(e)}t()})},h.prototype.interlaceNone=function(t){for(var r,n=this.png,i=Math.max(1,n.colors*n.bitDepth/8),o=i*n.width,a=e.allocUnsafe(i*n.width*n.height),s=0,u=0;u<t.length;u+=o+1){switch(r=t.slice(u+1,u+o+1),c(t,u)){case 0:this.unFilterNone(r,a,i,s,o);break;case 1:this.unFilterSub(r,a,i,s,o);break;case 2:this.unFilterUp(r,a,i,s,o);break;case 3:this.unFilterAverage(r,a,i,s,o);break;case 4:this.unFilterPaeth(r,a,i,s,o);break;default:throw new Error("unkown filtered scanline")}s+=o}n.pixels=a},h.prototype.interlaceAdam7=function(t){throw new Error("Adam7 interlacing is not implemented yet")},h.prototype.unFilterNone=function(t,e,r,n,i){for(var o=0,a=i;o<a;o++)e[n+o]=t[o]},h.prototype.unFilterSub=function(t,e,r,n,i){for(var o=0;o<r;o++)e[n+o]=t[o];for(;o<i;o++)e[n+o]=t[o]+e[n+o-r]&255},h.prototype.unFilterUp=function(t,e,r,n,i){var o=0;if(n-i<0)for(;o<i;o++)e[n+o]=t[o];else for(;o<i;o++){var a=t[o],s=e[n+o-i];e[n+o]=a+s&255}},h.prototype.unFilterAverage=function(t,e,r,n,i){var o=0;if(n-i<0){for(;o<r;o++)e[n+o]=t[o];for(;o<i;o++)e[n+o]=t[o]+(e[n+o-r]>>1)&255}else{for(;o<r;o++)e[n+o]=t[o]+(e[n-i+o]>>1)&255;for(;o<i;o++){var a=t[o],s=e[n+o-r],u=e[n+o-i];e[n+o]=a+(s+u>>1)&255}}},h.prototype.unFilterPaeth=function(t,e,r,n,i){var o=0;if(n-i<0){for(;o<r;o++)e[n+o]=t[o];for(;o<i;o++)e[n+o]=t[o]+e[n+o-r]&255}else{for(;o<r;o++)e[n+o]=t[o]+e[n+o-i]&255;for(;o<i;o++){var a,s=t[o],u=e[n+o-r],f=e[n+o-i],c=e[n+o-i-r],h=u+f-c,l=Math.abs(h-u),d=Math.abs(h-f),p=Math.abs(h-c);a=l<=d&&l<=p?u:d<=p?f:c,e[n+o]=s+a&255}}},h.prototype.parse=function(t,e){"function"==typeof t&&(e=t),"object"!==s(t)&&(t={});try{for(this.decodeHeader();this.i<this.bytes.length;){var r=this.decodeChunk();if("IHDR"===r&&!1===t.data||"IEND"===r)break}var n=this.png;this.decodePixels(function(t){e(t,n)})}catch(t){e(t)}};var l=h;function d(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var p=!1;function g(){var t;p&&(t=console).log.apply(t,arguments)}var y=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.data={},this.entries=[],this.buffer=null,this.storeBuffer=null!=e&&e}var e,r;return e=t,(r=[{key:"_Uint8ToString",value:function(t){var e=32768;-1!==navigator.userAgent.indexOf("Edge")&&(e=2048);var r=[];if(Uint8Array.prototype.subarray)for(var n=0;n<t.byteLength;n+=e)r.push(String.fromCharCode.apply(null,t.subarray(n,Math.min(n+e,t.byteLength))));else if(Uint8Array.prototype.slice)for(var i=0;i<t.byteLength;i+=e)r.push(String.fromCharCode.apply(null,t.slice(i,Math.min(i+e,t.byteLength))));else for(var o=0;o<t.byteLength;o+=e){for(var a=new Uint8Array(Math.min(e,t.byteLength-o)),s=0;s<a.byteLength;++s)a[s]=t[o+s];r.push(String.fromCharCode.apply(null,a))}return r.join("")}},{key:"_parseImgURI",value:function(t,e){if("undefined"==typeof btoa){var r=n(1);if(t instanceof Uint8Array)return null==e?"data:;base64,"+r(this._Uint8ToString(t)):"data:"+e+";base64,"+r(this._Uint8ToString(t));if(t instanceof ArrayBuffer){var i=new Uint8Array(t);return null==e?"data:;base64,"+r(this._Uint8ToString(i)):"data:"+e+";base64,"+r(this._Uint8ToString(i))}console.error("Unknow type ",t)}else{if(t instanceof Uint8Array)return null==e?"data:;base64,"+btoa(this._Uint8ToString(t)):"data:"+e+";base64,"+btoa(this._Uint8ToString(t));if(t instanceof ArrayBuffer){var o=new Uint8Array(t);return null==e?"data:;base64,"+btoa(this._Uint8ToString(o)):"data:"+e+";base64,"+btoa(this._Uint8ToString(o))}console.error("Unknow type ",t)}}},{key:"parseBundle",value:function(t,e,r,n){n=n||{};var i=0,o="",a=new Uint8Array(e*r*3),s=n.password||"";this.storeBuffer&&(this.buffer=a);for(var u=0;u<t.length;u++)(u+1)%4!=0&&(a[i++]=t[u]);if(g("Extracted Uint8Array",a.length,a),p){for(var f="",c=500;c<800;c++)f+=a[c]+",";console.log("".concat(500," to ").concat(800," bytes")),console.log(f)}for(i=0;i<a.length&&!(a[i]<5);)o+=String.fromCharCode(a[i++]);g("Found the string 0 char at index ".concat(i," with value ").concat(a[i])),g(o),i++;var h=0;if(""!==s)for(var l=i;l<a.length;l++){var d=a[l];d^=s.charCodeAt(h),a[l]=d,h=(h+1)%s.length}this.entries=[];var y=o.split("\\n");o=y.join(""),y=o.split(";");for(var m=0;m<y.length;m++)if(""!==y[m]){var v=y[m].split(",");this.entries.push({path:v[0],type:v[1],length:parseInt(v[2],10)})}g("this.entries",this.entries);for(var b=0;b<this.entries.length;b++){var w=this.entries[b],_=a.subarray(i,i+w.length);g("Extracting ".concat(w.path,": length ").concat(_.length)),g("Starts at ".concat(i," with value ").concat(_[0])),g("Ends at ".concat(i+w.length," with value ").concat(_[_.length-1])),i+=w.length,this.data[w.path]=_}}},{key:"read",value:function(t){return null===this.data[t]&&console.error("Bundle: ["+t+"] not found."),this.data[t]}},{key:"readText",value:function(t){var e="",r=this.read(t);if(null==r)return e;for(var n=0;n<r.length;n++)e+=String.fromCharCode(r[n]);return e}},{key:"readBuffer",value:function(t){var e=this.read(t);return null==e?new Uint8Array:e}},{key:"readJSON",value:function(t){var e=this.readText(t);return""===e?{}:JSON.parse(e)}},{key:"readImg",value:function(t){var e=this.read(t);return null===e?(console.error("Cannot read ",t),""):this._parseImgURI(e,"image/jpeg")}},{key:"clearData",value:function(){this.data={}}}])&&d(e.prototype,r),t}();function m(t){var e=t.url,r=t.trials,n=void 0===r?3:r,i=t.timeout;return function t(e){var r=e.trials,n=e.url,i=e.timeout;return r<=0?Promise.reject(new Error("0")):function(t){var e=t.url,r=t.timeout,n=new XMLHttpRequest;return n.open("GET",e,!0),n.timeout=r,n.responseType="arraybuffer",new Promise(function(t,e){n.onreadystatechange=function(){if(4===n.readyState)if(200===n.status){var r=n.response;t(r)}else e(new Error(n.status.toString()))},n.send()})}({url:n,timeout:i}).catch(function(e){return i*=2,--r<=0?Promise.reject(e):"404"===e.message||"403"===e.message?Promise.reject(e):t({trials:r,url:n,timeout:i})})}({trials:n,url:e,timeout:void 0===i?3e4:i}).then(function(t){return function(t){return(e=t,new Promise(function(t,r){new l(e).parse(function(e,n){e?(console.error(e),r(new Error("readPNG"))):t(n)})})).then(function(t){return function(t){var e=t.pixels,r=t.imgWidth,n=t.imgHeight;try{var i=new y;return i.parseBundle(e,r,n,{}),Promise.resolve(i)}catch(t){return console.error(t),Promise.reject(new Error("readImageData"))}}({pixels:t.pixels,imgWidth:t.getWidth(),imgHeight:t.getHeight()})}).then(function(t){return function(t){return new Promise(function(e,r){try{var n={};t.entries.map(function(e){var r,i=e.path,o=i.length;".osgjs"===i.substring(o-6)?r=t.readJSON(i):".json"===i.substring(o-5)?r=t.readJSON(i):".jpg"===i.substring(o-4)?r=t.readImg(i):".aa"===i.substring(o-3)?r=decodeURIComponent(escape(t.readText(i))):".bin"===i.substring(o-4)?r=t.readBuffer(i):".txt"===i.substring(o-4)?r=t.readJSON(i):".info"===i.substring(o-5)?r=t.readJSON(i):console.warn("unknown entry",e.path),n[i]=r}),t.clearData(),e(n)}catch(e){t.clearData(),console.log(t),console.error(e),r(new Error("readBundle"))}})}(t)}).then(function(t){return Promise.resolve(t)}).catch(function(t){return"readPNG"===t.message||"readImageData"===t.message||"readBundle"===t.message?Promise.reject(new Error("downloadEntries")):Promise.reject(t)});var e}(t)})}var v={position:3,uv:2,color:3,normal:3};function b(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function w(t,e,r){for(var n=r.decodeOffsets,i=r.decodeScales,o=e.attribRange[0],a=e.attribRange[1],s=r.decodeScales.length,u=new Float32Array(s*a),f=o,c=0;c<s;c++){var h=f+a,l=i[c],d=n[c];l&&y(t,f,h,u,c,s,d,l),f=h}var p=3*e.indexRange[1],g=new Uint32Array(p);return function(t,e,r,n,i){for(var o=0,a=0,s=0;s<r;s++)a=t.charCodeAt(e+s),n[s]=o-a,0===a&&o++}(t,f,p,g),{attribsOut:u,indicesOut:g};function y(t,e,r,n,i,o,a,s){for(var u=0,f=0,c=e;c<r;c++)u+=(f=t.charCodeAt(c))>>1^-(1&f),n[i]=s*(u+a),i+=o}}var _=function(){function t(e){var r=e.resourceKey,n=e.utf8;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.resourceKey=r,this.utf8=n,this._dutf8=null,this._rdutf8=null}var e,r;return e=t,(r=[{key:"destruct",value:function(){for(var t in this.resourceKey=null,this.utf8)this.utf8[t]=null;return this.utf8=null,this._dutf8=null,!0}},{key:"decode",value:function(){var t=this.meshFiles,e={};for(var r in t){var n=t[r],i=this._meshBuffer(r);e[r]=[];for(var o=0;o<n.length;o++){var a=n[o],s=a.indexRange;if(e[r][o]={},s){var u=s[0]+3*s[1];if(i.length<u){console.error("utf8 decode out of range.");break}var f=this.decodeParams;if(a.decodeParam)for(var c in a.decodeParam.decodeScales.length!==this.stride&&console.error("Component decode param in consistent",a.decodeParam,this.decodeParams),a.decodeParam)a.decodeParam[c]&&(f[c]=a.decodeParam[c]);var h=w(i,a,f),l=h.attribsOut,d=h.indicesOut;e[r][o].attributes=l,e[r][o].indices=d,e[r][o].materialName=a.material}}}this._dutf8={geometryArrays:e,materialParams:this.manifest.materials,imageStrings:this.imageStrings}}},{key:"_clearDutf8",value:function(){if(this._dutf8){for(var t in this._dutf8.geometryArrays){for(var e=this._dutf8.geometryArrays[t],r=0;r<e.length;r++)this._dutf8.geometryArrays[t][r].attributes=null,this._dutf8.geometryArrays[t][r].indices=null,this._dutf8.geometryArrays[t][r].materialName=null;this._dutf8.geometryArrays[t]=null}this._dutf8.geometryArrays=null,this._dutf8.materialParams=null,this._dutf8.imageStrings=null,this._dutf8=null}}},{key:"_meshBuffer",value:function(t){var e=t.length;return".aa"!==t.substring(e-3)&&(t=t+=".aa"),this.utf8[t]}},{key:"basename",get:function(){var t=this.resourceKey.replace(/.*\\/|\\.[^.]*$/g,"");return Object.defineProperty(this,"fileName",{value:t,writable:!1,configurable:!0}),this.fileName}},{key:"decodeParams",get:function(){var t=this.manifest.decodeParams,e=t.decodeOffsets,r=t.decodeScales,n=t.decodeTarget,i=t.decodeFormat;return n||(n=["position","uv","normal"]),i||(i=[3,2,3]),Object.defineProperty(this,"decodeParams",{value:{decodeOffsets:e,decodeScales:r,decodeTarget:n,decodeFormat:i},writable:!1,configurable:!0}),this.decodeParams}},{key:"stride",get:function(){var t,e=this.decodeParams.decodeScales.length,r=this.decodeParams.decodeOffsets.length,n=this.decodeParams.decodeFormat.reduce(function(t,e){return t+e},0);return e===r&&r===n||console.error("decodeParams",this.decodeParams),t=e,Object.defineProperty(this,"stride",{value:t,writable:!1,configurable:!0}),this.stride}},{key:"meshFiles",get:function(){return this.manifest.urls}},{key:"dutf8",get:function(){return this._dutf8||this.decode(),this._dutf8}},{key:"rdutf8",get:function(){var t=this;if(this._rdutf8)return this._rdutf8;var e=this.dutf8,r=[];for(var n in e.geometryArrays)for(var i=e.geometryArrays[n],o=0;o<i.length;o++){var a=i[o];r.push(a)}var s=0;r.forEach(function(e,r){if(r>0)for(var n=0,i=e.indices.length;n<i;n++)e.indices[n]+=s;s+=e.attributes.length/t.stride});var u=r.reduce(function(t,e){return t+e.attributes.length},0),f=new Float32Array(u),c=r.reduce(function(t,e){return t+e.indices.length},0),h=new Uint32Array(c),l=[],d=0,p=0;c>0?r.forEach(function(t,e){f.set(t.attributes,d),h.set(t.indices,p),l.push({start:p,count:t.indices.length,materialName:t.materialName}),d+=t.attributes.length,p+=t.indices.length}):r.forEach(function(e,r){f.set(e.attributes,d),l.push({start:d,count:e.attributes.length/t.stride,materialName:e.materialName}),d+=e.attributes.length});var g=e.materialParams,y=e.imageStrings;this._clearDutf8();var m={groups:l};h.length>0&&(m.index=h);for(var b=u/this.stride,w=this.decodeParams.decodeTarget,_=this.decodeParams.decodeFormat,A=[0],k=1;k<_.length;k++)A[k]=A[k-1]+_[k-1];var E={};w.forEach(function(e,r){var n=v[e],i=A[r];if(n){var o=function(t,e,r,n,i){for(var o=new Float32Array(r*i),a=0,s=n*i,u=e;u<s;u+=n)for(var f=0;f<r;f++)o[a++]=t[u+f];return o}(f,i,n,t.stride,b);E[e]=o}}),m.attributes=E;var x=function(t){var e=[-1/0,-1/0,-1/0],r=[1/0,1/0,1/0];if(!t)return{max:[0,0,0],min:[0,0,0]};for(var n=0,i=t.length;n<i;n+=3)for(var o=0;o<3;o++){var a=t[n+o];a>e[o]&&(e[o]=a),a<r[o]&&(r[o]=a)}return{max:e,min:r}}(E.position);return E=null,f=null,{geometry:m,materials:g,images:y,bbox:x}}},{key:"imageStrings",get:function(){var t=this,e={},r=["map_Ka","map_Kd","map_Ks"],n=function(n){var i=t.manifest.materials[n];r.forEach(function(r){var n=i[r];(function(t,e){return t&&"string"==typeof t&&t.length>0&&e[t]&&"string"==typeof e[t]})(n,t.utf8)&&(e[n]=t.utf8[n])})};for(var i in this.manifest.materials)n(i);return e}},{key:"manifest",get:function(){var t=null;for(var e in this.utf8){var r=e.length;if(".txt"===e.substring(r-4)){t=e;break}}return t||console.error("UTF8Decoder::manifest missing."),Object.defineProperty(this,"manifest",{value:this.utf8[t],writable:!1,configurable:!0}),this.manifest}}])&&b(e.prototype,r),t}();function A(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var k=function t(e){var r=e.RangeDataList,n=e.UserCenter;A(this,t),r["File 0"]&&".osgjs"===r["File 0"]&&r["File 1"]&&".osgjs"===r["File 1"].substring(r["File 1"].length-6)||console.warn("Unexpected",r);var i=r["File 1"]?r["File 1"]:r["File 0"];this.fileName=i.replace(/\\.[^\\/.]+$/,".ab"),this.userCenter=n,this.estimatedBBox=null},E=function t(e){for(var r in A(this,t),e)e[r]&&(this[r]=e[r])},x=function t(e){var r=e.Indices,n=e.Vertex,i=e.TexCoord0,o=e.StateSet;A(this,t),this.Indices=r,this.Vertex=n,this.TexCoord0=i,this.StateSet=o},S=function t(e){var r=e.nextLevelParam,n=e.geometryList;A(this,t),this.nextLevelParam=r,this.geometryList=n};function T(t,e){("OpenSceneGraph 3.1.7"!==t.Generator&&"OpenSceneGraph 3.2.1"!==t.Generator||9!==t.Version)&&console.warn(t.Generator,"version: ",t.Version,"may not be supported."),e||console.warn("No OSG bin.");var r=function t(e,r){return e["osg.Node"]?function(e,r){return function(e,r,n){return e&&e instanceof Array&&e.length>0?e.reduce(function(e,r,i){var o,a,s=t(r,n),u=(a=s,{PagedLODList:(o=e).PagedLODList.concat(a.PagedLODList),GeometryList:o.GeometryList.concat(a.GeometryList)});return u},r):r}(e.Children,{PagedLODList:[],GeometryList:[]},r)}(e["osg.Node"],r):e["osg.PagedLOD"]?{PagedLODList:P(e["osg.PagedLOD"],r),GeometryList:[]}:e["osg.Geometry"]?{PagedLODList:[],GeometryList:B(e["osg.Geometry"],r)}:void console.error("Unknown structure",e)}(t,e);return Promise.resolve(r)}function P(t,e){var r=t.Children,n=t.RangeDataList,i=t.UserCenter,o=new k({RangeDataList:n,UserCenter:i}),a=function t(e,r,n){return e&&e instanceof Array&&e.length>0?e.reduce(function(e,r,i){var o=[];return r["osg.Node"]?o=t(r["osg.Node"].Children,[],n):r["osg.Geometry"]?o=[B(r["osg.Geometry"],n)]:(console.error("Unknown structure",r),o=[]),e.concat(o)},r):r}(r,[],e);return new S({nextLevelParam:o,geometryList:a})}function B(t,e){var r=a(t.PrimitiveSetList[0].DrawElementsUInt.Indices),n=a(t.VertexAttributeList.TexCoord0),i=a(t.VertexAttributeList.Vertex),o=new E(t.StateSet["osg.StateSet"]);return new x({Indices:r,TexCoord0:n,Vertex:i,StateSet:o});function a(t){var r,n=null;t.Array.Uint32Array?(n="Uint32Array",r=Uint32Array):t.Array.Float32Array?(n="Float32Array",r=Float32Array):console.error("Unknown Array Type");var i=t.Array[n];if(i.Elements)return new r(i.Elements);if(i.File){var o=t.ItemSize,a=i.Offset,s=i.Size,u=r.BYTES_PER_ELEMENT,f=o*u*s,c=new r(o*s),h=new DataView(e.buffer,a+e.byteOffset,f),l=0,d=c.length;if("Uint32Array"===n)for(;l<d;l++)c[l]=h.getUint32(l*u,!0);else if("Float32Array"===n)for(;l<d;l++)c[l]=h.getFloat32(l*u,!0);return h=null,c}}}function R(t){for(var e=[-1/0,-1/0,-1/0],r=[1/0,1/0,1/0],n=0,i=t.length;n<i;n+=3)for(var o=0;o<3;o++){var a=t[n+o];a>e[o]&&(e[o]=a),a<r[o]&&(r[o]=a)}return{max:e,min:r}}function U(t){for(var e=t[0].max,r=t[0].min,n=1,i=t.length;n<i;n++)for(var o=t[n],a=0;a<3;a++)o.max[a]>e[a]&&(e[a]=o.max[a]),o.min[a]<r[a]&&(r[a]=o.min[a]);return{max:e,min:r}}function O(t){var e=t.url,r=t.trials;return m({url:e,trials:void 0===r?3:r,timeout:t.timeout}).then(function(t){return function(t){var e=null,r={},n=null,i=null;for(var o in t){var a=o.length;".osgjs"===o.substring(a-6)?e=t[o]:".jpg"===o.substring(a-4)?r[o]=t[o]:".json"===o.substring(a-5)?n=t[o]:".bin"===o.substring(a-4)&&(i=t[o])}return e?Promise.all([T(e,i),r,n]).then(function(t){var e=function(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!e||r.length!==e);n=!0);}catch(t){i=!0,o=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}return r}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}(t,3),r=e[0],n=r.GeometryList,i=r.PagedLODList,o=e[1],a=e[2],s=[],u=[],f=null;if(i.length>0){var c=[];i.forEach(function(t){var e=t.geometryList,r=t.nextLevelParam;e.length>0?(r.estimatedBBox=U(e.map(function(t){return R(t.Vertex)})),s.push(r),u=u.concat(e),c.push(r.estimatedBBox)):console.error("Empty pagedLOD.")}),f=U(c)}else n.length>0?f=U((u=n).map(function(t){return R(t.Vertex)})):console.error("Empty OsgJson.");var h=function(t){if(0!==t.length){var e={},r=[],n={};t.forEach(function(t,e){var i,o=u(t.StateSet),a=(i=t.StateSet).TextureAttributeList&&i.TextureAttributeList[0]&&i.TextureAttributeList[0][0]&&i.TextureAttributeList[0][0]["osg.Texture"]&&i.TextureAttributeList[0][0]["osg.Texture"].File&&i.TextureAttributeList[0][0]["osg.Texture"].File.length>0?i.TextureAttributeList[0][0]["osg.Texture"].File:void 0;if(void 0!==n[o]){var s=n[o];!r[s].map_Kd&&a&&(r[s].map_Kd=a,delete r[s].Kd)}else{var f=r.length;n[o]=f,r[f]={Ka:[0,0,0],Ks:[0,0,0],d:1,Ns:0},a?r[f].map_Kd=a:r[f].Kd=[255,255,255]}});var i=[],o=0,a=[];for(var s in t.forEach(function(t){a.push(o),o+=t.Vertex.length/3}),t.forEach(function(t,e){o=a[e];for(var r=0,s=t.Indices.length;r<s;r++)t.Indices[r]+=o;i.push({start:o,count:t.Indices.length,materialIndex:n[u(t.StateSet)]})}),t[0])"StateSet"!==s&&(e[s]=C(t,s));return{osgGeometry:new x(e),groups:i,materials:r}}function u(t){return t.UniqueID}console.error("Empty osg geometry")}(u),l={osgGeometry:h.osgGeometry,groups:h.groups,materials:h.materials,nextLevelParams:s,images:o,bbox:f,meta:a};return Promise.resolve(l)}).then(function(t){return Promise.resolve(t)}):Promise.reject(new Error("No osgjs."))}(t)})}function C(t,e){var r=new(0,t[0][e].constructor)(t.reduce(function(t,r){return t+r[e].length},0)),n=0;return t.forEach(function(t){t[e]&&(r.set(t[e],n),n+=t[e].length)}),r}function L(t){var e=t.url,r=t.timeout;switch(t.modelType){case"OSG":return O({url:e,timeout:r});default:return m({url:e,timeout:r}).then(function(t){var r=new _({resourceKey:e,utf8:t}),n=r.rdutf8;return r.destruct(),n})}}n.d(r,"downloadAB",function(){return L})}])}).call(this,r(3).Buffer)},function(t,e){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(t){"object"==typeof window&&(r=window)}t.exports=r},function(t,e,r){"use strict";r.r(e);var n=r(0);r(7),onmessage=function(t){var e=t.data.resourceKey,r=t.data.timeout,i=t.data.modelType;switch(i){case"OSG":return Object(n.downloadAB)({url:e,timeout:r,modelType:i}).then(function(t){postMessage({resourceKey:e,modelType:i,status:1,payload:t})}).catch(function(t){console.warn("osg worker",e,t),postMessage({resourceKey:e,modelType:i,status:0,payload:t.message})});default:return Object(n.downloadAB)({url:e,timeout:r}).then(function(t){var r=t.geometry.attributes,n=[];for(var o in t.geometry.index&&t.geometry.index.buffer&&n.push(t.geometry.index.buffer),r)r[o]&&r[o].buffer&&n.push(r[o].buffer);postMessage({resourceKey:e,modelType:i,status:200,payload:t},n),0!==t.geometry.attributes.position.buffer.byteLength&&console.warn("Transfer geometry failed.")}).catch(function(t){if("downloadEntries"===t.message)postMessage({resourceKey:e,modelType:i,status:-1,payload:t});else{var r=parseInt(t.message,10);postMessage({resourceKey:e,modelType:i,status:r,payload:{message:t.message}})}})}},onerror=function(t){throw console.error("BundleLoader onerror",t),t}},function(t,e,r){"use strict";(function(t){\n/*!\n * The buffer module from node.js, for the browser.\n *\n * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>\n * @license  MIT\n */\nvar n=r(4),i=r(5),o=r(6);function a(){return u.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function s(t,e){if(a()<e)throw new RangeError("Invalid typed array length");return u.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e)).__proto__=u.prototype:(null===t&&(t=new u(e)),t.length=e),t}function u(t,e,r){if(!(u.TYPED_ARRAY_SUPPORT||this instanceof u))return new u(t,e,r);if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return h(this,t)}return f(this,t,e,r)}function f(t,e,r,n){if("number"==typeof e)throw new TypeError(\'"value" argument must not be a number\');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?function(t,e,r,n){if(e.byteLength,r<0||e.byteLength<r)throw new RangeError("\'offset\' is out of bounds");if(e.byteLength<r+(n||0))throw new RangeError("\'length\' is out of bounds");e=void 0===r&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,r):new Uint8Array(e,r,n);u.TYPED_ARRAY_SUPPORT?(t=e).__proto__=u.prototype:t=l(t,e);return t}(t,e,r,n):"string"==typeof e?function(t,e,r){"string"==typeof r&&""!==r||(r="utf8");if(!u.isEncoding(r))throw new TypeError(\'"encoding" must be a valid string encoding\');var n=0|p(e,r),i=(t=s(t,n)).write(e,r);i!==n&&(t=t.slice(0,i));return t}(t,e,r):function(t,e){if(u.isBuffer(e)){var r=0|d(e.length);return 0===(t=s(t,r)).length?t:(e.copy(t,0,0,r),t)}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||(n=e.length)!=n?s(t,0):l(t,e);if("Buffer"===e.type&&o(e.data))return l(t,e.data)}var n;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,e)}function c(t){if("number"!=typeof t)throw new TypeError(\'"size" argument must be a number\');if(t<0)throw new RangeError(\'"size" argument must not be negative\')}function h(t,e){if(c(e),t=s(t,e<0?0:0|d(e)),!u.TYPED_ARRAY_SUPPORT)for(var r=0;r<e;++r)t[r]=0;return t}function l(t,e){var r=e.length<0?0:0|d(e.length);t=s(t,r);for(var n=0;n<r;n+=1)t[n]=255&e[n];return t}function d(t){if(t>=a())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+a().toString(16)+" bytes");return 0|t}function p(t,e){if(u.isBuffer(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var r=t.length;if(0===r)return 0;for(var n=!1;;)switch(e){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return j(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return Y(t).length;default:if(n)return j(t).length;e=(""+e).toLowerCase(),n=!0}}function g(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function y(t,e,r,n,i){if(0===t.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=i?0:t.length-1),r<0&&(r=t.length+r),r>=t.length){if(i)return-1;r=t.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof e&&(e=u.from(e,n)),u.isBuffer(e))return 0===e.length?-1:m(t,e,r,n,i);if("number"==typeof e)return e&=255,u.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(t,e,r):Uint8Array.prototype.lastIndexOf.call(t,e,r):m(t,[e],r,n,i);throw new TypeError("val must be string, number or Buffer")}function m(t,e,r,n,i){var o,a=1,s=t.length,u=e.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(t.length<2||e.length<2)return-1;a=2,s/=2,u/=2,r/=2}function f(t,e){return 1===a?t[e]:t.readUInt16BE(e*a)}if(i){var c=-1;for(o=r;o<s;o++)if(f(t,o)===f(e,-1===c?0:o-c)){if(-1===c&&(c=o),o-c+1===u)return c*a}else-1!==c&&(o-=o-c),c=-1}else for(r+u>s&&(r=s-u),o=r;o>=0;o--){for(var h=!0,l=0;l<u;l++)if(f(t,o+l)!==f(e,l)){h=!1;break}if(h)return o}return-1}function v(t,e,r,n){r=Number(r)||0;var i=t.length-r;n?(n=Number(n))>i&&(n=i):n=i;var o=e.length;if(o%2!=0)throw new TypeError("Invalid hex string");n>o/2&&(n=o/2);for(var a=0;a<n;++a){var s=parseInt(e.substr(2*a,2),16);if(isNaN(s))return a;t[r+a]=s}return a}function b(t,e,r,n){return Z(j(e,t.length-r),t,r,n)}function w(t,e,r,n){return Z(function(t){for(var e=[],r=0;r<t.length;++r)e.push(255&t.charCodeAt(r));return e}(e),t,r,n)}function _(t,e,r,n){return w(t,e,r,n)}function A(t,e,r,n){return Z(Y(e),t,r,n)}function k(t,e,r,n){return Z(function(t,e){for(var r,n,i,o=[],a=0;a<t.length&&!((e-=2)<0);++a)r=t.charCodeAt(a),n=r>>8,i=r%256,o.push(i),o.push(n);return o}(e,t.length-r),t,r,n)}function E(t,e,r){return 0===e&&r===t.length?n.fromByteArray(t):n.fromByteArray(t.slice(e,r))}function x(t,e,r){r=Math.min(t.length,r);for(var n=[],i=e;i<r;){var o,a,s,u,f=t[i],c=null,h=f>239?4:f>223?3:f>191?2:1;if(i+h<=r)switch(h){case 1:f<128&&(c=f);break;case 2:128==(192&(o=t[i+1]))&&(u=(31&f)<<6|63&o)>127&&(c=u);break;case 3:o=t[i+1],a=t[i+2],128==(192&o)&&128==(192&a)&&(u=(15&f)<<12|(63&o)<<6|63&a)>2047&&(u<55296||u>57343)&&(c=u);break;case 4:o=t[i+1],a=t[i+2],s=t[i+3],128==(192&o)&&128==(192&a)&&128==(192&s)&&(u=(15&f)<<18|(63&o)<<12|(63&a)<<6|63&s)>65535&&u<1114112&&(c=u)}null===c?(c=65533,h=1):c>65535&&(c-=65536,n.push(c>>>10&1023|55296),c=56320|1023&c),n.push(c),i+=h}return function(t){var e=t.length;if(e<=S)return String.fromCharCode.apply(String,t);var r="",n=0;for(;n<e;)r+=String.fromCharCode.apply(String,t.slice(n,n+=S));return r}(n)}e.Buffer=u,e.SlowBuffer=function(t){+t!=t&&(t=0);return u.alloc(+t)},e.INSPECT_MAX_BYTES=50,u.TYPED_ARRAY_SUPPORT=void 0!==t.TYPED_ARRAY_SUPPORT?t.TYPED_ARRAY_SUPPORT:function(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()&&"function"==typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(t){return!1}}(),e.kMaxLength=a(),u.poolSize=8192,u._augment=function(t){return t.__proto__=u.prototype,t},u.from=function(t,e,r){return f(null,t,e,r)},u.TYPED_ARRAY_SUPPORT&&(u.prototype.__proto__=Uint8Array.prototype,u.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&u[Symbol.species]===u&&Object.defineProperty(u,Symbol.species,{value:null,configurable:!0})),u.alloc=function(t,e,r){return function(t,e,r,n){return c(e),e<=0?s(t,e):void 0!==r?"string"==typeof n?s(t,e).fill(r,n):s(t,e).fill(r):s(t,e)}(null,t,e,r)},u.allocUnsafe=function(t){return h(null,t)},u.allocUnsafeSlow=function(t){return h(null,t)},u.isBuffer=function(t){return!(null==t||!t._isBuffer)},u.compare=function(t,e){if(!u.isBuffer(t)||!u.isBuffer(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var r=t.length,n=e.length,i=0,o=Math.min(r,n);i<o;++i)if(t[i]!==e[i]){r=t[i],n=e[i];break}return r<n?-1:n<r?1:0},u.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(t,e){if(!o(t))throw new TypeError(\'"list" argument must be an Array of Buffers\');if(0===t.length)return u.alloc(0);var r;if(void 0===e)for(e=0,r=0;r<t.length;++r)e+=t[r].length;var n=u.allocUnsafe(e),i=0;for(r=0;r<t.length;++r){var a=t[r];if(!u.isBuffer(a))throw new TypeError(\'"list" argument must be an Array of Buffers\');a.copy(n,i),i+=a.length}return n},u.byteLength=p,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)g(this,e,e+1);return this},u.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)g(this,e,e+3),g(this,e+1,e+2);return this},u.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)g(this,e,e+7),g(this,e+1,e+6),g(this,e+2,e+5),g(this,e+3,e+4);return this},u.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?x(this,0,t):function(t,e,r){var n=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return B(this,e,r);case"utf8":case"utf-8":return x(this,e,r);case"ascii":return T(this,e,r);case"latin1":case"binary":return P(this,e,r);case"base64":return E(this,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return R(this,e,r);default:if(n)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),n=!0}}.apply(this,arguments)},u.prototype.equals=function(t){if(!u.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===u.compare(this,t)},u.prototype.inspect=function(){var t="",r=e.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,r).match(/.{2}/g).join(" "),this.length>r&&(t+=" ... ")),"<Buffer "+t+">"},u.prototype.compare=function(t,e,r,n,i){if(!u.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===r&&(r=t?t.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),e<0||r>t.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&e>=r)return 0;if(n>=i)return-1;if(e>=r)return 1;if(this===t)return 0;for(var o=(i>>>=0)-(n>>>=0),a=(r>>>=0)-(e>>>=0),s=Math.min(o,a),f=this.slice(n,i),c=t.slice(e,r),h=0;h<s;++h)if(f[h]!==c[h]){o=f[h],a=c[h];break}return o<a?-1:a<o?1:0},u.prototype.includes=function(t,e,r){return-1!==this.indexOf(t,e,r)},u.prototype.indexOf=function(t,e,r){return y(this,t,e,r,!0)},u.prototype.lastIndexOf=function(t,e,r){return y(this,t,e,r,!1)},u.prototype.write=function(t,e,r,n){if(void 0===e)n="utf8",r=this.length,e=0;else if(void 0===r&&"string"==typeof e)n=e,r=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(r)?(r|=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-e;if((void 0===r||r>i)&&(r=i),t.length>0&&(r<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var o=!1;;)switch(n){case"hex":return v(this,t,e,r);case"utf8":case"utf-8":return b(this,t,e,r);case"ascii":return w(this,t,e,r);case"latin1":case"binary":return _(this,t,e,r);case"base64":return A(this,t,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return k(this,t,e,r);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var S=4096;function T(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(127&t[i]);return n}function P(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(t[i]);return n}function B(t,e,r){var n=t.length;(!e||e<0)&&(e=0),(!r||r<0||r>n)&&(r=n);for(var i="",o=e;o<r;++o)i+=F(t[o]);return i}function R(t,e,r){for(var n=t.slice(e,r),i="",o=0;o<n.length;o+=2)i+=String.fromCharCode(n[o]+256*n[o+1]);return i}function U(t,e,r){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>r)throw new RangeError("Trying to access beyond buffer length")}function O(t,e,r,n,i,o){if(!u.isBuffer(t))throw new TypeError(\'"buffer" argument must be a Buffer instance\');if(e>i||e<o)throw new RangeError(\'"value" argument is out of bounds\');if(r+n>t.length)throw new RangeError("Index out of range")}function C(t,e,r,n){e<0&&(e=65535+e+1);for(var i=0,o=Math.min(t.length-r,2);i<o;++i)t[r+i]=(e&255<<8*(n?i:1-i))>>>8*(n?i:1-i)}function L(t,e,r,n){e<0&&(e=4294967295+e+1);for(var i=0,o=Math.min(t.length-r,4);i<o;++i)t[r+i]=e>>>8*(n?i:3-i)&255}function I(t,e,r,n,i,o){if(r+n>t.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function D(t,e,r,n,o){return o||I(t,0,r,4),i.write(t,e,r,n,23,4),r+4}function M(t,e,r,n,o){return o||I(t,0,r,8),i.write(t,e,r,n,52,8),r+8}u.prototype.slice=function(t,e){var r,n=this.length;if((t=~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),(e=void 0===e?n:~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),e<t&&(e=t),u.TYPED_ARRAY_SUPPORT)(r=this.subarray(t,e)).__proto__=u.prototype;else{var i=e-t;r=new u(i,void 0);for(var o=0;o<i;++o)r[o]=this[o+t]}return r},u.prototype.readUIntLE=function(t,e,r){t|=0,e|=0,r||U(t,e,this.length);for(var n=this[t],i=1,o=0;++o<e&&(i*=256);)n+=this[t+o]*i;return n},u.prototype.readUIntBE=function(t,e,r){t|=0,e|=0,r||U(t,e,this.length);for(var n=this[t+--e],i=1;e>0&&(i*=256);)n+=this[t+--e]*i;return n},u.prototype.readUInt8=function(t,e){return e||U(t,1,this.length),this[t]},u.prototype.readUInt16LE=function(t,e){return e||U(t,2,this.length),this[t]|this[t+1]<<8},u.prototype.readUInt16BE=function(t,e){return e||U(t,2,this.length),this[t]<<8|this[t+1]},u.prototype.readUInt32LE=function(t,e){return e||U(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},u.prototype.readUInt32BE=function(t,e){return e||U(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},u.prototype.readIntLE=function(t,e,r){t|=0,e|=0,r||U(t,e,this.length);for(var n=this[t],i=1,o=0;++o<e&&(i*=256);)n+=this[t+o]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*e)),n},u.prototype.readIntBE=function(t,e,r){t|=0,e|=0,r||U(t,e,this.length);for(var n=e,i=1,o=this[t+--n];n>0&&(i*=256);)o+=this[t+--n]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*e)),o},u.prototype.readInt8=function(t,e){return e||U(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},u.prototype.readInt16LE=function(t,e){e||U(t,2,this.length);var r=this[t]|this[t+1]<<8;return 32768&r?4294901760|r:r},u.prototype.readInt16BE=function(t,e){e||U(t,2,this.length);var r=this[t+1]|this[t]<<8;return 32768&r?4294901760|r:r},u.prototype.readInt32LE=function(t,e){return e||U(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},u.prototype.readInt32BE=function(t,e){return e||U(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},u.prototype.readFloatLE=function(t,e){return e||U(t,4,this.length),i.read(this,t,!0,23,4)},u.prototype.readFloatBE=function(t,e){return e||U(t,4,this.length),i.read(this,t,!1,23,4)},u.prototype.readDoubleLE=function(t,e){return e||U(t,8,this.length),i.read(this,t,!0,52,8)},u.prototype.readDoubleBE=function(t,e){return e||U(t,8,this.length),i.read(this,t,!1,52,8)},u.prototype.writeUIntLE=function(t,e,r,n){(t=+t,e|=0,r|=0,n)||O(this,t,e,r,Math.pow(2,8*r)-1,0);var i=1,o=0;for(this[e]=255&t;++o<r&&(i*=256);)this[e+o]=t/i&255;return e+r},u.prototype.writeUIntBE=function(t,e,r,n){(t=+t,e|=0,r|=0,n)||O(this,t,e,r,Math.pow(2,8*r)-1,0);var i=r-1,o=1;for(this[e+i]=255&t;--i>=0&&(o*=256);)this[e+i]=t/o&255;return e+r},u.prototype.writeUInt8=function(t,e,r){return t=+t,e|=0,r||O(this,t,e,1,255,0),u.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},u.prototype.writeUInt16LE=function(t,e,r){return t=+t,e|=0,r||O(this,t,e,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):C(this,t,e,!0),e+2},u.prototype.writeUInt16BE=function(t,e,r){return t=+t,e|=0,r||O(this,t,e,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):C(this,t,e,!1),e+2},u.prototype.writeUInt32LE=function(t,e,r){return t=+t,e|=0,r||O(this,t,e,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):L(this,t,e,!0),e+4},u.prototype.writeUInt32BE=function(t,e,r){return t=+t,e|=0,r||O(this,t,e,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):L(this,t,e,!1),e+4},u.prototype.writeIntLE=function(t,e,r,n){if(t=+t,e|=0,!n){var i=Math.pow(2,8*r-1);O(this,t,e,r,i-1,-i)}var o=0,a=1,s=0;for(this[e]=255&t;++o<r&&(a*=256);)t<0&&0===s&&0!==this[e+o-1]&&(s=1),this[e+o]=(t/a>>0)-s&255;return e+r},u.prototype.writeIntBE=function(t,e,r,n){if(t=+t,e|=0,!n){var i=Math.pow(2,8*r-1);O(this,t,e,r,i-1,-i)}var o=r-1,a=1,s=0;for(this[e+o]=255&t;--o>=0&&(a*=256);)t<0&&0===s&&0!==this[e+o+1]&&(s=1),this[e+o]=(t/a>>0)-s&255;return e+r},u.prototype.writeInt8=function(t,e,r){return t=+t,e|=0,r||O(this,t,e,1,127,-128),u.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},u.prototype.writeInt16LE=function(t,e,r){return t=+t,e|=0,r||O(this,t,e,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):C(this,t,e,!0),e+2},u.prototype.writeInt16BE=function(t,e,r){return t=+t,e|=0,r||O(this,t,e,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):C(this,t,e,!1),e+2},u.prototype.writeInt32LE=function(t,e,r){return t=+t,e|=0,r||O(this,t,e,4,2147483647,-2147483648),u.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):L(this,t,e,!0),e+4},u.prototype.writeInt32BE=function(t,e,r){return t=+t,e|=0,r||O(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),u.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):L(this,t,e,!1),e+4},u.prototype.writeFloatLE=function(t,e,r){return D(this,t,e,!0,r)},u.prototype.writeFloatBE=function(t,e,r){return D(this,t,e,!1,r)},u.prototype.writeDoubleLE=function(t,e,r){return M(this,t,e,!0,r)},u.prototype.writeDoubleBE=function(t,e,r){return M(this,t,e,!1,r)},u.prototype.copy=function(t,e,r,n){if(r||(r=0),n||0===n||(n=this.length),e>=t.length&&(e=t.length),e||(e=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),t.length-e<n-r&&(n=t.length-e+r);var i,o=n-r;if(this===t&&r<e&&e<n)for(i=o-1;i>=0;--i)t[i+e]=this[i+r];else if(o<1e3||!u.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)t[i+e]=this[i+r];else Uint8Array.prototype.set.call(t,this.subarray(r,r+o),e);return o},u.prototype.fill=function(t,e,r,n){if("string"==typeof t){if("string"==typeof e?(n=e,e=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),1===t.length){var i=t.charCodeAt(0);i<256&&(t=i)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!u.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<r)throw new RangeError("Out of range index");if(r<=e)return this;var o;if(e>>>=0,r=void 0===r?this.length:r>>>0,t||(t=0),"number"==typeof t)for(o=e;o<r;++o)this[o]=t;else{var a=u.isBuffer(t)?t:j(new u(t,n).toString()),s=a.length;for(o=0;o<r-e;++o)this[o+e]=a[o%s]}return this};var N=/[^+\\/0-9A-Za-z-_]/g;function F(t){return t<16?"0"+t.toString(16):t.toString(16)}function j(t,e){var r;e=e||1/0;for(var n=t.length,i=null,o=[],a=0;a<n;++a){if((r=t.charCodeAt(a))>55295&&r<57344){if(!i){if(r>56319){(e-=3)>-1&&o.push(239,191,189);continue}if(a+1===n){(e-=3)>-1&&o.push(239,191,189);continue}i=r;continue}if(r<56320){(e-=3)>-1&&o.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(e-=3)>-1&&o.push(239,191,189);if(i=null,r<128){if((e-=1)<0)break;o.push(r)}else if(r<2048){if((e-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((e-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function Y(t){return n.toByteArray(function(t){if((t=function(t){return t.trim?t.trim():t.replace(/^\\s+|\\s+$/g,"")}(t).replace(N,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function Z(t,e,r,n){for(var i=0;i<n&&!(i+r>=e.length||i>=t.length);++i)e[i+r]=t[i];return i}}).call(this,r(1))},function(t,e,r){"use strict";e.byteLength=function(t){var e=f(t),r=e[0],n=e[1];return 3*(r+n)/4-n},e.toByteArray=function(t){for(var e,r=f(t),n=r[0],a=r[1],s=new o(function(t,e,r){return 3*(e+r)/4-r}(0,n,a)),u=0,c=a>0?n-4:n,h=0;h<c;h+=4)e=i[t.charCodeAt(h)]<<18|i[t.charCodeAt(h+1)]<<12|i[t.charCodeAt(h+2)]<<6|i[t.charCodeAt(h+3)],s[u++]=e>>16&255,s[u++]=e>>8&255,s[u++]=255&e;2===a&&(e=i[t.charCodeAt(h)]<<2|i[t.charCodeAt(h+1)]>>4,s[u++]=255&e);1===a&&(e=i[t.charCodeAt(h)]<<10|i[t.charCodeAt(h+1)]<<4|i[t.charCodeAt(h+2)]>>2,s[u++]=e>>8&255,s[u++]=255&e);return s},e.fromByteArray=function(t){for(var e,r=t.length,i=r%3,o=[],a=0,s=r-i;a<s;a+=16383)o.push(c(t,a,a+16383>s?s:a+16383));1===i?(e=t[r-1],o.push(n[e>>2]+n[e<<4&63]+"==")):2===i&&(e=(t[r-2]<<8)+t[r-1],o.push(n[e>>10]+n[e>>4&63]+n[e<<2&63]+"="));return o.join("")};for(var n=[],i=[],o="undefined"!=typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,u=a.length;s<u;++s)n[s]=a[s],i[a.charCodeAt(s)]=s;function f(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=t.indexOf("=");return-1===r&&(r=e),[r,r===e?0:4-r%4]}function c(t,e,r){for(var i,o,a=[],s=e;s<r;s+=3)i=(t[s]<<16&16711680)+(t[s+1]<<8&65280)+(255&t[s+2]),a.push(n[(o=i)>>18&63]+n[o>>12&63]+n[o>>6&63]+n[63&o]);return a.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(t,e){e.read=function(t,e,r,n,i){var o,a,s=8*i-n-1,u=(1<<s)-1,f=u>>1,c=-7,h=r?i-1:0,l=r?-1:1,d=t[e+h];for(h+=l,o=d&(1<<-c)-1,d>>=-c,c+=s;c>0;o=256*o+t[e+h],h+=l,c-=8);for(a=o&(1<<-c)-1,o>>=-c,c+=n;c>0;a=256*a+t[e+h],h+=l,c-=8);if(0===o)o=1-f;else{if(o===u)return a?NaN:1/0*(d?-1:1);a+=Math.pow(2,n),o-=f}return(d?-1:1)*a*Math.pow(2,o-n)},e.write=function(t,e,r,n,i,o){var a,s,u,f=8*o-i-1,c=(1<<f)-1,h=c>>1,l=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,d=n?0:o-1,p=n?1:-1,g=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,a=c):(a=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-a))<1&&(a--,u*=2),(e+=a+h>=1?l/u:l*Math.pow(2,1-h))*u>=2&&(a++,u/=2),a+h>=c?(s=0,a=c):a+h>=1?(s=(e*u-1)*Math.pow(2,i),a+=h):(s=e*Math.pow(2,h-1)*Math.pow(2,i),a=0));i>=8;t[r+d]=255&s,d+=p,s/=256,i-=8);for(a=a<<i|s,f+=i;f>0;t[r+d]=255&a,d+=p,a/=256,f-=8);t[r+d-p]|=128*g}},function(t,e){var r={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==r.call(t)}},function(t,e,r){(function(e,r){t.exports=function(){"use strict";function t(t){return"function"==typeof t}function n(){var t=setTimeout;return function(){return t(i,1)}}function i(){for(var t=0;t<v;t+=2){var e=T[t],r=T[t+1];e(r),T[t]=void 0,T[t+1]=void 0}v=0}function o(t,e){var r=this,n=new this.constructor(s);void 0===n[B]&&y(n);var i=r._state;if(i){var o=arguments[i-1];_(function(){return g(i,n,o,r._result)})}else d(r,n,t,e);return n}function a(t){if(t&&"object"==typeof t&&t.constructor===this)return t;var e=new this(s);return f(e,t),e}function s(){}function u(e,r,n){r.constructor===e.constructor&&n===o&&r.constructor.resolve===a?function(t,e){e._state===U?h(t,e._result):e._state===O?l(t,e._result):d(e,void 0,function(e){return f(t,e)},function(e){return l(t,e)})}(e,r):void 0===n?h(e,r):t(n)?function(t,e,r){_(function(t){var n=!1,i=function(t,e,r,n){try{t.call(e,r,n)}catch(t){return t}}(r,e,function(r){n||(n=!0,e!==r?f(t,r):h(t,r))},function(e){n||(n=!0,l(t,e))},t._label);!n&&i&&(n=!0,l(t,i))},t)}(e,r,n):h(e,r)}function f(t,e){if(t===e)l(t,new TypeError("You cannot resolve a promise with itself"));else if(function(t){var e=typeof t;return null!==t&&("object"===e||"function"===e)}(e)){var r=void 0;try{r=e.then}catch(e){return void l(t,e)}u(t,e,r)}else h(t,e)}function c(t){t._onerror&&t._onerror(t._result),p(t)}function h(t,e){t._state===R&&(t._result=e,t._state=U,0!==t._subscribers.length&&_(p,t))}function l(t,e){t._state===R&&(t._state=O,t._result=e,_(c,t))}function d(t,e,r,n){var i=t._subscribers,o=i.length;t._onerror=null,i[o]=e,i[o+U]=r,i[o+O]=n,0===o&&t._state&&_(p,t)}function p(t){var e=t._subscribers,r=t._state;if(0!==e.length){for(var n=void 0,i=void 0,o=t._result,a=0;a<e.length;a+=3)n=e[a],i=e[a+r],n?g(r,n,i,o):i(o);t._subscribers.length=0}}function g(e,r,n,i){var o=t(n),a=void 0,s=void 0,u=!0;if(o){try{a=n(i)}catch(t){u=!1,s=t}if(r===a)return void l(r,new TypeError("A promises callback cannot return that same promise."))}else a=i;r._state!==R||(o&&u?f(r,a):!1===u?l(r,s):e===U?h(r,a):e===O&&l(r,a))}function y(t){t[B]=C++,t._state=void 0,t._result=void 0,t._subscribers=[]}var m=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},v=0,b=void 0,w=void 0,_=function(t,e){T[v]=t,T[v+1]=e,2===(v+=2)&&(w?w(i):P())},A="undefined"!=typeof window?window:void 0,k=A||{},E=k.MutationObserver||k.WebKitMutationObserver,x="undefined"==typeof self&&void 0!==e&&"[object process]"==={}.toString.call(e),S="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,T=new Array(1e3),P=void 0;P=x?function(){return e.nextTick(i)}:E?function(){var t=0,e=new E(i),r=document.createTextNode("");return e.observe(r,{characterData:!0}),function(){r.data=t=++t%2}}():S?function(){var t=new MessageChannel;return t.port1.onmessage=i,function(){return t.port2.postMessage(0)}}():void 0===A?function(){try{var t=Function("return this")().require("vertx");return void 0!==(b=t.runOnLoop||t.runOnContext)?function(){b(i)}:n()}catch(t){return n()}}():n();var B=Math.random().toString(36).substring(2),R=void 0,U=1,O=2,C=0,L=function(){function t(t,e){this._instanceConstructor=t,this.promise=new t(s),this.promise[B]||y(this.promise),m(e)?(this.length=e.length,this._remaining=e.length,this._result=new Array(this.length),0===this.length?h(this.promise,this._result):(this.length=this.length||0,this._enumerate(e),0===this._remaining&&h(this.promise,this._result))):l(this.promise,new Error("Array Methods must be provided an Array"))}return t.prototype._enumerate=function(t){for(var e=0;this._state===R&&e<t.length;e++)this._eachEntry(t[e],e)},t.prototype._eachEntry=function(t,e){var r=this._instanceConstructor,n=r.resolve;if(n===a){var i=void 0,f=void 0,c=!1;try{i=t.then}catch(t){c=!0,f=t}if(i===o&&t._state!==R)this._settledAt(t._state,e,t._result);else if("function"!=typeof i)this._remaining--,this._result[e]=t;else if(r===I){var h=new r(s);c?l(h,f):u(h,t,i),this._willSettleAt(h,e)}else this._willSettleAt(new r(function(e){return e(t)}),e)}else this._willSettleAt(n(t),e)},t.prototype._settledAt=function(t,e,r){var n=this.promise;n._state===R&&(this._remaining--,t===O?l(n,r):this._result[e]=r),0===this._remaining&&h(n,this._result)},t.prototype._willSettleAt=function(t,e){var r=this;d(t,void 0,function(t){return r._settledAt(U,e,t)},function(t){return r._settledAt(O,e,t)})},t}(),I=function(){function e(t){this[B]=C++,this._result=this._state=void 0,this._subscribers=[],s!==t&&("function"!=typeof t&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof e?function(t,e){try{e(function(e){f(t,e)},function(e){l(t,e)})}catch(e){l(t,e)}}(this,t):function(){throw new TypeError("Failed to construct \'Promise\': Please use the \'new\' operator, this object constructor cannot be called as a function.")}())}return e.prototype.catch=function(t){return this.then(null,t)},e.prototype.finally=function(e){var r=this,n=r.constructor;return t(e)?r.then(function(t){return n.resolve(e()).then(function(){return t})},function(t){return n.resolve(e()).then(function(){throw t})}):r.then(e,e)},e}();return I.prototype.then=o,I.all=function(t){return new L(this,t).promise},I.race=function(t){var e=this;return new e(m(t)?function(r,n){for(var i=t.length,o=0;o<i;o++)e.resolve(t[o]).then(r,n)}:function(t,e){return e(new TypeError("You must pass an array to race."))})},I.resolve=a,I.reject=function(t){var e=new this(s);return l(e,t),e},I._setScheduler=function(t){w=t},I._setAsap=function(t){_=t},I._asap=_,I.polyfill=function(){var t=void 0;if(void 0!==r)t=r;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var e=t.Promise;if(e){var n=null;try{n=Object.prototype.toString.call(e.resolve())}catch(t){}if("[object Promise]"===n&&!e.cast)return}t.Promise=I},I.Promise=I,I.polyfill(),I}()}).call(this,r(8),r(1))},function(t,e){var r,n,i=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(t){if(r===setTimeout)return setTimeout(t,0);if((r===o||!r)&&setTimeout)return r=setTimeout,setTimeout(t,0);try{return r(t,0)}catch(e){try{return r.call(null,t,0)}catch(e){return r.call(this,t,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:o}catch(t){r=o}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(t){n=a}}();var u,f=[],c=!1,h=-1;function l(){c&&u&&(c=!1,u.length?f=u.concat(f):h=-1,f.length&&d())}function d(){if(!c){var t=s(l);c=!0;for(var e=f.length;e;){for(u=f,f=[];++h<e;)u&&u[h].run();h=-1,e=f.length}u=null,c=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(t)}}function p(t,e){this.fun=t,this.array=e}function g(){}i.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];f.push(new p(t,e)),1!==f.length||c||s(d)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.prependListener=g,i.prependOnceListener=g,i.listeners=function(t){return[]},i.binding=function(t){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(t){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}}]);',r.p+"bf35598781e2d3572153.worker.js")}},function(e,t,r){"use strict";var n=window.URL||window.webkitURL;e.exports=function(e,t){try{try{var r;try{(r=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder)).append(e),r=r.getBlob()}catch(t){r=new Blob([e])}return new Worker(n.createObjectURL(r))}catch(t){return new Worker("data:application/javascript,"+encodeURIComponent(e))}}catch(e){if(!t)throw Error("Inline worker is not supported");return new Worker(t)}}},function(e){e.exports={name:"altizure-gl-engine",version:"3.1.7",description:"Altizure webgl engine",main:"./release/altizure-gl-engine.min.js",scripts:{lint:"eslint ./src/","check-types":"tsc",test:"jest ./test/",testAll:"jest ./test/ && jest ./testOnline/",release:"rm -rf ./release/* && webpack --display-modules --config webpack.config.release.js",debug:"rm -rf ./build/* && webpack --config webpack.config.debug.js",build:"npm run debug",release_win:"webpack --config webpack.config.release.js",build_win:"webpack --config webpack.config.debug.js",doc:"jsdoc -c ./docs/jsdoc.tui.dev.json -r ./src/","setup-examples":"ln -s ../engine.examples/ engine.examples",example:"cp ./release/altizure-gl-engine.min.js ./engine.examples/public/js/altizure-gl-engine.min.js",prepublishOnly:"yarn && yarn release && npm version patch",postpublish:"git push origin v3",push:"git push origin beta && git push github beta && git push gitlab beta","debug:loader":"cp ../altizure-binary-loader/build/altizure-binary-loader.js ../altizure/node_modules/altizure-gl-engine/release/altizure-gl-engine.min.js && cp ./build/altizure-gl-engine.js.map ../altizure/node_modules/altizure-gl-engine/release/altizure-gl-engine.min.js.map && cd ../altizure && yarn build"},repository:{type:"git",url:"git+ssh://git@bitbucket.org/jingbo/altizure.gl-engine2.git"},keywords:["altizure","webgl","engine"],author:"Jingbo LIU",license:"ISC",homepage:"https://bitbucket.org/jingbo/altizure.gl-engine2#readme",devDependencies:{"@babel/cli":"^7.4.4","@babel/core":"^7.4.5","@babel/plugin-proposal-class-properties":"^7.5.0","@babel/plugin-proposal-decorators":"^7.4.4","@babel/plugin-proposal-object-rest-spread":"^7.5.4","@babel/preset-env":"^7.4.5","@babel/preset-stage-2":"^7.0.0","@babel/preset-typescript":"^7.3.3","awesome-typescript-loader":"^5.2.1","babel-eslint":"^10.0.2","babel-jest":"^24.8.0","babel-loader":"^8.0.6","es6-promise":"^4.2.8",eslint:"^5.16.0","eslint-config-standard":"^12.0.0-alpha.0","eslint-plugin-import":"^2.17.3","eslint-plugin-node":"^9.1.0","eslint-plugin-promise":"^4.1.1","eslint-plugin-standard":"^4.0.0",jest:"^24.8.0",jsdoc:"^3.6.3",path:"^0.12.7","regenerator-runtime":"^0.12.1","source-map-loader":"^0.2.4","tui-jsdoc-template":"^1.2.2",typescript:"^3.5.2",webpack:"^4.17.0","webpack-bundle-analyzer":"^2.11.2","webpack-cli":"^3.1.0"},peerDependencies:{},dependencies:{"@ald/altizure-binary-loader":"^0.0.10",axios:"0.18.1",cmask:"^1.2.0","crypto-js":"^3.1.9-1",lscache:"^1.3.0","normalize-path":"^3.0.0",three:"0.97.0","worker-loader":"^2.0.0"}}},function(e,t,r){var n;e.exports=(n=r(1),r(18),r(2),r(11),r(21),function(){var e=n,t=e.lib.BlockCipher,r=e.algo,i=[],o=[],a=[],s=[],u=[],c=[],l=[],f=[],h=[],p=[];!function(){for(var e=[],t=0;t<256;t++)e[t]=t<128?t<<1:t<<1^283;var r=0,n=0;for(t=0;t<256;t++){var d=n^n<<1^n<<2^n<<3^n<<4;d=d>>>8^255&d^99,i[r]=d,o[d]=r;var v=e[r],y=e[v],m=e[y],g=257*e[d]^16843008*d;a[r]=g<<24|g>>>8,s[r]=g<<16|g>>>16,u[r]=g<<8|g>>>24,c[r]=g,g=16843009*m^65537*y^257*v^16843008*r,l[d]=g<<24|g>>>8,f[d]=g<<16|g>>>16,h[d]=g<<8|g>>>24,p[d]=g,r?(r=v^e[e[e[m^v]]],n^=e[e[n]]):r=n=1}}();var d=[0,1,2,4,8,16,32,64,128,27,54],v=r.AES=t.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var e=this._keyPriorReset=this._key,t=e.words,r=e.sigBytes/4,n=4*((this._nRounds=r+6)+1),o=this._keySchedule=[],a=0;a<n;a++)if(a<r)o[a]=t[a];else{var s=o[a-1];a%r?r>6&&a%r==4&&(s=i[s>>>24]<<24|i[s>>>16&255]<<16|i[s>>>8&255]<<8|i[255&s]):(s=i[(s=s<<8|s>>>24)>>>24]<<24|i[s>>>16&255]<<16|i[s>>>8&255]<<8|i[255&s],s^=d[a/r|0]<<24),o[a]=o[a-r]^s}for(var u=this._invKeySchedule=[],c=0;c<n;c++)a=n-c,s=c%4?o[a]:o[a-4],u[c]=c<4||a<=4?s:l[i[s>>>24]]^f[i[s>>>16&255]]^h[i[s>>>8&255]]^p[i[255&s]]}},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,a,s,u,c,i)},decryptBlock:function(e,t){var r=e[t+1];e[t+1]=e[t+3],e[t+3]=r,this._doCryptBlock(e,t,this._invKeySchedule,l,f,h,p,o),r=e[t+1],e[t+1]=e[t+3],e[t+3]=r},_doCryptBlock:function(e,t,r,n,i,o,a,s){for(var u=this._nRounds,c=e[t]^r[0],l=e[t+1]^r[1],f=e[t+2]^r[2],h=e[t+3]^r[3],p=4,d=1;d<u;d++){var v=n[c>>>24]^i[l>>>16&255]^o[f>>>8&255]^a[255&h]^r[p++],y=n[l>>>24]^i[f>>>16&255]^o[h>>>8&255]^a[255&c]^r[p++],m=n[f>>>24]^i[h>>>16&255]^o[c>>>8&255]^a[255&l]^r[p++],g=n[h>>>24]^i[c>>>16&255]^o[l>>>8&255]^a[255&f]^r[p++];c=v,l=y,f=m,h=g}v=(s[c>>>24]<<24|s[l>>>16&255]<<16|s[f>>>8&255]<<8|s[255&h])^r[p++],y=(s[l>>>24]<<24|s[f>>>16&255]<<16|s[h>>>8&255]<<8|s[255&c])^r[p++],m=(s[f>>>24]<<24|s[h>>>16&255]<<16|s[c>>>8&255]<<8|s[255&l])^r[p++],g=(s[h>>>24]<<24|s[c>>>16&255]<<16|s[l>>>8&255]<<8|s[255&f])^r[p++],e[t]=v,e[t+1]=y,e[t+2]=m,e[t+3]=g},keySize:8});e.AES=t._createHelper(v)}(),n.AES)},function(e,t,r){var n;e.exports=(n=r(1),n.enc.Utf8)},function(e,t,r){var n,i,o;i=[e,t],void 0===(o="function"==typeof(n=function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={decodeNumMat:function(e){for(var t=e.width,r=e.height,n=e.data,i=this.decodeNumArray(n),o=0,a=[],s=0;s<t;s++){a[s]=[];for(var u=0;u<r;u++)a[s][u]=i[o],o++}return a},encodeNumMat:function(e){for(var t=e.length,r=e[0].length,n=[],i=0;i<t;i++)for(var o=0;o<r;o++)n.push(e[i][o]);var a=this.encodeNumArray(n);return{width:t,height:r,data:a}},_firstChar:48,decodeNumArray:function(e){var t,r=[],n=[];for(t=0;t<e.length;t+=3){var i=e.charAt(t).charCodeAt()-this._firstChar,o=e.charAt(t+1).charCodeAt()-this._firstChar,a=e.charAt(t+2).charCodeAt()-this._firstChar;n.push(63&i>>2),n.push((3&i)<<4|15&o>>4),n.push((15&o)<<2|3&a>>6),n.push(63&a)}for(t=0;t<n.length;t++)63!==n[t]&&r.push(n[t]);return r},encodeNumArray:function(e){for(var t=[],r=0;r<e.length;r+=4){var n=e[r],i=r+1<e.length?e[r+1]:63,o=r+2<e.length?e[r+2]:63,a=r+3<e.length?e[r+3]:63;this.encodeSet(n,i,o,a,t)}return this.stringFromArray(t)},stringFromArray:function(e){for(var t="",r=0;r<e.length;r++)t+=e[r];return t},encodeSet:function(e,t,r,n,i){var o=String.fromCharCode;i.push(o(((63&e)<<2|3&t>>4)+this._firstChar)),i.push(o(((15&t)<<4|15&r>>2)+this._firstChar)),i.push(o(((3&r)<<6|63&n)+this._firstChar))},pack_boolean:function(e){for(var t={width:e.length,height:e[0].length,data:[]},r=0,n=!1,i=0;i<e.length;i++)for(var o=0;o<e[i].length;o++)e[i][o]===n?r++:e[i][o]===!n?(t.data.push(r),n=!n,r=1):console.warn("Error: unknown entry ["+i+","+o+"]="+e[i][o]);return t.data.push(r),t},unpack_boolean:function(e){function t(e,t,n,i){for(var a=n,s=e,u=t;a--;)o[s][u]=i,++u===r&&(s++,u=0);return{row:s,col:u}}for(var r=e.width,n=e.height,i=e.data,o=[],a=n;a--;)o[a]=[];var s=!1;a=0;for(var u=0,c=0;c<i.length;c+=16)for(var l=0;l<16;++l){var f=i[l+c],h=t(a,u,f,s);a=h.row,u=h.col,s=!s}return o},unpackToImage:function(e){function t(e,t,n,i){for(var a=n,s=e,u=t,c=4*(s*r+u);a--;)o[c]=o[c+1]=o[c+2]=o[c+3]=i,c+=4,++u===r&&(s++,u=0);return{row:s,col:u}}for(var r=e.width,n=e.height,i=e.data,o=new Uint8ClampedArray(r*n*4),a=0,s=!1,u=0,c=0,l=0;l<i.length;l+=16)for(var f=0;f<16;++f){var h=i[f+l],p=t(u,c,h,s?255:0);u=p.row,c=p.col,a+=!0===s?1:0,s=!s}var d={rgba:o,cntWhite:a};return d},downsampleImage:function(e,t,r,n){for(var i=Math.floor,o=i(t*n),a=i(r*n),s=new Uint8ClampedArray(o*a*4),u=0,c=0,l=0,f=0;f<a;++f)for(var h=0;h<o;++h)l=4*(f/n*t+h/n),s[c=4*(f*o+h)]=e[l],s[c+1]=e[l+1],s[c+2]=e[l+2],s[c+3]=e[l+3],u+=0===s[c]?0:1;return{rgba:s,cntWhite:u}}},e.exports=t.default})?n.apply(t,i):n)||(e.exports=o)},function(e,t,r){var n,i,o,a,s,u,c,l;e.exports=(n=r(1),r(19),r(20),o=(i=n).lib,a=o.Base,s=o.WordArray,u=i.algo,c=u.MD5,l=u.EvpKDF=a.extend({cfg:a.extend({keySize:4,hasher:c,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var r=this.cfg,n=r.hasher.create(),i=s.create(),o=i.words,a=r.keySize,u=r.iterations;o.length<a;){c&&n.update(c);var c=n.update(e).finalize(t);n.reset();for(var l=1;l<u;l++)c=n.finalize(c),n.reset();i.concat(c)}return i.sigBytes=4*a,i}}),i.EvpKDF=function(e,t,r){return l.create(r).compute(e,t)},n.EvpKDF)},function(e,t,r){var n,i,o;i=[],void 0===(o="function"==typeof(n=function(){var e,t,r="lscache-",n="-cacheexpiration",i=10,o=6e4,a=w(o),s="",u=!1;function c(){var t="__lscachetest__";if(void 0!==e)return e;try{if(!localStorage)return!1}catch(e){return!1}try{v(t,"__lscachetest__"),y(t),e=!0}catch(t){e=!(!l(t)||!localStorage.length)}return e}function l(e){return e&&("QUOTA_EXCEEDED_ERR"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name||"QuotaExceededError"===e.name)}function f(){return void 0===t&&(t=null!=window.JSON),t}function h(e){return e+n}function p(){return Math.floor((new Date).getTime()/o)}function d(e){return localStorage.getItem(r+s+e)}function v(e,t){localStorage.removeItem(r+s+e),localStorage.setItem(r+s+e,t)}function y(e){localStorage.removeItem(r+s+e)}function m(e){for(var t=new RegExp("^"+r+s.replace(/[[\]{}()*+?.\\^$|]/g,"\\$&")+"(.*)"),i=localStorage.length-1;i>=0;--i){var o=localStorage.key(i);(o=(o=o&&o.match(t))&&o[1])&&o.indexOf(n)<0&&e(o,h(o))}}function g(e){var t=h(e);y(e),y(t)}function b(e){var t=h(e),r=d(t);if(r){var n=parseInt(r,i);if(p()>=n)return y(e),y(t),!0}}function _(e,t){u&&"console"in window&&"function"==typeof window.console.warn&&(window.console.warn("lscache - "+e),t&&window.console.warn("lscache - The error was: "+t.message))}function w(e){return Math.floor(864e13/e)}return{set:function(e,t,r){if(!c())return!1;if(!f())return!1;try{t=JSON.stringify(t)}catch(e){return!1}try{v(e,t)}catch(r){if(!l(r))return _("Could not add item with key '"+e+"'",r),!1;var n,o=[];m(function(e,t){var r=d(t);r=r?parseInt(r,i):a,o.push({key:e,size:(d(e)||"").length,expiration:r})}),o.sort(function(e,t){return t.expiration-e.expiration});for(var s=(t||"").length;o.length&&s>0;)n=o.pop(),_("Cache is full, removing item with key '"+e+"'"),g(n.key),s-=n.size;try{v(e,t)}catch(t){return _("Could not add item with key '"+e+"', perhaps it's too big?",t),!1}}return r?v(h(e),(p()+r).toString(i)):y(h(e)),!0},get:function(e){if(!c())return null;if(b(e))return null;var t=d(e);if(!t||!f())return t;try{return JSON.parse(t)}catch(e){return t}},remove:function(e){c()&&g(e)},supported:function(){return c()},flush:function(){c()&&m(function(e){g(e)})},flushExpired:function(){c()&&m(function(e){b(e)})},setBucket:function(e){s=e},resetBucket:function(){s=""},getExpiryMilliseconds:function(){return o},setExpiryMilliseconds:function(e){a=w(o=e)},enableWarnings:function(e){u=e}}})?n.apply(t,i):n)||(e.exports=o)},function(e,t,r){e.exports=function(){return r(6)('!function(t){var e={};function i(r){if(e[r])return e[r].exports;var n=e[r]={i:r,l:!1,exports:{}};return t[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(r,n,function(e){return t[e]}.bind(null,n));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=3)}([function(t,e,i){(function(e,i){t.exports=function(){"use strict";function t(t){return"function"==typeof t}function r(){var t=setTimeout;return function(){return t(n,1)}}function n(){for(var t=0;t<y;t+=2){var e=S[t],i=S[t+1];e(i),S[t]=void 0,S[t+1]=void 0}y=0}function o(t,e){var i=this,r=new this.constructor(a);void 0===r[T]&&p(r);var n=i._state;if(n){var o=arguments[n-1];w(function(){return v(n,r,o,i._result)})}else l(i,r,t,e);return r}function s(t){if(t&&"object"==typeof t&&t.constructor===this)return t;var e=new this(a);return u(e,t),e}function a(){}function h(e,i,r){i.constructor===e.constructor&&r===o&&i.constructor.resolve===s?function(t,e){e._state===A?_(t,e._result):e._state===P?f(t,e._result):l(e,void 0,function(e){return u(t,e)},function(e){return f(t,e)})}(e,i):void 0===r?_(e,i):t(r)?function(t,e,i){w(function(t){var r=!1,n=function(t,e,i,r){try{t.call(e,i,r)}catch(t){return t}}(i,e,function(i){r||(r=!0,e!==i?u(t,i):_(t,i))},function(e){r||(r=!0,f(t,e))},t._label);!r&&n&&(r=!0,f(t,n))},t)}(e,i,r):_(e,i)}function u(t,e){if(t===e)f(t,new TypeError("You cannot resolve a promise with itself"));else if(function(t){var e=typeof t;return null!==t&&("object"===e||"function"===e)}(e)){var i=void 0;try{i=e.then}catch(e){return void f(t,e)}h(t,e,i)}else _(t,e)}function c(t){t._onerror&&t._onerror(t._result),g(t)}function _(t,e){t._state===k&&(t._result=e,t._state=A,0!==t._subscribers.length&&w(g,t))}function f(t,e){t._state===k&&(t._state=P,t._result=e,w(c,t))}function l(t,e,i,r){var n=t._subscribers,o=n.length;t._onerror=null,n[o]=e,n[o+A]=i,n[o+P]=r,0===o&&t._state&&w(g,t)}function g(t){var e=t._subscribers,i=t._state;if(0!==e.length){for(var r=void 0,n=void 0,o=t._result,s=0;s<e.length;s+=3)r=e[s],n=e[s+i],r?v(i,r,n,o):n(o);t._subscribers.length=0}}function v(e,i,r,n){var o=t(r),s=void 0,a=void 0,h=!0;if(o){try{s=r(n)}catch(t){h=!1,a=t}if(i===s)return void f(i,new TypeError("A promises callback cannot return that same promise."))}else s=n;i._state!==k||(o&&h?u(i,s):!1===h?f(i,a):e===A?_(i,s):e===P&&f(i,s))}function p(t){t[T]=j++,t._state=void 0,t._result=void 0,t._subscribers=[]}var d=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},y=0,m=void 0,b=void 0,w=function(t,e){S[y]=t,S[y+1]=e,2===(y+=2)&&(b?b(n):N())},x="undefined"!=typeof window?window:void 0,M=x||{},z=M.MutationObserver||M.WebKitMutationObserver,q="undefined"==typeof self&&void 0!==e&&"[object process]"==={}.toString.call(e),E="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,S=new Array(1e3),N=void 0;N=q?function(){return e.nextTick(n)}:z?function(){var t=0,e=new z(n),i=document.createTextNode("");return e.observe(i,{characterData:!0}),function(){i.data=t=++t%2}}():E?function(){var t=new MessageChannel;return t.port1.onmessage=n,function(){return t.port2.postMessage(0)}}():void 0===x?function(){try{var t=Function("return this")().require("vertx");return void 0!==(m=t.runOnLoop||t.runOnContext)?function(){m(n)}:r()}catch(t){return r()}}():r();var T=Math.random().toString(36).substring(2),k=void 0,A=1,P=2,j=0,O=function(){function t(t,e){this._instanceConstructor=t,this.promise=new t(a),this.promise[T]||p(this.promise),d(e)?(this.length=e.length,this._remaining=e.length,this._result=new Array(this.length),0===this.length?_(this.promise,this._result):(this.length=this.length||0,this._enumerate(e),0===this._remaining&&_(this.promise,this._result))):f(this.promise,new Error("Array Methods must be provided an Array"))}return t.prototype._enumerate=function(t){for(var e=0;this._state===k&&e<t.length;e++)this._eachEntry(t[e],e)},t.prototype._eachEntry=function(t,e){var i=this._instanceConstructor,r=i.resolve;if(r===s){var n=void 0,u=void 0,c=!1;try{n=t.then}catch(t){c=!0,u=t}if(n===o&&t._state!==k)this._settledAt(t._state,e,t._result);else if("function"!=typeof n)this._remaining--,this._result[e]=t;else if(i===I){var _=new i(a);c?f(_,u):h(_,t,n),this._willSettleAt(_,e)}else this._willSettleAt(new i(function(e){return e(t)}),e)}else this._willSettleAt(r(t),e)},t.prototype._settledAt=function(t,e,i){var r=this.promise;r._state===k&&(this._remaining--,t===P?f(r,i):this._result[e]=i),0===this._remaining&&_(r,this._result)},t.prototype._willSettleAt=function(t,e){var i=this;l(t,void 0,function(t){return i._settledAt(A,e,t)},function(t){return i._settledAt(P,e,t)})},t}(),I=function(){function e(t){this[T]=j++,this._result=this._state=void 0,this._subscribers=[],a!==t&&("function"!=typeof t&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof e?function(t,e){try{e(function(e){u(t,e)},function(e){f(t,e)})}catch(e){f(t,e)}}(this,t):function(){throw new TypeError("Failed to construct \'Promise\': Please use the \'new\' operator, this object constructor cannot be called as a function.")}())}return e.prototype.catch=function(t){return this.then(null,t)},e.prototype.finally=function(e){var i=this,r=i.constructor;return t(e)?i.then(function(t){return r.resolve(e()).then(function(){return t})},function(t){return r.resolve(e()).then(function(){throw t})}):i.then(e,e)},e}();return I.prototype.then=o,I.all=function(t){return new O(this,t).promise},I.race=function(t){var e=this;return new e(d(t)?function(i,r){for(var n=t.length,o=0;o<n;o++)e.resolve(t[o]).then(i,r)}:function(t,e){return e(new TypeError("You must pass an array to race."))})},I.resolve=s,I.reject=function(t){var e=new this(a);return f(e,t),e},I._setScheduler=function(t){b=t},I._setAsap=function(t){w=t},I._asap=w,I.polyfill=function(){var t=void 0;if(void 0!==i)t=i;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var e=t.Promise;if(e){var r=null;try{r=Object.prototype.toString.call(e.resolve())}catch(t){}if("[object Promise]"===r&&!e.cast)return}t.Promise=I},I.Promise=I,I.polyfill(),I}()}).call(this,i(1),i(2))},function(t,e){var i,r,n=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(t){if(i===setTimeout)return setTimeout(t,0);if((i===o||!i)&&setTimeout)return i=setTimeout,setTimeout(t,0);try{return i(t,0)}catch(e){try{return i.call(null,t,0)}catch(e){return i.call(this,t,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:o}catch(t){i=o}try{r="function"==typeof clearTimeout?clearTimeout:s}catch(t){r=s}}();var h,u=[],c=!1,_=-1;function f(){c&&h&&(c=!1,h.length?u=h.concat(u):_=-1,u.length&&l())}function l(){if(!c){var t=a(f);c=!0;for(var e=u.length;e;){for(h=u,u=[];++_<e;)h&&h[_].run();_=-1,e=u.length}h=null,c=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===s||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(t);try{r(t)}catch(e){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}(t)}}function g(t,e){this.fun=t,this.array=e}function v(){}n.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];u.push(new g(t,e)),1!==u.length||c||a(l)},g.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=v,n.addListener=v,n.once=v,n.off=v,n.removeListener=v,n.removeAllListeners=v,n.emit=v,n.prependListener=v,n.prependOnceListener=v,n.listeners=function(t){return[]},n.binding=function(t){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(t){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},function(t,e){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(t){"object"==typeof window&&(i=window)}t.exports=i},function(t,e,i){"use strict";i.r(e);var r=6378137,n=6356752.314245,o=40075016.68557849;function s(t,e,i){this.x=t||0,this.y=e||0,this.z=i||0}var a={constructor:s,isVector3:!0,clone:function(){return new this.constructor(this.x,this.y,this.z)},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},normalize:function(){return this.divideScalar(this.length()||1)},divideScalar:function(t){return this.multiplyScalar(1/t)},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},multiplyVectors:function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},cross:function(t,e){if(void 0!==e)return this.crossVectors(t,e);var i=this.x,r=this.y,n=this.z;return this.x=r*t.z-n*t.y,this.y=n*t.x-i*t.z,this.z=i*t.y-r*t.x,this},crossVectors:function(t,e){var i=t.x,r=t.y,n=t.z,o=e.x,s=e.y,a=e.z;return this.x=r*a-n*s,this.y=n*o-i*a,this.z=i*s-r*o,this}};for(var h in a)Object.prototype.hasOwnProperty.call(a,h)&&(s.prototype[h]=a[h]);var u=s;function c(t,e,i){var r=o/2,n=2*r/Math.pow(2,t),s=e*n-r,a=r-i*n;return{minX:s,minY:a-n,maxX:s+n,maxY:a}}function _(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function f(t){return t*(Math.PI/180)}function l(t){return t*(180/Math.PI)}var g=new(function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=e.a_,o=void 0===i?r:i,s=e.b_,a=void 0===s?n:s;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.a_=o,this.b_=a,this.f_=(this.a_-this.b_)/this.a_,this.f_inv_=1/this.f_,this.a_sq_=this.a_*this.a_,this.b_sq_=this.b_*this.b_,this.e_sq_=this.f_*(2-this.f_),this.eps_=this.e_sq_/(1-this.e_sq_),this.e_sqsq_=this.e_sq_*this.e_sq_,this.E_sq_=this.a_sq_-this.b_sq_,this.bda_sq_=1-this.e_sq_,this.perimeter_=this.a_*Math.PI,this.radii_inv=new u(1/this.a_sq_,1/this.a_sq_,1/this.b_sq_),this.wgs84_origin_=[0,0,0],this.ecef_origin_=[0,0,0],this.sin_lambda_origin_=0,this.cos_lambda_origin_=0,this.cos_phi_origin_=0,this.sin_phi_origin_=0}var e,i,o;return e=t,(i=[{key:"setWGS84Reference",value:function(t){this.wgs84_origin_=t;var e=this.wgs84_origin_[0],i=this.wgs84_origin_[1],r=this.wgs84_origin_[2],n=f(e),o=f(i);this.sin_lambda_origin_=Math.sin(n),this.cos_lambda_origin_=Math.cos(n),this.cos_phi_origin_=Math.cos(o),this.sin_phi_origin_=Math.sin(o);var s=Math.sin(n),a=this.a_/Math.sqrt(1-this.e_sq_*s*s);this.ecef_origin_[0]=(r+a)*this.cos_lambda_origin_*this.cos_phi_origin_,this.ecef_origin_[1]=(r+a)*this.cos_lambda_origin_*this.sin_phi_origin_,this.ecef_origin_[2]=(r+(1-this.e_sq_)*a)*this.sin_lambda_origin_}},{key:"setECEFReference",value:function(t){this.ecef_origin_=t;var e=this.ecef2Wgs84(this.ecef_origin_[0],this.ecef_origin_[1],this.ecef_origin_[2]),i=e.latitude,r=e.longitude,n=e.height,o=f(i),s=f(r);this.sin_lambda_origin_=Math.sin(o),this.cos_lambda_origin_=Math.cos(o),this.cos_phi_origin_=Math.cos(s),this.sin_phi_origin_=Math.sin(s),this.wgs84_origin_[0]=i,this.wgs84_origin_[1]=r,this.wgs84_origin_[2]=n}},{key:"wgs84Reference",value:function(){return this.wgs84_origin_}},{key:"ecefReference",value:function(){return this.ecef_origin_}},{key:"wgs842Ecef",value:function(t,e,i){var r=f(t),n=f(e),o=Math.sin(r),s=this.a_/Math.sqrt(1-this.e_sq_*o*o),a=Math.sin(r),h=Math.cos(r);return{x:(i+s)*h*Math.cos(n),y:(i+s)*h*Math.sin(n),z:(i+(1-this.e_sq_)*s)*a}}},{key:"ecef2Wgs84",value:function(t,e,i){var r=t*t+e*e,n=Math.sqrt(r),o=i*i,s=54*this.b_sq_*o,a=r+this.bda_sq_*o-this.e_sq_*this.E_sq_,h=a*a,u=this.e_sqsq_*s*r/h/a,c=Math.pow(1+u+Math.sqrt(u*u+2*u),1/3),_=c+1/c+1,f=s/3/_/_/h,g=Math.sqrt(1+2*this.e_sqsq_*f),v=-f*this.e_sq_*n/(1+g)+Math.sqrt(this.a_sq_*(1+1/g)/2-f*this.bda_sq_*o/(g+1)/g-f*r/2),p=n-this.e_sq_*v;p*=p;var d=Math.sqrt(p+o),y=Math.sqrt(p+this.bda_sq_*o),m=this.b_sq_*i/this.a_/y,b=d*(1-this.b_sq_/this.a_/y),w=Math.atan2(i+this.eps_*m,n),x=Math.atan2(e,t);return{latitude:l(w),longitude:l(x),height:b}}},{key:"ecef2Enu",value:function(t,e,i){var r=t-this.ecef_origin_[0],n=e-this.ecef_origin_[1],o=i-this.ecef_origin_[2];return{xEast:-this.sin_phi_origin_*r+this.cos_phi_origin_*n,yNorth:-this.cos_phi_origin_*this.sin_lambda_origin_*r-this.sin_lambda_origin_*this.sin_phi_origin_*n+this.cos_lambda_origin_*o,zUp:this.cos_lambda_origin_*this.cos_phi_origin_*r+this.cos_lambda_origin_*this.sin_phi_origin_*n+this.sin_lambda_origin_*o}}},{key:"enu2Ecef",value:function(t,e,i){var r=-this.sin_phi_origin_*t-this.cos_phi_origin_*this.sin_lambda_origin_*e+this.cos_lambda_origin_*this.cos_phi_origin_*i,n=this.cos_phi_origin_*t-this.sin_lambda_origin_*this.sin_phi_origin_*e+this.cos_lambda_origin_*this.sin_phi_origin_*i,o=this.cos_lambda_origin_*e+this.sin_lambda_origin_*i;return{x:r+this.ecef_origin_[0],y:n+this.ecef_origin_[1],z:o+this.ecef_origin_[2]}}},{key:"wgs842Enu",value:function(t,e,i){var r=this.wgs842Ecef(t,e,i),n=r.x,o=r.y,s=r.z,a=this.ecef2Enu(n,o,s);return{xEast:a.xEast,yNorth:a.yNorth,zUp:a.zUp}}},{key:"enu2Wgs84",value:function(t,e,i){var r=this.enu2Ecef(t,e,i),n=r.x,o=r.y,s=r.z,a=this.ecef2Wgs84(n,o,s);return{latitude:a.latitude,longitude:a.longitude,height:a.height}}},{key:"wgs842WebMercator",value:function(t,e){var i=e*this.perimeter_/180,r=Math.log(Math.tan((90+t)*Math.PI/360))/(Math.PI/180);return{x:i,y:r=r*this.perimeter_/180}}},{key:"webMercator2Wgs84",value:function(t,e){var i=t/this.perimeter_*180,r=e/this.perimeter_*180;return{latitude:r=180/Math.PI*(2*Math.atan(Math.exp(r*Math.PI/180))-Math.PI/2),longitude:i}}},{key:"ecef2WebMercator",value:function(t,e,i){var r=this.ecef2Wgs84(t,e,i),n=r.latitude,o=r.longitude,s=r.height,a=this.wgs842WebMercator(n,o,s);return{x:a.x,y:a.y,z:s}}},{key:"webMercator2Ecef",value:function(t,e,i){var r=this.webMercator2Wgs84(t,e),n=r.latitude,o=r.longitude,s=i,a=this.wgs842Ecef(n,o,s);return{x:a.x,y:a.y,z:a.z}}},{key:"load",value:function(t){var e=JSON.parse(t);this.wgs84_origin_=e.wgs84_origin,this.ecef_origin_=e.ecef_origin,this.sin_lambda_origin_=e.sin_lambda_origin,this.cos_lambda_origin_=e.cos_lambda_origin,this.cos_phi_origin_=e.cos_phi_origin,this.sin_phi_origin_=e.sin_phi_origin}},{key:"save",value:function(){var t={wgs84_origin:this.wgs84_origin_,ecef_origin:this.ecef_origin_,sin_lambda_origin:this.sin_lambda_origin_,cos_lambda_origin:this.cos_lambda_origin_,cos_phi_origin:this.cos_phi_origin_,sin_phi_origin:this.sin_phi_origin_};return JSON.stringify(t)}},{key:"toSRSString",value:function(){if(0===this.ecef_origin_[0]&&0===this.ecef_origin_[1]&&0===this.ecef_origin_[2])return"";return 0===this.wgs84_origin_[2]?"ENU:".concat(this.wgs84_origin_[0],",").concat(this.wgs84_origin_[1]):"ENU:".concat(this.wgs84_origin_[0],",").concat(this.wgs84_origin_[1],",").concat(this.wgs84_origin_[2])}},{key:"fromSRSString",value:function(t){var e=t.split(":");if(2!==e.length&&"ENU"!==e[0])return!1;var i=e[1].split(",");if(2!==i.length&&3!==i.length)return!1;var r=parseFloat(i[0]),n=parseFloat(i[1]),o=0;return 3===i.length&&(o=parseFloat(i[2])),!(r<-90||r>90)&&(!(n<-180||n>180)&&(this.setWGS84Reference([r,n,o]),!0))}},{key:"getENUSystem",value:function(t,e,i){void 0!==i&&console.warn("ENU is always on oblate surface, not affected by the altitude.");var r=this.wgs842Ecef(t,e,0),n=new u(r.x,r.y,r.z);0===n.lengthSq()&&(n.z=1);var o=this.geodeticSurfaceNormal(n),s=new u(0,0,1),a=(new u).crossVectors(s,o);0===a.lengthSq()&&(a=new u(1,0,0)),a.normalize();var h=(new u).crossVectors(o,a);return h.normalize(),{east:a,up:o,north:h,origin:n}}},{key:"geodeticSurfaceNormal",value:function(t){var e=(new u).multiplyVectors(this.radii_inv,t);return e.normalize(),e}}])&&_(e.prototype,i),o&&_(e,o),t}());function v(t){for(var e=[-1/0,-1/0,-1/0],i=[1/0,1/0,1/0],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.length;r<n;r+=3)for(var o=0;o<3;o++){var s=t[r+o];s>e[o]&&(e[o]=s),s<i[o]&&(i[o]=s)}return{max:e,min:i}}var p=32;function d(t,e,i,r,n){return{u:(e+r)/t,v:(i+n)/t}}function y(t,e,i,r,n){return{u:t*r-e,v:t*n-i}}var m=25e3,b=2,w=3;function x(t,e,i,r,n){var o;r?o=function(t){var e=t.level,i=t.x,r=t.y,n=t.demResource,o=t.demImageData,s=t.segment,a=void 0===s?p:s;n.level<0&&(n={level:0,x:0,y:0});for(var h,u,_=c(e,i,r),f=_.minX,l=_.minY,m=_.maxX,b=_.maxY,w=new Float32Array((a+1)*(a+1)*3+4*(a+1)*3),x=(m-f)/a,M=(b-l)/a,z=[],q=[],E=[],S=[],N=o.width,T=o.height,k=Math.pow(2,e),A=Math.pow(2,n.level),P=0;P<=a;P++){z.push(m-P*x),q.push(l+P*M),h=d(k,i,r,1-P/a,1-P/a),u=y(A,n.x,n.y,h.u,h.v);var j=Math.min(N-1,Math.max(u.u*N-.5,0)),O=Math.min(T-1,Math.max(u.v*T-.5,0));E.push(j),S.push(O)}for(var I=0,R=null,W=null,U=0,L=[0,0,0],V=0;V<=a;V++)for(var F=0;F<=a;F++)R=g.webMercator2Ecef(z[F],q[V],0),W=g.geodeticSurfaceNormal(R),Mt(o,E[F],S[V],L),U=.1*(256*L[0]*256+256*L[1]+L[2])-1e4,(isNaN(R.x)||isNaN(R.y)||isNaN(R.z))&&console.error("p",R),(isNaN(W.x)||isNaN(W.y)||isNaN(W.z))&&console.error("n",W),isNaN(U)&&console.error("ele",U),w[I]=R.x+U*W.x,w[I+1]=R.y+U*W.y,w[I+2]=R.z+U*W.z,I+=3;for(var Y=new Uint32Array(a*a*6+4*a*6),C=0,X=0;X<a;X++)for(var K=0;K<a;K++){var B=(a+1)*X+K,D=(a+1)*(X+1)+K,G=D+1,H=B+1;Y[C++]=B,Y[C++]=D,Y[C++]=G,Y[C++]=G,Y[C++]=H,Y[C++]=B}for(var J=v(w,0,(a+1)*(a+1)*3),Q=0,Z=0;Z<3;Z++){var $=J.max[Z]-J.min[Z];Q=Math.max($,Q)}Q*=.1;var tt=0,et=0;for(et=0;et<=a;et++){R=g.webMercator2Ecef(z[et],q[tt],0),W=g.geodeticSurfaceNormal(R);var it=3*((a+1)*tt+et);w[I]=w[it]-W.x*Q,w[I+1]=w[it+1]-W.y*Q,w[I+2]=w[it+2]-W.z*Q,I+=3}for(tt=a,et=0;et<=a;et++){R=g.webMercator2Ecef(z[et],q[tt],0),W=g.geodeticSurfaceNormal(R);var rt=3*((a+1)*tt+et);w[I]=w[rt]-W.x*Q,w[I+1]=w[rt+1]-W.y*Q,w[I+2]=w[rt+2]-W.z*Q,I+=3}for(et=0,tt=0;tt<=a;tt++){R=g.webMercator2Ecef(z[et],q[tt],0),W=g.geodeticSurfaceNormal(R);var nt=3*((a+1)*tt+et);w[I]=w[nt]-W.x*Q,w[I+1]=w[nt+1]-W.y*Q,w[I+2]=w[nt+2]-W.z*Q,I+=3}for(et=a,tt=0;tt<=a;tt++){R=g.webMercator2Ecef(z[et],q[tt],0),W=g.geodeticSurfaceNormal(R);var ot=3*((a+1)*tt+et);w[I]=w[ot]-W.x*Q,w[I+1]=w[ot+1]-W.y*Q,w[I+2]=w[ot+2]-W.z*Q,I+=3}var st=(a+1)*(a+1);for(tt=0,et=0;et<a;et++){var at=st,ht=(a+1)*tt+et,ut=ht+1,ct=at+1;st+=1,Y[C++]=at,Y[C++]=ht,Y[C++]=ut,Y[C++]=ut,Y[C++]=ct,Y[C++]=at}for(st+=1,tt=a,et=0;et<a;et++){var _t=(a+1)*tt+et,ft=st,lt=ft+1,gt=_t+1;st+=1,Y[C++]=_t,Y[C++]=ft,Y[C++]=lt,Y[C++]=lt,Y[C++]=gt,Y[C++]=_t}for(st+=1,et=0,tt=0;tt<a;tt++){var vt=st,pt=st+1,dt=(a+1)*tt+et,yt=dt+(a+1);st+=1,Y[C++]=vt,Y[C++]=pt,Y[C++]=yt,Y[C++]=yt,Y[C++]=dt,Y[C++]=vt}for(st+=1,et=a,tt=0;tt<a;tt++){var mt=(a+1)*tt+et,bt=mt+(a+1),wt=st,xt=st+1;st+=1,Y[C++]=mt,Y[C++]=bt,Y[C++]=xt,Y[C++]=xt,Y[C++]=wt,Y[C++]=mt}return{position:w,index:Y,boundingBox:J};function Mt(t,e,i,r){for(var n=Math.min(N-1,Math.max(Math.floor(e),0)),o=Math.min(T-1,Math.max(Math.floor(i),0)),s=n===N-1?n:n+1,a=o===T-1?o:o+1,h=e%1,u=i%1,c=4*(n+o*N),_=4*(s+o*N),f=4*(n+a*N),l=4*(s+a*N),g=t.data,v=0;v<3;v++){var p=(g[_++]-g[c])*h+g[c++],d=(g[l++]-g[f])*h+g[f++];r[v]=(d-p)*u+p}return r}}({level:t,x:e,y:i,demImageData:r,demResource:n}):o=function(t){var e=t.level,i=t.x,r=t.y,n=t.mapResource,o=t.segment,s=void 0===o?p:o,a=c(e,i,r),h=a.minX,u=a.minY,_=a.maxX,f=a.maxY,l=new Float32Array((s+1)*(s+1)*3),d=new Uint32Array(s*s*6),y=(_-h)/s,m=(f-u)/s;n||(n={level:e,x:i,y:r});for(var b=[],w=[],x=0;x<=s;x++)b.push(_-x*y),w.push(u+x*m);for(var M=0,z=null,q=0;q<=s;q++)for(var E=0;E<=s;E++)z=g.webMercator2Ecef(b[E],w[q],0),l[M=3*((s+1)*q+E)]=z.x,l[M+1]=z.y,l[M+2]=z.z;for(var S=0,N=0;N<s;N++)for(var T=0;T<s;T++){var k=(s+1)*N+T,A=(s+1)*(N+1)+T,P=A+1,j=k+1;d[S++]=k,d[S++]=A,d[S++]=P,d[S++]=P,d[S++]=j,d[S++]=k}return{position:l,index:d,boundingBox:v(l)}}({level:t,x:e,y:i,mapResource:{level:t,x:e,y:i}});return Promise.resolve(o)}i(0),onmessage=function(t){var e=this,i=t.data.action,r=t.data.resourceKey,n=t.data.params;if(i===w){var o=n.mapName;(function(t){if(!t)return Promise.reject(new Error("10086"));try{var e=new XMLHttpRequest;e.open("GET",t,!0),e.timeout=m,e.responseType="blob"}catch(e){return console.error("XML",t),Promise.reject(new Error("10087"))}return new Promise(function(t,i){e.onreadystatechange=function(){if(4===e.readyState)if(200===e.status){var r=new Blob([e.response],{type:e.response.type});createImageBitmap(r).then(function(e){t({bitmap:e,status:200})})}else i(new Error(e.status.toString()))},e.send()})})(n.url).then(function(t){var e=t.bitmap,i={status:t.status,resourceKey:r,payload:{bitmap:e,mapName:o}};postMessage(i,[e]),0!==i.payload.bitmap.height&&console.warn("Transfer ImageBitmap has problem.")}).catch(function(t){var e=parseInt(t.message,10);postMessage({status:e,resourceKey:r,payload:t.message})})}else if(i===b){x(n.level,n.x,n.y,n.demImageData,n.demResource).then(function(t){var i=t.position,n=t.index,o=[i.buffer,n.buffer];postMessage({resourceKey:r,status:200,payload:t},o),0===i.buffer.byteLength&&0===n.buffer.byteLength||e.console.warn("Transfer geometry has a problem")}).catch(function(t){console.error("planet worker",t),e.postMessage({resourceKey:r,status:0,payload:t.message})})}},onerror=function(t){throw console.error("PlanetTileLoader onerror",t),t}}]);',r.p+"df6be659fd63a1c87931.worker.js")}},function(e,t,r){e.exports=function(){return r(6)('!function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=1)}([function(e,t,r){var n;e.exports=function e(t,r,i){function o(s,f){if(!r[s]){if(!t[s]){var c="function"==typeof n&&n;if(!f&&c)return n(s,!0);if(a)return a(s,!0);var l=new Error("Cannot find module \'"+s+"\'");throw l.code="MODULE_NOT_FOUND",l}var h=r[s]={exports:{}};t[s][0].call(h.exports,function(e){return o(t[s][1][e]||e)},h,h.exports,e,t,r,i)}return r[s].exports}for(var a="function"==typeof n&&n,s=0;s<i.length;s++)o(i[s]);return o}({1:[function(e,t,r){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;r.assign=function(e){for(var t,r,n=Array.prototype.slice.call(arguments,1);n.length;){var i=n.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(var o in i)t=i,r=o,Object.prototype.hasOwnProperty.call(t,r)&&(e[o]=i[o])}}return e},r.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var i={arraySet:function(e,t,r,n,i){if(t.subarray&&e.subarray)e.set(t.subarray(r,r+n),i);else for(var o=0;o<n;o++)e[i+o]=t[r+o]},flattenChunks:function(e){var t,r,n,i,o,a;for(t=n=0,r=e.length;t<r;t++)n+=e[t].length;for(a=new Uint8Array(n),t=i=0,r=e.length;t<r;t++)o=e[t],a.set(o,i),i+=o.length;return a}},o={arraySet:function(e,t,r,n,i){for(var o=0;o<n;o++)e[i+o]=t[r+o]},flattenChunks:function(e){return[].concat.apply([],e)}};r.setTyped=function(e){e?(r.Buf8=Uint8Array,r.Buf16=Uint16Array,r.Buf32=Int32Array,r.assign(r,i)):(r.Buf8=Array,r.Buf16=Array,r.Buf32=Array,r.assign(r,o))},r.setTyped(n)},{}],2:[function(e,t,r){"use strict";var n=e("./common"),i=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch(e){i=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){o=!1}for(var a=new n.Buf8(256),s=0;s<256;s++)a[s]=252<=s?6:248<=s?5:240<=s?4:224<=s?3:192<=s?2:1;function f(e,t){if(t<65534&&(e.subarray&&o||!e.subarray&&i))return String.fromCharCode.apply(null,n.shrinkBuf(e,t));for(var r="",a=0;a<t;a++)r+=String.fromCharCode(e[a]);return r}a[254]=a[254]=1,r.string2buf=function(e){var t,r,i,o,a,s=e.length,f=0;for(o=0;o<s;o++)55296==(64512&(r=e.charCodeAt(o)))&&o+1<s&&56320==(64512&(i=e.charCodeAt(o+1)))&&(r=65536+(r-55296<<10)+(i-56320),o++),f+=r<128?1:r<2048?2:r<65536?3:4;for(t=new n.Buf8(f),o=a=0;a<f;o++)55296==(64512&(r=e.charCodeAt(o)))&&o+1<s&&56320==(64512&(i=e.charCodeAt(o+1)))&&(r=65536+(r-55296<<10)+(i-56320),o++),r<128?t[a++]=r:(r<2048?t[a++]=192|r>>>6:(r<65536?t[a++]=224|r>>>12:(t[a++]=240|r>>>18,t[a++]=128|r>>>12&63),t[a++]=128|r>>>6&63),t[a++]=128|63&r);return t},r.buf2binstring=function(e){return f(e,e.length)},r.binstring2buf=function(e){for(var t=new n.Buf8(e.length),r=0,i=t.length;r<i;r++)t[r]=e.charCodeAt(r);return t},r.buf2string=function(e,t){var r,n,i,o,s=t||e.length,c=new Array(2*s);for(r=n=0;r<s;)if((i=e[r++])<128)c[n++]=i;else if(4<(o=a[i]))c[n++]=65533,r+=o-1;else{for(i&=2===o?31:3===o?15:7;1<o&&r<s;)i=i<<6|63&e[r++],o--;1<o?c[n++]=65533:i<65536?c[n++]=i:(i-=65536,c[n++]=55296|i>>10&1023,c[n++]=56320|1023&i)}return f(c,n)},r.utf8border=function(e,t){var r;for((t=t||e.length)>e.length&&(t=e.length),r=t-1;0<=r&&128==(192&e[r]);)r--;return r<0?t:0===r?t:r+a[e[r]]>t?r:t}},{"./common":1}],3:[function(e,t,r){"use strict";t.exports=function(e,t,r,n){for(var i=65535&e|0,o=e>>>16&65535|0,a=0;0!==r;){for(r-=a=2e3<r?2e3:r;o=o+(i=i+t[n++]|0)|0,--a;);i%=65521,o%=65521}return i|o<<16|0}},{}],4:[function(e,t,r){"use strict";t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],5:[function(e,t,r){"use strict";var n=function(){for(var e,t=[],r=0;r<256;r++){e=r;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t}();t.exports=function(e,t,r,i){var o=n,a=i+r;e^=-1;for(var s=i;s<a;s++)e=e>>>8^o[255&(e^t[s])];return-1^e}},{}],6:[function(e,t,r){"use strict";t.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],7:[function(e,t,r){"use strict";t.exports=function(e,t){var r,n,i,o,a,s,f,c,l,h,u,d,p,b,m,w,v,g,y,k,_,x,E,A,S;r=e.state,n=e.next_in,A=e.input,i=n+(e.avail_in-5),o=e.next_out,S=e.output,a=o-(t-e.avail_out),s=o+(e.avail_out-257),f=r.dmax,c=r.wsize,l=r.whave,h=r.wnext,u=r.window,d=r.hold,p=r.bits,b=r.lencode,m=r.distcode,w=(1<<r.lenbits)-1,v=(1<<r.distbits)-1;e:do{p<15&&(d+=A[n++]<<p,p+=8,d+=A[n++]<<p,p+=8),g=b[d&w];t:for(;;){if(d>>>=y=g>>>24,p-=y,0==(y=g>>>16&255))S[o++]=65535&g;else{if(!(16&y)){if(0==(64&y)){g=b[(65535&g)+(d&(1<<y)-1)];continue t}if(32&y){r.mode=12;break e}e.msg="invalid literal/length code",r.mode=30;break e}k=65535&g,(y&=15)&&(p<y&&(d+=A[n++]<<p,p+=8),k+=d&(1<<y)-1,d>>>=y,p-=y),p<15&&(d+=A[n++]<<p,p+=8,d+=A[n++]<<p,p+=8),g=m[d&v];r:for(;;){if(d>>>=y=g>>>24,p-=y,!(16&(y=g>>>16&255))){if(0==(64&y)){g=m[(65535&g)+(d&(1<<y)-1)];continue r}e.msg="invalid distance code",r.mode=30;break e}if(_=65535&g,p<(y&=15)&&(d+=A[n++]<<p,(p+=8)<y&&(d+=A[n++]<<p,p+=8)),f<(_+=d&(1<<y)-1)){e.msg="invalid distance too far back",r.mode=30;break e}if(d>>>=y,p-=y,(y=o-a)<_){if(l<(y=_-y)&&r.sane){e.msg="invalid distance too far back",r.mode=30;break e}if(E=u,(x=0)===h){if(x+=c-y,y<k){for(k-=y;S[o++]=u[x++],--y;);x=o-_,E=S}}else if(h<y){if(x+=c+h-y,(y-=h)<k){for(k-=y;S[o++]=u[x++],--y;);if(x=0,h<k){for(k-=y=h;S[o++]=u[x++],--y;);x=o-_,E=S}}}else if(x+=h-y,y<k){for(k-=y;S[o++]=u[x++],--y;);x=o-_,E=S}for(;2<k;)S[o++]=E[x++],S[o++]=E[x++],S[o++]=E[x++],k-=3;k&&(S[o++]=E[x++],1<k&&(S[o++]=E[x++]))}else{for(x=o-_;S[o++]=S[x++],S[o++]=S[x++],S[o++]=S[x++],2<(k-=3););k&&(S[o++]=S[x++],1<k&&(S[o++]=S[x++]))}break}}break}}while(n<i&&o<s);n-=k=p>>3,d&=(1<<(p-=k<<3))-1,e.next_in=n,e.next_out=o,e.avail_in=n<i?i-n+5:5-(n-i),e.avail_out=o<s?s-o+257:257-(o-s),r.hold=d,r.bits=p}},{}],8:[function(e,t,r){"use strict";var n=e("../utils/common"),i=e("./adler32"),o=e("./crc32"),a=e("./inffast"),s=e("./inftrees"),f=1,c=2,l=0,h=-2,u=1,d=852,p=592;function b(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function m(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new n.Buf16(320),this.work=new n.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function w(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=u,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new n.Buf32(d),t.distcode=t.distdyn=new n.Buf32(p),t.sane=1,t.back=-1,l):h}function v(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,w(e)):h}function g(e,t){var r,n;return e&&e.state?(n=e.state,t<0?(r=0,t=-t):(r=1+(t>>4),t<48&&(t&=15)),t&&(t<8||15<t)?h:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=r,n.wbits=t,v(e))):h}function y(e,t){var r,n;return e?(n=new m,(e.state=n).window=null,(r=g(e,t))!==l&&(e.state=null),r):h}var k,_,x=!0;function E(e){if(x){var t;for(k=new n.Buf32(512),_=new n.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(s(f,e.lens,0,288,k,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;s(c,e.lens,0,32,_,0,e.work,{bits:5}),x=!1}e.lencode=k,e.lenbits=9,e.distcode=_,e.distbits=5}function A(e,t,r,i){var o,a=e.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new n.Buf8(a.wsize)),i>=a.wsize?(n.arraySet(a.window,t,r-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):(i<(o=a.wsize-a.wnext)&&(o=i),n.arraySet(a.window,t,r-i,o,a.wnext),(i-=o)?(n.arraySet(a.window,t,r-i,i,0),a.wnext=i,a.whave=a.wsize):(a.wnext+=o,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=o))),0}r.inflateReset=v,r.inflateReset2=g,r.inflateResetKeep=w,r.inflateInit=function(e){return y(e,15)},r.inflateInit2=y,r.inflate=function(e,t){var r,d,p,m,w,v,g,y,k,_,x,S,T,C,B,D,M,I,O,Z,P,U,N,R,z=0,L=new n.Buf8(4),F=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return h;12===(r=e.state).mode&&(r.mode=13),w=e.next_out,p=e.output,g=e.avail_out,m=e.next_in,d=e.input,v=e.avail_in,y=r.hold,k=r.bits,_=v,x=g,U=l;e:for(;;)switch(r.mode){case u:if(0===r.wrap){r.mode=13;break}for(;k<16;){if(0===v)break e;v--,y+=d[m++]<<k,k+=8}if(2&r.wrap&&35615===y){L[r.check=0]=255&y,L[1]=y>>>8&255,r.check=o(r.check,L,2,0),k=y=0,r.mode=2;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&y)<<8)+(y>>8))%31){e.msg="incorrect header check",r.mode=30;break}if(8!=(15&y)){e.msg="unknown compression method",r.mode=30;break}if(k-=4,P=8+(15&(y>>>=4)),0===r.wbits)r.wbits=P;else if(P>r.wbits){e.msg="invalid window size",r.mode=30;break}r.dmax=1<<P,e.adler=r.check=1,r.mode=512&y?10:12,k=y=0;break;case 2:for(;k<16;){if(0===v)break e;v--,y+=d[m++]<<k,k+=8}if(r.flags=y,8!=(255&r.flags)){e.msg="unknown compression method",r.mode=30;break}if(57344&r.flags){e.msg="unknown header flags set",r.mode=30;break}r.head&&(r.head.text=y>>8&1),512&r.flags&&(L[0]=255&y,L[1]=y>>>8&255,r.check=o(r.check,L,2,0)),k=y=0,r.mode=3;case 3:for(;k<32;){if(0===v)break e;v--,y+=d[m++]<<k,k+=8}r.head&&(r.head.time=y),512&r.flags&&(L[0]=255&y,L[1]=y>>>8&255,L[2]=y>>>16&255,L[3]=y>>>24&255,r.check=o(r.check,L,4,0)),k=y=0,r.mode=4;case 4:for(;k<16;){if(0===v)break e;v--,y+=d[m++]<<k,k+=8}r.head&&(r.head.xflags=255&y,r.head.os=y>>8),512&r.flags&&(L[0]=255&y,L[1]=y>>>8&255,r.check=o(r.check,L,2,0)),k=y=0,r.mode=5;case 5:if(1024&r.flags){for(;k<16;){if(0===v)break e;v--,y+=d[m++]<<k,k+=8}r.length=y,r.head&&(r.head.extra_len=y),512&r.flags&&(L[0]=255&y,L[1]=y>>>8&255,r.check=o(r.check,L,2,0)),k=y=0}else r.head&&(r.head.extra=null);r.mode=6;case 6:if(1024&r.flags&&(v<(S=r.length)&&(S=v),S&&(r.head&&(P=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),n.arraySet(r.head.extra,d,m,S,P)),512&r.flags&&(r.check=o(r.check,d,S,m)),v-=S,m+=S,r.length-=S),r.length))break e;r.length=0,r.mode=7;case 7:if(2048&r.flags){if(0===v)break e;for(S=0;P=d[m+S++],r.head&&P&&r.length<65536&&(r.head.name+=String.fromCharCode(P)),P&&S<v;);if(512&r.flags&&(r.check=o(r.check,d,S,m)),v-=S,m+=S,P)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=8;case 8:if(4096&r.flags){if(0===v)break e;for(S=0;P=d[m+S++],r.head&&P&&r.length<65536&&(r.head.comment+=String.fromCharCode(P)),P&&S<v;);if(512&r.flags&&(r.check=o(r.check,d,S,m)),v-=S,m+=S,P)break e}else r.head&&(r.head.comment=null);r.mode=9;case 9:if(512&r.flags){for(;k<16;){if(0===v)break e;v--,y+=d[m++]<<k,k+=8}if(y!==(65535&r.check)){e.msg="header crc mismatch",r.mode=30;break}k=y=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=12;break;case 10:for(;k<32;){if(0===v)break e;v--,y+=d[m++]<<k,k+=8}e.adler=r.check=b(y),k=y=0,r.mode=11;case 11:if(0===r.havedict)return e.next_out=w,e.avail_out=g,e.next_in=m,e.avail_in=v,r.hold=y,r.bits=k,2;e.adler=r.check=1,r.mode=12;case 12:if(5===t||6===t)break e;case 13:if(r.last){y>>>=7&k,k-=7&k,r.mode=27;break}for(;k<3;){if(0===v)break e;v--,y+=d[m++]<<k,k+=8}switch(r.last=1&y,k-=1,3&(y>>>=1)){case 0:r.mode=14;break;case 1:if(E(r),r.mode=20,6!==t)break;y>>>=2,k-=2;break e;case 2:r.mode=17;break;case 3:e.msg="invalid block type",r.mode=30}y>>>=2,k-=2;break;case 14:for(y>>>=7&k,k-=7&k;k<32;){if(0===v)break e;v--,y+=d[m++]<<k,k+=8}if((65535&y)!=(y>>>16^65535)){e.msg="invalid stored block lengths",r.mode=30;break}if(r.length=65535&y,k=y=0,r.mode=15,6===t)break e;case 15:r.mode=16;case 16:if(S=r.length){if(v<S&&(S=v),g<S&&(S=g),0===S)break e;n.arraySet(p,d,m,S,w),v-=S,m+=S,g-=S,w+=S,r.length-=S;break}r.mode=12;break;case 17:for(;k<14;){if(0===v)break e;v--,y+=d[m++]<<k,k+=8}if(r.nlen=257+(31&y),y>>>=5,k-=5,r.ndist=1+(31&y),y>>>=5,k-=5,r.ncode=4+(15&y),y>>>=4,k-=4,286<r.nlen||30<r.ndist){e.msg="too many length or distance symbols",r.mode=30;break}r.have=0,r.mode=18;case 18:for(;r.have<r.ncode;){for(;k<3;){if(0===v)break e;v--,y+=d[m++]<<k,k+=8}r.lens[F[r.have++]]=7&y,y>>>=3,k-=3}for(;r.have<19;)r.lens[F[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,N={bits:r.lenbits},U=s(0,r.lens,0,19,r.lencode,0,r.work,N),r.lenbits=N.bits,U){e.msg="invalid code lengths set",r.mode=30;break}r.have=0,r.mode=19;case 19:for(;r.have<r.nlen+r.ndist;){for(;D=(z=r.lencode[y&(1<<r.lenbits)-1])>>>16&255,M=65535&z,!((B=z>>>24)<=k);){if(0===v)break e;v--,y+=d[m++]<<k,k+=8}if(M<16)y>>>=B,k-=B,r.lens[r.have++]=M;else{if(16===M){for(R=B+2;k<R;){if(0===v)break e;v--,y+=d[m++]<<k,k+=8}if(y>>>=B,k-=B,0===r.have){e.msg="invalid bit length repeat",r.mode=30;break}P=r.lens[r.have-1],S=3+(3&y),y>>>=2,k-=2}else if(17===M){for(R=B+3;k<R;){if(0===v)break e;v--,y+=d[m++]<<k,k+=8}k-=B,P=0,S=3+(7&(y>>>=B)),y>>>=3,k-=3}else{for(R=B+7;k<R;){if(0===v)break e;v--,y+=d[m++]<<k,k+=8}k-=B,P=0,S=11+(127&(y>>>=B)),y>>>=7,k-=7}if(r.have+S>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=30;break}for(;S--;)r.lens[r.have++]=P}}if(30===r.mode)break;if(0===r.lens[256]){e.msg="invalid code -- missing end-of-block",r.mode=30;break}if(r.lenbits=9,N={bits:r.lenbits},U=s(f,r.lens,0,r.nlen,r.lencode,0,r.work,N),r.lenbits=N.bits,U){e.msg="invalid literal/lengths set",r.mode=30;break}if(r.distbits=6,r.distcode=r.distdyn,N={bits:r.distbits},U=s(c,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,N),r.distbits=N.bits,U){e.msg="invalid distances set",r.mode=30;break}if(r.mode=20,6===t)break e;case 20:r.mode=21;case 21:if(6<=v&&258<=g){e.next_out=w,e.avail_out=g,e.next_in=m,e.avail_in=v,r.hold=y,r.bits=k,a(e,x),w=e.next_out,p=e.output,g=e.avail_out,m=e.next_in,d=e.input,v=e.avail_in,y=r.hold,k=r.bits,12===r.mode&&(r.back=-1);break}for(r.back=0;D=(z=r.lencode[y&(1<<r.lenbits)-1])>>>16&255,M=65535&z,!((B=z>>>24)<=k);){if(0===v)break e;v--,y+=d[m++]<<k,k+=8}if(D&&0==(240&D)){for(I=B,O=D,Z=M;D=(z=r.lencode[Z+((y&(1<<I+O)-1)>>I)])>>>16&255,M=65535&z,!(I+(B=z>>>24)<=k);){if(0===v)break e;v--,y+=d[m++]<<k,k+=8}y>>>=I,k-=I,r.back+=I}if(y>>>=B,k-=B,r.back+=B,r.length=M,0===D){r.mode=26;break}if(32&D){r.back=-1,r.mode=12;break}if(64&D){e.msg="invalid literal/length code",r.mode=30;break}r.extra=15&D,r.mode=22;case 22:if(r.extra){for(R=r.extra;k<R;){if(0===v)break e;v--,y+=d[m++]<<k,k+=8}r.length+=y&(1<<r.extra)-1,y>>>=r.extra,k-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=23;case 23:for(;D=(z=r.distcode[y&(1<<r.distbits)-1])>>>16&255,M=65535&z,!((B=z>>>24)<=k);){if(0===v)break e;v--,y+=d[m++]<<k,k+=8}if(0==(240&D)){for(I=B,O=D,Z=M;D=(z=r.distcode[Z+((y&(1<<I+O)-1)>>I)])>>>16&255,M=65535&z,!(I+(B=z>>>24)<=k);){if(0===v)break e;v--,y+=d[m++]<<k,k+=8}y>>>=I,k-=I,r.back+=I}if(y>>>=B,k-=B,r.back+=B,64&D){e.msg="invalid distance code",r.mode=30;break}r.offset=M,r.extra=15&D,r.mode=24;case 24:if(r.extra){for(R=r.extra;k<R;){if(0===v)break e;v--,y+=d[m++]<<k,k+=8}r.offset+=y&(1<<r.extra)-1,y>>>=r.extra,k-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=30;break}r.mode=25;case 25:if(0===g)break e;if(S=x-g,r.offset>S){if((S=r.offset-S)>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=30;break}S>r.wnext?(S-=r.wnext,T=r.wsize-S):T=r.wnext-S,S>r.length&&(S=r.length),C=r.window}else C=p,T=w-r.offset,S=r.length;for(g<S&&(S=g),g-=S,r.length-=S;p[w++]=C[T++],--S;);0===r.length&&(r.mode=21);break;case 26:if(0===g)break e;p[w++]=r.length,g--,r.mode=21;break;case 27:if(r.wrap){for(;k<32;){if(0===v)break e;v--,y|=d[m++]<<k,k+=8}if(x-=g,e.total_out+=x,r.total+=x,x&&(e.adler=r.check=r.flags?o(r.check,p,x,w-x):i(r.check,p,x,w-x)),x=g,(r.flags?y:b(y))!==r.check){e.msg="incorrect data check",r.mode=30;break}k=y=0}r.mode=28;case 28:if(r.wrap&&r.flags){for(;k<32;){if(0===v)break e;v--,y+=d[m++]<<k,k+=8}if(y!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=30;break}k=y=0}r.mode=29;case 29:U=1;break e;case 30:U=-3;break e;case 31:return-4;case 32:default:return h}return e.next_out=w,e.avail_out=g,e.next_in=m,e.avail_in=v,r.hold=y,r.bits=k,(r.wsize||x!==e.avail_out&&r.mode<30&&(r.mode<27||4!==t))&&A(e,e.output,e.next_out,x-e.avail_out)?(r.mode=31,-4):(_-=e.avail_in,x-=e.avail_out,e.total_in+=_,e.total_out+=x,r.total+=x,r.wrap&&x&&(e.adler=r.check=r.flags?o(r.check,p,x,e.next_out-x):i(r.check,p,x,e.next_out-x)),e.data_type=r.bits+(r.last?64:0)+(12===r.mode?128:0)+(20===r.mode||15===r.mode?256:0),(0===_&&0===x||4===t)&&U===l&&(U=-5),U)},r.inflateEnd=function(e){if(!e||!e.state)return h;var t=e.state;return t.window&&(t.window=null),e.state=null,l},r.inflateGetHeader=function(e,t){var r;return e&&e.state?0==(2&(r=e.state).wrap)?h:((r.head=t).done=!1,l):h},r.inflateSetDictionary=function(e,t){var r,n=t.length;return e&&e.state?0!==(r=e.state).wrap&&11!==r.mode?h:11===r.mode&&i(1,t,n,0)!==r.check?-3:A(e,t,n,n)?(r.mode=31,-4):(r.havedict=1,l):h},r.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":1,"./adler32":3,"./crc32":5,"./inffast":7,"./inftrees":9}],9:[function(e,t,r){"use strict";var n=e("../utils/common"),i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],a=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],s=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(e,t,r,f,c,l,h,u){var d,p,b,m,w,v,g,y,k,_=u.bits,x=0,E=0,A=0,S=0,T=0,C=0,B=0,D=0,M=0,I=0,O=null,Z=0,P=new n.Buf16(16),U=new n.Buf16(16),N=null,R=0;for(x=0;x<=15;x++)P[x]=0;for(E=0;E<f;E++)P[t[r+E]]++;for(T=_,S=15;1<=S&&0===P[S];S--);if(S<T&&(T=S),0===S)return c[l++]=20971520,c[l++]=20971520,u.bits=1,0;for(A=1;A<S&&0===P[A];A++);for(T<A&&(T=A),x=D=1;x<=15;x++)if(D<<=1,(D-=P[x])<0)return-1;if(0<D&&(0===e||1!==S))return-1;for(U[1]=0,x=1;x<15;x++)U[x+1]=U[x]+P[x];for(E=0;E<f;E++)0!==t[r+E]&&(h[U[t[r+E]]++]=E);if(0===e?(O=N=h,v=19):1===e?(O=i,Z-=257,N=o,R-=257,v=256):(O=a,N=s,v=-1),x=A,w=l,B=E=I=0,b=-1,m=(M=1<<(C=T))-1,1===e&&852<M||2===e&&592<M)return 1;for(;;){for(g=x-B,h[E]<v?(y=0,k=h[E]):h[E]>v?(y=N[R+h[E]],k=O[Z+h[E]]):(y=96,k=0),d=1<<x-B,A=p=1<<C;c[w+(I>>B)+(p-=d)]=g<<24|y<<16|k|0,0!==p;);for(d=1<<x-1;I&d;)d>>=1;if(0!==d?(I&=d-1,I+=d):I=0,E++,0==--P[x]){if(x===S)break;x=t[r+h[E]]}if(T<x&&(I&m)!==b){for(0===B&&(B=T),w+=A,D=1<<(C=x-B);C+B<S&&!((D-=P[C+B])<=0);)C++,D<<=1;if(M+=1<<C,1===e&&852<M||2===e&&592<M)return 1;c[b=I&m]=T<<24|C<<16|w-l|0}}return 0!==I&&(c[w+I]=x-B<<24|64<<16|0),u.bits=T,0}},{"../utils/common":1}],10:[function(e,t,r){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],11:[function(e,t,r){"use strict";t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],"/lib/inflate.js":[function(e,t,r){"use strict";var n=e("./zlib/inflate"),i=e("./utils/common"),o=e("./utils/strings"),a=e("./zlib/constants"),s=e("./zlib/messages"),f=e("./zlib/zstream"),c=e("./zlib/gzheader"),l=Object.prototype.toString;function h(e){if(!(this instanceof h))return new h(e);this.options=i.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&0<=t.windowBits&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(0<=t.windowBits&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),15<t.windowBits&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new f,this.strm.avail_out=0;var r=n.inflateInit2(this.strm,t.windowBits);if(r!==a.Z_OK)throw new Error(s[r]);if(this.header=new c,n.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=o.string2buf(t.dictionary):"[object ArrayBuffer]"===l.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(r=n.inflateSetDictionary(this.strm,t.dictionary))!==a.Z_OK))throw new Error(s[r])}function u(e,t){var r=new h(t);if(r.push(e,!0),r.err)throw r.msg||s[r.err];return r.result}h.prototype.push=function(e,t){var r,s,f,c,h,u=this.strm,d=this.options.chunkSize,p=this.options.dictionary,b=!1;if(this.ended)return!1;s=t===~~t?t:!0===t?a.Z_FINISH:a.Z_NO_FLUSH,"string"==typeof e?u.input=o.binstring2buf(e):"[object ArrayBuffer]"===l.call(e)?u.input=new Uint8Array(e):u.input=e,u.next_in=0,u.avail_in=u.input.length;do{if(0===u.avail_out&&(u.output=new i.Buf8(d),u.next_out=0,u.avail_out=d),(r=n.inflate(u,a.Z_NO_FLUSH))===a.Z_NEED_DICT&&p&&(r=n.inflateSetDictionary(this.strm,p)),r===a.Z_BUF_ERROR&&!0===b&&(r=a.Z_OK,b=!1),r!==a.Z_STREAM_END&&r!==a.Z_OK)return this.onEnd(r),!(this.ended=!0);u.next_out&&(0!==u.avail_out&&r!==a.Z_STREAM_END&&(0!==u.avail_in||s!==a.Z_FINISH&&s!==a.Z_SYNC_FLUSH)||("string"===this.options.to?(f=o.utf8border(u.output,u.next_out),c=u.next_out-f,h=o.buf2string(u.output,f),u.next_out=c,u.avail_out=d-c,c&&i.arraySet(u.output,u.output,f,c,0),this.onData(h)):this.onData(i.shrinkBuf(u.output,u.next_out)))),0===u.avail_in&&0===u.avail_out&&(b=!0)}while((0<u.avail_in||0===u.avail_out)&&r!==a.Z_STREAM_END);return r===a.Z_STREAM_END&&(s=a.Z_FINISH),s===a.Z_FINISH?(r=n.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===a.Z_OK):s!==a.Z_SYNC_FLUSH||(this.onEnd(a.Z_OK),!(u.avail_out=0))},h.prototype.onData=function(e){this.chunks.push(e)},h.prototype.onEnd=function(e){e===a.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},r.Inflate=h,r.inflate=u,r.inflateRaw=function(e,t){return(t=t||{}).raw=!0,u(e,t)},r.ungzip=u},{"./utils/common":1,"./utils/strings":2,"./zlib/constants":4,"./zlib/gzheader":6,"./zlib/inflate":8,"./zlib/messages":10,"./zlib/zstream":11}]},{},[])("/lib/inflate.js")},function(e,t,r){"use strict";r.r(t);var n=r(0),i=function(){this.width=0,this.height=0,this.bitDepth=0,this.colorType=0,this.compressionMethod=0,this.filterMethod=0,this.interlaceMethod=0,this.colors=0,this.alpha=!1,this.pixelBits=0,this.palette=null,this.pixels=null};i.prototype.getWidth=function(){return this.width},i.prototype.setWidth=function(e){this.width=e},i.prototype.getHeight=function(){return this.height},i.prototype.setHeight=function(e){this.height=e},i.prototype.getBitDepth=function(){return this.bitDepth},i.prototype.setBitDepth=function(e){if(-1===[2,4,8,16].indexOf(e))throw new Error("invalid bith depth "+e);this.bitDepth=e},i.prototype.getColorType=function(){return this.colorType},i.prototype.setColorType=function(e){var t=0,r=!1;switch(e){case 0:t=1;break;case 2:t=3;break;case 3:t=1;break;case 4:t=2,r=!0;break;case 6:t=4,r=!0;break;default:throw new Error("invalid color type")}this.colors=t,this.alpha=r,this.colorType=e},i.prototype.getCompressionMethod=function(){return this.compressionMethod},i.prototype.setCompressionMethod=function(e){if(0!==e)throw new Error("invalid compression method "+e);this.compressionMethod=e},i.prototype.getFilterMethod=function(){return this.filterMethod},i.prototype.setFilterMethod=function(e){if(0!==e)throw new Error("invalid filter method "+e);this.filterMethod=e},i.prototype.getInterlaceMethod=function(){return this.interlaceMethod},i.prototype.setInterlaceMethod=function(e){if(0!==e&&1!==e)throw new Error("invalid interlace method "+e);this.interlaceMethod=e},i.prototype.setPalette=function(e){if(e.length%3!=0)throw new Error("incorrect PLTE chunk length");if(e.length>3*Math.pow(2,this.bitDepth))throw new Error("palette has more colors than 2^bitdepth");this.palette=e},i.prototype.getPalette=function(){return this.palette},i.prototype.getPixel=function(e,t){if(!this.pixels)throw new Error("pixel data is empty");if(e>=this.width||t>=this.height)throw new Error("x,y position out of bound");var r=this.colors*this.bitDepth/8*(t*this.width+e),n=this.pixels;switch(this.colorType){case 0:return[n[r],n[r],n[r],255];case 2:return[n[r],n[r+1],n[r+2],255];case 3:return[this.palette[3*n[r]+0],this.palette[3*n[r]+1],this.palette[3*n[r]+2],255];case 4:return[n[r],n[r],n[r],n[r+1]];case 6:return[n[r],n[r+1],n[r+2],n[r+3]]}};var o=i;function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Uint8Array.prototype.slice||Object.defineProperty(Uint8Array.prototype,"slice",{value:function(e,t){return new Uint8Array(Array.prototype.slice.call(this,e,t))}});var s=Object.prototype.toString;function f(e,t){return(e[t]<<24)+(e[t+1]<<16)+(e[t+2]<<8)+(e[t+3]<<0)}function c(e,t){return e[t]<<0}function l(e){if("string"==typeof e){var t=e;e=new Array(t.length);for(var r=0,n=t.length;r<n;r++)e[r]=t[r].charCodeAt(0)}else{"ArrayBuffer"===s.call(e).slice(8,-1)&&(e=new Uint8Array(e))}this.i=0,this.bytes=e,this.png=new o,this.dataChunks=[]}l.prototype.readBytes=function(e){var t=this.i+e;if(t>this.bytes.length)throw new Error("Unexpectedly reached end of file");var r=this.bytes.slice(this.i,t);return this.i=t,r},l.prototype.decodeHeader=function(){if(0!==this.i)throw new Error("file pointer should be at 0 to read the header");var e=this.readBytes(8);if(!function(e,t){if(e.length!==t.length)return!1;for(var r=e.length;r--;)if(e[r]!==t[r])return!1;return!0}(e,[137,80,78,71,13,10,26,10]))throw new Error("invalid PNGReader file (bad signature)");this.header=e},l.prototype.decodeChunk=function(){var e=f(this.readBytes(4),0);if(e<0)throw new Error("Bad chunk length "+(4294967295&e));var t=function(e){for(var t="",r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}(this.readBytes(4)),r=this.readBytes(e);this.readBytes(4);switch(t){case"IHDR":this.decodeIHDR(r);break;case"PLTE":this.decodePLTE(r);break;case"IDAT":this.decodeIDAT(r);break;case"IEND":this.decodeIEND(r)}return t},l.prototype.decodeIHDR=function(e){var t=this.png;t.setWidth(f(e,0)),t.setHeight(f(e,4)),t.setBitDepth(c(e,8)),t.setColorType(c(e,9)),t.setCompressionMethod(c(e,10)),t.setFilterMethod(c(e,11)),t.setInterlaceMethod(c(e,12))},l.prototype.decodePLTE=function(e){this.png.setPalette(e)},l.prototype.decodeIDAT=function(e){this.dataChunks.push(e)},l.prototype.decodeIEND=function(){},l.prototype.decodePixels=function(e){var t,r=this.png,i=this,o=0;for(t=this.dataChunks.length;t--;)o+=this.dataChunks[t].length;var a=new Uint8Array(o);for(t=0,o=0;t<this.dataChunks.length;t++)a.set(this.dataChunks[t],o),o+=this.dataChunks[t].length;!function(e,t){try{t(null,Object(n.inflate)(e))}catch(e){t(e)}}(a,function(t,n){if(t)return e(t);try{0===r.getInterlaceMethod()?i.interlaceNone(n):i.interlaceAdam7(n)}catch(t){return e(t)}e()})},l.prototype.interlaceNone=function(e){for(var t,r=this.png,n=Math.max(1,r.colors*r.bitDepth/8),i=n*r.width,o=new Uint8Array(n*r.width*r.height),a=0,s=0;s<e.length;s+=i+1){switch(t=e.slice(s+1,s+i+1),c(e,s)){case 0:this.unFilterNone(t,o,n,a,i);break;case 1:this.unFilterSub(t,o,n,a,i);break;case 2:this.unFilterUp(t,o,n,a,i);break;case 3:this.unFilterAverage(t,o,n,a,i);break;case 4:this.unFilterPaeth(t,o,n,a,i);break;default:throw new Error("unkown filtered scanline")}a+=i}r.pixels=o},l.prototype.interlaceAdam7=function(e){throw new Error("Adam7 interlacing is not implemented yet")},l.prototype.unFilterNone=function(e,t,r,n,i){for(var o=0,a=i;o<a;o++)t[n+o]=e[o]},l.prototype.unFilterSub=function(e,t,r,n,i){for(var o=0;o<r;o++)t[n+o]=e[o];for(;o<i;o++)t[n+o]=e[o]+t[n+o-r]&255},l.prototype.unFilterUp=function(e,t,r,n,i){var o=0;if(n-i<0)for(;o<i;o++)t[n+o]=e[o];else for(;o<i;o++){var a=e[o],s=t[n+o-i];t[n+o]=a+s&255}},l.prototype.unFilterAverage=function(e,t,r,n,i){var o=0;if(n-i<0){for(;o<r;o++)t[n+o]=e[o];for(;o<i;o++)t[n+o]=e[o]+(t[n+o-r]>>1)&255}else{for(;o<r;o++)t[n+o]=e[o]+(t[n-i+o]>>1)&255;for(;o<i;o++){var a=e[o],s=t[n+o-r],f=t[n+o-i];t[n+o]=a+(s+f>>1)&255}}},l.prototype.unFilterPaeth=function(e,t,r,n,i){var o=0;if(n-i<0){for(;o<r;o++)t[n+o]=e[o];for(;o<i;o++)t[n+o]=e[o]+t[n+o-r]&255}else{for(;o<r;o++)t[n+o]=e[o]+t[n+o-i]&255;for(;o<i;o++){var a=e[o],s=t[n+o-r],f=t[n+o-i],c=t[n+o-i-r],l=s+f-c,h=Math.abs(l-s),u=Math.abs(l-f),d=Math.abs(l-c),p=void 0;p=h<=u&&h<=d?s:u<=d?f:c,t[n+o]=a+p&255}}},l.prototype.parse=function(e,t){"function"==typeof e&&(t=e),"object"!==a(e)&&(e={});try{for(this.decodeHeader();this.i<this.bytes.length;){var r=this.decodeChunk();if("IHDR"===r&&!1===e.data||"IEND"===r)break}var n=this.png;this.decodePixels(function(e){t(e,n)})}catch(e){t(e)}};var h=l;function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var d=function(){var e=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),t=4017,r=799,n=3406,i=2276,o=1567,a=3784,s=5793,f=2896;function c(){}function l(e,t){for(var r,n,i=0,o=[],a=16;a>0&&!e[a-1];)a--;o.push({children:[],index:0});var s,f=o[0];for(r=0;r<a;r++){for(n=0;n<e[r];n++){for((f=o.pop()).children[f.index]=t[i];f.index>0;)f=o.pop();for(f.index++,o.push(f);o.length<=r;)o.push(s={children:[],index:0}),f.children[f.index]=s.children,f=s;i++}r+1<a&&(o.push(s={children:[],index:0}),f.children[f.index]=s.children,f=s)}return o[0].children}function h(t,r,n,i,o,a,s,f,c){var l=n.mcusPerLine,h=n.progressive,d=r,p=0,b=0;function m(){if(b>0)return p>>--b&1;if(255===(p=t[r++])){var e=t[r++];if(e)throw new Error("unexpected marker: "+(p<<8|e).toString(16))}return b=7,p>>>7}function w(e){for(var t,r=e;null!==(t=m());){if("number"==typeof(r=r[t]))return r;if("object"!==u(r))throw new Error("invalid huffman sequence")}return null}function v(e){for(var t=0;e>0;){var r=m();if(null===r)return;t=t<<1|r,e--}return t}function g(e){var t=v(e);return t>=1<<e-1?t:t+(-1<<e)+1}var y=0;var k,_=0;function x(e,t,r,n,i){var o=r%l,a=(r/l|0)*e.v+n,s=o*e.h+i;t(e,e.blocks[a][s])}function E(e,t,r){var n=r/e.blocksPerLine|0,i=r%e.blocksPerLine;t(e,e.blocks[n][i])}var A,S,T,C,B,D,M=i.length;D=h?0===a?0===f?function(e,t){var r=w(e.huffmanTableDC),n=0===r?0:g(r)<<c;t[0]=e.pred+=n}:function(e,t){t[0]|=m()<<c}:0===f?function(t,r){if(y>0)y--;else for(var n=a,i=s;n<=i;){var o=w(t.huffmanTableAC),f=15&o,l=o>>4;if(0!==f)r[e[n+=l]]=g(f)*(1<<c),n++;else{if(l<15){y=v(l)+(1<<l)-1;break}n+=16}}}:function(t,r){for(var n=a,i=s,o=0;n<=i;){var f=e[n],l=r[f]<0?-1:1;switch(_){case 0:var h=w(t.huffmanTableAC),u=15&h;if(o=h>>4,0===u)o<15?(y=v(o)+(1<<o),_=4):(o=16,_=1);else{if(1!==u)throw new Error("invalid ACn encoding");k=g(u),_=o?2:3}continue;case 1:case 2:r[f]?r[f]+=(m()<<c)*l:0==--o&&(_=2===_?3:0);break;case 3:r[f]?r[f]+=(m()<<c)*l:(r[f]=k<<c,_=0);break;case 4:r[f]&&(r[f]+=(m()<<c)*l)}n++}4===_&&0==--y&&(_=0)}:function(t,r){var n=w(t.huffmanTableDC),i=0===n?0:g(n);r[0]=t.pred+=i;for(var o=1;o<64;){var a=w(t.huffmanTableAC),s=15&a,f=a>>4;if(0!==s)r[e[o+=f]]=g(s),o++;else{if(f<15)break;o+=16}}};var I,O,Z,P,U=0;for(O=1===M?i[0].blocksPerLine*i[0].blocksPerColumn:l*n.mcusPerColumn,o||(o=O);U<O;){for(S=0;S<M;S++)i[S].pred=0;if(y=0,1===M)for(A=i[0],B=0;B<o;B++)E(A,D,U),U++;else for(B=0;B<o;B++){for(S=0;S<M;S++)for(Z=(A=i[S]).h,P=A.v,T=0;T<P;T++)for(C=0;C<Z;C++)x(A,D,U,T,C);if(++U===O)break}if(b=0,(I=t[r]<<8|t[r+1])<65280)throw new Error("marker was not found");if(!(I>=65488&&I<=65495))break;r+=2}return r-d}function d(e,c){var l,h,u=[],d=c.blocksPerLine,p=c.blocksPerColumn,b=d<<3,m=new Int32Array(64),w=new Uint8Array(64);function v(e,l,h){var u,d,p,b,m,w,v,g,y,k,_=c.quantizationTable,x=h;for(k=0;k<64;k++)x[k]=e[k]*_[k];for(k=0;k<8;++k){var E=8*k;0!==x[1+E]||0!==x[2+E]||0!==x[3+E]||0!==x[4+E]||0!==x[5+E]||0!==x[6+E]||0!==x[7+E]?(u=s*x[0+E]+128>>8,d=s*x[4+E]+128>>8,p=x[2+E],b=x[6+E],m=f*(x[1+E]-x[7+E])+128>>8,g=f*(x[1+E]+x[7+E])+128>>8,w=x[3+E]<<4,v=x[5+E]<<4,y=u-d+1>>1,u=u+d+1>>1,d=y,y=p*a+b*o+128>>8,p=p*o-b*a+128>>8,b=y,y=m-v+1>>1,m=m+v+1>>1,v=y,y=g+w+1>>1,w=g-w+1>>1,g=y,y=u-b+1>>1,u=u+b+1>>1,b=y,y=d-p+1>>1,d=d+p+1>>1,p=y,y=m*i+g*n+2048>>12,m=m*n-g*i+2048>>12,g=y,y=w*r+v*t+2048>>12,w=w*t-v*r+2048>>12,v=y,x[0+E]=u+g,x[7+E]=u-g,x[1+E]=d+v,x[6+E]=d-v,x[2+E]=p+w,x[5+E]=p-w,x[3+E]=b+m,x[4+E]=b-m):(y=s*x[0+E]+512>>10,x[0+E]=y,x[1+E]=y,x[2+E]=y,x[3+E]=y,x[4+E]=y,x[5+E]=y,x[6+E]=y,x[7+E]=y)}for(k=0;k<8;++k){var A=k;0!==x[8+A]||0!==x[16+A]||0!==x[24+A]||0!==x[32+A]||0!==x[40+A]||0!==x[48+A]||0!==x[56+A]?(u=s*x[0+A]+2048>>12,d=s*x[32+A]+2048>>12,p=x[16+A],b=x[48+A],m=f*(x[8+A]-x[56+A])+2048>>12,g=f*(x[8+A]+x[56+A])+2048>>12,w=x[24+A],v=x[40+A],y=u-d+1>>1,u=u+d+1>>1,d=y,y=p*a+b*o+2048>>12,p=p*o-b*a+2048>>12,b=y,y=m-v+1>>1,m=m+v+1>>1,v=y,y=g+w+1>>1,w=g-w+1>>1,g=y,y=u-b+1>>1,u=u+b+1>>1,b=y,y=d-p+1>>1,d=d+p+1>>1,p=y,y=m*i+g*n+2048>>12,m=m*n-g*i+2048>>12,g=y,y=w*r+v*t+2048>>12,w=w*t-v*r+2048>>12,v=y,x[0+A]=u+g,x[56+A]=u-g,x[8+A]=d+v,x[48+A]=d-v,x[16+A]=p+w,x[40+A]=p-w,x[24+A]=b+m,x[32+A]=b-m):(y=s*h[k+0]+8192>>14,x[0+A]=y,x[8+A]=y,x[16+A]=y,x[24+A]=y,x[32+A]=y,x[40+A]=y,x[48+A]=y,x[56+A]=y)}for(k=0;k<64;++k){var S=128+(x[k]+8>>4);l[k]=S<0?0:S>255?255:S}}for(var g=0;g<p;g++){var y=g<<3;for(l=0;l<8;l++)u.push(new Uint8Array(b));for(var k=0;k<d;k++){v(c.blocks[g][k],w,m);var _=0,x=k<<3;for(h=0;h<8;h++){var E=u[y+h];for(l=0;l<8;l++)E[x+l]=w[_++]}}}return u}function p(e){return e<0?0:e>255?255:e}return c.prototype={parse:function(t){var r=0;function n(){var e=t[r]<<8|t[r+1];return r+=2,e}function i(e){var t,r,n=0,i=0;for(r in e.components)e.components.hasOwnProperty(r)&&(n<(t=e.components[r]).h&&(n=t.h),i<t.v&&(i=t.v));var o=Math.ceil(e.samplesPerLine/8/n),a=Math.ceil(e.scanLines/8/i);for(r in e.components)if(e.components.hasOwnProperty(r)){t=e.components[r];for(var s=Math.ceil(Math.ceil(e.samplesPerLine/8)*t.h/n),f=Math.ceil(Math.ceil(e.scanLines/8)*t.v/i),c=o*t.h,l=a*t.v,h=[],u=0;u<l;u++){for(var d=[],p=0;p<c;p++)d.push(new Int32Array(64));h.push(d)}t.blocksPerLine=s,t.blocksPerColumn=f,t.blocks=h}e.maxH=n,e.maxV=i,e.mcusPerLine=o,e.mcusPerColumn=a}var o,a,s,f,c=null,u=null,p=[],b=[],m=[],w=[],v=n();if(65496!==v)throw new Error("SOI not found");for(v=n();65497!==v;){var g,y;switch(v){case 65280:break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var k=(s=void 0,f=void 0,s=n(),f=t.subarray(r,r+s-2),r+=f.length,f);65504===v&&74===k[0]&&70===k[1]&&73===k[2]&&70===k[3]&&0===k[4]&&(c={version:{major:k[5],minor:k[6]},densityUnits:k[7],xDensity:k[8]<<8|k[9],yDensity:k[10]<<8|k[11],thumbWidth:k[12],thumbHeight:k[13],thumbData:k.subarray(14,14+3*k[12]*k[13])}),65518===v&&65===k[0]&&100===k[1]&&111===k[2]&&98===k[3]&&101===k[4]&&0===k[5]&&(u={version:k[6],flags0:k[7]<<8|k[8],flags1:k[9]<<8|k[10],transformCode:k[11]});break;case 65499:for(var _=n()+r-2;r<_;){var x=t[r++],E=new Int32Array(64);if(x>>4==0)for(y=0;y<64;y++){E[e[y]]=t[r++]}else{if(x>>4!=1)throw new Error("DQT: invalid table spec");for(y=0;y<64;y++){E[e[y]]=n()}}p[15&x]=E}break;case 65472:case 65473:case 65474:n(),(o={}).extended=65473===v,o.progressive=65474===v,o.precision=t[r++],o.scanLines=n(),o.samplesPerLine=n(),o.components={},o.componentsOrder=[];var A,S=t[r++];for(g=0;g<S;g++){A=t[r];var T=t[r+1]>>4,C=15&t[r+1],B=t[r+2];o.componentsOrder.push(A),o.components[A]={h:T,v:C,quantizationIdx:B},r+=3}i(o),b.push(o);break;case 65476:var D=n();for(g=2;g<D;){var M=t[r++],I=new Uint8Array(16),O=0;for(y=0;y<16;y++,r++)O+=I[y]=t[r];var Z=new Uint8Array(O);for(y=0;y<O;y++,r++)Z[y]=t[r];g+=17+O,(M>>4==0?w:m)[15&M]=l(I,Z)}break;case 65501:n(),a=n();break;case 65498:n();var P,U=t[r++],N=[];for(g=0;g<U;g++){P=o.components[t[r++]];var R=t[r++];P.huffmanTableDC=w[R>>4],P.huffmanTableAC=m[15&R],N.push(P)}var z=t[r++],L=t[r++],F=t[r++],H=h(t,r,o,N,a,z,L,F>>4,15&F);r+=H;break;case 65535:255!==t[r]&&r--;break;default:if(255===t[r-3]&&t[r-2]>=192&&t[r-2]<=254){r-=3;break}throw new Error("unknown JPEG marker "+v.toString(16))}v=n()}if(1!==b.length)throw new Error("only single frame JPEGs supported");for(var j=0;j<b.length;j++){var X=b[j].components;for(var Y in X)X[Y].quantizationTable=p[X[Y].quantizationIdx],delete X[Y].quantizationIdx}this.width=o.samplesPerLine,this.height=o.scanLines,this.jfif=c,this.adobe=u,this.components=[];for(var K=0;K<o.componentsOrder.length;K++){var G=o.components[o.componentsOrder[K]];this.components.push({lines:d(0,G),scaleX:G.h/o.maxH,scaleY:G.v/o.maxV})}},getData:function(e,t){var r,n,i,o,a,s,f,c,l,h,u,d,b,m,w,v,g,y,k,_,x,E=this.width/e,A=this.height/t,S=0,T=e*t*this.components.length,C=new Uint8Array(T);switch(this.components.length){case 1:for(r=this.components[0],h=0;h<t;h++)for(a=r.lines[0|h*r.scaleY*A],l=0;l<e;l++)u=a[0|l*r.scaleX*E],C[S++]=u;break;case 2:for(r=this.components[0],n=this.components[1],h=0;h<t;h++)for(a=r.lines[0|h*r.scaleY*A],s=n.lines[0|h*n.scaleY*A],l=0;l<e;l++)u=a[0|l*r.scaleX*E],C[S++]=u,u=s[0|l*n.scaleX*E],C[S++]=u;break;case 3:for(x=!0,this.adobe&&this.adobe.transformCode?x=!0:void 0!==this.colorTransform&&(x=!!this.colorTransform),r=this.components[0],n=this.components[1],i=this.components[2],h=0;h<t;h++)for(a=r.lines[0|h*r.scaleY*A],s=n.lines[0|h*n.scaleY*A],f=i.lines[0|h*i.scaleY*A],l=0;l<e;l++)x?(u=a[0|l*r.scaleX*E],d=s[0|l*n.scaleX*E],y=p(u+1.402*((b=f[0|l*i.scaleX*E])-128)),k=p(u-.3441363*(d-128)-.71413636*(b-128)),_=p(u+1.772*(d-128))):(y=a[0|l*r.scaleX*E],k=s[0|l*n.scaleX*E],_=f[0|l*i.scaleX*E]),C[S++]=y,C[S++]=k,C[S++]=_;break;case 4:if(!this.adobe)throw new Error("Unsupported color mode (4 components)");for(x=!1,this.adobe&&this.adobe.transformCode?x=!0:void 0!==this.colorTransform&&(x=!!this.colorTransform),r=this.components[0],n=this.components[1],i=this.components[2],o=this.components[3],h=0;h<t;h++)for(a=r.lines[0|h*r.scaleY*A],s=n.lines[0|h*n.scaleY*A],f=i.lines[0|h*i.scaleY*A],c=o.lines[0|h*o.scaleY*A],l=0;l<e;l++)x?(u=a[0|l*r.scaleX*E],d=s[0|l*n.scaleX*E],b=f[0|l*i.scaleX*E],m=c[0|l*o.scaleX*E],w=255-p(u+1.402*(b-128)),v=255-p(u-.3441363*(d-128)-.71413636*(b-128)),g=255-p(u+1.772*(d-128))):(w=a[0|l*r.scaleX*E],v=s[0|l*n.scaleX*E],g=f[0|l*i.scaleX*E],m=c[0|l*o.scaleX*E]),C[S++]=255-w,C[S++]=255-v,C[S++]=255-g,C[S++]=255-m;break;default:throw new Error("Unsupported color mode")}return C},copyToImageData:function(e){var t,r,n,i,o,a,s,f,c,l=e.width,h=e.height,u=e.data,d=this.getData(l,h),b=0,m=0;switch(this.components.length){case 1:for(r=0;r<h;r++)for(t=0;t<l;t++)n=d[b++],u[m++]=n,u[m++]=n,u[m++]=n,u[m++]=255;break;case 3:for(r=0;r<h;r++)for(t=0;t<l;t++)s=d[b++],f=d[b++],c=d[b++],u[m++]=s,u[m++]=f,u[m++]=c,u[m++]=255;break;case 4:for(r=0;r<h;r++)for(t=0;t<l;t++)o=d[b++],a=d[b++],n=d[b++],s=255-p(o*(1-(i=d[b++])/255)+i),f=255-p(a*(1-i/255)+i),c=255-p(n*(1-i/255)+i),u[m++]=s,u[m++]=f,u[m++]=c,u[m++]=255;break;default:throw new Error("Unsupported color mode")}}},c}();function p(e,t,r){if("png"===r)new h(e).parse(function(e,r){if(e)postMessage({success:!1,message:"readPNG: "+t,url:t});else{var n={width:r.width,height:r.height,data:r.pixels};postMessage({decoded:n,url:t,success:!0},[n.data.buffer])}});else if("jpg"===r){var n=function(e,t){var r={useTArray:!0,colorTransform:!0};t?"object"===u(t)?t={useTArray:void 0===t.useTArray?r.useTArray:t.useTArray,colorTransform:void 0===t.colorTransform?r.colorTransform:t.colorTransform}:(t=r).useTArray=!0:t=r;var n=new Uint8Array(e),i=new d;i.parse(n),i.colorTransform=t.colorTransform;var o={width:i.width,height:i.height,data:new Uint8Array(i.width*i.height*4)};return i.copyToImageData(o),o}(e,{useTArray:!0});postMessage({decoded:n,url:t,success:!0},[n.data.buffer])}else postMessage({success:!1,message:"Unsupported type "+r,url:t})}onmessage=function(e){var t=e.data.bufferArray,r=e.data.url,n=e.data.type;t?p(t,r,n):function(e,t){var r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="arraybuffer",r.onload=function(){if(200===r.status){var n=new Uint8Array(r.response||r.mozResponseArrayBuffer);n.length>0?t(n):postMessage({success:!1,message:"404",url:e})}else postMessage({success:!1,message:"404",url:e})},r.send()}(r,function(e){p(e,r,n)})},onerror=function(e){throw console.error("PicDecoder onerror",e),e}}]);',r.p+"da7071bea9585f24eb17.worker.js")}},function(e,t){
/*!
 * normalize-path <https://github.com/jonschlinkert/normalize-path>
 *
 * Copyright (c) 2014-2018, Jon Schlinkert.
 * Released under the MIT License.
 */
e.exports=function(e,t){if("string"!=typeof e)throw new TypeError("expected path to be a string");if("\\"===e||"/"===e)return"/";var r=e.length;if(r<=1)return e;var n="";if(r>4&&"\\"===e[3]){var i=e[2];"?"!==i&&"."!==i||"\\\\"!==e.slice(0,2)||(e=e.slice(2),n="//")}var o=e.split(/[\/\\]+/);return!1!==t&&""===o[o.length-1]&&o.pop(),n+o.join("/")}},function(e,t,r){r(17),e.exports=r(25)},function(e,t){!function(t){"use strict";var r,n=Object.prototype,i=n.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag",c="object"==typeof e,l=t.regeneratorRuntime;if(l)c&&(e.exports=l);else{(l=t.regeneratorRuntime=c?e.exports:{}).wrap=_;var f="suspendedStart",h="suspendedYield",p="executing",d="completed",v={},y={};y[a]=function(){return this};var m=Object.getPrototypeOf,g=m&&m(m(j([])));g&&g!==n&&i.call(g,a)&&(y=g);var b=k.prototype=x.prototype=Object.create(y);A.prototype=b.constructor=k,k.constructor=A,k[u]=A.displayName="GeneratorFunction",l.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===A||"GeneratorFunction"===(t.displayName||t.name))},l.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,k):(e.__proto__=k,u in e||(e[u]="GeneratorFunction")),e.prototype=Object.create(b),e},l.awrap=function(e){return{__await:e}},O(S.prototype),S.prototype[s]=function(){return this},l.AsyncIterator=S,l.async=function(e,t,r,n){var i=new S(_(e,t,r,n));return l.isGeneratorFunction(t)?i:i.next().then(function(e){return e.done?e.value:i.next()})},O(b),b[u]="Generator",b[a]=function(){return this},b.toString=function(){return"[object Generator]"},l.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},l.values=j,M.prototype={constructor:M,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=r,this.done=!1,this.delegate=null,this.method="next",this.arg=r,this.tryEntries.forEach(E),!e)for(var t in this)"t"===t.charAt(0)&&i.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=r)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,i){return s.type="throw",s.arg=e,t.next=n,i&&(t.method="next",t.arg=r),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var u=i.call(a,"catchLoc"),c=i.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&i.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,v):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),E(r),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;E(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:j(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=r),v}}}function _(e,t,r,n){var i=t&&t.prototype instanceof x?t:x,o=Object.create(i.prototype),a=new M(n||[]);return o._invoke=function(e,t,r){var n=f;return function(i,o){if(n===p)throw new Error("Generator is already running");if(n===d){if("throw"===i)throw o;return C()}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var s=P(a,r);if(s){if(s===v)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===f)throw n=d,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=p;var u=w(e,t,r);if("normal"===u.type){if(n=r.done?d:h,u.arg===v)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n=d,r.method="throw",r.arg=u.arg)}}}(e,r,a),o}function w(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}function x(){}function A(){}function k(){}function O(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function S(e){var t;this._invoke=function(r,n){function o(){return new Promise(function(t,o){!function t(r,n,o,a){var s=w(e[r],e,n);if("throw"!==s.type){var u=s.arg,c=u.value;return c&&"object"==typeof c&&i.call(c,"__await")?Promise.resolve(c.__await).then(function(e){t("next",e,o,a)},function(e){t("throw",e,o,a)}):Promise.resolve(c).then(function(e){u.value=e,o(u)},function(e){return t("throw",e,o,a)})}a(s.arg)}(r,n,t,o)})}return t=t?t.then(o,o):o()}}function P(e,t){var n=e.iterator[t.method];if(n===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=r,P(e,t),"throw"===t.method))return v;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return v}var i=w(n,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,v;var o=i.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=r),t.delegate=null,v):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,v)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function M(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function j(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,o=function t(){for(;++n<e.length;)if(i.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=r,t.done=!0,t};return o.next=o}}return{next:C}}function C(){return{value:r,done:!0}}}(function(){return this||"object"==typeof self&&self}()||Function("return this")())},function(e,t,r){var n,i,o;e.exports=(n=r(1),o=(i=n).lib.WordArray,i.enc.Base64={stringify:function(e){var t=e.words,r=e.sigBytes,n=this._map;e.clamp();for(var i=[],o=0;o<r;o+=3)for(var a=(t[o>>>2]>>>24-o%4*8&255)<<16|(t[o+1>>>2]>>>24-(o+1)%4*8&255)<<8|t[o+2>>>2]>>>24-(o+2)%4*8&255,s=0;s<4&&o+.75*s<r;s++)i.push(n.charAt(a>>>6*(3-s)&63));var u=n.charAt(64);if(u)for(;i.length%4;)i.push(u);return i.join("")},parse:function(e){var t=e.length,r=this._map,n=this._reverseMap;if(!n){n=this._reverseMap=[];for(var i=0;i<r.length;i++)n[r.charCodeAt(i)]=i}var a=r.charAt(64);if(a){var s=e.indexOf(a);-1!==s&&(t=s)}return function(e,t,r){for(var n=[],i=0,a=0;a<t;a++)if(a%4){var s=r[e.charCodeAt(a-1)]<<a%4*2,u=r[e.charCodeAt(a)]>>>6-a%4*2;n[i>>>2]|=(s|u)<<24-i%4*8,i++}return o.create(n,i)}(e,t,n)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},n.enc.Base64)},function(e,t,r){var n,i,o,a,s,u,c,l;e.exports=(n=r(1),o=(i=n).lib,a=o.WordArray,s=o.Hasher,u=i.algo,c=[],l=u.SHA1=s.extend({_doReset:function(){this._hash=new a.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var r=this._hash.words,n=r[0],i=r[1],o=r[2],a=r[3],s=r[4],u=0;u<80;u++){if(u<16)c[u]=0|e[t+u];else{var l=c[u-3]^c[u-8]^c[u-14]^c[u-16];c[u]=l<<1|l>>>31}var f=(n<<5|n>>>27)+s+c[u];f+=u<20?1518500249+(i&o|~i&a):u<40?1859775393+(i^o^a):u<60?(i&o|i&a|o&a)-1894007588:(i^o^a)-899497514,s=a,a=o,o=i<<30|i>>>2,i=n,n=f}r[0]=r[0]+n|0,r[1]=r[1]+i|0,r[2]=r[2]+o|0,r[3]=r[3]+a|0,r[4]=r[4]+s|0},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,n=8*e.sigBytes;return t[n>>>5]|=128<<24-n%32,t[14+(n+64>>>9<<4)]=Math.floor(r/4294967296),t[15+(n+64>>>9<<4)]=r,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=s.clone.call(this);return e._hash=this._hash.clone(),e}}),i.SHA1=s._createHelper(l),i.HmacSHA1=s._createHmacHelper(l),n.SHA1)},function(e,t,r){var n,i,o,a,s,u,c;e.exports=(n=r(1),o=(i=n).lib,a=o.Base,s=i.enc,u=s.Utf8,c=i.algo,void(c.HMAC=a.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=u.parse(t));var r=e.blockSize,n=4*r;t.sigBytes>n&&(t=e.finalize(t)),t.clamp();for(var i=this._oKey=t.clone(),o=this._iKey=t.clone(),a=i.words,s=o.words,c=0;c<r;c++)a[c]^=1549556828,s[c]^=909522486;i.sigBytes=o.sigBytes=n,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,r=t.finalize(e);t.reset();var n=t.finalize(this._oKey.clone().concat(r));return n}})))},function(e,t,r){var n;e.exports=(n=r(1),r(11),void(n.lib.Cipher||function(e){var t=n,r=t.lib,i=r.Base,o=r.WordArray,a=r.BufferedBlockAlgorithm,s=t.enc,u=(s.Utf8,s.Base64),c=t.algo,l=c.EvpKDF,f=r.Cipher=a.extend({cfg:i.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,r){this.cfg=this.cfg.extend(r),this._xformMode=e,this._key=t,this.reset()},reset:function(){a.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){e&&this._append(e);var t=this._doFinalize();return t},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function e(e){return"string"==typeof e?A:_}return function(t){return{encrypt:function(r,n,i){return e(n).encrypt(t,r,n,i)},decrypt:function(r,n,i){return e(n).decrypt(t,r,n,i)}}}}()}),h=(r.StreamCipher=f.extend({_doFinalize:function(){var e=this._process(!0);return e},blockSize:1}),t.mode={}),p=r.BlockCipherMode=i.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}}),d=h.CBC=function(){var t=p.extend();function r(t,r,n){var i=this._iv;if(i){var o=i;this._iv=e}else var o=this._prevBlock;for(var a=0;a<n;a++)t[r+a]^=o[a]}return t.Encryptor=t.extend({processBlock:function(e,t){var n=this._cipher,i=n.blockSize;r.call(this,e,t,i),n.encryptBlock(e,t),this._prevBlock=e.slice(t,t+i)}}),t.Decryptor=t.extend({processBlock:function(e,t){var n=this._cipher,i=n.blockSize,o=e.slice(t,t+i);n.decryptBlock(e,t),r.call(this,e,t,i),this._prevBlock=o}}),t}(),v=t.pad={},y=v.Pkcs7={pad:function(e,t){for(var r=4*t,n=r-e.sigBytes%r,i=n<<24|n<<16|n<<8|n,a=[],s=0;s<n;s+=4)a.push(i);var u=o.create(a,n);e.concat(u)},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},m=(r.BlockCipher=f.extend({cfg:f.cfg.extend({mode:d,padding:y}),reset:function(){f.reset.call(this);var e=this.cfg,t=e.iv,r=e.mode;if(this._xformMode==this._ENC_XFORM_MODE)var n=r.createEncryptor;else{var n=r.createDecryptor;this._minBufferSize=1}this._mode&&this._mode.__creator==n?this._mode.init(this,t&&t.words):(this._mode=n.call(r,this,t&&t.words),this._mode.__creator=n)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){e.pad(this._data,this.blockSize);var t=this._process(!0)}else{var t=this._process(!0);e.unpad(t)}return t},blockSize:4}),r.CipherParams=i.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}})),g=t.format={},b=g.OpenSSL={stringify:function(e){var t=e.ciphertext,r=e.salt;if(r)var n=o.create([1398893684,1701076831]).concat(r).concat(t);else var n=t;return n.toString(u)},parse:function(e){var t=u.parse(e),r=t.words;if(1398893684==r[0]&&1701076831==r[1]){var n=o.create(r.slice(2,4));r.splice(0,4),t.sigBytes-=16}return m.create({ciphertext:t,salt:n})}},_=r.SerializableCipher=i.extend({cfg:i.extend({format:b}),encrypt:function(e,t,r,n){n=this.cfg.extend(n);var i=e.createEncryptor(r,n),o=i.finalize(t),a=i.cfg;return m.create({ciphertext:o,key:r,iv:a.iv,algorithm:e,mode:a.mode,padding:a.padding,blockSize:e.blockSize,formatter:n.format})},decrypt:function(e,t,r,n){n=this.cfg.extend(n),t=this._parse(t,n.format);var i=e.createDecryptor(r,n).finalize(t.ciphertext);return i},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}}),w=t.kdf={},x=w.OpenSSL={execute:function(e,t,r,n){n||(n=o.random(8));var i=l.create({keySize:t+r}).compute(e,n),a=o.create(i.words.slice(t),4*r);return i.sigBytes=4*t,m.create({key:i,iv:a,salt:n})}},A=r.PasswordBasedCipher=_.extend({cfg:_.cfg.extend({kdf:x}),encrypt:function(e,t,r,n){var i=(n=this.cfg.extend(n)).kdf.execute(r,e.keySize,e.ivSize);n.iv=i.iv;var o=_.encrypt.call(this,e,t,i.key,n);return o.mixIn(i),o},decrypt:function(e,t,r,n){n=this.cfg.extend(n),t=this._parse(t,n.format);var i=n.kdf.execute(r,e.keySize,e.ivSize,t.salt);n.iv=i.iv;var o=_.decrypt.call(this,e,t,i.key,n);return o}})}()))},function(e,t,r){(function(t,r){e.exports=function(){"use strict";function e(e){return"function"==typeof e}function n(){var e=setTimeout;return function(){return e(i,1)}}function i(){for(var e=0;e<g;e+=2){var t=P[e],r=P[e+1];t(r),P[e]=void 0,P[e+1]=void 0}g=0}function o(e,t){var r=this,n=new this.constructor(s);void 0===n[E]&&y(n);var i=r._state;if(i){var o=arguments[i-1];w(function(){return v(i,n,o,r._result)})}else p(r,n,e,t);return n}function a(e){if(e&&"object"==typeof e&&e.constructor===this)return e;var t=new this(s);return c(t,e),t}function s(){}function u(t,r,n){r.constructor===t.constructor&&n===o&&r.constructor.resolve===a?function(e,t){t._state===j?f(e,t._result):t._state===C?h(e,t._result):p(t,void 0,function(t){return c(e,t)},function(t){return h(e,t)})}(t,r):void 0===n?f(t,r):e(n)?function(e,t,r){w(function(e){var n=!1,i=function(e,t,r,n){try{e.call(t,r,n)}catch(e){return e}}(r,t,function(r){n||(n=!0,t!==r?c(e,r):f(e,r))},function(t){n||(n=!0,h(e,t))},e._label);!n&&i&&(n=!0,h(e,i))},e)}(t,r,n):f(t,r)}function c(e,t){if(e===t)h(e,new TypeError("You cannot resolve a promise with itself"));else if(function(e){var t=typeof e;return null!==e&&("object"===t||"function"===t)}(t)){var r=void 0;try{r=t.then}catch(t){return void h(e,t)}u(e,t,r)}else f(e,t)}function l(e){e._onerror&&e._onerror(e._result),d(e)}function f(e,t){e._state===M&&(e._result=t,e._state=j,0!==e._subscribers.length&&w(d,e))}function h(e,t){e._state===M&&(e._state=C,e._result=t,w(l,e))}function p(e,t,r,n){var i=e._subscribers,o=i.length;e._onerror=null,i[o]=t,i[o+j]=r,i[o+C]=n,0===o&&e._state&&w(d,e)}function d(e){var t=e._subscribers,r=e._state;if(0!==t.length){for(var n=void 0,i=void 0,o=e._result,a=0;a<t.length;a+=3)n=t[a],i=t[a+r],n?v(r,n,i,o):i(o);e._subscribers.length=0}}function v(t,r,n,i){var o=e(n),a=void 0,s=void 0,u=!0;if(o){try{a=n(i)}catch(e){u=!1,s=e}if(r===a)return void h(r,new TypeError("A promises callback cannot return that same promise."))}else a=i;r._state!==M||(o&&u?c(r,a):!1===u?h(r,s):t===j?f(r,a):t===C&&h(r,a))}function y(e){e[E]=R++,e._state=void 0,e._result=void 0,e._subscribers=[]}var m=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},g=0,b=void 0,_=void 0,w=function(e,t){P[g]=e,P[g+1]=t,2===(g+=2)&&(_?_(i):T())},x="undefined"!=typeof window?window:void 0,A=x||{},k=A.MutationObserver||A.WebKitMutationObserver,O="undefined"==typeof self&&void 0!==t&&"[object process]"==={}.toString.call(t),S="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,P=new Array(1e3),T=void 0;T=O?function(){return t.nextTick(i)}:k?function(){var e=0,t=new k(i),r=document.createTextNode("");return t.observe(r,{characterData:!0}),function(){r.data=e=++e%2}}():S?function(){var e=new MessageChannel;return e.port1.onmessage=i,function(){return e.port2.postMessage(0)}}():void 0===x?function(){try{var e=Function("return this")().require("vertx");return void 0!==(b=e.runOnLoop||e.runOnContext)?function(){b(i)}:n()}catch(e){return n()}}():n();var E=Math.random().toString(36).substring(2),M=void 0,j=1,C=2,R=0,I=function(){function e(e,t){this._instanceConstructor=e,this.promise=new e(s),this.promise[E]||y(this.promise),m(t)?(this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?f(this.promise,this._result):(this.length=this.length||0,this._enumerate(t),0===this._remaining&&f(this.promise,this._result))):h(this.promise,new Error("Array Methods must be provided an Array"))}return e.prototype._enumerate=function(e){for(var t=0;this._state===M&&t<e.length;t++)this._eachEntry(e[t],t)},e.prototype._eachEntry=function(e,t){var r=this._instanceConstructor,n=r.resolve;if(n===a){var i=void 0,c=void 0,l=!1;try{i=e.then}catch(e){l=!0,c=e}if(i===o&&e._state!==M)this._settledAt(e._state,t,e._result);else if("function"!=typeof i)this._remaining--,this._result[t]=e;else if(r===L){var f=new r(s);l?h(f,c):u(f,e,i),this._willSettleAt(f,t)}else this._willSettleAt(new r(function(t){return t(e)}),t)}else this._willSettleAt(n(e),t)},e.prototype._settledAt=function(e,t,r){var n=this.promise;n._state===M&&(this._remaining--,e===C?h(n,r):this._result[t]=r),0===this._remaining&&f(n,this._result)},e.prototype._willSettleAt=function(e,t){var r=this;p(e,void 0,function(e){return r._settledAt(j,t,e)},function(e){return r._settledAt(C,t,e)})},e}(),L=function(){function t(e){this[E]=R++,this._result=this._state=void 0,this._subscribers=[],s!==e&&("function"!=typeof e&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof t?function(e,t){try{t(function(t){c(e,t)},function(t){h(e,t)})}catch(t){h(e,t)}}(this,e):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return t.prototype.catch=function(e){return this.then(null,e)},t.prototype.finally=function(t){var r=this,n=r.constructor;return e(t)?r.then(function(e){return n.resolve(t()).then(function(){return e})},function(e){return n.resolve(t()).then(function(){throw e})}):r.then(t,t)},t}();return L.prototype.then=o,L.all=function(e){return new I(this,e).promise},L.race=function(e){var t=this;return new t(m(e)?function(r,n){for(var i=e.length,o=0;o<i;o++)t.resolve(e[o]).then(r,n)}:function(e,t){return t(new TypeError("You must pass an array to race."))})},L.resolve=a,L.reject=function(e){var t=new this(s);return h(t,e),t},L._setScheduler=function(e){_=e},L._setAsap=function(e){w=e},L._asap=w,L.polyfill=function(){var e=void 0;if(void 0!==r)e=r;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var n=null;try{n=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===n&&!t.cast)return}e.Promise=L},L.Promise=L,L.polyfill(),L}()}).call(this,r(23),r(24))},function(e,t){var r,n,i=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(e){if(r===setTimeout)return setTimeout(e,0);if((r===o||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:o}catch(e){r=o}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(e){n=a}}();var u,c=[],l=!1,f=-1;function h(){l&&u&&(l=!1,u.length?c=u.concat(c):f=-1,c.length&&p())}function p(){if(!l){var e=s(h);l=!0;for(var t=c.length;t;){for(u=c,c=[];++f<t;)u&&u[f].run();f=-1,t=c.length}u=null,l=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function d(e,t){this.fun=e,this.array=t}function v(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];c.push(new d(e,t)),1!==c.length||l||s(p)},d.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=v,i.addListener=v,i.once=v,i.off=v,i.removeListener=v,i.removeAllListeners=v,i.emit=v,i.prependListener=v,i.prependOnceListener=v,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){"use strict";r.r(t);var n={};r.r(n),r.d(n,"env",function(){return N});var i={};r.r(i),r.d(i,"delayPromise",function(){return G}),r.d(i,"timedPromise",function(){return H}),r.d(i,"throttle",function(){return K}),r.d(i,"debounce",function(){return q});var o={};r.r(o),r.d(o,"MAJOR_AXIS",function(){return Y}),r.d(o,"MINOR_AXIS",function(){return X}),r.d(o,"MINOR_OVER_MAJOR",function(){return Z}),r.d(o,"EQUATOR",function(){return Q}),r.d(o,"EARTH_RADIUS",function(){return J}),r.d(o,"ATMOSTPHERE_OUTER_RATIO",function(){return $}),r.d(o,"ATMOSTPHERE_INNER_RATIO",function(){return ee});var a={};r.r(a),r.d(a,"getTileWebMercatorEnvelopeByGrid",function(){return se}),r.d(a,"intersectRayAndEllipsoid",function(){return ue});var s={};r.r(s),r.d(s,"oblate",function(){return ve});var u={};r.r(u),r.d(u,"deprecated",function(){return ye}),r.d(u,"removed",function(){return me});var c={};r.r(c),r.d(c,"loadTexture",function(){return Jn}),r.d(c,"stringsToTextures",function(){return $n}),r.d(c,"stringToTexture",function(){return ti}),r.d(c,"loadImageData",function(){return ni}),r.d(c,"loadDemImageData",function(){return oi});var l={};r.r(l),r.d(l,"loadUVMap",function(){return Pi}),r.d(l,"solidColorTexture",function(){return Ti});var f={};r.r(f),r.d(f,"loadMaskAPI",function(){return Uf});var h=r(7),p=r(0),d={};d.isMobile=/iPhone|iPod|iPad|Android|BlackBerry/.test(navigator.userAgent),d.createDiv=function(e,t,r,n){var i=document.createElement("div");return"undefined"!=typeof id&&(i.id=t+"_div"),void 0!==t&&(i.className=t),void 0!==r&&(i.style.cssText=r),void 0!==n&&(i.innerHTML=n),e.appendChild(i),i},d.createMessageDiv=function(e,t,r,n){var i=["z-index: 2;","position: absolute;","left:0px;","top:0px;","width:100%;","height:100%;","font-size:12pt;","text-align: center;","vertical-align: middle;","text-align: -webkit-center;","vertical-align: -webkit-middle;","background-color: #"+r.toString(16)+";","color: #"+(16777215-r).toString(16)+";","margin:0px;","padding:0px;"].join(""),o=d.createDiv(e,"ErrorDiv",i),a=["position: relative;","top:40%;","font-size:12pt;","text-align: center;","vertical-align: middle;","text-align: -webkit-center;","vertical-align: -webkit-middle;","margin:0px;","padding:0px;"].join(""),s=d.createDiv(o,"ErrorTextDiv",a);return s.innerHTML=t,n&&(s.innerHTML+='<br><br><a href="'+n+'" class="btn-link">Learn More</a>'),o},d.createThree=function(e,t){var r=["z-index: 0;","position: relative;","left:0px;","top:0px;","width:100%;","height:100%;","margin:0px;","overflow: hidden !important;","padding:0px;"];return t&&r.push("background-image: ".concat(t)),r=r.join(""),d.createDiv(e,"ThreeDiv",r)},d.displayDepthTexture=function(e,t){var r=window.open("","_blank"),n=e.dimension.width,i=e.dimension.height;r.document.write("\n      <title>".concat(t,"</title>\n      <p>").concat(t,'</p>\n      <p>depth</p>\n      <div><canvas id="targetdepth" width=').concat(n," height=").concat(i," /></div>\n      "));var o=r.document.getElementById("targetdepth").getContext("2d");o.clearRect(0,0,n,i);for(var a=o.createImageData(n,i),s=0;s<a.data.length;s+=4)a.data[s]=e.buffer[s/4],a.data[s+1]=e.buffer[s/4],a.data[s+2]=e.buffer[s/4],a.data[s+3]=e.buffer[s/4];o.putImageData(a,0,0)},d.displayTexture=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"texture",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"rgb",n=window.open("",t),i=e.dimension.width,o=e.dimension.height;n.document.write("\n      <title>".concat(t,"</title>\n      <p>").concat(t,'</p>\n      <p>depth</p>\n      <div><canvas id="textureCanvas" width=').concat(i," height=").concat(o," /></div>\n      "));var a=n.document.getElementById("textureCanvas").getContext("2d");a.clearRect(0,0,i,o);var s=a.createImageData(i,o);if("rgb"===r)for(var u=0;u<s.data.length;u+=1)s.data[u]=e.buffer[u];else if("depth"===r)for(var c=0;c<s.data.length;c+=4)s.data[c]=e.buffer[c/4],s.data[c+1]=e.buffer[c/4],s.data[c+2]=e.buffer[c/4],s.data[c+3]=e.buffer[c/4];a.putImageData(s,0,0)};var v=d,y={disposeMesh:function(e){e&&(e.geometry&&e.geometry.dispose&&e.geometry.dispose(),e.material&&(e.material.map&&e.material.map.dispose&&(e.material.map.dispose(),e.material.map=void 0),e.material.alphaMap&&e.material.alphaMap.dispose&&(e.material.alphaMap.dispose(),e.material.alphaMap=void 0),e.material.dispose&&e.material.dispose()))},clearRenderListRenferenceToMesh:function(e){for(var t=0;t<e.transparent.length;++t){var r=e.transparent[t];r.id=void 0,r.object=void 0,r.geometry=void 0,r.material=void 0,r.program=void 0,r.renderOrder=void 0,r.z=void 0,r.group=void 0}for(var n=0;n<e.opaque.length;++n){var i=e.opaque[n];i.id=void 0,i.object=void 0,i.geometry=void 0,i.material=void 0,i.program=void 0,i.renderOrder=void 0,i.z=void 0,i.group=void 0}}};function m(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var g=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._viewer=t,this._transparent=r.transparent,this._opacity=r.opacity,this._color=new p.Color(r.color),this._image=r.image}var t,r,n;return t=e,(r=[{key:"destruct",value:function(){this._viewer=void 0,this._transparent=void 0,this._opacity=void 0,this._color=void 0,this._image=void 0}},{key:"transparent",get:function(){return this._transparent}},{key:"opacity",set:function(e){this._viewer.renderer.setClearAlpha(e),this._opacity=e},get:function(){return this._opacity}},{key:"color",set:function(e){var t=new p.Color(e);this._viewer.renderer.setClearColor(t,this.opacity),this._color=e},get:function(){return this._color}},{key:"image",set:function(e){var t=["z-index: 0;","position: relative;","left:0px;","top:0px;","width:100%;","height:100%;","margin:0px;","overflow: hidden !important;","padding:0px;"];e&&t.push("background-image: ".concat(e)),t=t.join(""),this._viewer.threeContainer.style.cssText=t,this._image=e},get:function(){return this._image}}])&&m(t.prototype,r),n&&m(t,n),e}(),b=r(4),_=r.n(b),w=r(12),x=r.n(w);function A(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var k=function(){function e(t){var r=t.name;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name=r,this.lscache=x.a,this.lscache.setBucket(this.name+"-")}var t,r,n;return t=e,(r=[{key:"destruct",value:function(){return this.name=void 0,this.lscache=void 0,!0}},{key:"setItem",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,n=this.lscache.set(e,t,r);return Promise.resolve(n)}},{key:"getItem",value:function(e){var t=this.lscache.get(e);return t?Promise.resolve(t):Promise.reject(new Error("404"))}},{key:"remove",value:function(e){return this.lscache.remove(e)}},{key:"flush",value:function(){return this.lscache.flush()}},{key:"flushExpired",value:function(){return this.lscache.flushExpired()}},{key:"stat",get:function(){var e,t=0;for(e in localStorage)localStorage.hasOwnProperty(e)&&(t+=2*(localStorage[e].length+e.length));return{used:t/=1024}}}])&&A(t.prototype,r),n&&A(t,n),e}(),O=r(2),S=r.n(O),P=r(3),T=r.n(P);function E(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var M=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.apiUrl=t.apiUrl,this.key=t.key,this.altitoken=t.altitoken,this.cache=new k({name:S()("EngineApi").toString(T.a)})}var t,r,n;return t=e,(r=[{key:"destruct",value:function(){return this.cache.flushExpired(),!0}},{key:"project",value:function(e){var t=e.pid,r=e.timeout,n=void 0===r?1e4:r,i='{project(id: "'+t+'") { id name owner { id name } isImported modelType views date versionControl cloudPath { key dataUrl } geoInfo { mercatorTransform transformed manualAligned autoAligned minLat minLong maxLat maxLong centerLat centerLong } annotations{edges{node{ id modelx modely modelz title description color glyph createTimestamp editTimestamp cameraPosition {x y z} centerPosition {x y z}}}} modelTransform { origin xDir yDir zDir minBound maxBound xTiles yTiles zTiles floorHeight onLoadTrans lengthUnitToMeter initialCamPos {cameraPos centerPos} }}}';return this._requestNcache(i,n).then(function(e){return Promise.resolve(e.data.data.project)}).catch(function(e){return console.error("api:project",e),Promise.reject(e)})}},{key:"my",value:function(e){var t=e&&e.timeout?e.timeout:1e4;return this._requestNcache("{my{self{ id name email balance company country joined}\n   projects { edges {node { id name owner {id username name} views date versionControl  cloudPath { key dataUrl }  geoInfo { mercatorTransform transformed manualAligned autoAligned minLat minLong maxLat maxLong centerLat centerLong }  modelTransform { origin xDir yDir zDir minBound maxBound xTiles yTiles zTiles floorHeight onLoadTrans lengthUnitToMeter}}}}}}",t).then(function(e){return Promise.resolve(e.data.data.my)}).catch(function(e){return console.error("api:my",e),Promise.reject(e)})}},{key:"allProjects",value:function(e){var t=e.limit,r=e.timeout?e.timeout:2e4,n="{ allProjects (first: "+t+") { edges { node { id name showLocation visibility geoInfo {autoAligned minLat minLong maxLat maxLong centerLat centerLong } cloudPath {key dataUrl} versionControl  modelTransform { origin xDir yDir zDir minBound maxBound xTiles yTiles zTiles floorHeight onLoadTrans lengthUnitToMeter}  views owner {name joined} date  } } } }";return this._requestNcache(n,r).then(function(e){for(var t=[],r=e.data.data.allProjects.edges,n=0;n<r.length;n++)t.push(r[n].node);return Promise.resolve(t)}).catch(function(e){return console.error("api:allProjects",e),Promise.reject(e)})}},{key:"getCountryName",value:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).timeout,t=void 0===e?1e4:e;return this._requestNcache("{ getGeoIPInfo { countryName } }",t).then(function(e){return Promise.resolve(e.data.data.getGeoIPInfo.countryName)}).catch(function(e){return console.warn("api:getGeoIPInfo",e,"set to China"),Promise.resolve("China")})}},{key:"geoNearProjects",value:function(e){var t=e.limit,r=e.center,n=e.span,i=e.timeout?e.timeout:1e4,o=function(e){var t=e[0],r=e[1];t<-180?t=-180:t>180&&(t=180);r<-90?r=-90:r>90&&(r=90);return[t,r]}([r.lng,r.lat]),a="{geoNearProjects(center: "+("{ latitude: "+o[1]+", longitude:"+o[0]+" }")+", span:"+n+", limit: "+t+") {id name visibility geoInfo {autoAligned minLat minLong maxLat maxLong centerLat centerLong } cloudPath {key dataUrl} versionControl  modelTransform { origin xDir yDir zDir minBound maxBound xTiles yTiles zTiles floorHeight onLoadTrans lengthUnitToMeter}  views owner {name joined} date }}";return this._request(a,i).then(function(e){var t=e.data.data.geoNearProjects;return Promise.resolve(t)}).catch(function(e){return console.error("api:geoNearProjects",e),Promise.reject(e)})}},{key:"getMatchingPose",value:function(e){for(var t=e.intrinsic,r=e.pairs,n=e.timeout,i=void 0===n?1e4:n,o="intrinsic:{u:"+t.u+",v:"+t.v+",f:"+t.f+"}",a="pairs:[",s=0;s<5;++s){var u=r[s],c=u.imageCoord,l=u.objectCoord;a+="{imageCoord:"+h([c[0],c[1]])+",objectCoord:"+h([l[0],l[1],l[2]])+"}",4!==s&&(a+=",")}var f="{utility{poseEstimation(input:{"+o+","+(a+="]")+"}){ok message{en{errorCode description solution}zh_cn{errorCode description solution}} reprojectionError pose}}}";function h(e){for(var t="[",r=0;r<e.length-1;++r)t+=e[r]+",";return t+=e[e.length-1]+"]"}return this._request(f,i).then(function(e){return Promise.resolve(e)}).catch(function(e){return console.error("api:getMatchingPose",e),Promise.reject(e)})}},{key:"_request",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e4,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,n={key:this.key};this.altitoken&&(n.altitoken=this.altitoken);var i=this;return r--,_()({method:"post",url:this.apiUrl,timeout:t,headers:n,data:"query="+e+" #sdk",responseType:"json"}).catch(function(n){return n instanceof Error&&n.message.includes("timeout")&&r>0?i._request(e,2*t,r):Promise.reject(n)})}},{key:"_requestNcache",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e4,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4320,i=S()(e+this.key+this.altitoken).toString(T.a),o=this,a=o._request(e,t,r).then(function(e){return o.cache.setItem(i,{data:e.data},n).catch(function(e){return console.warn(e),Promise.resolve()}),Promise.resolve(e)});return this.cache.getItem(i).catch(function(e){return"404"!==e.message&&console.warn(e),a})}},{key:"cropMask",value:function(e){var t=e.pid,r=e.timeout?e.timeout:1e4,n='{project(id: "'+t+'") { \n      cropMask { \n        usage \n        maskBox { minX minY maxX maxY } \n        maskInfos { polyNum width height data } \n      } \n    }}';return this._request(n,r).then(function(e){return Promise.resolve(e.data.data.project.cropMask)}).catch(function(e){return console.error("api:cropMask",e),Promise.reject(e)})}},{key:"waterMask",value:function(e){var t=e.pid,r=e.timeout?e.timeout:1e4,n='{project(id: "'+t+'"){\n      waterMask {\n        maskInfos { level alpha wave color polyNum width height data }\n        maskBox { minX minY maxX maxY }\n      }\n    }}';return this._request(n,r).then(function(e){return Promise.resolve(e.data.data.project.waterMask)}).catch(function(e){return console.error("api:waterMask",e),Promise.reject(e)})}},{key:"projectMask",value:function(e){var t=e.pid,r=e.usage;return"crop"===r?this.cropMask({pid:t}):"water"===r?this.waterMask({pid:t}):Promise.reject(new Error("Unknown mask usage "+r))}},{key:"altitoken",set:function(e){this._altitoken=e},get:function(){return this._altitoken}},{key:"key",set:function(e){this._key=e},get:function(){return this._key}}])&&E(t.prototype,r),n&&E(t,n),e}(),j=r(8),C=r.n(j),R=r(9),I=r.n(R);function L(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var B=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._version="0.0.1"}var t,r,n;return t=e,n=[{key:"detectIE",value:function(){var e=window.navigator.userAgent,t=e.indexOf("MSIE ");if(t>0)return parseInt(e.substring(t+5,e.indexOf(".",t)),10);if(e.indexOf("Trident/")>0){var r=e.indexOf("rv:");return parseInt(e.substring(r+3,e.indexOf(".",r)),10)}var n=e.indexOf("Edge/");return n>0&&parseInt(e.substring(n+5,e.indexOf(".",n)),10)}},{key:"isMobile",get:function(){return!(!navigator||!navigator.userAgent)&&/iPhone|iPod|iPad|Android|BlackBerry/.test(navigator.userAgent)}},{key:"canvas",get:function(){return!!window.CanvasRenderingContext2D}},{key:"webgl",get:function(){return function(){try{return!!window.WebGLRenderingContext&&!!document.createElement("canvas").getContext("experimental-webgl")}catch(e){return!1}}()}},{key:"webgl2",get:function(){return!!document.createElement("canvas").getContext("webgl2")}},{key:"workers",get:function(){return!!window.Worker}},{key:"browser",get:function(){return{isWeChat:navigator.userAgent.indexOf("MicroMessenger")>=0,isOpera:!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0,isFirefox:"undefined"!=typeof InstallTrigger,isSafari:Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0,isChrome:!!window.chrome,isIE:!!document.documentMode}}}],(r=null)&&L(t.prototype,r),n&&L(t,n),e}();function U(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function D(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var N=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),D(this,"_countryName","China"),D(this,"_ISMOBILE",!0),D(this,"_WEBGL",!0),D(this,"_BROWSER",void 0),console.log("LocalEnv constructor`"),this._countryName=this._tryAssignByCache("countryName"),this._ISMOBILE=B.isMobile,this._WEBGL=B.webgl,this._BROWSER=B.browser}var t,r,n;return t=e,(r=[{key:"_tryAssignByCache",value:function(e){try{var t=localStorage.getItem(e);if(t)return t}catch(e){console.error(e)}return"China"}},{key:"countryName",get:function(){return this._countryName},set:function(e){e!==this.countryName&&(this._countryName=e,localStorage.setItem("countryName",e))}},{key:"ISMOBILE",get:function(){return this._ISMOBILE}},{key:"WEBGL",get:function(){return this._WEBGL}},{key:"BROWSER",get:function(){return this._BROWSER}}])&&U(t.prototype,r),n&&U(t,n),e}());function z(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var F=function(){function e(t,r){var n=r.HOST,i=r.api,o=r.background,a=void 0===o?{transparent:!1,opacity:.8,color:2565927,image:void 0}:o,s=r.debug;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),i&&i.key&&i.apiUrl||console.warn("No api.");var u=this;this.debug=s,this._HOST=n,this._apiParams=i,this.rootContainer=null,this.threeContainer=null,this.renderer=null,this.scene=null,this.camera=null,this.effect=null,this._freeze=!1,this._live=!1,this.layers={},this.control=null,window.viewer=this,function(){if(u.rootContainer=document.getElementById(t),!u.rootContainer)return console.error("Invalid "+t),!1;if(u.threeContainer=v.createThree(u.rootContainer,a.image),!N.WEBGL){if(N.BROWSER.isWeChat){var e=/iPhone|iPod|iPad/.test(navigator.userAgent)?"Open in Safari":"Open with Browser";return v.createMessageDiv(u.rootContainer,'1. Click the button on upper right corner. <br>2. Select "'+e+'".',a.color),!1}return v.createMessageDiv(u.rootContainer,"No WebGL Support",a.color,"/support/articles/faq_compatibility"),!1}}(),function(){u.scene=new p.Scene;var e={eye:new p.Vector3(0,0,0),NEAR:u.scale/1e10,FAR:6*u.scale},t=u.width/u.height,r=e.NEAR,n=e.FAR;u.camera=new p.PerspectiveCamera(45,t,r,n),u.scene.add(u.camera),u.camera.position.copy(e.eye);var i=a;u.renderer=new p.WebGLRenderer({antialias:!0,alpha:i.transparent,logarithmicDepthBuffer:!1}),window.__renderer=u.renderer,u.renderer.setClearColor(new p.Color(i.color),i.transparent?i.opacity:void 0),u.renderer.autoClear=!1;var o=void 0!==window.devicePixelRatio?window.devicePixelRatio:1,s=Math.max(1.2,.1*(o-1)+1);u.renderer.setPixelRatio(s),u.renderer.setSize(u.width,u.height),u.renderer.context.getExtension("OES_standard_derivatives"),u.threeContainer.appendChild(u.renderer.domElement);var c=new p.AmbientLight(4210752,1);u.scene.add(c);var l=new p.PointLight(13696511,1.1,0);l.color.setHex(16777215),l.position.set(0,0,0),u.camera.add(l),u._lights={ambient:c,point:l}}(),this.background=new g(this,a),this._live=!0,function e(){if(!u.isUpdating)return;u.control&&u.control.update();u.animate();u.render();u._stats&&u._stats.update();requestAnimationFrame(e)}()}var t,r,n;return t=e,(r=[{key:"destruct",value:function(){var e=!0;return this.background.destruct(),this.background=void 0,this.layers={},this.layersReady=null,this.control&&(e=this.control.destruct()&&e,this.control=void 0),this.renderer.forceContextLoss(),this.renderer.context=null,this.renderer.domElement=null,this.renderer.dispose(),this.renderer=null,this._welcomeMesh&&(this._welcomeMesh.geometry.dispose(),this._welcomeMesh.material.dispose(),this._welcomeMesh=void 0),this._live=!1,window.viewer=void 0,e}},{key:"freeze",value:function(){this._freeze=!0}},{key:"unfreeze",value:function(){this._freeze=!1}},{key:"animate",value:function(){}},{key:"render",value:function(){this.effect?this.effect.render(this.scene,this.camera):(this.renderer.clear(),this.renderer.render(this.scene,this.camera),this.__sceneOrtho&&this.__cameraOrtho&&this.__displayingTexture&&(this.renderer.clearDepth(),this.renderer.render(this.__sceneOrtho,this.__cameraOrtho),y.clearRenderListRenferenceToMesh(this.renderer.renderLists.get(this.__sceneOrtho,this.__cameraOrtho))),y.clearRenderListRenferenceToMesh(this.renderer.renderLists.get(this.scene,this.camera)))}},{key:"cameraChangeHandler",value:function(){}},{key:"updateViewDependentContent",value:function(){}},{key:"updateViewDependentVisibility",value:function(){}},{key:"attachEffect",value:function(e,t){return this.threeContainer&&this.renderer?(this.effect=new e(this.renderer,t),this.effect&&this.effect.setSize(this.width,this.height),this.effect):(console.error("The renderer has not been initialized"),null)}},{key:"resize",value:function(){this.camera.aspect=this.width/this.height,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.width,this.height),this.effect&&this.effect.setSize(this.width,this.height)}},{key:"_updateVisibility",value:function(){this.camera.updateMatrix(),this.camera.updateMatrixWorld(!0),this.camera.updateProjectionMatrix(),this.camera.matrixWorldInverse.getInverse(this.camera.matrixWorld);var e=new p.Frustum;e.setFromMatrix((new p.Matrix4).multiplyMatrices(this.camera.projectionMatrix,this.camera.matrixWorldInverse));var t={frustum:e};for(var r in this.layers)this.layers[r]&&this.layers[r].updateVisibility(t);return!0}},{key:"_displayTexture",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:256,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:256;void 0===this.__sceneOrtho&&(this.__sceneOrtho=new p.Scene),void 0===this.__textureSprite&&(this.__textureSprite=new p.Sprite,this.__sceneOrtho.add(this.__textureSprite)),void 0===this.__cameraOrtho&&(this.__cameraOrtho=new p.OrthographicCamera(-this.width/2,this.width/2,this.height/2,-this.height/2,1,10),this.__cameraOrtho.position.z=10),this.__textureSprite.visible=!0,this.__textureSprite.scale.set(t,r,1);var n=this.width/2,i=this.height/2,o=t/2,a=r/2;this.__textureSprite.position.set(-n+o,i-a,1),e&&(this.__textureSprite.material.map=e,this.__textureSprite.material.transparent=!0,this.__textureSprite.material.needsUpdate=!0),this.__displayingTexture=!0}},{key:"_hideTexture",value:function(){this.__sceneOrtho&&this.__cameraOrtho&&this.__displayingTexture&&(this.__textureSprite.visible=!1,this.__displayingTexture=!1)}},{key:"width",get:function(){return this.threeContainer.clientWidth}},{key:"height",get:function(){return this.threeContainer.clientHeight}},{key:"HOST",get:function(){return this._HOST}},{key:"altizureApi",get:function(){var e="China"===N.countryName?"U2FsdGVkX19l4+V8uQYRigbhRUbtp+TqhjxwRO/FKTliJ0AFJkFXCzSs+ehN700y":"U2FsdGVkX1+4NPYcWb4OT1DtznlOxtfVxvmlbvbsJtDc929Fj2i8H+oXYiIHG2h2QXmweoJYwWJjkPNXS/29SQ==",t=Object.assign({},{API_HOST:e,API_KEY:"U2FsdGVkX19phGn0b5VCcKo7Vu7x1XAz2BKyuIasob2KrQD1CLAC9Ls72FjPeP+/NBhDGn19Gsh13EumIGZ95w=="},this._apiParams),r=C.a.decrypt(t.API_HOST,"altizure-environment").toString(I.a),n=C.a.decrypt(t.API_KEY,"altizure-environment").toString(I.a);return Object.defineProperty(this,"altizureApi",{value:new M({apiUrl:r,key:n,altitoken:t.altitoken}),writable:!1,configurable:!0}),this.altizureApi},set:function(e){var t=e.apiUrl,r=e.key,n=e.altitoken;t&&(this.altizureApi.apiUrl=t),r&&(this.altizureApi.key=r),n&&(this.altizureApi.altitoken=n)}},{key:"countryName",get:function(){var e=this;return this.altizureApi.getCountryName().then(function(e){return N.countryName=e,Promise.resolve(e)}).catch(function(e){return console.warn(e),Promise.resolve("China")}).then(function(t){return Object.defineProperty(e,"countryName",{value:Promise.resolve(t),writable:!1,configurable:!0}),t})}},{key:"lights",get:function(){return this._lights}},{key:"isFreezing",get:function(){return this._freeze}},{key:"isLiving",get:function(){return this._live}},{key:"isUpdating",get:function(){return!this.isFreezing&&this.isLiving}}])&&z(t.prototype,r),n&&z(t,n),e}();function V(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var W=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._parent=t,this._node=new p.Object3D,this._children=[],null!==t&&t.addChild(this),this.visible=!0,this._property={type:"HyperNode"}}var t,r,n;return t=e,(r=[{key:"destruct",value:function(){this._property.type="destructed";var e=!0;if(this.children&&this.children.length>0)for(var t=this.children.length-1;t>=0;t--)e=e&&this.children[t].destruct();return this._children=[],this.parent&&(e=e&&this.parent.removeChild(this)),this._parent=null,this._node=void 0,e||console.warn("HyperNode destruct failure."),e}},{key:"addChild",value:function(e){return-1!==this._children.indexOf(e)?(console.warn("Trying to add an exisitng child."),!1):(this._children.push(e),this._node.add(e.sceneNode),!0)}},{key:"removeChild",value:function(e){var t=this._children.indexOf(e);return-1===t?(console.warn("Trying to remove an un-exisitng child."),!1):(this._children.splice(t,1),this._node.remove(e.sceneNode),!0)}},{key:"applyToChildren",value:function(e,t,r,n){for(var i=!0,o=0;o<this._children.length;o++)i=e(this._children[o],t,r,n)&&i;return i}},{key:"traverse",value:function(e){var t=!0;t=e(this)&&t;for(var r=0;r<this._children.length;r++)t=this._children[r].traverse(e)&&t;return t}},{key:"traverseVisible",value:function(e){if(!1===this.visible)return!0;var t=!0;t=e(this)&&t;for(var r=0;r<this._children.length;r++)t=this._children[r].traverse(e)&&t;return t}},{key:"traverseAncestors",value:function(e){var t=this.parent,r=!0;return null!==t&&(r=e(t)&&r,r=t.traverseAncestors(e)&&r),r}},{key:"setMatrix",value:function(e,t){this.sceneNode.matrix.copy(e),this.sceneNode.matrixWorldNeedsUpdate=!0}},{key:"sceneUpdated",value:function(e){this.applyToChildren(function(e,t){e.sceneUpdated(t)},e)}},{key:"updateVisibility",value:function(e){this.applyToChildren(function(e,t){e.updateVisibility(t)},e)}},{key:"animate",value:function(e){this.applyToChildren(function(e,t){e.animate(t)},e)}},{key:"initInfo",value:function(){console.warn("HyperNode.initInfo is not implemented")}},{key:"sceneNode",get:function(){return this._node}},{key:"children",get:function(){return this._children}},{key:"parent",get:function(){return this._parent}},{key:"matrix",get:function(){return this.sceneNode.matrix}},{key:"matrixWorld",get:function(){return this.sceneNode.matrixWorld}},{key:"visible",get:function(){return this._visible},set:function(e){this._visible=e}},{key:"type",get:function(){return this._property.type}},{key:"property",get:function(){return JSON.parse(JSON.stringify(this._property))},set:function(e){this._property=JSON.parse(JSON.stringify(e))}},{key:"JSON",get:function(){for(var e=[],t=0;t<this.children.length;t++)e.push(this.children[t].JSON);return{property:this.property,children:e}}}])&&V(t.prototype,r),n&&V(t,n),e}();function G(e){return function(t){return new Promise(function(r){return setTimeout(function(){return r(t)},e)})}}function H(e,t){var r=new Promise(function(e,r){var n=setTimeout(function(){clearTimeout(n),r(new Error("408"))},t)});return Promise.race([e,r])}var K=function(e,t){var r,n,i;return function(){var o=this,a=arguments;r?(clearTimeout(n),n=setTimeout(function(){Date.now()-i>=t&&(e.apply(o,a),i=Date.now())},t-(Date.now()-i))):(e.apply(o,a),i=Date.now(),r=!0)}},q=function(e,t){var r;return function(){var n=this,i=arguments;clearTimeout(r),r=setTimeout(function(){return e.apply(n,i)},t)}},Y=6378137,X=6356752.314245,Z=.9966471893352243,Q=40075016.68557849,J=Y,$=1.00505,ee=.999;function te(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var re=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.lng,n=void 0===r?0:r,i=t.lat,o=void 0===i?0:i,a=t.alt,s=void 0===a?0:a,u=t.north,c=void 0===u?0:u,l=t.tilt,f=void 0===l?0:l,h=t.up,p=void 0===h?0:h;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.lng=n,this.lat=o,this.alt=s,this.north=c,this.tilt=f,this.up=p}var t,r,n;return t=e,(r=[{key:"reset",value:function(){this.lng=0,this.lat=0,this.alt=0,this.north=0,this.tilt=0,this.up=0}},{key:"clone",value:function(){return new e(this.value)}},{key:"equals",value:function(e){return e.lat===this.lat&&e.lng===this.lng&&e.alt===this.alt&&e.north===this.north&&e.tilt===this.tilt&&e.up===this.up}},{key:"add",value:function(e){return this.lng=this.lng+e.lng,this.lat=this.lat+e.lat,this.alt=this.alt+e.alt,this.north=this.north+e.north,this.tilt=this.tilt+e.tilt,this.up=this.up+e.up,this}},{key:"lng",set:function(e){(e%=360)>=180?e-=360:e<=-180&&(e+=360),this._lng=e},get:function(){return this._lng}},{key:"lat",set:function(e){this._lat=Math.max(Math.min(87,e),-87)},get:function(){return this._lat}},{key:"alt",set:function(e){this._alt=Math.max(-1*X,e)},get:function(){return this._alt}},{key:"north",set:function(e){e=(e%360+360)%360,this._north=e},get:function(){return this._north}},{key:"tilt",set:function(e){this._tilt=e},get:function(){return this._tilt}},{key:"up",set:function(e){this._up=e},get:function(){return this._up}},{key:"value",set:function(e){var t=e.lng,r=e.lat,n=e.alt,i=e.north,o=e.tilt,a=e.up;void 0!==t&&(this._pose.lng=t),void 0!==r&&(this._pose.lat=r),void 0!==n&&(this._pose.alt=n),void 0!==i&&(this._pose.north=i),void 0!==o&&(this._pose.tilt=o),void 0!==a&&(this._pose.up=a)},get:function(){return{lng:this.lng,lat:this.lat,alt:this.alt,north:this.north,tilt:this.tilt,up:this.up}}}])&&te(t.prototype,r),n&&te(t,n),e}();function ne(e,t,r){this.x=e||0,this.y=t||0,this.z=r||0}var ie={constructor:ne,isVector3:!0,clone:function(){return new this.constructor(this.x,this.y,this.z)},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},normalize:function(){return this.divideScalar(this.length()||1)},divideScalar:function(e){return this.multiplyScalar(1/e)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},cross:function(e,t){if(void 0!==t)return this.crossVectors(e,t);var r=this.x,n=this.y,i=this.z;return this.x=n*e.z-i*e.y,this.y=i*e.x-r*e.z,this.z=r*e.y-n*e.x,this},crossVectors:function(e,t){var r=e.x,n=e.y,i=e.z,o=t.x,a=t.y,s=t.z;return this.x=n*s-i*a,this.y=i*o-r*s,this.z=r*a-n*o,this}};for(var oe in ie)Object.prototype.hasOwnProperty.call(ie,oe)&&(ne.prototype[oe]=ie[oe]);var ae=ne;function se(e,t,r){var n=Q/2,i=2*n/Math.pow(2,e),o=t*i-n,a=n-r*i;return{minX:o,minY:a-i,maxX:o+i,maxY:a}}function ue(e,t){var r,n,i,o,a,s=new ae(1/t.a,1/t.b,1/t.c),u=(new ae).multiplyVectors(s,e.origin),c=(new ae).multiplyVectors(s,e.direction),l=u.lengthSq(),f=u.clone().dot(c);if(l>1){if(f>=0)return;var h=f*f;if(r=l-1,h<(i=(n=c.lengthSq())*r))return;if(h>i){o=f*f-i;var p=(a=-f+Math.sqrt(o))/n,d=r/a;return p<d?{start:p,stop:d}:{start:d,stop:p}}var v=Math.sqrt(r/n);return{start:v,stop:v}}return l<1?(r=l-1,o=f*f-(i=(n=c.lengthSq())*r),{start:0,stop:(a=-f+Math.sqrt(o))/n}):f<0?{start:0,end:-f/(n=c.lengthSq())}:void 0}function ce(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var le=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._ray=new p.Ray(new p.Vector3(0,0,0),new p.Vector3(0,0,-1))}var t,r,n;return t=e,(r=[{key:"destruct",value:function(){this._ray=void 0}},{key:"intersect",value:function(e){arguments.length>1&&void 0!==arguments[1]?arguments[1]:new p.Vector2(0,0);this._ray.origin.set(0,0,0),this._ray.direction.set(0,0,-1),this._ray.applyMatrix4(e);var t={a:Y,b:Y,c:X},r=ue(this._ray,t);if(r){var n=r.start;return this._ray.origin.clone().addScaledVector(this._ray.direction,n)}}}])&&ce(t.prototype,r),n&&ce(t,n),e}();function fe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function he(e){return e*(Math.PI/180)}function pe(e){return e*(180/Math.PI)}var de,ve=new(function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.a_,n=void 0===r?Y:r,i=t.b_,o=void 0===i?X:i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.a_=n,this.b_=o,this.f_=(this.a_-this.b_)/this.a_,this.f_inv_=1/this.f_,this.a_sq_=this.a_*this.a_,this.b_sq_=this.b_*this.b_,this.e_sq_=this.f_*(2-this.f_),this.eps_=this.e_sq_/(1-this.e_sq_),this.e_sqsq_=this.e_sq_*this.e_sq_,this.E_sq_=this.a_sq_-this.b_sq_,this.bda_sq_=1-this.e_sq_,this.perimeter_=this.a_*Math.PI,this.radii_inv=new ae(1/this.a_sq_,1/this.a_sq_,1/this.b_sq_),this.wgs84_origin_=[0,0,0],this.ecef_origin_=[0,0,0],this.sin_lambda_origin_=0,this.cos_lambda_origin_=0,this.cos_phi_origin_=0,this.sin_phi_origin_=0}var t,r,n;return t=e,(r=[{key:"setWGS84Reference",value:function(e){this.wgs84_origin_=e;var t=this.wgs84_origin_[0],r=this.wgs84_origin_[1],n=this.wgs84_origin_[2],i=he(t),o=he(r);this.sin_lambda_origin_=Math.sin(i),this.cos_lambda_origin_=Math.cos(i),this.cos_phi_origin_=Math.cos(o),this.sin_phi_origin_=Math.sin(o);var a=Math.sin(i),s=this.a_/Math.sqrt(1-this.e_sq_*a*a);this.ecef_origin_[0]=(n+s)*this.cos_lambda_origin_*this.cos_phi_origin_,this.ecef_origin_[1]=(n+s)*this.cos_lambda_origin_*this.sin_phi_origin_,this.ecef_origin_[2]=(n+(1-this.e_sq_)*s)*this.sin_lambda_origin_}},{key:"setECEFReference",value:function(e){this.ecef_origin_=e;var t=this.ecef2Wgs84(this.ecef_origin_[0],this.ecef_origin_[1],this.ecef_origin_[2]),r=t.latitude,n=t.longitude,i=t.height,o=he(r),a=he(n);this.sin_lambda_origin_=Math.sin(o),this.cos_lambda_origin_=Math.cos(o),this.cos_phi_origin_=Math.cos(a),this.sin_phi_origin_=Math.sin(a),this.wgs84_origin_[0]=r,this.wgs84_origin_[1]=n,this.wgs84_origin_[2]=i}},{key:"wgs84Reference",value:function(){return this.wgs84_origin_}},{key:"ecefReference",value:function(){return this.ecef_origin_}},{key:"wgs842Ecef",value:function(e,t,r){var n=he(e),i=he(t),o=Math.sin(n),a=this.a_/Math.sqrt(1-this.e_sq_*o*o),s=Math.sin(n),u=Math.cos(n);return{x:(r+a)*u*Math.cos(i),y:(r+a)*u*Math.sin(i),z:(r+(1-this.e_sq_)*a)*s}}},{key:"ecef2Wgs84",value:function(e,t,r){var n=e*e+t*t,i=Math.sqrt(n),o=r*r,a=54*this.b_sq_*o,s=n+this.bda_sq_*o-this.e_sq_*this.E_sq_,u=s*s,c=this.e_sqsq_*a*n/u/s,l=Math.pow(1+c+Math.sqrt(c*c+2*c),1/3),f=l+1/l+1,h=a/3/f/f/u,p=Math.sqrt(1+2*this.e_sqsq_*h),d=-h*this.e_sq_*i/(1+p)+Math.sqrt(this.a_sq_*(1+1/p)/2-h*this.bda_sq_*o/(p+1)/p-h*n/2),v=i-this.e_sq_*d;v*=v;var y=Math.sqrt(v+o),m=Math.sqrt(v+this.bda_sq_*o),g=this.b_sq_*r/this.a_/m,b=y*(1-this.b_sq_/this.a_/m),_=Math.atan2(r+this.eps_*g,i),w=Math.atan2(t,e);return{latitude:pe(_),longitude:pe(w),height:b}}},{key:"ecef2Enu",value:function(e,t,r){var n=e-this.ecef_origin_[0],i=t-this.ecef_origin_[1],o=r-this.ecef_origin_[2];return{xEast:-this.sin_phi_origin_*n+this.cos_phi_origin_*i,yNorth:-this.cos_phi_origin_*this.sin_lambda_origin_*n-this.sin_lambda_origin_*this.sin_phi_origin_*i+this.cos_lambda_origin_*o,zUp:this.cos_lambda_origin_*this.cos_phi_origin_*n+this.cos_lambda_origin_*this.sin_phi_origin_*i+this.sin_lambda_origin_*o}}},{key:"enu2Ecef",value:function(e,t,r){var n=-this.sin_phi_origin_*e-this.cos_phi_origin_*this.sin_lambda_origin_*t+this.cos_lambda_origin_*this.cos_phi_origin_*r,i=this.cos_phi_origin_*e-this.sin_lambda_origin_*this.sin_phi_origin_*t+this.cos_lambda_origin_*this.sin_phi_origin_*r,o=this.cos_lambda_origin_*t+this.sin_lambda_origin_*r;return{x:n+this.ecef_origin_[0],y:i+this.ecef_origin_[1],z:o+this.ecef_origin_[2]}}},{key:"wgs842Enu",value:function(e,t,r){var n=this.wgs842Ecef(e,t,r),i=n.x,o=n.y,a=n.z,s=this.ecef2Enu(i,o,a);return{xEast:s.xEast,yNorth:s.yNorth,zUp:s.zUp}}},{key:"enu2Wgs84",value:function(e,t,r){var n=this.enu2Ecef(e,t,r),i=n.x,o=n.y,a=n.z,s=this.ecef2Wgs84(i,o,a);return{latitude:s.latitude,longitude:s.longitude,height:s.height}}},{key:"wgs842WebMercator",value:function(e,t){var r=t*this.perimeter_/180,n=Math.log(Math.tan((90+e)*Math.PI/360))/(Math.PI/180);return{x:r,y:n=n*this.perimeter_/180}}},{key:"webMercator2Wgs84",value:function(e,t){var r=e/this.perimeter_*180,n=t/this.perimeter_*180;return{latitude:n=180/Math.PI*(2*Math.atan(Math.exp(n*Math.PI/180))-Math.PI/2),longitude:r}}},{key:"ecef2WebMercator",value:function(e,t,r){var n=this.ecef2Wgs84(e,t,r),i=n.latitude,o=n.longitude,a=n.height,s=this.wgs842WebMercator(i,o,a);return{x:s.x,y:s.y,z:a}}},{key:"webMercator2Ecef",value:function(e,t,r){var n=this.webMercator2Wgs84(e,t),i=n.latitude,o=n.longitude,a=r,s=this.wgs842Ecef(i,o,a);return{x:s.x,y:s.y,z:s.z}}},{key:"load",value:function(e){var t=JSON.parse(e);this.wgs84_origin_=t.wgs84_origin,this.ecef_origin_=t.ecef_origin,this.sin_lambda_origin_=t.sin_lambda_origin,this.cos_lambda_origin_=t.cos_lambda_origin,this.cos_phi_origin_=t.cos_phi_origin,this.sin_phi_origin_=t.sin_phi_origin}},{key:"save",value:function(){var e={wgs84_origin:this.wgs84_origin_,ecef_origin:this.ecef_origin_,sin_lambda_origin:this.sin_lambda_origin_,cos_lambda_origin:this.cos_lambda_origin_,cos_phi_origin:this.cos_phi_origin_,sin_phi_origin:this.sin_phi_origin_};return JSON.stringify(e)}},{key:"toSRSString",value:function(){if(0===this.ecef_origin_[0]&&0===this.ecef_origin_[1]&&0===this.ecef_origin_[2])return"";return 0===this.wgs84_origin_[2]?"ENU:".concat(this.wgs84_origin_[0],",").concat(this.wgs84_origin_[1]):"ENU:".concat(this.wgs84_origin_[0],",").concat(this.wgs84_origin_[1],",").concat(this.wgs84_origin_[2])}},{key:"fromSRSString",value:function(e){var t=e.split(":");if(2!==t.length&&"ENU"!==t[0])return!1;var r=t[1].split(",");if(2!==r.length&&3!==r.length)return!1;var n=parseFloat(r[0]),i=parseFloat(r[1]),o=0;return 3===r.length&&(o=parseFloat(r[2])),!(n<-90||n>90)&&(!(i<-180||i>180)&&(this.setWGS84Reference([n,i,o]),!0))}},{key:"getENUSystem",value:function(e,t,r){void 0!==r&&console.warn("ENU is always on oblate surface, not affected by the altitude.");var n=this.wgs842Ecef(e,t,0),i=new ae(n.x,n.y,n.z);0===i.lengthSq()&&(i.z=1);var o=this.geodeticSurfaceNormal(i),a=new ae(0,0,1),s=(new ae).crossVectors(a,o);0===s.lengthSq()&&(s=new ae(1,0,0)),s.normalize();var u=(new ae).crossVectors(o,s);return u.normalize(),{east:s,up:o,north:u,origin:i}}},{key:"geodeticSurfaceNormal",value:function(e){var t=(new ae).multiplyVectors(this.radii_inv,e);return t.normalize(),t}}])&&fe(t.prototype,r),n&&fe(t,n),e}());function ye(e,t,r){var n=r.value;"function"==typeof n&&(r.value=function(){console.error(t+"() has deprecated and will be removed in a future version");for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];return n.apply(this,r)})}function me(e,t,r){var n=r.value;"function"==typeof n&&(r.value=function(){console.error(t+"() has been removed in this version");for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];return n.apply(this,r)})}function ge(e){return(ge="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function be(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _e(e,t){return!t||"object"!==ge(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function we(e,t,r,n){return(we="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(e,t,r,n){var i,o=ke(e,t);if(o){if((i=Object.getOwnPropertyDescriptor(o,t)).set)return i.set.call(n,r),!0;if(!i.writable)return!1}if(i=Object.getOwnPropertyDescriptor(n,t)){if(!i.writable)return!1;i.value=r,Object.defineProperty(n,t,i)}else!function(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(n,t,r);return!0})(e,t,r,n)}function xe(e,t,r,n,i){if(!we(e,t,r,n||e)&&i)throw new Error("failed to set property");return r}function Ae(e,t,r){return(Ae="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=ke(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function ke(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Oe(e)););return e}function Oe(e){return(Oe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Se(e,t){return(Se=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Pe(e,t,r,n,i){var o={};return Object.keys(n).forEach(function(e){o[e]=n[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=r.slice().reverse().reduce(function(r,n){return n(e,t,r)||r},o),i&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(i):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(e,t,o),o=null),o}var Te=Math.PI/180,Ee=180/Math.PI,Me=(Pe((de=function(e){function t(e){var r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=_e(this,Oe(t).call(this,e)))._mat=new p.Matrix4,r._anchor=new p.Vector3,r._orbitSphDelta=new p.Spherical(0,0,0),r._swirlSphDelta=new p.Spherical(0,0,0),r.needsApplyDelta=!1,r.matNeedsUpdate=!1,r.poseNeedsUpdate=!1;var n=Object.assign({},{minTilt:0,maxTilt:75,minAlt:.1,maxAlt:2*J},e);return r._minTilt=n.minTilt,r._maxTilt=n.maxTilt,r._minAlt=n.minAlt,r._maxAlt=n.maxAlt,r.minPolarAngleVert=10*Te,r.maxPolarAngleVert=170*Te,r._lastValidPose={lng:0,lat:0,alt:100,tilt:0,north:0},r._updateMat(!0),r}var r,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Se(e,t)}(t,re),r=t,i=[{key:"poseToMat",value:function(e){var t=ve.getENUSystem(e.lat,e.lng),r=t.origin,n=t.east,i=t.north,o=t.up,a=(new p.Matrix4).makeBasis(n,i,o).setPosition(r),s=(new p.Matrix4).makeRotationX(Math.PI/2),u=(new p.Matrix4).multiplyMatrices(a,s),c=e.tilt*Te,l=e.north*Te,f=new p.Spherical(Math.max(e.alt,.01),c,l),h=(new p.Vector3).setFromSpherical(f),d=(new p.Vector3).copy(i).applyAxisAngle(o,l),v=h.applyMatrix4(u),y=(new p.Matrix4).lookAt(v,r,d);return y.setPosition(v),y}},{key:"matToPose",value:function(e){var r=t._earthPicker.intersect(e.clone());if(r){var n=ve.ecef2Wgs84(r.x,r.y,r.z),i=n.latitude,o=n.longitude,a=ve.getENUSystem(i,o),s=a.east,u=a.north,c=a.up,l=a.origin,f=(new p.Matrix4).makeBasis(s,u,c).setPosition(l),h=(new p.Matrix4).makeRotationX(Math.PI/2),d=(new p.Matrix4).multiplyMatrices(f,h),v=(new p.Matrix4).getInverse(d,!0),y=(new p.Vector3).setFromMatrixPosition(e).applyMatrix4(v),m=(new p.Spherical).setFromVector3(y),g=m.phi*Ee,b=m.theta*Ee;return{lng:o,lat:i,alt:m.radius,north:b,tilt:g}}}},{key:"MAX_TILT",get:function(){return 75}}],(n=[{key:"destruct",value:function(){return this.reset(),!0}},{key:"add",value:function(e){return this.lng=this.lng+e.lng,this.lat=this.lat+e.lat,this.alt=this.alt+e.alt,this.north=this.north+e.north,this.tilt=this.tilt+e.tilt,this.up=this.up+e.up,this}},{key:"reset",value:function(){Ae(Oe(t.prototype),"reset",this).call(this),this._onPoseChange(),this._updateMat(!0)}},{key:"_updateMat",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.matNeedsUpdate||e){var r=t.poseToMat(this.value);this._mat.copy(r)}this.matNeedsUpdate=!1}},{key:"_updatePose",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this.poseNeedsUpdate||e)&&this._matToPose(),this.poseNeedsUpdate=!1}},{key:"_matToPose",value:function(e){e||(e=this.matrix.clone());var r=t.matToPose(e);r&&(xe(Oe(t.prototype),"_lng",r.lng,this,!0),xe(Oe(t.prototype),"_lat",r.lat,this,!0),xe(Oe(t.prototype),"_alt",r.alt,this,!0),xe(Oe(t.prototype),"_north",r.north,this,!0),xe(Oe(t.prototype),"_tilt",r.tilt,this,!0))}},{key:"_matToPoseWithAnchor",value:function(e,t){}},{key:"_matToAltNorthTiltWithAnchor",value:function(e,t){}},{key:"_onPoseChange",value:function(){(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&(this.matNeedsUpdate=!0)}},{key:"_onMatChange",value:function(){(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&(this.poseNeedsUpdate=!0)}},{key:"_sphereLocalCoordinates",value:function(e,t){}},{key:"_toEarthLocalSpherical",value:function(e,t){}},{key:"orbitLeft",value:function(e){0!==e&&(this._orbitSphDelta.theta+=e*this._screenfov,this.needsApplyDelta=!0)}},{key:"orbitUp",value:function(e){e&&(this._orbitSphDelta.phi+=e*this._screenfov,this.needsApplyDelta=!0)}},{key:"dolly",value:function(e){0!==e&&(this._orbitSphDelta.radius+=e,this.needsApplyDelta=!0)}},{key:"swirlLeft",value:function(e){this._swirlSphDelta.theta+=e*Te,this.needsApplyDelta=!0}},{key:"swirlUp",value:function(e){this._swirlSphDelta.phi+=e*Te,this.needsApplyDelta=!0}},{key:"applyDeltaPrev",value:function(){if(this.needsApplyDelta){var e,r=this.matrix.clone(),n=this.anchor,i=(new p.Vector3).setFromMatrixPosition(r),o=new p.Vector3(1,0,0).transformDirection(r),a=new p.Vector3(0,1,0).transformDirection(r),s=i.clone().sub(n);if(this._orbitSphDelta.radius){var u=1+this._orbitSphDelta.radius/10;u=Math.min(1.5,Math.max(.01,u));var c,l=s.length()*u;c=l>this.maxAlt?n.clone().addScaledVector(s.clone().normalize(),this.maxAlt):l<this.minAlt?n.clone().addScaledVector(s.clone().normalize(),this.minAlt):n.clone().addScaledVector(s,u),e=r.clone().setPosition(c)}else e=r;var f=e.clone();if(this._swirlSphDelta.theta){var h=n.clone().normalize(),d=(new p.Matrix4).makeRotationAxis(h,this._swirlSphDelta.theta);f.premultiply((new p.Matrix4).getInverse(d))}if(this._swirlSphDelta.phi){var v=n.clone(),y=(new p.Vector3).copy(o);v.projectOnPlane(y);var m=v.angleTo(a);if(this._swirlSphDelta.phi+m>=Math.PI/2-this.minTilt*Te-.01);else if(this._swirlSphDelta.phi+m<Math.PI/2-this.maxTilt*Te+.01);else{var g=(new p.Matrix4).setPosition(n.clone().negate()),b=(new p.Matrix4).makeRotationAxis(o,this._swirlSphDelta.phi),_=(new p.Matrix4).setPosition(n).multiply(b).multiply(g),w=f.clone().premultiply((new p.Matrix4).getInverse(_)),x=t.matToPose(w);if(!x)return void console.error("Failed to locate.");x.tilt>this.maxTilt?(x.tilt=this.maxTilt,f.copy(t.poseToMat(x))):x.tilt<this.minTilt?(x.tilt=this.minTilt,f.copy(t.poseToMat(x))):f.copy(w)}var A=(new p.Matrix4).getInverse(f),k=(new p.Vector3).setFromMatrixPosition(A);if(0!==k.x){var O=n.clone().applyMatrix4(A),S=k.clone().sub(O).normalize(),P=S.clone().setX(0).normalize(),T=(new p.Matrix4).setPosition(O.clone().negate()).premultiply((new p.Matrix4).makeRotationFromQuaternion((new p.Quaternion).setFromUnitVectors(S,P))).premultiply((new p.Matrix4).setPosition(O.clone()));f.multiply((new p.Matrix4).getInverse(T))}}var E=(new p.Matrix4).identity();if(this._orbitSphDelta.theta){var M=(new p.Matrix4).makeRotationAxis(a,this._orbitSphDelta.theta);E.copy(M)}if(this._orbitSphDelta.phi){var j=(new p.Matrix4).makeRotationAxis(o,this._orbitSphDelta.phi);E.multiply(j)}var C=(new p.Matrix4).getInverse(E).multiply(f);this.matrix=C,this._orbitSphDelta.theta=0,this._orbitSphDelta.phi=0,this._orbitSphDelta.radius=0,this._swirlSphDelta.theta=0,this._swirlSphDelta.phi=0,this._swirlSphDelta.radius=0,this.needsApplyDelta=!1}}},{key:"applyDelta",value:function(){this.applyDeltaNext()}},{key:"applyDeltaNext",value:function(){if(this.needsApplyDelta){var e=this.matrix.clone(),r=this.anchor,n=(new p.Vector3).setFromMatrixPosition(e),i=new p.Vector3(1,0,0).transformDirection(e),o=new p.Vector3(0,1,0).transformDirection(e),a=n.clone().sub(r),s=e;if(this._orbitSphDelta.radius){var u=1+this._orbitSphDelta.radius/10;u=Math.min(1.5,Math.max(.01,u));var c=a.length()*u;c=Math.max(this.minAlt,Math.min(this.maxAlt,c));var l=r.clone().addScaledVector(a.clone().normalize(),c);s=e.clone().setPosition(l)}var f=s.clone();if(this._swirlSphDelta.theta){var h=r.clone().normalize(),d=(new p.Matrix4).makeRotationAxis(h,this._swirlSphDelta.theta);f.premultiply((new p.Matrix4).getInverse(d))}if(this._swirlSphDelta.phi){var v=r.clone(),y=(new p.Vector3).copy(i);v.projectOnPlane(y);var m=v.angleTo(o);if(this._swirlSphDelta.phi+m>=Math.PI/2-this.minTilt*Te-.01);else if(this._swirlSphDelta.phi+m<Math.PI/2-this.maxTilt*Te+.01);else{var g=(new p.Matrix4).setPosition(r.clone().negate()),b=(new p.Matrix4).makeRotationAxis(i,this._swirlSphDelta.phi),_=(new p.Matrix4).setPosition(r).multiply(b).multiply(g),w=f.clone().premultiply((new p.Matrix4).getInverse(_));f.copy(w)}}var x=(new p.Matrix4).identity();if(this._orbitSphDelta.theta){var A=(new p.Matrix4).makeRotationAxis(o,this._orbitSphDelta.theta);x.copy(A)}if(this._orbitSphDelta.phi){var k=(new p.Matrix4).makeRotationAxis(i,this._orbitSphDelta.phi);x.multiply(k)}var O=(new p.Matrix4).getInverse(x).multiply(f),S=t.matToPose(O);return S?(S.tilt>this.maxTilt?S.tilt=this.maxTilt-.01:S.tilt<this.minTilt&&(S.tilt=this.minTilt+.01),this.matrix=t.poseToMat(S),this._updateLastValidPose(S),this._attenuateDelta(),!0):(console.error("Failed to locate."),this._rescueDelta(),!1)}}},{key:"_attenuateDelta",value:function(){var e=!0;this._orbitSphDelta.theta=0,this._orbitSphDelta.phi=0,this._orbitSphDelta.radius*=.618,Math.abs(this._orbitSphDelta.radius)<.01?this._orbitSphDelta.radius=0:e=!1,this._swirlSphDelta.theta=0,this._swirlSphDelta.phi=0,this._swirlSphDelta.radius=0,this.needsApplyDelta=!e}},{key:"_clearDelta",value:function(){var e=this;["theta","phi","radius"].forEach(function(t){e._orbitSphDelta[t]=0,e._swirlSphDelta[t]=0}),this.needsApplyDelta=!1}},{key:"_rescueDelta",value:function(){this._clearDelta(),this.matrix=t.poseToMat(this._lastValidPose)}},{key:"_updateLastValidPose",value:function(e){this._isPoseValid(e)&&(this._lastValidPose.lng=e.lng,this._lastValidPose.lat=e.lat,this._lastValidPose.alt=e.alt,this._lastValidPose.north=e.north,this._lastValidPose.tilt=e.tilt)}},{key:"_isPoseValid",value:function(e){var t=this,r=!0;return["alt","north","tilt"].forEach(function(n){var i=n.charAt(0).toUpperCase()+n.substring(1);e[n]>t["max"+i]&&(r=!1),e[n]<t["min"+i]&&(r=!1)}),r}},{key:"putAnchor",value:function(e){return e?this._anchor.copy(e):this._updateAnchor()}},{key:"recommendedFrustum",value:function(e){e.camera,e.targetFocus}},{key:"_updateAnchor",value:function(){var e=this._centerIntersection();return e&&this._anchor.copy(e),this.anchor}},{key:"_centerIntersection",value:function(){return t._earthPicker.intersect(this.matrix)}},{key:"matrix",get:function(){return this._updateMat(),this._mat.clone()},set:function(e){e.isMatrix4?e.equals(this.matrix)||(this._mat.copy(e),this._onMatChange()):console.error("Unknown matrix",e)}},{key:"POS",get:function(){var e=new p.Vector3,t=new p.Quaternion,r=new p.Vector3;return this.matrix.clone().decompose(e,t,r),{position:e,orientation:t,scale:r}}},{key:"value",get:function(){return Ae(Oe(t.prototype),"value",this)},set:function(e){var t=Object.assign({},this.value,e);this.lng=t.lng,this.lat=t.lat,this.alt=t.alt,this.north=t.north,this.tilt=t.tilt,this.up=t.up}},{key:"lng",set:function(e){isNaN(e)||e===this.lng||(xe(Oe(t.prototype),"lng",e,this,!0),this._onPoseChange())},get:function(){return this._updatePose(),Ae(Oe(t.prototype),"lng",this)}},{key:"lat",set:function(e){isNaN(e)||e===this.lat||(xe(Oe(t.prototype),"lat",e,this,!0),this._onPoseChange())},get:function(){return this._updatePose(),Ae(Oe(t.prototype),"lat",this)}},{key:"alt",set:function(e){!isNaN(e)&&e!==this.alt&&e>=.1&&(void 0===this.minAlt&&void 0===this.maxAlt||(e=Math.max(this.minAlt,Math.min(this.maxAlt,e))),xe(Oe(t.prototype),"alt",e,this,!0),this._onPoseChange())},get:function(){return this._updatePose(),Ae(Oe(t.prototype),"alt",this)}},{key:"north",set:function(e){isNaN(e)||e===this.north||(xe(Oe(t.prototype),"north",e,this,!0),this._onPoseChange())},get:function(){return this._updatePose(),Ae(Oe(t.prototype),"north",this)}},{key:"tilt",set:function(e){e=Math.max(0,Math.min(t.MAX_TILT,e)),isNaN(e)||(xe(Oe(t.prototype),"tilt",e,this,!0),this._onPoseChange())},get:function(){return this._updatePose(),Ae(Oe(t.prototype),"tilt",this)}},{key:"up",set:function(e){isNaN(e)||e===this.up||(xe(Oe(t.prototype),"up",e,this,!0),this._onPoseChange())},get:function(){return this._updatePose(),Ae(Oe(t.prototype),"up",this)}},{key:"anchor",set:function(e){this._anchor.copy(e)},get:function(){return this._anchor.clone()}},{key:"maxAlt",set:function(e){(e=Math.max(.1,Math.min(2*J,e)))<this.minAlt&&(console.warn("altRangeMax",e,this.minAlt),this._minAlt=e),this._maxAlt=e},get:function(){return this._maxAlt}},{key:"minAlt",set:function(e){(e=Math.max(.1,Math.min(2*J,e)))>this.maxAlt&&(console.warn("altRangeMin",e,this.maxAlt),this._maxAlt=e),this._minAlt=e},get:function(){return this._minAlt}},{key:"maxTilt",set:function(e){(e=Math.max(0,Math.min(t.MAX_TILT,e)))<this.minTilt&&(console.warn("TiltRangeMax",e,this.minTilt),this._minTilt=e),this._maxTilt=e},get:function(){return this._maxTilt}},{key:"minTilt",set:function(e){(e=Math.max(0,Math.min(t.MAX_TILT,e)))>this.maxTilt&&(console.warn("TiltRangeMin",e,this.maxTilt),this._maxTilt=e),this._minTilt=e},get:function(){return this._minTilt}},{key:"distanceToAnchor",get:function(){var e=(new p.Vector3).setFromMatrixPosition(this.matrix),t=this.anchor;return e.distanceTo(t)}},{key:"_screenfov",get:function(){var e=this.distanceToAnchor;e=Math.max(1,Math.min(e,J));var t=45*Te,r=e*Math.tan(t/2);return 2*Math.atan2(r,J)}}])&&be(r.prototype,n),i&&be(r,i),t}()).prototype,"_matToPoseWithAnchor",[me],Object.getOwnPropertyDescriptor(de.prototype,"_matToPoseWithAnchor"),de.prototype),Pe(de.prototype,"_matToAltNorthTiltWithAnchor",[me],Object.getOwnPropertyDescriptor(de.prototype,"_matToAltNorthTiltWithAnchor"),de.prototype),Pe(de.prototype,"_sphereLocalCoordinates",[me],Object.getOwnPropertyDescriptor(de.prototype,"_sphereLocalCoordinates"),de.prototype),Pe(de.prototype,"_toEarthLocalSpherical",[me],Object.getOwnPropertyDescriptor(de.prototype,"_toEarthLocalSpherical"),de.prototype),Pe(de.prototype,"recommendedFrustum",[me],Object.getOwnPropertyDescriptor(de.prototype,"recommendedFrustum"),de.prototype),de);Me._earthPicker=new le;var je=Me;function Ce(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Re=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,n;return t=e,(r=[{key:"addEventListener",value:function(e,t){void 0===this._listeners&&(this._listeners={});var r=this._listeners;void 0===r[e]&&(r[e]=[]),-1===r[e].indexOf(t)&&r[e].push(t)}},{key:"hasEventListener",value:function(e,t){if(void 0===this._listeners)return!1;var r=this._listeners;return void 0!==r[e]&&-1!==r[e].indexOf(t)}},{key:"removeEventListener",value:function(e,t){if(void 0!==this._listeners){var r=this._listeners[e];if(void 0!==r){var n=r.indexOf(t);-1!==n&&r.splice(n,1)}}}},{key:"dispatchEvent",value:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var r=t.slice(0),n=0,i=r.length;n<i;n++)r[n].call(this,e)}}}}])&&Ce(t.prototype,r),n&&Ce(t,n),e}();function Ie(e){return(Ie="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Le(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Be(e,t){return!t||"object"!==Ie(t)&&"function"!=typeof t?De(e):t}function Ue(e){return(Ue=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function De(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ne(e,t){return(Ne=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ze=function(e){function t(e){var r,n=e.camera,i=e.handlers;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o=De(r=Be(this,Ue(t).call(this))),a=["onCameraChange","onCameraStart","onCameraEnd"];if(!function(){if(!n)return!1;i&&a.forEach(function(e){i&&i[e]&&(o[e]=i[e])});return!0}())return Be(r,void 0);return r._camera=n,r._enabled=!0,r._handlers={},a.forEach(function(e){o._handlers["_"+e]=function(t){if(o.dispatchEvent({type:e}),o[e])return o[e](t)}}),r}var r,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ne(e,t)}(t,Re),r=t,(n=[{key:"destruct",value:function(){return!0}},{key:"triggerChangeEvent",value:function(){this.dispatchEvent({type:"onCameraChange"})}},{key:"camera",get:function(){return this._camera}}])&&Le(r.prototype,n),i&&Le(r,i),t}();function Fe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Ve=function(){function e(t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t instanceof je&&r instanceof je&&n instanceof Object&&void 0!==n.start&&void 0!==n.end?(this.src=t,this.dst=r,this.time=n,this.setAlphaAdaptFunc(),this.setInterpolateFunc(),this._enabled=!1):console.error("EarthCameraPath",t,r,n)}var t,r,n;return t=e,n=[{key:"MAX_FLY_DURATION",get:function(){return 3e5}}],(r=[{key:"destruct",value:function(){var e=!0;return this.enabled=!1,e=this.src.destruct()&&e,e=this.dst.destruct()&&e,this.time={},e}},{key:"sync",value:function(e){e instanceof re?this.src.value=e.value:e.isMatrix4&&(this.src.matrix=e)}},{key:"destinate",value:function(t,r){!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this.onFail(new Error("destination changed")),t.isMatrix4)this.dst.matrix=t;else{if(!(t instanceof Object))return Promise.reject(new Error("unknown destination type"));this.dst.value=t}this.duration=r,this.enabled=!0;var n=this;return this.destinated=H(new Promise(function(e,t){n._onDestinated=e,n._onInterrupted=t}),e.MAX_FLY_DURATION),this.destinated}},{key:"interrupt",value:function(e){this.onFail(e)}},{key:"setAlphaAdaptFunc",value:function(e){this._alphaAdaptFunc=e||this._alphaSinMitigate}},{key:"setInterpolateFunc",value:function(e){this._interpolateFunc=e?function(t){var r=new je;return r.matrix=e(t),r}:this._interpolatePose}},{key:"_alphaSinMitigate",value:function(e){var t=.50005*(Math.sin((e-.5)*Math.PI)+1);return Math.min(Math.max(t,0),1)}},{key:"_interpolateMatirx",value:function(e){var t=this.src.POS,r=t.position,n=t.orientation,i=this.dst.POS,o=i.position,a=i.orientation,s=r.clone().lerp(o,e),u=n.clone().slerp(a,e).normalize(),c=new p.Vector3(1,1,1),l=(new p.Matrix4).compose(s,u,c),f=new je;return f.matrix=l,f}},{key:"_interpolatePose",value:function(e){var t,r,n,i=this.src.value,o=this.dst.value,a={};return["lat","alt","tilt","up"].forEach(function(t){a[t]=s(i[t],o[t],e)}),r=i[t="lng"]+180,n=o[t]+180,Math.abs(n-r)>180?a[t]=u(r,n,e)-180:a[t]=s(i[t],o[t],e),r=i[t="north"],n=o[t],Math.abs(n-r)>180?a[t]=u(r,n,e):a[t]=s(i[t],o[t],e),new je(a);function s(e,t,r){return e*(1-r)+r*t}function u(e,t,r){var n=s(e,t+=t>e?-360:360,r);return n=(n=n<0?n+360:n)>360?n-360:n}}},{key:"_interpolateSpherical",value:function(e){var t=this.src.POS,r=t.position,n=t.orientation,i=this.dst.POS,o=i.position,a=i.orientation,s=(new p.Spherical).setFromVector3(r.clone()),u=(new p.Spherical).setFromVector3(o.clone()),c=new p.Spherical((1-e)*s.radius+e*u.radius,(1-e)*s.phi+e*u.phi,(1-e)*s.theta+e*u.theta),l=(new p.Vector3).setFromSpherical(c),f=n.clone().slerp(a,e).normalize(),h=new p.Vector3(1,1,1),d=(new p.Matrix4).compose(l,f,h),v=new je;return v.matrix=d,v}},{key:"orbitLeft",value:function(e,t){}},{key:"swirlLeft",value:function(e,t){}},{key:"onComplete",value:function(){this.src.value=this.dst.value,this.enabled=!1,this._onDestinated()}},{key:"_onDestinated",value:function(){}},{key:"onFail",value:function(e){if(this.enabled){var t=this.pose;if(t){var r=t.matrix;this.src.matrix=r,this.dst.matrix=r}this.enabled=!1,this._onInterrupted(e)}}},{key:"_onInterrupted",value:function(){}},{key:"reset",value:function(){this.src.reset(),this.dst.reset(),this.duration=0,this.onFail()}},{key:"enabled",set:function(e){this._enabled=e},get:function(){return this._enabled}},{key:"focus",get:function(){return new p.Vector3}},{key:"pose",get:function(){if(this.enabled){this.time.current=Date.now();var e=this.time.current-this.time.start,t=e/(this.time.end-this.time.start);return isNaN(t)?(console.error("pose",t),void this.onFail()):(t>1?t=1:t<0?(console.warn("".concat(e/1e3," seconds to start.")),t=0):t=this._alphaAdaptFunc(t),t>=1?(this.onComplete(),this.dst):this._interpolateFunc(t))}}},{key:"duration",set:function(t){if(t<0||t>e.MAX_FLY_DURATION)console.error("EarthCameraPath.duration",t);else{var r=Date.now();this.time.start=r-1,this.time.current=r,this.time.end=r+t}}}])&&Fe(t.prototype,r),n&&Fe(t,n),e}();function We(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Ge=function(){function e(t){var r=t.camera,n=t.domElement;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._camera=r,this._domElement=n,this._rayCaster=new p.Raycaster,this.mouseOffsetNeedsUpdate=!0}var t,r,n;return t=e,(r=[{key:"destruct",value:function(){return this._camera=void 0,this._domElement=void 0,this._rayCaster=void 0,this.mouseOffsetNeedsUpdate=!1,!0}},{key:"pick",value:function(e,t){var r=this._NDC(e,t),n=r.x,i=r.y;return this._rayCaster.setFromCamera(new p.Vector2(n,i),this.camera),this._rayCaster.intersectObjects(this.targets,!0)}},{key:"_NDC",value:function(e,t){var r=this.mouseOffset;return e-=r.left,t-=r.top,{x:e=e/this.domWidth*2-1,y:t=-t/this.domHeight*2+1}}},{key:"_NDCinv",value:function(e,t){var r=this.mouseOffset;return{x:(e+1)/2*this.domWidth+r.left,y:(1-t)/2*this.domHeight+r.top}}},{key:"_updateMouseOffset",value:function(){var e=this._domElement.getBoundingClientRect();this._mouseOffset={left:e.left,top:e.top},this.mouseOffsetNeedsUpdate=!1}},{key:"camera",get:function(){return this._camera}},{key:"mouseOffset",get:function(){return this.mouseOffsetNeedsUpdate&&this._updateMouseOffset(),this._mouseOffset}},{key:"domWidth",get:function(){return this._domElement.clientWidth}},{key:"domHeight",get:function(){return this._domElement.clientHeight}},{key:"targets",get:function(){return[]}}])&&We(t.prototype,r),n&&We(t,n),e}();function He(e){return(He="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ke(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function qe(e,t){return!t||"object"!==He(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ye(e,t,r){return(Ye="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Xe(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function Xe(e){return(Xe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ze(e,t){return(Ze=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Qe=function(e){function t(e){var r,n=e.camera,i=e.layers,o=e.domElement;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=qe(this,Xe(t).call(this,{camera:n,domElement:o})))._layers=i,r.layerName="project",r}var r,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ze(e,t)}(t,Ge),r=t,(n=[{key:"destruct",value:function(){return this._layers=void 0,this.layerName=void 0,Ye(Xe(t.prototype),"destruct",this).call(this)}},{key:"layer",get:function(){return this._layers[this.layerName]},set:function(e){this.layerName=e}},{key:"targets",get:function(){if(!this.layer)return[];for(var e=[],t=0;t<this.layer.children.length;t++){var r=this.layer.children[t],n=r.treeNode;n&&(r.sceneNode&&(r.sceneNode.updateMatrix(),r.sceneNode.updateMatrixWorld()),e.push(n))}return e},set:function(e){console.warn("Not allowed")}}])&&Ke(r.prototype,n),i&&Ke(r,i),t}();function Je(e){return(Je="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function $e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function et(e,t){return!t||"object"!==Je(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function tt(e){return(tt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function rt(e,t){return(rt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var nt=function(e){function t(e){var r,n=e.camera,i=e.domElement,o=e.control;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=et(this,tt(t).call(this,{camera:n,domElement:i})))._control=o,r}var r,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&rt(e,t)}(t,Ge),r=t,(n=[{key:"destruct",value:function(){this._control=void 0}},{key:"pick",value:function(e,t){var r=this._NDC(e,t),n=r.x,i=r.y;return this.pickNDC(n,i)}},{key:"pickNDC",value:function(e,t){this._rayCaster.setFromCamera(new p.Vector2(e,t),this.camera);var r=this._rayCaster.ray.clone(),n=this._control._pose.matrix;r.applyMatrix4(n);var i=ue(r,{a:Y,b:Y,c:X});if(i){var o=i.start;return r.origin.clone().addScaledVector(r.direction,o)}}}])&&$e(r.prototype,n),i&&$e(r,i),t}(),it=function(e,t){if(void 0!==e){(t=t||{}).handlers=t.handlers||{},t.thresholds=t.thresholds||{},this.domElement=e,this.enabled=!0,this.debug=t.debug||!1,this.rawTouchDebug=!1,this.handlers={tap:t.handlers.tap||null,"double-tap":t.handlers["double-tap"]||null,"drag-start":t.handlers["drag-start"]||null,drag:t.handlers.drag||null,"drag-end":t.handlers["drag-end"]||null,"pinch-start":t.handlers["pinch-start"]||null,pinch:t.handlers.pinch||null,"pinch-end":t.handlers["pinch-end"]||null,"rotate-start":t.handlers["rotate-start"]||null,rotate:t.handlers.rotate||null,"rotate-end":t.handlers["rotate-end"]||null,"twofingersweep-start":t.handlers["twofingersweep-start"]||null,twofingersweep:t.handlers.twofingersweep||null,"twofingersweep-end":t.handlers["twofingersweep-end"]||null},this.thresholds={doubleTapTimeout:void 0===t.thresholds.doubleTapTimeout?500:t.thresholds.doubleTapTimeout,singleTapTimeout:250,holdTapTimeout:600,twoFingerSweepTorlerance:4,twoFingerSweepOffset:void 0===t.thresholds.twoFingerSweepOffset?2:t.thresholds.twoFingerSweepOffset,gestureQueueLength:void 0===t.thresholds.gestureQueueLength?3:t.thresholds.gestureQueueLength,gestureConsistency:void 0===t.thresholds.gestureConsistency?.66:t.thresholds.gestureConsistency},this.thresholds.twoFingerSweepOffset=Math.max(1,this.thresholds.twoFingerSweepOffset),this.thresholds.twoFingerSweepTorlerance=Math.max(1,this.thresholds.twoFingerSweepTorlerance),this.debug&&console.log("Init recognizer",this.handlers,this.thresholds);var r=-1,n=0,i=0,o=null,a=null,s={NONE:-1,TOUCHSTART:0,TOBETAP:1,TOBEDOUBLETAP:2,TAP:3,DOUBLETAP:4,TOBEDRAG:10,DRAGSTART:11,DRAGGING:12,DRAGEND:13,TOBEPINCH:20,PINCHSTART:21,PINCH:22,PINCHEND:22,TOBEROTATE:30,ROTATESTART:31,ROTATE:32,ROTATEEND:33,TOBETWOFINGERSWEEP:40,TWOFINGERSWEEPSTART:41,TWOFINGERSWEEP:42,TWOFINGERSWEEPEND:43,DBLTAPDRAGSTART:51,DBLTAPDRAGGING:52,DBLTAPDRAGEND:53};this.recognizerState=s.NONE,this.recognizerStateQueue=[];var u=this;u.domElement.addEventListener("touchstart",v,!1),this.removeListeners=function(){u.domElement.removeEventListener("touchstart",v,!1)}}else console.error("Invalid domElement");function c(e){u.debug&&e!==u.recognizerState&&console.log("RecognizerState =>",e),u.recognizerState=e}function l(e){for(var t,r={touches:[]},n=0;n<e.touches.length;++n)r.touches.push({identifier:(t=e.touches[n]).identifier,pageX:t.pageX,pageY:t.pageY});return r.type=e.type,r}function f(e){for(;u.recognizerStateQueue.length>=u.thresholds.gestureQueueLength;)u.recognizerStateQueue.shift();u.recognizerStateQueue.push(e),u.debug&&console.log(u.recognizerStateQueue)}function h(){u.recognizerStateQueue=[]}function d(e){if(u.recognizerStateQueue.length!==u.thresholds.gestureQueueLength)return!1;for(var t=0,r=0;r<u.recognizerStateQueue.length;++r)u.recognizerStateQueue[r]===e&&(t+=1);return t/u.thresholds.gestureQueueLength>=u.thresholds.gestureConsistency}function v(e){if(u.debug&&console.log("onTouchStart"),u.rawTouchDebug&&console.log(e),!1!==u.enabled)switch(!!navigator.platform&&/iPad|iPhone|iPod/.test(navigator.platform)&&e.preventDefault(),u.domElement.addEventListener("touchend",m,!1),u.domElement.addEventListener("touchmove",y,!1),u.debug&&console.log(u.recognizerState),r=0,n=Date.now(),o=l(e),e.touches.length){case 1:u.recognizerState===s.TOBETAP?c(s.TOBEDOUBLETAP):c(s.TOUCHSTART);break;case 2:if(u.recognizerState===s.NONE)c(s.TOUCHSTART),h();else if(u.recognizerState===s.DRAGGING){c(s.TOUCHSTART),h();var t={type:"drag-end"};t.touchEvent=e,u.dispatchEvent(t)}}}function y(e){if(u.debug&&console.log("onTouchMove"),u.rawTouchDebug&&console.log(e),!1!==u.enabled){e.preventDefault(),e.stopPropagation(),r+=1;var t=Date.now();if(i>1e3/60)return u.debug&&console.log("skip the events",i),i=0,void(n=t);switch(e.touches.length){case 1:if(u.recognizerState===s.TOUCHSTART){if(f(s.TOBEDRAG),d(s.TOBEDRAG)){c(s.DRAGSTART);var h={type:"drag-start"};h.touchEvent=null===a?o:a,u.dispatchEvent(h)}}else if(u.recognizerState===s.TOBEDOUBLETAP&&(f(s.TOBEDRAG),d(s.TOBEDRAG))){c(s.DBLTAPDRAGSTART);var v={type:"dbltap-drag-start"};v.touchEvent=null===a?o:a,u.dispatchEvent(v)}if(u.recognizerState===s.DRAGSTART||u.recognizerState===s.DRAGGING){c(s.DRAGGING);var y={type:"drag"};y.touchEvent=e,u.dispatchEvent(y)}else if(u.recognizerState===s.DBLTAPDRAGSTART||u.recognizerState===s.DBLTAPDRAGGING){c(s.DBLTAPDRAGGING);var m={type:"dbltap-drag"};m.touchEvent=e,u.dispatchEvent(m)}break;case 2:if(u.recognizerState===s.TOUCHSTART||u.recognizerState===s.TOBEROTATE||u.recognizerState===s.TOBEPINCH||u.recognizerState===s.TOBETWOFINGERSWEEP){for(var g=[new p.Vector2,new p.Vector2],b=[new p.Vector2,new p.Vector2],_=0;_<2;++_)g[_].set(o.touches[_].pageX,o.touches[_].pageY);for(var w=0;w<2;++w)b[w].set(e.touches[w].pageX,e.touches[w].pageY);for(var x=[new p.Vector2,new p.Vector2],A=0;A<2;++A)x[A].subVectors(b[A],g[A]);var k=[new p.Vector2,new p.Vector2];k[0].subVectors(g[1],g[0]),k[1].subVectors(g[0],g[1]);var O=[new p.Vector2,new p.Vector2];O[0].subVectors(b[1],b[0]),O[1].subVectors(b[0],b[1]);var S=k[0].length()*O[0].length(),P=k[0].dot(O[0])/S,T=new p.Vector3(k[0].x,k[0].y,0),E=new p.Vector3(O[0].x,O[0].y,0),M=T.cross(E).z/S,j=Math.atan2(M,P),C=Math.abs(O[0].length()-k[0].length()),R=Math.abs(k[0].length()*j);if(u.debug&&(console.log("last",g,"current",b,"delta",x),console.log("dir-angle",180*j/Math.PI,"scale-delta",C,"rotate-delta",R)),C-R>u.thresholds.twoFingerSweepTorlerance||C>R&&R>u.thresholds.twoFingerSweepTorlerance){for(var I=C;I>u.thresholds.twoFingerSweepTorlerance;)f(s.TOBEPINCH),I-=u.thresholds.twoFingerSweepTorlerance;if(d(s.TOBEPINCH)){c(s.PINCHSTART),o=null===a?o:a;var L={type:"pinch-start",scale:1,rotation:0},B=new p.Vector2;B.addVectors(g[0],g[1]),B.multiplyScalar(.5),L.center={pageX:B.x,pageY:B.y},L.deltaTime=1e3/60,L.touchEvent=o,L.deltaX=0,L.deltaY=0,u.dispatchEvent(L),L.type="pinchrotate-start",u.dispatchEvent(L)}}else if(R-C>u.thresholds.twoFingerSweepTorlerance||C<R&&C>u.thresholds.twoFingerSweepTorlerance){for(var U=R;U>u.thresholds.twoFingerSweepTorlerance;)f(s.TOBEROTATE),U-=u.thresholds.twoFingerSweepTorlerance;if(d(s.TOBEROTATE)){c(s.ROTATESTART);var D={type:"rotate-start",scale:1,rotation:0},N=new p.Vector2;N.addVectors(g[0],g[1]),N.multiplyScalar(.5),D.center={pageX:N.x,pageY:N.y},D.deltaTime=1e3/60,D.touchEvent=o,D.deltaX=0,D.deltaY=0,u.dispatchEvent(D),D.type="pinchrotate-start",u.dispatchEvent(D)}}else if(x[0].y*x[1].y>0&&Math.abs(x[0].y)>u.thresholds.twoFingerSweepOffset&&Math.abs(x[1].y)>u.thresholds.twoFingerSweepOffset){for(var z=.5*(Math.abs(x[0].y)+Math.abs(x[1].y));z>u.thresholds.twoFingerSweepOffset;)f(s.TOBETWOFINGERSWEEP),z-=u.thresholds.twoFingerSweepOffset;if(d(s.TOBETWOFINGERSWEEP)){c(s.TWOFINGERSWEEPSTART);var F={type:"twofingersweep-start",scale:1,rotation:0},V=new p.Vector2;V.addVectors(g[0],g[1]),V.multiplyScalar(.5),F.center={pageX:V.x,pageY:V.y},F.deltaTime=1e3/60,F.touchEvent=o,F.deltaX=0,F.deltaY=0,u.dispatchEvent(F)}}else f(s.TOUCHSTART)}if(u.recognizerState===s.TWOFINGERSWEEPSTART||u.recognizerState===s.TWOFINGERSWEEP){c(s.TWOFINGERSWEEP);for(var W=[new p.Vector2,new p.Vector2],G=0;G<2;++G)W[G].set(e.touches[G].pageX,e.touches[G].pageY);var H={type:"twofingersweep",scale:1,rotation:0},K=new p.Vector2;K.addVectors(W[0],W[1]),K.multiplyScalar(.5),H.center={pageX:K.x,pageY:K.y},H.deltaTime=1e3/60,H.touchEvent=e,H.deltaX=0,H.deltaY=0,u.dispatchEvent(H)}else if(u.recognizerState===s.PINCHSTART||u.recognizerState===s.PINCH){for(var q=[new p.Vector2,new p.Vector2],Y=0;Y<2;++Y)q[Y].set(o.touches[Y].pageX,o.touches[Y].pageY);c(s.PINCH);for(var X=[new p.Vector2,new p.Vector2],Z=0;Z<2;++Z)X[Z].set(e.touches[Z].pageX,e.touches[Z].pageY);var Q={type:"pinch"},J=new p.Vector2;J.subVectors(q[1],q[0]);var $=new p.Vector2;$.subVectors(X[1],X[0]);var ee=J.length(),te=$.length(),re=J.dot($)/(ee*te),ne=new p.Vector3(J.x,J.y,0),ie=new p.Vector3($.x,$.y,0),oe=ne.cross(ie).z/(ee*te);Q.scale=te/ee,Math.abs(ee)<1e-7&&(Q.scale=1),Q.rotation=180*Math.atan2(oe,re)/Math.PI;var ae=new p.Vector2;ae.addVectors(X[0],X[1]),ae.multiplyScalar(.5),Q.center={pageX:ae.x,pageY:ae.y},Q.deltaTime=1e3/60,Q.touchEvent=e,Q.deltaX=0,Q.deltaY=0,u.dispatchEvent(Q),Q.type="pinchrotate",u.dispatchEvent(Q)}else if(u.recognizerState===s.ROTATESTART||u.recognizerState===s.ROTATE){for(var se=[new p.Vector2,new p.Vector2],ue=0;ue<2;++ue)se[ue].set(o.touches[ue].pageX,o.touches[ue].pageY);c(s.ROTATE);for(var ce=[new p.Vector2,new p.Vector2],le=0;le<2;++le)ce[le].set(e.touches[le].pageX,e.touches[le].pageY);var fe={type:"rotate"},he=new p.Vector2;he.subVectors(se[1],se[0]);var pe=new p.Vector2;pe.subVectors(ce[1],ce[0]);var de=he.length(),ve=pe.length(),ye=he.dot(pe)/(de*ve),me=new p.Vector3(he.x,he.y,0),ge=new p.Vector3(pe.x,pe.y,0),be=me.cross(ge).z/(de*ve);fe.scale=ve/de,Math.abs(de)<1e-7&&(fe.scale=1),fe.rotation=180*Math.atan2(be,ye)/Math.PI;var _e=new p.Vector2;_e.addVectors(ce[0],ce[1]),_e.multiplyScalar(.5),fe.center={pageX:_e.x,pageY:_e.y},fe.deltaTime=1e3/60,fe.touchEvent=e,fe.deltaX=0,fe.deltaY=0,u.dispatchEvent(fe),fe.type="pinchrotate",u.dispatchEvent(fe)}break;default:u.debug&&console.log(e)}a=l(e),i=Date.now()-t,u.debug&&console.log("touchMove",n,"ms")}}function m(e){if(u.debug&&console.log("onTouchEnd"),u.rawTouchDebug&&console.log(e),!1!==u.enabled){u.debug&&console.log(r),u.debug&&console.log(u.handlers),u.debug&&console.log(e),u.debug&&console.log(o),u.debug&&console.log(u.recognizerState);var t,i=Date.now();if(u.recognizerState===s.TWOFINGERSWEEP){c(s.NONE),h();var l={type:"twofingersweep-end"};l.touchEvent=a,u.dispatchEvent(l)}else if(u.recognizerState===s.ROTATE){c(s.NONE),h();var f={type:"rotate-end"};f.touchEvent=a,u.dispatchEvent(f),f.type="pinchrotate-end",u.dispatchEvent(f)}if(u.recognizerState===s.PINCH){c(s.NONE),h();var p={type:"pinch-end"};p.touchEvent=a,u.dispatchEvent(p),p.type="pinchrotate-end",u.dispatchEvent(p)}else switch(o.touches.length){case 1:if(0===r){if(i-n>u.thresholds.singleTapTimeout){c(s.NONE),u.debug&&console.log("Cancel a tap because it is hold for too long");break}if(u.recognizerState!==s.TOBEDOUBLETAP)u.debug&&console.log("first Tapping"),c(s.TOBETAP),setTimeout((t=o,function(){if(u.recognizerState===s.TOBETAP){c(s.TAP);var e={type:"tap"};e.touchEvent=t,u.dispatchEvent(e),c(s.NONE)}}),u.thresholds.doubleTapTimeout);else{u.debug&&console.log("second Tapping"),c(s.DOUBLETAP);var d={type:"double-tap"};d.touchEvent=o,u.dispatchEvent(d),c(s.NONE)}}else if(u.recognizerState===s.DRAGGING){c(s.NONE),h();var v={type:"drag-end"};v.touchEvent=e,u.dispatchEvent(v)}else if(u.recognizerState===s.DBLTAPDRAGGING){c(s.NONE),h();var g={type:"dbltap-drag-end"};g.touchEvent=e,u.dispatchEvent(g)}}r=-1,o=null,a=null,u.domElement.removeEventListener("touchend",m,!1),u.domElement.removeEventListener("touchmove",y,!1)}}};(it.prototype=Object.create(p.EventDispatcher.prototype)).constructor=it,it.prototype.destruct=function(){return this.removeListeners(),this.enabled=!1,this.domElement=void 0,this.handlers=void 0,this.thresholds=void 0,this.recognizerStateQueue=void 0,!0};var ot,at=it;function st(e){return(st="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ut(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ct(e,t){return!t||"object"!==st(t)&&"function"!=typeof t?lt(e):t}function lt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ft(e,t,r){return(ft="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ht(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function ht(e){return(ht=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function pt(e,t){return(pt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var dt,vt,yt,mt,gt,bt,_t={NONE:0,ORBIT:1,DOLLY:2,SWIRL:3,TOUCH_ORBIT:11,TOUCH_DOLLY:12,TOUCH_SWIRL:13,FLYTO:21},wt=p.MOUSE.LEFT,xt=p.MOUSE.MIDDLE,At=p.MOUSE.RIGHT,kt=(dt=(ot=function(e){function t(e){var r,n=e.camera,i=e.openning,o=void 0===i?{}:i,a=e.handlers,s=e.ecefNode,u=e.layers,c=e.domElement,l=e.showAnchor,f=void 0!==l&&l;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var h=lt(r=ct(this,ht(t).call(this,{camera:n,handlers:a})));r._pose=new je,r._cameraPath=null,r.ecefNode=s,r.layers=u,r.domElement=c,function(){h.preventDefault=h._preventDefault.bind(h),h.onMouseDown=h._onMouseDown.bind(h),h.onMouseMove=h._onMouseMove.bind(h),h.onMouseUp=h._onMouseUp.bind(h);var e=h._onMouseWheel.bind(h),t=q(function(e){h._wheelBursting=!1},500);h.___wheelThrottlePrev=Date.now(),h.onMouseWheel=function(r){r.preventDefault(),h.___wheelThrottleNow=Date.now();var n=h.___wheelThrottleNow-h.___wheelThrottlePrev;n<45||(h.___wheelThrottlePrev=h.___wheelThrottleNow,e(r),t(r))},h.onDragStart=h._onDragStart.bind(h),h.onDrag=h._onDrag.bind(h),h.onDragEnd=h._onDragEnd.bind(h),h.onTwoFingerStart=h._onTwoFingerStart.bind(h),h.onTwoFinger=h._onTwoFinger.bind(h),h.onTwoFingerEnd=h._onTwoFingerEnd.bind(h)}(),r.gestureRecognizer=new at(r.domElement,{debug:!1}),r.orbitSpeed=.1,r.swirlSpeed=12,r.dollySpeed=1.5,r.enabled=!0,r._enabledDamping=!1,r._state=_t.NONE,r._orbitStart=new p.Vector2(0,0),r._orbitEnd=new p.Vector2(0,0),r._swirlStart=new p.Vector2(0,0),r._swirlEnd=new p.Vector2(0,0),r._rotateStart=new p.Vector2(0,0),r._rotateEnd=new p.Vector2(0,0),r._dollyStart=0,r._dollyEnd=0,r._wheelBursting=!1,r._showAnchor=f,r.showContact=!1,r.showENU=!1,r._anchorScaleFactor=1,r._targetCenterFocus=null,r._picker=new Qe({camera:n,layers:u,domElement:c}),r._earthPicker=new nt({camera:n,domElement:c,control:lt(r)});var d,v,y,m,g=new p.SphereBufferGeometry(5,32,32),b=new p.MeshBasicMaterial({color:16776960,side:p.DoubleSide});return r.showAnchor&&(r.__anchorPoint=new p.Mesh(g,b),r.ecefNode.sceneNode.add(r.__anchorPoint)),r.showContact&&(r.__contactPoint=new p.Mesh(g,b),r.ecefNode.sceneNode.add(r.__contactPoint)),r.__enu=new p.AxesHelper(1e6),r.__enu.matrixAutoUpdate=!1,r.showENU&&r.ecefNode.sceneNode.add(r.__enu),d=o.poseTo,v=Object.assign({},{lat:22.335836,lng:114.263885,alt:1e6,north:0,tilt:60,up:0},d),y=Object.assign({},v,d),m=Date.now(),h._cameraPath=new Ve(new je(y),new je(y),{start:m-1,current:m,end:m}),h._pose.value=y,h._updateFrustum=K(function(){h.__updateFrustum()},30),h._updateNearFar=K(function(){h.__updateNearFar()},100),r}var r,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&pt(e,t)}(t,ze),r=t,(n=[{key:"destruct",value:function(){return this.enabled=!1,this._cameraPath&&this._cameraPath.destruct(),this._cameraPath=void 0,this._pose&&this._pose.destruct(),this._pose=void 0,this.gestureRecognizer&&this.gestureRecognizer.destruct(),this.gestureRecognizer=void 0,this._picker&&this._picker.destruct(),this._picker=void 0,this._earthPicker&&this._earthPicker.destruct(),this._earthPicker=void 0,this._updateFrustum&&(this._updateFrustum=void 0),this._updateNearFar&&(this._updateNearFar=void 0),this.ecefNode=void 0,this._orbitStart=void 0,this._orbitEnd=void 0,this._swirlStart=void 0,this._swirlEnd=void 0,this._rotateStart=void 0,this._rotateEnd=void 0,ft(ht(t.prototype),"destruct",this).call(this)}},{key:"cameraPose",value:function(){return this._pose.value}},{key:"freeze",value:function(){this.enabled=!1}},{key:"unfreeze",value:function(){this.enabled=!0}},{key:"tiltRange",value:function(e){var t=e.max,r=e.min;return isNaN(r)||(this.pose.tilt<r&&(this._pose.tilt=r+1e-4),this._pose.minTilt=r),isNaN(t)||(t>je.maxTilt&&(console.warn("maxTilt cannot exceed",je.maxTilt),t=je.maxTilt-1e-4),this.pose.tilt>t&&(this._pose.tilt=t-1e-4),this._pose.maxTilt=t),{max:this._pose.maxTilt,min:this._pose.minTilt}}},{key:"altRange",value:function(e){var t=e.max,r=e.min;return isNaN(r)||(this.pose.alt<r&&(this._pose.alt=r+1e-4),this._pose.minAlt=r),isNaN(t)||(this.pose.alt>t&&(this._pose.alt=t-1e-4),this._pose.maxAlt=t),{max:this._pose.maxAlt,min:this._pose.minAlt}}},{key:"flyToPose",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e3,n=this;return this.state!==_t.FLYTO&&(this.cameraPath.sync(this._pose.matrix),this.state=_t.FLYTO),this._putAnchor(),this.cameraPath.destinate(e,r).then(function(){return n._pose.value=n.cameraPath.dst.value,t._putAnchor(),n.state=_t.NONE,n.onCameraChange(),Promise.resolve()}).catch(function(e){return t._putAnchor(),n.onCameraChange(),"destination changed"===e.message?(n._pose.matrix=n.cameraPath.dst.matrix,Promise.resolve(e.message)):"disabled"===e.message?Promise.resolve(e.message):(n._pose.matrix=n.cameraPath.dst.matrix,Promise.reject(e))})}},{key:"flyToMat",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e3,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=this;return this.state!==_t.FLYTO&&(this.cameraPath.sync(this._pose.matrix),this.state=_t.FLYTO),this._putAnchor(),r&&r.isVector3?this._targetCenterFocus=r.clone():this._targetCenterFocus=null,this.cameraPath.destinate(e,t).then(function(){return n._pose.matrix=n.cameraPath.dst.matrix,n._putAnchor(),n.state=_t.NONE,n.onCameraChange(),Promise.resolve()}).catch(function(e){return n._putAnchor(),n.onCameraChange(),"destination changed"===e.message?(n._pose.matrix=n.cameraPath.dst.matrix,Promise.resolve(e.message)):"disabled"===e.message?Promise.resolve(e.message):(n._pose.matrix=n.cameraPath.dst.matrix,Promise.reject(e))})}},{key:"flyToMatNorthUp",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=new p.Vector3,i=new p.Quaternion,o=new p.Vector3;e.decompose(n,i,o);var a=n.clone(),s=o.clone(),u=n.clone().normalize(),c=new p.Vector3(0,0,-1).applyQuaternion(i.clone()),l=c.clone().cross(u).normalize(),f=l.clone().cross(c).normalize();(new p.Matrix4).makeBasis(l.normalize(),f.normalize(),c.negate().normalize()).decompose(n,i,o);var h=i.clone(),d=(new p.Matrix4).compose(a,h,s);return this.flyToMat(d,t,r)}},{key:"flyToMatWithFocus",value:function(e,t,r){return this._targetCenterFocus=r.clone(),this.flyToMat(e,t)}},{key:"flyAlong",value:function(e,t){var r=this,n=this;this.cameraPath.setAlphaAdaptFunc(function(e){return e});var i=e(0);return this.flyToMat(i,1e3).then(function(){r.state!==_t.FLYTO&&(r.cameraPath.sync(r._pose.matrix),r.state=_t.FLYTO),r._putAnchor();var i=e(1);return r.cameraPath.setInterpolateFunc(e),r.cameraPath.destinate(i,t).then(function(){return n._pose.matrix=n.cameraPath.dst.matrix,n._putAnchor(),n.state=_t.NONE,n.onCameraChange(),n.cameraPath.setAlphaAdaptFunc(),n.cameraPath.setInterpolateFunc(),Promise.resolve()}).catch(function(e){return n._putAnchor(),n.onCameraChange(),"destination changed"===e.message?(n._pose.matrix=n.cameraPath.dst.matrix,n.cameraPath.setAlphaAdaptFunc(),n.cameraPath.setInterpolateFunc(),Promise.resolve(e.message)):"disabled"===e.message?(n.cameraPath.setAlphaAdaptFunc(),n.cameraPath.setInterpolateFunc(),Promise.resolve(e.message)):(n._pose.matrix=n.cameraPath.dst.matrix,n.cameraPath.setAlphaAdaptFunc(),n.cameraPath.setInterpolateFunc(),Promise.reject(e))})})}},{key:"stopFlying",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.state===_t.FLYTO){var t=e?new Error("destination changed"):new Error("stopFlying");this.cameraPath.interrupt(t),this.state=_t.NONE}}},{key:"restoreView",value:function(){this._targetCenterFocus=null;var e=this._camera,t=e.view,r=this;return t?new Promise(function(n,i){setTimeout(function(){e.setViewOffset(t.fullWidth,t.fullHeight,0,0,t.fullWidth,t.fullHeight),r._handlers._onCameraChange(),n()},1e3)}):Promise.reject(new Error("No view"))}},{key:"update",value:function(){if(!this.cameraPath)return!1;var e;if(this.state!==_t.FLYTO)this._pose.applyDelta(),e=this._pose.matrix;else{var t=this.cameraPath.pose;if(t){var r=t.matrix;this._pose.matrix=r,e=r,this.__updateFrustum()}else e=this._pose.matrix}if(!this.__prevCamToEarth||!e.equals(this.__prevCamToEarth)){try{var n=(new p.Matrix4).getInverse(e,!0)}catch(e){return console.error("no inverse"),!1}if(this.ecefNode.setMatrix(n),this._handlers._onCameraChange(),this.__prevCamToEarth?this.__prevCamToEarth.copy(e):this.__prevCamToEarth=e,(this.showContact||this.showAnchor)&&this.ecefNode){var i=(new p.Vector3).setFromMatrixPosition(e),o=this._pose.anchor,a=i.distanceTo(o),s=.002*this._anchorScaleFactor*a;if(this.showAnchor){var u=this.__anchorPoint;u.position.copy(o),u.scale.set(s,s,s),u.visible=!0}if(this.showContact)this.__contactPoint.scale.set(s,s,s);if(this.showENU){var c=ve.ecef2Wgs84(o.x,o.y,o.z),l=c.longitude,f=c.latitude,h=ve.getENUSystem(f,l),d=h.origin,v=h.east,y=h.north,m=h.up,g=(new p.Matrix4).makeBasis(v,y,m).setPosition(d);this.__enu.matrix.copy(g)}}}return!0}},{key:"_mount",value:function(){this.domElement.addEventListener("contextmenu",this.preventDefault),this.domElement.addEventListener("mousedown",this.onMouseDown),this.domElement.addEventListener("mousewheel",this.onMouseWheel),this.domElement.addEventListener("MozMousePixelScroll",this.onMouseWheel),this.gestureRecognizer.addEventListener("drag-start",this.onDragStart,!1),this.gestureRecognizer.addEventListener("pinch-start",this.onTwoFingerStart,!1),this.gestureRecognizer.addEventListener("twofingersweep-start",this.onTwoFingerStart,!1),this.gestureRecognizer.addEventListener("rotate-start",this.onTwoFingerStart,!1)}},{key:"_unmount",value:function(){this.domElement.removeEventListener("contextmenu",this.preventDefault,!1),this.domElement.removeEventListener("mousedown",this.onMouseDown,!1),this.domElement.removeEventListener("mousewheel",this.onMouseWheel,!1),this.domElement.removeEventListener("MozMousePixelScroll",this.onMouseWheel,!1),this.gestureRecognizer.removeEventListener("drag-start",this.onDragStart,!1),this.gestureRecognizer.removeEventListener("pinch-start",this.onTwoFingerStart,!1),this.gestureRecognizer.removeEventListener("twofingersweep-start",this.onTwoFingerStart,!1),this.gestureRecognizer.removeEventListener("rotate-start",this.onTwoFingerStart,!1)}},{key:"_preventDefault",value:function(e){e.preventDefault()}},{key:"_onMouseDown",value:function(e){if(this.enabled){if(e.preventDefault(),this.stopFlying(!0),e.button===wt){if(!this.enabledOrbit)return;this._handleOrbitStart(e.clientX,e.clientY),this.state=_t.ORBIT}else if(e.button===xt){if(!this.enabledDolly)return;this.state=_t.DOLLY}else if(e.button===At){if(!this.enabledSwirl)return;this._handleSwirlStart(e.clientX,e.clientY),this.state=_t.SWIRL}this.state!==_t.NONE&&(this.domElement.addEventListener("mousemove",this.onMouseMove),this.domElement.addEventListener("mouseup",this.onMouseUp),this.domElement.addEventListener("mouseout",this.onMouseUp),this._handlers._onCameraStart(e))}}},{key:"_onMouseWheel",value:function(e){if(this.enabled&&this.enabledDolly){e.preventDefault();var t=0;void 0!==e.wheelDelta?t=e.wheelDelta:void 0!==e.detail&&(t=-e.detail),t>0?t=this.dollySpeed:t<0&&(t=-this.dollySpeed),this._wheelBursting||(this.stopFlying(!0),this._pose.distanceToAnchor>.1*J?this._putAnchor():this._putAnchor({x:e.clientX,y:e.clientY}),this._wheelBursting=!0),this.dolly(-t)}}},{key:"_onMouseMove",value:function(e){if(this.enabled){e.preventDefault();var t=this.state;if(t===_t.ORBIT){if(!this.enabledOrbit)return;this._handleOrbitMove(e.clientX,e.clientY)}else if(t===_t.DOLLY){if(!this.enabledDolly)return}else if(t===_t.SWIRL){if(!this.enabledSwirl)return;this._handleSwirl(e.clientX,e.clientY)}if(this.showContact){var r={x:e.clientX,y:e.clientY},n=this._earthPicker.pick(r.x,r.y);if(n){var i=this.__contactPoint;i.position.copy(n),i.visible=!0}}}}},{key:"_onMouseUp",value:function(e){this.enabled&&(this.state===_t.ORBIT?(this.enabledOrbit&&this._handlers._onCameraEnd(e),this.state=_t.NONE):this.state===_t.DOLLY?(this.enabledDolly&&this._handlers._onCameraEnd(e),this.state=_t.NONE):this.state===_t.SWIRL&&(this.enabledSwirl&&this._handlers._onCameraEnd(e),this.state=_t.NONE),this.domElement.removeEventListener("mousemove",this.onMouseMove),this.domElement.removeEventListener("mouseup",this.onMouseUp),this.domElement.removeEventListener("mouseout",this.onMouseUp))}},{key:"_onDragStart",value:function(e){if(this.enabledOrbit){this.stopFlying(!0);var t=e.touchEvent,r=t.touches[0].pageX,n=t.touches[0].pageY;this._handleOrbitStart(r,n),this.state=_t.ORBIT,this.gestureRecognizer.addEventListener("drag",this.onDrag),this.gestureRecognizer.addEventListener("drag-end",this.onDragEnd),this._handlers._onCameraStart(t)}}},{key:"_onDrag",value:function(e){if(this.enabledOrbit){var t=e.touchEvent;this._handleOrbitMove(t.touches[0].pageX,t.touches[0].pageY),this.state=_t.ORBIT}}},{key:"_onDragEnd",value:function(e){if(this.enabledOrbit){var t=e.touchEvent;this.gestureRecognizer.removeEventListener("drag",this.onDrag),this.gestureRecognizer.removeEventListener("drag-end",this.onDragEnd),this._handlers._onCameraEnd(t),this.state=_t.NONE}}},{key:"_onTwoFingerStart",value:function(e){if(this.enabledSwirl||this.enabledDolly){this.stopFlying(!0);for(var t=e.center,r=[new p.Vector2,new p.Vector2],n=0;n<2;++n)r[n].set(event.touches[n].pageX,event.touches[n].pageY);var i=new p.Vector2;i.subVectors(r[1],r[0]),this._handleSwirlStart(t.pageX,t.pageY,i),this.state=_t.SWIRL;var o=this.__twoTouchPoints(e),a=o.p,s=o.q,u=a.distanceTo(s);isNaN(u)||(this._dollyStart=u),this.gestureRecognizer.addEventListener("pinch",this.onTwoFinger),this.gestureRecognizer.addEventListener("pinch-end",this.onTwoFingerEnd),this.gestureRecognizer.addEventListener("twofingersweep",this.onTwoFinger),this.gestureRecognizer.addEventListener("twofingersweep-end",this.onTwoFingerEnd),this.gestureRecognizer.addEventListener("rotate",this.onTwoFinger),this.gestureRecognizer.addEventListener("rotate-end",this.onTwoFingerEnd),this._handlers._onCameraStart(event)}}},{key:"_onTwoFinger",value:function(e){if(this.enabledSwirl||this.enabledDolly){for(var t=e.center,r=[new p.Vector2,new p.Vector2],n=0;n<2;++n)r[n].set(event.touches[n].pageX,event.touches[n].pageY);var i=new p.Vector2;i.subVectors(r[1],r[0]),this._handleSwirl(t.pageX,t.pageY,i);var o=this.__twoTouchPoints(e),a=o.p,s=o.q,u=a.distanceTo(s);if(!isNaN(u)){if(this._dollyEnd=u,0!==this._dollyStart){var c=(this._dollyEnd-this._dollyStart)/-50;this.dolly(c*this.dollySpeed)}this._dollyStart=this._dollyEnd}this.state=_t.SWIRL}}},{key:"_onTwoFingerEnd",value:function(e){if(this._onDragEnd(e),this.enabledSwirl||this.enabledDolly){var t=e.touchEvent;this._dollyStart=this._dollyEnd=0,this.gestureRecognizer.removeEventListener("pinch",this.onTwoFinger),this.gestureRecognizer.removeEventListener("pinch-end",this.onTwoFingerEnd),this.gestureRecognizer.removeEventListener("twofingersweep",this.onTwoFinger),this.gestureRecognizer.removeEventListener("twofingersweep-end",this.onTwoFingerEnd),this.gestureRecognizer.removeEventListener("rotate",this.onTwoFinger),this.gestureRecognizer.removeEventListener("rotate-end",this.onTwoFingerEnd),this._handlers._onCameraEnd(t),this.state=_t.NONE}}},{key:"_handleOrbitStart",value:function(e,t){this._putAnchor({x:e,y:t}),this._orbitStart.set(e,t)}},{key:"_handleOrbitMove",value:function(e,t){this._orbitEnd.set(e,t);var r=(new p.Vector3).subVectors(this._orbitEnd,this._orbitStart);r.lengthSq()>100&&(console.warn("Abnormal large orbit move."),r.normalize().multiplyScalar(10));var n=Math.min(this.domElement.clientHeight,this.domElement.clientWidth,50);this.orbitLeft(r.x/n*this.orbitSpeed),this.orbitUp(r.y/n*this.orbitSpeed),this._orbitStart.copy(this._orbitEnd)}},{key:"_handleSwirlStart",value:function(e,t,r){this._putAnchor({x:e,y:t}),this._swirlStart.set(e,t),r&&this._rotateStart.copy(r)}},{key:"_handleSwirl",value:function(e,t,r){this._swirlEnd.set(e,t);var n=(new p.Vector3).subVectors(this._swirlEnd,this._swirlStart),i=Math.min(this.domElement.clientHeight,this.domElement.clientWidth,50);if(this.swirlLeft(n.x/i*this.swirlSpeed),this.swirlUp(n.y/i*this.swirlSpeed),this._swirlStart.copy(this._swirlEnd),r){this._rotateEnd=r;var o=this._rotateStart.length()*this._rotateEnd.length(),a=this._rotateStart.dot(this._rotateEnd)/o,s=new p.Vector3(this._rotateStart.x,this._rotateStart.y,0),u=new p.Vector3(this._rotateEnd.x,this._rotateEnd.y,0),c=s.cross(u).z/o,l=Math.atan2(c,a);this.swirlLeft(-2*l*this.swirlSpeed),this._rotateStart.copy(this._rotateEnd)}}},{key:"_putAnchor",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._pose;if(e){var r=this.pickProjectContactPointInEarth({rawX:e.x,rawY:e.y},"marker");return r||(r=this.pickProjectContactPointInEarth({rawX:e.x,rawY:e.y})),void(r?t.putAnchor(r):t.putAnchor())}t.putAnchor()}},{key:"__updateNearFar",value:function(){var e,t,r=this._camera,n=this._pose.matrix,i=(new p.Vector3).setFromMatrixPosition(n),o=this._pose.anchor,a=i.distanceTo(o),s=i.length();if(o.lengthSq()<.8*J)e=1,t=s;else{e=.01*a,t=s+Math.min(Math.max(10*a,s),2*J);var u=$*J,c=u-J;a<($-1)*J?(e=.01*a,t=Math.sqrt(a*(a+2*u))+Math.sqrt(c*(2*J+c))+2e5):(e=.1*a,t=30*J)}r.near=e,r.far=t,r.updateProjectionMatrix()}},{key:"__updateFrustum",value:function(){var e=this._targetCenterFocus;if(e){var t=this._camera,r=this._pose.matrix;if(!t.view)return void console.warn("No view ready.");0;var n=e.clone(),i=(new p.Matrix4).getInverse(r);n.applyMatrix4(i);var o=t.fov,a=t.aspect,s=t.near,u=t.far,c=new p.PerspectiveCamera(o,a,s,u),l=n.project(c);0;var f=(l.x+1)/2*this.domWidth,h=(1-l.y)/2*this.domHeight,d=t.view,v=f-(d.offsetX+d.width/2),y=h-(d.offsetY+d.height/2),m=d.offsetX+v,g=d.offsetY+y;0,t.setViewOffset(d.fullWidth,d.fullHeight,m,g,d.width,d.height)}}},{key:"__twoTouchPoints",value:function(e){var t=e.touchEvent.touches;return{p:new p.Vector2(t[0].pageX,t[0].pageY),q:new p.Vector2(t[1].pageX,t[1].pageY)}}},{key:"putCenterAnchor",value:function(){var e=this.domWidth/2,t=this.domHeight/2;return this._putAnchor({x:e,y:t})}},{key:"orbitLeft",value:function(e){0!==e&&this._pose.orbitLeft(e)}},{key:"orbitUp",value:function(e){0!==e&&this._pose.orbitUp(e)}},{key:"dolly",value:function(e){0!==e&&this._pose.dolly(e)}},{key:"swirlLeft",value:function(e){this.enabledSwirlLeft&&e&&this._pose.swirlLeft(e)}},{key:"swirlUp",value:function(e){this.enabledSwirlUp&&e&&this._pose.swirlUp(e)}},{key:"pickEarthContactPoint",value:function(e){var t=e.rawX,r=e.rawY,n=this._earthPicker.pick(t,r);if(n){var i=ve.ecef2Wgs84(n.x,n.y,n.z),o=i.latitude;return{lng:i.longitude,lat:o,alt:0}}}},{key:"pickProjectContactPoint",value:function(e){var t=e.rawX,r=e.rawY,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"project",i=this.pickProjectContactPointInEarth({rawX:t,rawY:r},n);if(i){var o=ve.ecef2Wgs84(i.x,i.y,i.z),a=o.latitude;return{lng:o.longitude,lat:a,alt:o.height}}}},{key:"pickProjectContactPointInEarth",value:function(e){var t=e.rawX,r=e.rawY,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"project";this._picker.layerName=n;var i=this._picker.pick(t,r);if(i.length>0){var o=this._pose.matrix,a=i[0].point.clone();return a.applyMatrix4(o),a}}},{key:"mapToWindow",value:function(e,t){return this._picker._NDCinv(e,t)}},{key:"onCameraChange",value:function(){this._updateNearFar()}},{key:"cameraPath",get:function(){return this._cameraPath}},{key:"pose",get:function(){return this._pose.value},set:function(e){this._pose.value=e,this._handlers._onCameraChange()}},{key:"camToEarth",get:function(){return this._pose.matrix}},{key:"POS",get:function(){return this._pose.POS}},{key:"state",set:function(e){this._state=e},get:function(){return this._state}},{key:"enabled",set:function(e){this._enabled=e,this.enabledOrbit=e,this.enabledDolly=e,this.enabledSwirl=e,e?this._mount():(this._unmount(),this.state=_t.NONE,this.cameraPath.interrupt(new Error("disabled")))},get:function(){return this._enabled}},{key:"enabledOrbit",set:function(e){this._enabledOrbit=e},get:function(){return this._enabledOrbit}},{key:"enabledDolly",set:function(e){this._enabledDolly=e},get:function(){return this._enabledDolly}},{key:"enabledSwirl",set:function(e){this.enabledSwirlLeft=e,this.enabledSwirlUp=e},get:function(){return this.enabledSwirlLeft||this.enabledSwirlUp}},{key:"enabledSwirlUp",set:function(e){this._enabledSwirlUp=e},get:function(){return this._enabledSwirlUp}},{key:"enabledSwirlLeft",set:function(e){this._enabledSwirlLeft=e},get:function(){return this._enabledSwirlLeft}},{key:"enableRotate",set:function(e){this.enabledOrbit=e}},{key:"focus",get:function(){return this._pose.value}},{key:"domWidth",get:function(){return this.domElement.clientWidth}},{key:"domHeight",get:function(){return this.domElement.clientHeight}},{key:"showAnchor",get:function(){return this._showAnchor},set:function(e){this._showAnchor=e}}])&&ut(r.prototype,n),i&&ut(r,i),t}()).prototype,vt="enableRotate",yt=[ye],mt=Object.getOwnPropertyDescriptor(ot.prototype,"enableRotate"),gt=ot.prototype,bt={},Object.keys(mt).forEach(function(e){bt[e]=mt[e]}),bt.enumerable=!!bt.enumerable,bt.configurable=!!bt.configurable,("value"in bt||bt.initializer)&&(bt.writable=!0),bt=yt.slice().reverse().reduce(function(e,t){return t(dt,vt,e)||e},bt),gt&&void 0!==bt.initializer&&(bt.value=bt.initializer?bt.initializer.call(gt):void 0,bt.initializer=void 0),void 0===bt.initializer&&(Object.defineProperty(dt,vt,bt),bt=null),ot);function Ot(e){return(Ot="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function St(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Pt(e,t){return!t||"object"!==Ot(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Tt(e){return(Tt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Et(e,t){return(Et=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Mt=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=Pt(this,Tt(t).call(this,e)))._property.type="HyperLayer",r}var r,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Et(e,t)}(t,W),r=t,(n=[{key:"clear",value:function(){console.warn("clear is not implemented")}}])&&St(r.prototype,n),i&&St(r,i),t}();function jt(e){return(jt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ct(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Rt(e,t){return!t||"object"!==jt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function It(e,t,r){return(It="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=Bt(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function Lt(e,t,r,n){return(Lt="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(e,t,r,n){var i,o=Bt(e,t);if(o){if((i=Object.getOwnPropertyDescriptor(o,t)).set)return i.set.call(n,r),!0;if(!i.writable)return!1}if(i=Object.getOwnPropertyDescriptor(n,t)){if(!i.writable)return!1;i.value=r,Object.defineProperty(n,t,i)}else!function(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(n,t,r);return!0})(e,t,r,n)}function Bt(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Ut(e)););return e}function Ut(e){return(Ut=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Dt(e,t){return(Dt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Nt=function(e){function t(e,r){var n,i=r.name,o=void 0===i?"HyperEntity":i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=Rt(this,Ut(t).call(this,e))).name=o,n._property.type="HyperEntity",n}var r,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Dt(e,t)}(t,W),r=t,(n=[{key:"initInfo",value:function(){return Promise.reject(new Error("initInfo not impelemented."))}},{key:"visible",set:function(e){!function(e,t,r,n,i){if(!Lt(e,t,r,n||e)&&i)throw new Error("failed to set property")}(Ut(t.prototype),"visible",e,this,!0),this._tree&&(this._tree.visible=e)},get:function(){return It(Ut(t.prototype),"visible",this)}}])&&Ct(r.prototype,n),i&&Ct(r,i),t}();function zt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Ft=function(){function e(t,r){var n=r.name,i=r.sceneGraphRoot,o=r.eventHandlers,a=void 0===o?{}:o,s=r.maxLevel,u=r.minLevel,c=r.priorityRank,l=void 0===c?1:c,f=r.showBBox,h=void 0!==f&&f,d=r.debug;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._name=n,this.Node=t,this.sceneGraphRoot=i,this.eventHandlers=a,this.maxLevel=s,this.minLevel=u,this.debug=d,this.root=null,this.numOfNodes=0;var v=a.onTileDownloaded,y=a.onError;this.sharedOptions={sceneGraphRoot:i,debug:d,onError:y,onTileDownloaded:v,priorityRank:l,showBBox:h,frustumInTree:new p.Frustum,camInTree:new p.Vector3,fov:50},this.flags={modelInitialized:!1};var m=this;this.initialized=new Promise(function(e,t){m._onInitSuccess=e,m._onInitFail=t}),this.style={}}var t,r,n;return t=e,(r=[{key:"destruct",value:function(){var e=!0;return e=e&&this.dispose(this.root),this.root=null,this._onContentDisposed(),this.tile_retriever&&(console.warn("deprecated"),e=e&&this.tile_retriever.destruct(),this.tile_retriever=null),e}},{key:"expand",value:function(e){return console.error("expand is not implemented"),!1}},{key:"dispose",value:function(e){var t=this.debug;if(null==e)return!0;var r=!0;void 0===e.nodes&&console.warn("inspect",e.info);for(var n=0;n<e.nodes.length;n++)r=this.dispose(e.nodes[n])&&r;return t&&console.log("delete",JSON.stringify(e.info)),r=e.destruct()&&r,e=void 0,this.numOfNodes--,r}},{key:"prune",value:function(e){if(void 0===e)return console.warn("Trying to prune undefined node"),!1;var t=!0;if(e.isInScene||e.displayByPrune(),e.nodes.length>0){for(var r=0;r<e.nodes.length;r++)t=this.dispose(e.nodes[r])&&t;e.nodes=[]}return t}},{key:"traverse",value:function(e,t,r,n){var i=!0;i=t(e,r,n)&&i;for(var o=0;o<e.nodes.length;o++)i=this.traverse(e.nodes[o],t,r,n)&&i;return i}},{key:"preSceneUpdate",value:function(e){var t=e.camera;return this._onCameraChanged(),this._updateCameraPose({camera:t}),!0}},{key:"updateVisibility",value:function(){return this.root&&this.traverse(this.root,function(e){return e.updateVisibility(),!0}),!0}},{key:"_onCameraChanged",value:function(){return this.root&&this.traverse(this.root,function(e){return e.cameraChanged(),!0}),!0}},{key:"_updateCameraPose",value:function(e){var t=e.camera,r=t.matrixWorldInverse.clone().multiply(this.sceneGraphRoot.matrixWorld);this.sharedOptions.frustumInTree.setFromMatrix((new p.Matrix4).multiplyMatrices(t.projectionMatrix,r)),this.sharedOptions.camInTree.setFromMatrixPosition((new p.Matrix4).getInverse(r)),this.sharedOptions.fov=t.fov}},{key:"_onContentInitialized",value:function(){this.flags.modelInitialized=!0,this.eventHandlers.onContentInitialized&&this.eventHandlers.onContentInitialized(),this._onInitSuccess(this)}},{key:"_onContentDisposed",value:function(){this.flags.modelInitialized=!1,this.eventHandlers.onContentDisposed&&this.eventHandlers.onContentDisposed()}},{key:"name",get:function(){return this._name}},{key:"visible",get:function(){return this.sceneGraphRoot.visible},set:function(e){this.sceneGraphRoot.visible=e}},{key:"size",get:function(){var e=0;return this.root&&this.traverse(this.root,function(t){return e++,!0}),e}},{key:"estimatedGpuUsage",get:function(){var e=0;return this.root&&this.traverse(this.root,function(t){return t.isInScene&&t.estimatedGpuUsage&&(e+=t.estimatedGpuUsage),!0}),e}},{key:"gpuUsage",get:function(){var e=0;return this.root&&this.traverse(this.root,function(t){return t.isInScene&&t.gpuUsage&&(e+=t.gpuUsage),!0}),e}},{key:"estimatedGpuMaxUsage",get:function(){var e=0;return this.root&&this.traverse(this.root,function(t){return t.estimatedGpuUsage&&(e+=t.estimatedGpuUsage),!0}),e}},{key:"gpuMaxUsage",get:function(){var e=0;return this.root&&this.traverse(this.root,function(t){return t.gpuUsage&&(e+=t.gpuUsage),!0}),e}},{key:"estimatedRamUsage",get:function(){var e=0;return this.root&&this.traverse(this.root,function(t){return t.estimatedRamUsage&&(e+=t.estimatedRamUsage),!0}),e}}])&&zt(t.prototype,r),n&&zt(t,n),e}();function Vt(e){return(Vt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Wt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Gt(e,t){return!t||"object"!==Vt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ht(e,t,r){return(Ht="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Kt(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function Kt(e){return(Kt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function qt(e,t){return(qt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Yt=function(e){function t(e,r){var n,i=r.name,o=r.sceneGraphRoot,a=r.eventHandlers,s=r.maxLevel,u=r.minLevel,c=r.priorityRank,l=r.showBBox,f=r.debug,h=r.TreeMaterialType,p=r.NodeMaterialType;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=Gt(this,Kt(t).call(this,e,{name:i,sceneGraphRoot:o,eventHandlers:a,maxLevel:s,minLevel:u,priorityRank:c,showBBox:l,debug:f})))._TreeMaterialType=h,n._NodeMaterialType=p,n}var r,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&qt(e,t)}(t,Ft),r=t,(n=[{key:"destruct",value:function(){var e=!0;return this._material&&(e=this._material.destruct()&&e),e=Ht(Kt(t.prototype),"destruct",this).call(this)&&e}},{key:"material",get:function(){if(!this._material){var e=this._NodeMaterialType,t=this._TreeMaterialType;this._material=new t({tree:this,Type:e})}return this._material},set:function(e){e!==this._material&&(e.tree=this,this._material&&this._material.destruct(),this._material=e,this._TreeMaterialType=e.constructor,this._NodeMaterialType=e.Type,this.sharedOptions.treeMaterial=this._material,this._material.updateMaterial()||console.warn("set material"))}},{key:"TreeMaterialType",get:function(){return this._TreeMaterialType}},{key:"NodeMaterialType",get:function(){return this.material.Type}}])&&Wt(r.prototype,n),i&&Wt(r,i),t}();function Xt(e){return(Xt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Zt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){Qt(e,t,r[t])})}return e}function Qt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Jt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function $t(e,t){return!t||"object"!==Xt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function er(e,t,r){return(er="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=tr(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function tr(e){return(tr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function rr(e,t){return(rr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var nr=function(e){function t(e,r){var n,i=r.sceneGraphRoot,o=r.name,a=void 0===o?"QuadLodTree":o,s=r.eventHandlers,u=r.maxLevel,c=r.minLevel,l=r.priorityRank,f=r.showBBox,h=r.camera,p=r.debug,d=r.TreeMaterialType,v=r.NodeMaterialType;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=$t(this,tr(t).call(this,e,{name:a,sceneGraphRoot:i,eventHandlers:s,maxLevel:u,minLevel:c,priorityRank:l,showBBox:f,debug:p,TreeMaterialType:d,NodeMaterialType:v}))).sharedOptions.maxLevel=u,n.sharedOptions.minLevel=c,n.camera=h,n}var r,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&rr(e,t)}(t,Yt),r=t,(n=[{key:"destruct",value:function(){return this.sharedOptions.maxLevel=0,this.sharedOptions.minLevel=0,this.camera=void 0,er(tr(t.prototype),"destruct",this).call(this)}},{key:"expand",value:function(e){if(e.level>=this.maxLevel)return console.warn(e,"exceed max level",this.maxLevel),!1;if(e.nodes.length>0)return console.warn(e,"children exist"),!1;if(0===e.nodes.length){var t=e.x,r=e.y,n={level:e.level+1,parent:e,sharedOptions:this.sharedOptions};return e.nodes[0]=new this.Node(Zt({x:2*t,y:2*r},n)),e.nodes[1]=new this.Node(Zt({x:2*t,y:2*r+1},n)),e.nodes[2]=new this.Node(Zt({x:2*t+1,y:2*r},n)),e.nodes[3]=new this.Node(Zt({x:2*t+1,y:2*r+1},n)),this.numOfNodes+=4,this.debug&&console.log("tree expand"),!0}return console.warn("unknown expand error"),!1}},{key:"preSceneUpdate",value:function(e){var r=e.camera;return er(tr(t.prototype),"preSceneUpdate",this).call(this,{camera:r}),this.camera!==r&&(this.camera&&console.warn("Camera instance Changed.",r,this.camera),this.camera=r),!0}}])&&Jt(r.prototype,n),i&&Jt(r,i),t}();function ir(e){var t={};return Object.keys(e).filter(function(t){return void 0!==e[t]&&null!==e[t]}).forEach(function(r){t[r]=e[r]}),t}function or(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e instanceof Object?Object.assign({},ir(e),ir(t)):e}function ar(e){return(ar="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function sr(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function ur(e,t){return!t||"object"!==ar(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function cr(e){return(cr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function lr(e,t){return(lr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var fr=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.level,i=r.x,o=r.y,a=sr(r,["level","x","y"]);!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var s=a.color,u=a.map,c=a.transparent,l=void 0!==c&&c,f=a.opacity,h=void 0===f?1:f;return(e=ur(this,cr(t).call(this,ir({color:s,map:u,transparent:l,opacity:h})))).level=n,e.x=i,e.y=o,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&lr(e,t)}(t,p["MeshBasicMaterial"]),t}();function hr(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function pr(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var dr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.tree,n=t.Type,i=void 0===n?fr:n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._tree=r,this._Type=i}var t,r,n;return t=e,(r=[{key:"destruct",value:function(){return this._tree=void 0,this._Type=void 0,!0}},{key:"updateMaterial",value:function(){return this.tree.traverse(this.tree.root,function(e){return e.updateMaterial(),!0})}},{key:"generateTileMaterial",value:function(e){var t=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){hr(e,t,r[t])})}return e}({},ir(e.style),ir(this.tree.style));return new this.Type(t)}},{key:"releaseMemoryOf",value:function(e){return!0}},{key:"tree",get:function(){return this._tree},set:function(e){this._tree=e}},{key:"Type",set:function(e){return this._Type=e,this.updateMaterial()},get:function(){return this._Type}}])&&pr(t.prototype,r),n&&pr(t,n),e}(),vr=r(13),yr=r.n(vr);function mr(e){for(var t=[-1/0,-1/0,-1/0],r=[1/0,1/0,1/0],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.length;n<i;n+=3)for(var o=0;o<3;o++){var a=e[n+o];a>t[o]&&(t[o]=a),a<r[o]&&(r[o]=a)}return{max:t,min:r}}function gr(e){var t=0;for(var r in e.attributes)t+=e.attributes[r].array.byteLength;return e.index&&(t+=e.index.array.byteLength),t}function br(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var _r=32;function wr(e){var t=se(e.level,e.x,e.y),r=t.minX,n=t.minY,i=t.maxX,o=t.maxY;return[[r,n],[i,n],[i,o],[r,o]].map(function(e){var t=br(e,2),r=t[0],n=t[1];return ve.webMercator2Ecef(r,n,0)})}function xr(e,t,r,n,i){return{u:(t+n)/e,v:(e-1-r+i)/e}}function Ar(e,t,r,n,i){return{u:e*n-t,v:e*i-(e-1-r)}}var kr=2,Or=3;function Sr(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Pr=function(){function e(){var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:4;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.workerSize=r,this.listeners=new Map,this.workers=[],this.jobs=[];for(var n=function(e){t.workers.push(new yr.a),t.jobs.push(0),t.workers[e].onmessage=function(r){var n=r.data.status,i=r.data.payload,o=r.data.resourceKey;if(t.listeners.has(o)){var a=t.listeners.get(o);t.listeners.delete(o),a.forEach(function(e){var t=e.resolve,r=e.reject;200===n?t(i):r(new Error(n))})}else console.error("Worker cannot find callback for",o);t.jobs[e]--},t.workers[e].onerror=function(e){console.error("PlanetLoader",e)}},i=0;i<this.workerSize;i++)n(i)}var t,r,n;return t=e,(r=[{key:"destruct",value:function(){return this.listeners.clear(),this.terminate()}},{key:"terminate",value:function(){var e=!0;if(this.workers&&this.workers.length>0)try{e=this.workers.reduce(function(e,t){return t.terminate()&&e},!0),this.workers=[],this.jobs=[]}catch(e){return console.error("LoadWorker terminate failed",e),!1}return e}},{key:"downloadMapForTile",value:function(e,t){var r=this,n=t;return new Promise(function(i,o){var a={resolve:i,reject:o};if(r.listeners.has(n)){r.listeners.get(n).push(a)}else{r.listeners.set(n,[a]);var s={action:Or,resourceKey:n,params:{mapName:e,url:t}},u=r.jobs.reduce(function(e,t,r,n){return t<n[e]?r:e},0);r.jobs[u]++,r.workers[u].postMessage(s)}})}},{key:"requestMesh",value:function(e,t,r){var n=this,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{timeout:3e3},o=(i.timeout,i.demImageData),a=i.demResource,s=kr+"-"+e+"-"+t+"-"+r;return o&&(s+="-"+a.level+"-"+a.x+"-"+a.y),new Promise(function(i,u){var c={resolve:i,reject:u};if(n.listeners.has(s)){n.listeners.get(s).push(c)}else{n.listeners.set(s,[c]);var l={action:kr,resourceKey:s,params:{level:e,x:t,y:r,demImageData:o,demResource:a}},f=n.jobs.reduce(function(e,t,r,n){return t<n[e]?r:e},0);n.jobs[f]++,n.workers[f].postMessage(l)}})}}])&&Sr(t.prototype,r),n&&Sr(t,n),e}(),Tr=r(14),Er=r.n(Tr);function Mr(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var jr=function(){function e(){var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.workerSize=r,this.listeners=new Map,this.workers=[],this.jobs=[];for(var n=function(e){t.workers.push(new Er.a),t.jobs.push(0),t.workers[e].onmessage=function(r){var n=r.data.url,i=r.data.success;if(t.listeners.has(n)){var o=t.listeners.get(n);t.listeners.delete(n),o.forEach(function(e){var t=e.resolve,n=e.reject;i?t(r.data.decoded):n(new Error(r.data.message))})}else console.error("Worker cannot find callback for",n);t.jobs[e]--}},i=0;i<this.workerSize;++i)n(i)}var t,r,n;return t=e,(r=[{key:"destruct",value:function(){return this.listeners.clear(),this.terminate()}},{key:"terminate",value:function(){var e=!0;if(this.workers&&this.workers.length>0)try{e=this.workers.reduce(function(e,t){return t.terminate()&&e},!0),this.workers=[],this.jobs=[]}catch(e){return console.error("LoadWorker terminate failed",e),!1}return e}},{key:"decode",value:function(e,t){var r=this,n=t;return new Promise(function(o,a){var s={resolve:o,reject:a};if(r.listeners.has(n)){r.listeners.get(n).push(s)}else{r.listeners.set(n,[s]);var u=r.jobs.reduce(function(e,t,r,n){return t<n[e]?r:e},0);r.jobs[u]++,e?r.workers[u].postMessage({bufferArray:e,url:t,type:i(t,"jpg")?"jpg":"png"},[e.buffer]):r.workers[u].postMessage({bufferArray:e,url:t,type:i(t,"jpg")?"jpg":"png"})}});function i(e,t){var r=e.length;return e.substring(r-t.length,r)===t}}},{key:"download",value:function(e){return this.decode(null,e)}}])&&Mr(t.prototype,r),n&&Mr(t,n),e}(),Cr=["// Atmospheric scattering vertex shader","// Author: Sean O'Neil","// Copyright (c) 2004 Sean O'Neil","uniform vec3 v3InvWavelength;","uniform float fOuterRadius;","uniform float fOuterRadius2;","uniform float fInnerRadius;","uniform float fInnerRadius2;","uniform float fKrESun;","uniform float fKmESun;","uniform float fKr4PI;","uniform float fKm4PI;","uniform float fScale;","uniform float fScaleDepth;","uniform float fScaleOverScaleDepth;","const int nSamples = 3;","const float fSamples = 3.0;","varying vec3 v3Direction;","varying vec3 c0;","varying vec3 c1;","varying float startDepth;","uniform vec3 v3LightPosition;","varying vec3 ncenter;","float scale(float fCos)","{","float x = 1.0 - fCos;","return fScaleDepth * exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));","}","#include <logdepthbuf_pars_vertex>","varying float inspace;","varying vec3 cloudPos;","void main(void)","{","vec3 modelPos = (modelMatrix * vec4(position, 1.0)).xyz;","ncenter = (modelMatrix * vec4(0, 0, 0, 1.0)).xyz;","vec3 translatedPosition = modelPos - ncenter;","vec3 translatedCameraPosition = cameraPosition - ncenter;","float fCameraHeight = max(0.0, length(cameraPosition - ncenter));","float fCameraHeight2 = pow(fCameraHeight, 2.0);","vec3 v3Ray = translatedPosition - translatedCameraPosition;","float fFar = length(v3Ray);","v3Ray /= fFar;","bool inSpace = fCameraHeight>fOuterRadius;","float B = 2.0 * dot(translatedCameraPosition, v3Ray);","float C = fCameraHeight2 - fOuterRadius2;","float fDet = max(0.0, B*B - 4.0 * C);","float fNear = 0.5 * (-B - sqrt(fDet));","fFar = inSpace ? fFar - fNear : fFar;","vec3 v3Start = inSpace ? translatedCameraPosition + v3Ray * fNear : translatedCameraPosition;","float fHeight = inSpace ? fOuterRadius : length(v3Start);","float fStartAngle = dot(v3Ray, v3Start) / fHeight;","float closeSurfaceDiff = min(0.0, (fInnerRadius - fHeight));","float fStartDepth = inSpace ? exp(-1.0 / fScaleDepth) : exp(fScaleOverScaleDepth * closeSurfaceDiff);","float fStartOffset = fStartDepth*scale(fStartAngle);","startDepth = clamp(fStartOffset,0.0,1.0);","float fSampleLength = fFar / fSamples;","float fScaledLength = fSampleLength * fScale;","vec3 v3SampleRay = v3Ray * fSampleLength;","vec3 v3SamplePoint = v3Start + v3SampleRay * 0.5;","vec3 v3FrontColor = vec3(0.0, 0.0, 0.0);","float fScatter;","float fDepth;","float fLightAngle;","float fCameraAngle;","vec3 v3Attenuate;","#pragma unroll_loop","for ( int i = 0; i < 3; i ++ ) {","fHeight = length(v3SamplePoint);","fHeight = fHeight < fInnerRadius && fHeight >= fInnerRadius * 0.99 ? fInnerRadius : fHeight;","fDepth = exp(fScaleOverScaleDepth * (fInnerRadius - fHeight));","fLightAngle = dot(v3LightPosition, v3SamplePoint) / fHeight;","fCameraAngle = dot(v3Ray, v3SamplePoint) / fHeight;","fScatter = (fStartOffset + fDepth * (scale(fLightAngle) - scale(fCameraAngle)));","v3Attenuate = exp(-fScatter * (v3InvWavelength * fKr4PI + fKm4PI));","v3FrontColor += v3Attenuate * (fDepth * fScaledLength);","v3SamplePoint += v3SampleRay;","v3FrontColor = fHeight < fInnerRadius ? vec3(0.5803921568627451,0.7725490196078432,1.0) : v3FrontColor;","}","vec3 transformed = vec3( position );","vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );","gl_Position = projectionMatrix * mvPosition;","c0 = v3FrontColor * (v3InvWavelength * fKrESun);","c1 = v3FrontColor * fKmESun;","cloudPos = normalize(position);","float l = length(translatedCameraPosition) / fOuterRadius * 1.0;","l = l - 1.0;","inspace = clamp(l, 0.0, 1.0);","v3Direction = translatedCameraPosition - translatedPosition;","#include <logdepthbuf_vertex>","}"].join("\n"),Rr="\n// with help and reference to these shadertoy examples:\n// https://www.shadertoy.com/view/XslGRr\n// https://www.shadertoy.com/view/ldyXRw\n// https://www.shadertoy.com/view/MlSSR1\n// https://www.shadertoy.com/view/XscXRs\n// https://www.shadertoy.com/view/Msdfz8\n// https://www.shadertoy.com/view/Xs2fDw\n// https://www.shadertoy.com/view/XdXyz8\n// https://www.shadertoy.com/view/4tGBDd\n// https://www.shadertoy.com/view/MsXSDN\n\nvarying vec3 cloudPos;\nuniform float time;\nfloat mod289(float x){return x - floor(x * (1.0 / 289.0)) * 289.0;}\nvec4 mod289(vec4 x){return x - floor(x * (1.0 / 289.0)) * 289.0;}\nvec4 perm(vec4 x){return mod289(((x * 34.0) + 1.0) * x);}\n\nfloat random3_2nd(vec3 p, float time){\n    vec3 a = floor(p);\n    vec3 d = p - a;\n    d = d * d * (3.0 - 2.0 * d);\n\n    vec4 b = a.xxyy + vec4(0.0, 1.0, 0.0, 1.0);\n    vec4 k1 = perm(b.xyxy);\n    vec4 k2 = perm(k1.xyxy + b.zzww);\n\n    vec4 c = k2 + a.zzzz;\n    vec4 k3 = perm(c);\n    vec4 k4 = perm(c + 1.0);\n\n    vec4 o1 = fract(k3 * (1.0 / 41.0));\n    vec4 o2 = fract(k4 * (1.0 / 41.0));\n\n    vec4 o3 = o2 * d.z + o1 * (1.0 - d.z);\n    vec2 o4 = o3.yw * d.x + o3.xz * (1.0 - d.x);\n\n    float f = o4.y * d.y + o4.x * (1.0 - d.y);\n    return f;\n}\nfloat fbm(vec3 p,float time)\n{\n  mat2 m=mat2(cos(time),-sin(time), sin(time),cos(time));\n  float f = 0.0;\n  vec3 c = p;\n  f += 0.5000*random3_2nd(c,time); c = c*2.02;c.xy=m*c.xy;\n  f += 0.2500*random3_2nd(c,time); c = c*2.03;c.zx=m*c.zx;\n  f += 0.1250*random3_2nd(c,time); c = c*2.01;c.yz=m*c.yz;\n  f += 0.0625*random3_2nd(c,time);\n  return f/0.9375;\n}\nfloat get_inner_clouds (vec3 p, float time) {\n  float f = fbm(p*100.0,time); // tuned parameter 100.0, make clouds smaller\n  f = f * f;\n  return smoothstep(0.0, 1.0, f);\n}\nfloat get_clouds_mask_value (vec3 pos, float time) {\n  // random3_2nd, some tuned parameters\n  // 3.0 5.5 10.0\n  // 3.0, 5.6, 10.6\n  // 3.0 5.6 10.5\n  // 3.0 5.6 15.6\n  mat2 m=mat2(cos(time),-sin(time), sin(time),cos(time)); // use to rotate the different mask\n  vec3 p = pos;\n  float f0 = random3_2nd(p*3.0, time); // the large mask\n  p.xz = m*p.xz;\n  float f1 = abs(random3_2nd(p*5.6, time)); // the middle size mask\n  p.yx = m*p.yx;\n  p -= 0.3 * random3_2nd(p, time); // to make the shape different, tuned 0.3\n  float f2 = (random3_2nd(p*15.6, time)); // smaller clouds shape\n  float f = (f0+f1+f2)/2.0*(f0)*(f1); // 2.0 to control the size and density of the cloud, tuned magic parameter\n  // make cloud having more contrast, the hsbc contrast are applied here\n  f = (f - 0.5) * 2.5 + 0.5; // 2.5 is the contrast parameter, default 1.0\n  // f = f * f * 3.0;\n  // f = clamp(f,0.0,1.0);\n  return smoothstep(0.0, 1.0, f);\n}\n",Ir=["uniform float fExposure;","uniform vec3 v3LightPosition;","uniform float g;","uniform float g2;","uniform float fOuterRadius;","varying vec3 v3Direction;","varying vec3 c0;","varying vec3 c1;","varying float startDepth;","varying vec3 ncenter;","float getMiePhase(float fCos, float fCos2, float g, float g2)","{","return 1.5 * ((1.0 - g2) / (2.0 + g2)) * (1.0 + fCos2) / pow(max(0.0, 1.0 + g2 - 2.0 * g * fCos), 1.5);","}","float getRayleighPhase(float fCos2)","{","return 0.75 + 0.75 * fCos2;","}","#include <logdepthbuf_pars_fragment>","varying float inspace;",Rr,"void main (void)","{","#include <logdepthbuf_fragment>","float fCameraHeight = length(cameraPosition - ncenter);","float fCos = dot(v3LightPosition, v3Direction) / length(v3Direction);","float fCos2 = fCos * fCos;","float rayleighPhase = getRayleighPhase(fCos2);","float miePhase = getMiePhase(fCos, fCos2, g, g2);","float sun = 2.0*((1.0 - 0.2) / (2.0 + 0.2)) * (1.0 + fCos*fCos) / pow(max(0.0, 1.0 + 0.2 - 2.0*(-0.2)*fCos), 1.0);","float noisevalue = inspace > 0.0 ? get_clouds_mask_value(cloudPos, time) * inspace : get_inner_clouds(cloudPos, time);","vec3 color = rayleighPhase * c0 +","miePhase * c1 +","startDepth * sun * mix(vec3(0.05,0.05,0.1), vec3(1.0), noisevalue);","color = vec3(1.0) - exp(-fExposure*color);","float nightmult = clamp(max(color.x, max(color.y, color.z))*1.5,0.0,1.0);","gl_FragColor = vec4(color, nightmult);","gl_FragColor.a = fCameraHeight<=fOuterRadius ? nightmult + fOuterRadius - fCameraHeight : gl_FragColor.a;","}"].join("\n"),Lr=["uniform vec3 v3LightPosition;","uniform vec3 v3InvWavelength;","uniform float fOuterRadius;","uniform float fOuterRadius2;","uniform float fInnerRadius;","uniform float fInnerRadius2;","uniform float fKrESun;","uniform float fKmESun;","uniform float fKr4PI;","uniform float fKm4PI;","uniform float fScale;","uniform float fScaleDepth;","uniform float fScaleOverScaleDepth;","uniform sampler2D tDiffuse;","varying vec3 c0;","varying vec3 c1;","varying vec2 vUv;","const int nSamples = 3;","const float fSamples = 3.0;","float scale(float fCos)","{","float x = 1.0 - fCos;","return fScaleDepth * exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));","}","#include <logdepthbuf_pars_vertex>","varying float inspace;","varying vec3 cloudPos;","void main(void)","{","vec3 ncenter = (modelMatrix * vec4(0, 0, 0, 1.0)).xyz;","vec3 modelPos = (modelMatrix * vec4(position, 1.0)).xyz;","vec3 translatedPosition = modelPos - ncenter;","vec3 translatedCameraPosition = cameraPosition - ncenter;","float fCameraHeight = max(0.0, length(cameraPosition - ncenter));","float fCameraHeight2 = pow(fCameraHeight, 2.0);","vec3 v3Ray = translatedPosition - translatedCameraPosition;","float fFar = length(v3Ray);","v3Ray /= fFar;","bool inSpace = fCameraHeight>fOuterRadius;","float B = 2.0 * dot(translatedCameraPosition, v3Ray);","float C = fCameraHeight2 - fOuterRadius2;","float fDet = max(0.0, B*B - 4.0 * C);","float fNear = 0.5 * (-B - sqrt(fDet));","fFar = inSpace ? fFar - fNear : fFar;","vec3 v3Start = inSpace ? translatedCameraPosition + v3Ray * fNear : translatedCameraPosition;","float fDepth = exp((fInnerRadius - fOuterRadius) / fScaleDepth);","float fCameraAngle = dot(-v3Ray, translatedPosition) / length(translatedPosition);","float fLightAngle = dot(v3LightPosition, translatedPosition) / length(translatedPosition);","float fCameraScale = scale(fCameraAngle);","float fLightScale = scale(fLightAngle);","float fCameraOffset = fDepth*fCameraScale;","float fTemp = (fLightScale + fCameraScale);","float fSampleLength = fFar / fSamples;","float fScaledLength = fSampleLength * fScale;","vec3 v3SampleRay = v3Ray * fSampleLength;","vec3 v3SamplePoint = v3Start + v3SampleRay * 0.5;","vec3 v3FrontColor = vec3(0.0, 0.0, 0.0);","vec3 v3Attenuate;","float fHeight;","float fScatter;","float closeSurfaceDiff;","#pragma unroll_loop","for ( int i = 0; i < 3; i ++ ) {","fHeight = length(v3SamplePoint);","closeSurfaceDiff = min(0.6 * (fInnerRadius - fOuterRadius), (fInnerRadius - fHeight));","fDepth = exp(fScaleOverScaleDepth * closeSurfaceDiff);","fCameraOffset = clamp(fCameraOffset, -0.1, 0.1);","fScatter = fDepth*fTemp - fCameraOffset;","v3Attenuate = exp(-fScatter * (v3InvWavelength * fKr4PI + fKm4PI));","v3FrontColor += v3Attenuate * (fDepth * fScaledLength);","v3SamplePoint += v3SampleRay;","}","c0 = v3Attenuate;","c1 = v3FrontColor * (v3InvWavelength * fKrESun + fKmESun);","vec3 transformed = vec3( position );","vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );","gl_Position = projectionMatrix * mvPosition;","vUv = uv;","cloudPos = normalize(position);","float l = length(translatedCameraPosition) / fOuterRadius * 1.0;","l = l - 1.0;","inspace = clamp(l, 0.0, 1.0);","#include <logdepthbuf_vertex>","}"].join("\n"),Br=["uniform float fNightScale;","uniform sampler2D tDiffuse;","varying vec3 c0;","varying vec3 c1;","varying vec2 vUv;","uniform float fExposure;","#include <logdepthbuf_pars_fragment>","varying float inspace;",Rr,"void main (void)","{","#include <logdepthbuf_fragment>","vec3 diffuseTex = texture2D( tDiffuse, vUv ).xyz;","float noisevalue = inspace > 0.0 ? get_clouds_mask_value(cloudPos, time) * inspace : 0.0;","float shadowNoisevalue = inspace > 0.0 ? clamp(noisevalue * 2.5, 0.0, 1.0) : get_inner_clouds(cloudPos, time);","diffuseTex = mix(diffuseTex, diffuseTex * 0.5, shadowNoisevalue);","diffuseTex = mix(diffuseTex, vec3(1.0), noisevalue);","vec3 diffuseNightTex = diffuseTex * 0.1;","vec3 day = diffuseTex * c0;","vec3 night = fNightScale * diffuseNightTex * diffuseNightTex * diffuseNightTex * (1.0 - c0);","vec3 color = c1 + day + night;","color = 1.0 - exp(-fExposure * color);","gl_FragColor = vec4(color, 1.0);","}"].join("\n");function Ur(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Dr(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Nr(e){return(Nr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function zr(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Fr(e,t){return!t||"object"!==Nr(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Vr(e){return(Vr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Wr(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Gr(e,t)}function Gr(e,t){return(Gr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Hr={Kr:.0025,Km:.001,ESun:20,g:-.95,innerRadius:ee*Y,outerRadius:$*Y,wavelength:[.65,.57,.475],scaleDepth:.25},Kr={uniforms:{v3LightPosition:{type:"v3",value:new p.Vector3(1,1,1).normalize()},focus:{type:"v3",value:new p.Vector3(0,0,0)},v3InvWavelength:{type:"v3",value:new p.Vector3(1/Math.pow(Hr.wavelength[0],4),1/Math.pow(Hr.wavelength[1],4),1/Math.pow(Hr.wavelength[2],4))},fInnerRadius:{type:"f",value:Hr.innerRadius},fInnerRadius2:{type:"f",value:Hr.innerRadius*Hr.innerRadius},fOuterRadius:{type:"f",value:Hr.outerRadius},fOuterRadius2:{type:"f",value:Hr.outerRadius*Hr.outerRadius},fKrESun:{type:"f",value:Hr.Kr*Hr.ESun},fKmESun:{type:"f",value:Hr.Km*Hr.ESun},fKr4PI:{type:"f",value:4*Hr.Kr*Math.PI},fKm4PI:{type:"f",value:4*Hr.Km*Math.PI},fScale:{type:"f",value:1/(Hr.outerRadius-Hr.innerRadius)},fScaleDepth:{type:"f",value:Hr.scaleDepth},fScaleOverScaleDepth:{type:"f",value:1/(Hr.outerRadius-Hr.innerRadius)/Hr.scaleDepth},g:{type:"f",value:Hr.g},g2:{type:"f",value:Hr.g*Hr.g},fNightScale:{type:"f",value:1},fExposure:{type:"f",value:2},time:{type:"f",value:0}},vertexShader_atmosphere:Cr,fragmentShader_atmosphere:Ir,vertexShader_ground:Lr,fragmentShader_ground:Br},qr=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.level,i=r.x,o=r.y,a=r.flatShading;return zr(this,t),(e=Fr(this,Vr(t).call(this))).uniforms=Kr.uniforms,e.vertexShader=Kr.vertexShader_atmosphere,e.fragmentShader=Kr.fragmentShader_atmosphere,e.transparent=!0,e.extensions.derivatives=!0,e.side=p.BackSide,e.level=n,e.x=i,e.y=o,e.flatShading=a,e}return Wr(t,p["ShaderMaterial"]),t}(),Yr=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.map,i=r.level,o=r.x,a=r.y,s=r.flatShading,u=r.transparent,c=void 0!==u&&u;return zr(this,t),(e=Fr(this,Vr(t).call(this))).uniforms=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){Ur(e,t,r[t])})}return e}({},Kr.uniforms,{tDiffuse:{type:"t",value:n}}),e.vertexShader=Kr.vertexShader_ground,e.fragmentShader=Kr.fragmentShader_ground,e.transparent=c,e.extensions.derivatives=!0,e.level=i,e.x=o,e.y=a,e.flatShading=s,e}var r,n,i;return Wr(t,p["ShaderMaterial"]),r=t,(n=[{key:"map",set:function(e){this.uniforms.tDiffuse.value=e},get:function(){return this.uniforms.tDiffuse.value}},{key:"sun",set:function(e){this.uniforms.v3LightPosition.value.copy(e)},get:function(){return this.uniforms.v3LightPosition.value}}])&&Dr(r.prototype,n),i&&Dr(r,i),t}();function Xr(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Zr(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Qr=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Zr(this,"queue",[]),Zr(this,"offset",0)}var t,r,n;return t=e,(r=[{key:"getLength",value:function(){return this.queue.length-this.offset}},{key:"isEmpty",value:function(){return 0===this.queue.length}},{key:"enqueue",value:function(e){this.queue.push(e)}},{key:"dequeue",value:function(){if(0!==this.queue.length){var e=this.queue[this.offset];return 2*++this.offset>=this.queue.length&&(this.queue=this.queue.slice(this.offset),this.offset=0),e}}},{key:"peek",value:function(){return this.queue.length>0?this.queue[this.offset]:void 0}},{key:"clear",value:function(){this.queue=[],this.offset=0}}])&&Xr(t.prototype,r),n&&Xr(t,n),e}();function Jr(e,t,r,n,i,o,a){try{var s=e[o](a),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,i)}function $r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function en(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function tn(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var rn=function e(t,r,n,i){tn(this,e),this.dockKey=t,this.func=r,this.onsuccess=n,this.onerror=i},nn=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];tn(this,e),en(this,"_capacity",void 0),en(this,"_size",0),en(this,"waitQueue",new Qr),en(this,"taskMap",new Map),en(this,"status","live"),en(this,"debug",void 0),this._capacity=t,this.debug=r}var t,r,n;return t=e,(r=[{key:"destruct",value:function(){return this.waitQueue.clear(),this.taskMap.clear(),this._capacity=0,this._size=0,this.status="dead",!0}},{key:"clear",value:function(){return this.waitQueue.clear(),this.taskMap.clear(),this._size=0,!0}},{key:"abortPending",value:function(){for(;!this.waitQueue.isEmpty();){var e=this.waitQueue.dequeue();if(void 0===e)break;e.onerror(new Error("[Dock] abortPending"))}return Promise.resolve()}},{key:"fill",value:function(){for(var e=this.waitQueue,t=this,r=this.capacity-this.size;r>0&&!e.isEmpty();){var n=e.dequeue();if(void 0===n)break;this.act(n).then(function(){t._size--,t.fill()}).catch(function(e){t._size--}),r=this.capacity-this.size}}},{key:"act",value:function(){var e,t=(e=regeneratorRuntime.mark(function e(t){var r,n,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._size++,r=t.func,n=t.onsuccess,i=t.onerror,e.abrupt("return",H(r(),3e4).then(function(e){return n(e),Promise.resolve()}).catch(function(e){return"408"!==e.message&&console.error("act error",e),i(e),Promise.resolve()}));case 5:case"end":return e.stop()}},e,this)}),function(){var t=this,r=arguments;return new Promise(function(n,i){var o=e.apply(t,r);function a(e){Jr(o,n,i,a,s,"next",e)}function s(e){Jr(o,n,i,a,s,"throw",e)}a(void 0)})});return function(e){return t.apply(this,arguments)}}()},{key:"queue",value:function(e){var t=this,r=this,n=e.dockKey,i=e.asyncAction,o=this.taskMap.get(n);return void 0===o&&(o=new Promise(function(e,o){var a=new rn(n,i,function(t){"live"===r.status&&r.taskMap.delete(n),e(t)},function(e){"live"===r.status&&r.taskMap.delete(n),o(e)});t.waitQueue.enqueue(a)}),this.taskMap.set(n,o),this.fill()),o}},{key:"size",get:function(){return this._size}},{key:"capacity",get:function(){return this._capacity}},{key:"info",get:function(){return{capacity:this.capacity,size:this.size,queue:this.waitQueue.getLength()}}}])&&$r(t.prototype,r),n&&$r(t,n),e}();function on(e){return(on="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function an(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function sn(e,t){return!t||"object"!==on(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function un(e,t,r){return(un="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=cn(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function cn(e){return(cn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ln(e,t){return(ln=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var fn,hn=N.ISMOBILE,pn=function(e){function t(e,r){var n,i=r.sceneGraphRoot,o=r.name,a=void 0===o?"QuadLodTree":o,s=r.eventHandlers,u=r.maxLevel,c=void 0===u?20:u,l=r.minLevel,f=r.priorityRank,h=void 0===f?8:f,p=r.debug,d=void 0!==p&&p,v=r.planet,y=r.countryName,m=void 0===y?"US":y,g=r.showBBox,b=void 0!==g&&g,_=r.solidColorTexture,w=r.TreeMaterialType,x=void 0===w?dr:w,A=r.NodeMaterialType,k=void 0===A?Yr:A;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=sn(this,cn(t).call(this,e,{sceneGraphRoot:i,name:a,eventHandlers:s,maxLevel:c,minLevel:l,priorityRank:h,debug:d,showBBox:b,TreeMaterialType:x,NodeMaterialType:k}))).sharedOptions.planet=v,n.sharedOptions.neighborFindingStats={time:0,number:0},n.sharedOptions.countryName=m,n.sharedOptions.solidColorTexture=_;var O=hn?1:2;n.sharedOptions.loadWorker=new Pr(O),n.sharedOptions.picDecoder=new jr(hn?1:2),n.sharedOptions.dock=new nn(hn?5:7,!1),n.nodeMap={},n.sharedOptions.nodeMap=n.nodeMap;var S,P,T,E=v.basemapName,M=v.mapMaxLevel;return n.sharedOptions.mapSettings=(T={maxLevel:M},(P=E)in(S={})?Object.defineProperty(S,P,{value:T,enumerable:!0,configurable:!0,writable:!0}):S[P]=T,S),n.root=new n.Node({parent:null,name:"Planet root",x:0,y:0,level:0,sharedOptions:n.sharedOptions}),n.nodeMap[n.root.nodeID]=n.root,n.numOfNodes++,n}var r,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ln(e,t)}(t,nr),r=t,(n=[{key:"destruct",value:function(){var e=!0;return this.sharedOptions.solidColorTexture=void 0,this.sharedOptions.loadWorker.destruct(),this.sharedOptions.loadWorker=void 0,this.sharedOptions.picDecoder.destruct(),this.sharedOptions.picDecoder=void 0,e=un(cn(t.prototype),"destruct",this).call(this)&&e}},{key:"expand",value:function(e){var r=this;if(this.stop)return!0;var n=un(cn(t.prototype),"expand",this).call(this,e);return e.nodes.forEach(function(e){r.nodeMap[e.nodeID]=e}),n}},{key:"prune",value:function(e){return!!this.stop||un(cn(t.prototype),"prune",this).call(this,e)}},{key:"updatePlanetMap",value:function(){this.sharedOptions.dock.abortPending().then(function(){return Promise.resolve()}),this.traverse(this.root,function(e){e.updateMap()})}},{key:"changeMapMaxLevel",value:function(e){var t=e.level,r=e.name;if("number"==typeof t){var n=this.sharedOptions.mapSettings[r]?this.sharedOptions.mapSettings[r].maxLevel:1/0;this.sharedOptions.mapSettings[r]={maxLevel:t},t>n&&this.traverse(this.root,function(e){e.level>n&&e.level<=t&&e.sendDownloadRequest(r)})}}},{key:"updatePlanetWireframeVisibility",value:function(){this.traverse(this.root,function(e){e.__wireframe&&(e.__wireframe.visible=e.showPlanetWireframe)})}}])&&an(r.prototype,n),i&&an(r,i),t}();function dn(e,t,r,n,i,o,a){try{var s=e[o](a),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,i)}function vn(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){var o=e.apply(t,r);function a(e){dn(o,n,i,a,s,"next",e)}function s(e){dn(o,n,i,a,s,"throw",e)}a(void 0)})}}function yn(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var mn=(function(e,t,r,n,i){var o={};Object.keys(n).forEach(function(e){o[e]=n[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=r.slice().reverse().reduce(function(r,n){return n(e,t,r)||r},o),i&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(i):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(e,t,o),o=null)}((fn=function(){function e(t){var r=this,n=t.parent,i=t.name,o=t.sharedOptions;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parent=n,this.name=i,this.sharedOptions=o,this.lifeState="empty",this._is404=!1,this.needsPrune=!1,this.shapeHolder=new p.Object3D,this.shapeHolder.name="LodNodeShapeHolder",this.contentHolder=new p.Object3D,this.contentHolder.name="LodNodeContentHolder",this.decoHolder=new p.Object3D,this.decoHolder.name="LodNodeDecoHolder",this.shapeHolder.add(this.contentHolder),this.shapeHolder.add(this.decoHolder),this.content=void 0,this.nodes=[],this.contentLoaded=new Promise(function(e,t){r._onContentLoadCompleted=e,r._onContentLoadFailed=t}),this._boundingBox=void 0,this.visibilityNeedsUpdate=!0,this.screenAreaNeedsUpdate=!0}var t,r,n;return t=e,(r=[{key:"destruct",value:function(){return this.debug&&console.log("destruct",JSON.stringify(this.info)),this.isInScene&&this._removeFromSceneGraph(),this._destroyBBox(),this.shapeHolder.remove(this.contentHolder),this.shapeHolder.remove(this.decoHolder),this.contentHolder.remove(this.content),this.content=void 0,this.parent=void 0,this.name=void 0,this.lifeState="expired",this._gpuUsage=void 0,this.sharedOptions={},this.nodes=void 0,this._visible=!0,this._isPlaceHolder=!1,!0}},{key:"preDownload",value:function(){var e=vn(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.resolve());case 1:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"downloading",value:function(){var e=vn(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r="downloading is not implemented",console.warn(r),e.abrupt("return",Promise.reject(new Error(r)));case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"postDownload",value:function(){var e=vn(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.sharedOptions&&this.sharedOptions.onTileDownloaded&&this.sharedOptions.onTileDownloaded(),e.abrupt("return",Promise.resolve(t));case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"cook",value:function(){var e=vn(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r="cook not implemented",console.warn(r),e.abrupt("return",Promise.reject(new Error(r)));case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"defaultCooked",value:function(){var e=vn(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t="defaultCooked not implemented",console.warn(t),e.abrupt("return",Promise.reject(new Error(t)));case 3:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"digest",value:function(e){console.warn("digest not implemented")}},{key:"_computeEstimatedGpuUsage",value:function(){if(this.isRoot)return this.estimatedRootGpuUsage;var e=this.parent.estimatedGpuUsage*this.estimationCoefficient,t=this.maxGpuUsage;return isNaN(t)?e:e>t?t:e}},{key:"_computeEstimatedRamUsage",value:function(){return this.isRoot?4194304:this.parent.estimatedRamUsage*this.estimationCoefficient}},{key:"_computeEstimatedBBox",value:function(){console.error("_computeEstimatedBBox is not implemented.")}},{key:"_updateVisibility",value:function(){return!(this.is404||!this.estimatedBBox)&&this.sharedOptions.frustumInTree.intersectsBox(this.estimatedBBox)}},{key:"_updateScreenArea",value:function(){if(!this.visible)return 0;var e=new p.Vector3;this.estimatedBBox.getCenter(e);var t=new p.Vector3;this.estimatedBBox.getSize(t);for(var r=t.toArray(),n=0,i=1;i<3;i++)r[i]<r[n]&&(n=i);for(var o=1,a=0;a<3;a++)a!==n&&(o*=r[a]);var s=Math.max(e.distanceTo(this.sharedOptions.camInTree),Number.MIN_VALUE);return isNaN(this.fov)||(s=1.732*s*Math.tan(this.fov/180*Math.PI)),o/s/s/this.priorityRank}},{key:"_displayBBox",value:function(){if(this.showBBox&&!this.__box3helper&&this.boundingBox){var e=255<<this.level%3*8;this.__box3helper=new p.Box3Helper(this.boundingBox,e),this.sceneGraphRoot.add(this.__box3helper)}}},{key:"_destroyBBox",value:function(){this.__box3helper&&(this.sceneGraphRoot.remove(this.__box3helper),this.__box3helper.geometry.dispose(),this.__box3helper.material.dispose(),this.__box3helper=void 0)}},{key:"traverse",value:function(e,t){var r=!0;r=e(this,t)&&r;for(var n=0;n<this.nodes.length;n++)r=this.nodes[n].traverse(e,t)&&r;return r}},{key:"download",value:function(){var e=vn(regeneratorRuntime.mark(function e(){var t=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.preDownload().then(function(e){return t.downloading(e)}).then(function(e){return t.postDownload(e)}));case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"onContentLoaded",value:function(e){var t=!0;return this.content?(console.warn("trying to assign content to a loaded tile",this,e),t=!1):(this.content=e,this.contentHolder.add(this.content),this.debug&&console.log("onload",JSON.stringify(this.info)),this.lifeState="loaded",this._onContentLoadCompleted(e)),t}},{key:"cameraChanged",value:function(){this.visibilityNeedsUpdate=!0,this.screenAreaNeedsUpdate=!0}},{key:"updateVisibility",value:function(){return this.visible}},{key:"displayByload",value:function(){this.debug&&console.log("displayByload",JSON.stringify(this.info));var e=!1;return this.loaded?(this.isRoot?this.loaded&&!this.isInScene&&(e=this._addToSceneAsync()&&e):e=this._replaceParentAttempt()&&e,e):(console.error("not loaded but display attempt"),e=!1)}},{key:"displayByPrune",value:function(){this.debug&&console.log("displayByPrune",JSON.stringify(this.info));var e=!1;return this.loaded?(this.isRoot?this.isInScene?e=!0:this.loaded?(this._addToSceneGraph(),e=!0):e=!1:!function(e){var t=e;for(;null!==t.parent;)t=t.parent;return t.loaded}(this)?e=!1:!function(e){var t=e.parent;for(;null!==t;){if(t.isInScene)return t;t=t.parent}return}(this)?this.isInScene?e=!0:(this.loaded?this._addToSceneGraph():console.error("node is not loaded but descendants in scene"),e=!0):e=!1,e):e=!1}},{key:"_replaceParentAttempt",value:function(){var e=!1;if("loaded"!==this.lifeState)return console.error("not loaded but display atttempt"),e=!1;if(this.isRoot)console.warn("unreachable");else if(this.siblingsLoaded&&this.parent.isInScene){var t=this.parent.nodes;this.parent._removeFromSceneGraph();for(var r=0;r<t.length;r++)t[r]._addToSceneAsync();e=!0}return e}},{key:"_addToSceneAsync",value:function(){return this._addToSceneGraph(),this._beReplacedAttempt(),!0}},{key:"_beReplacedAttempt",value:function(e){var t=!0;if(!this.loaded)return console.error("not loaded but display atttempt"),t=!1;if(!this.isInScene)return console.error("not in scene but be replaced atttempt"),t=!1;if(0===this.nodes.length)t=!1;else if(this.nodes.length>0){if(this.childrenLoaded){this._removeFromSceneGraph();for(var r=0;r<this.nodes.length;r++)this.nodes[r]._addToSceneAsync();t=!0}}else console.error("node with unexpected number of children",this),t=!1;return t}},{key:"_addToSceneGraph",value:function(){var e=this.debug,t=!0;return"loaded"!==this.lifeState?(console.warn(JSON.stringify(this.info)+", content undefined, cannot add to scene"),t=!1):this.isInScene?(console.warn("Twice adding to scene attempt",this.info),t=!1):(this.sceneGraphRoot.add(this.shapeHolder),this._displayBBox(),e&&console.log("add to scene",this.info),void 0===this.gpuUsage&&console.error("gpuUsage is missing")),t}},{key:"_removeFromSceneGraph",value:function(){var e=!0;return this.isInScene&&this.content?(this.sceneGraphRoot.remove(this.shapeHolder),this._destroyBBox(),this.debug&&console.log("remove from scene",this.info),e):(console.warn("_removeFromSceneGraph fail",this),e=!1)}},{key:"setVisibility",value:function(e){console.warn("deprecated")}},{key:"resourceKey",get:function(){console.error("resourceKey undefined")}},{key:"expandable",get:function(){return!this.is404}},{key:"estimationCoefficient",get:function(){return 4}},{key:"maxGpuUsage",get:function(){}},{key:"estimatedRootGpuUsage",get:function(){return 4194304}},{key:"estimatedGpuUsage",get:function(){return void 0!==this.gpuUsage?this.gpuUsage:this._computeEstimatedGpuUsage()}},{key:"gpuUsage",get:function(){return this._gpuUsage},set:function(e){e>10485760&&console.warn("Unusual large chuck of size",e,this.resourceKey),this._gpuUsage=e}},{key:"estimatedRamUsage",get:function(){return void 0!==this.ramUsage?this.ramUsage:this._computeEstimatedRamUsage()}},{key:"ramUsage",get:function(){return this._ramUsage},set:function(e){this._ramUsage=e}},{key:"boundingBox",get:function(){return this._boundingBox},set:function(e){!e.isBox3||isNaN(e.min.x)||isNaN(e.min.y)||isNaN(e.min.z)||isNaN(e.max.x)||isNaN(e.max.y)||isNaN(e.max.z)?console.warn("Invalid boundingBox"):(this._boundingBox=e,this.visibilityNeedsUpdate=!0,this.screenAreaNeedsUpdate=!0)}},{key:"estimatedBBox",get:function(){return this.boundingBox?this.boundingBox:this._computeEstimatedBBox()}},{key:"priorityRank",get:function(){return Math.max(1,this.sharedOptions.priorityRank)}},{key:"frustumInTree",get:function(){return this.sharedOptions.frustumInTree}},{key:"camInTree",get:function(){return this.sharedOptions.camInTree}},{key:"fov",get:function(){return this.sharedOptions.fov}},{key:"showBBox",get:function(){return this.sharedOptions.showBBox}},{key:"sceneGraphRoot",get:function(){return this.sharedOptions.sceneGraphRoot}},{key:"debug",get:function(){return this.sharedOptions.debug}},{key:"info",get:function(){return{name:this.name}}},{key:"isRoot",get:function(){return null===this.parent}},{key:"isPlaceHolder",get:function(){return this._isPlaceHolder},set:function(e){this._isPlaceHolder=e}},{key:"is404",get:function(){return this._is404},set:function(e){this._is404=e,e&&(this.traverse(function(t){t._is404=e,t.screenAreaNeedsUpdate=!0}),this.gpuUsage=10)}},{key:"visible",get:function(){return this.visibilityNeedsUpdate&&(this._visible=this._updateVisibility(),this.visibilityNeedsUpdate=!1),this._visible}},{key:"loaded",get:function(){return"loaded"===this.lifeState}},{key:"expired",get:function(){return"expired"===this.lifeState}},{key:"screenArea",get:function(){return this.screenAreaNeedsUpdate&&(this._screenArea=this._updateScreenArea(),this.screenAreaNeedsUpdate=!1),this._screenArea}},{key:"isInScene",get:function(){return!(null===this.shapeHolder.parent||void 0===this.shapeHolder.parent)}},{key:"siblingsLoaded",get:function(){for(var e=this.parent.nodes,t=!0,r=0;r<e.length&&(t="loaded"===e[r].lifeState&&t);r++);return t}},{key:"childrenLoaded",get:function(){var e=this.nodes;if(e.length>0){for(var t=!0,r=0;r<e.length&&(t="loaded"===e[r].lifeState&&t);r++);return t}return!1}}])&&yn(t.prototype,r),n&&yn(t,n),e}()).prototype,"setVisibility",[ye],Object.getOwnPropertyDescriptor(fn.prototype,"setVisibility"),fn.prototype),fn),gn=function(e,t){var r;switch(t){case"standard":r=bn(e);break;case"phong":r=_n(e);break;default:console.warn("Unknown type",t),r=_n(e)}return r},bn=function(e){var t=Object.assign({},{opacity:1,map:null},{opacity:e.opacity,color:e.color,map:e.map,emissive:e.emissive,metalness:e.metalness,roughness:e.roughness,emissiveIntensity:e.shininess});return t.opacity<1?t.transparent=!0:t.transparent=!1,ir(t)},_n=function(e){var t={opacity:1,emissive:new p.Color(1,1,1),color:new p.Color(1,1,1),map:null},r=Object.assign({},t,{opacity:e.opacity||e.d,emissive:e.emissive||n(e.Ka),emissiveMap:e.emissiveMap||n(e.map_Ka),color:e.color||n(e.Kd),map:e.map||e.map_Kd,specular:e.specular||n(e.Ks),specularMap:e.specularMap||e.map_Ks,shininess:e.shininess||e.Ns});function n(e){if(e&&e instanceof Array&&3===e.length)return new p.Color(e[0]/255,e[1]/255,e[2]/255)}return r.opacity<1?r.transparent=!0:r.transparent=!1,ir(r)},wn=function(e){return e instanceof Array?e.forEach(function(e){e.dispose()}):e.dispose(),!0},xn=function(e){return e instanceof Array?e.forEach(function(e){t(e)}):t(e),!0;function t(e){["map","emissiveMap","specularMap"].forEach(function(t){e[t]&&(e[t].dispose(),e[t]=null)})}};function An(e){var t=0;return e instanceof Array?e.forEach(function(e){t+=r(e)}):t+=r(e),t;function r(e){var t=0;return["map","emissiveMap","specularMap"].forEach(function(r){e[r]&&(t+=e[r].image.width*e[r].image.height*4)}),t}}function kn(e){return(kn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function On(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Sn(e,t){return!t||"object"!==kn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Pn(e,t,r){return(Pn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Tn(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function Tn(e){return(Tn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function En(e,t){return(En=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Mn=function(e){function t(e){var r=e.parent,n=e.name,i=e.sharedOptions;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Sn(this,Tn(t).call(this,{parent:r,name:n,sharedOptions:i}))}var r,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&En(e,t)}(t,mn),r=t,(n=[{key:"destruct",value:function(){return this._material&&(wn(this._material),this._material=void 0),Pn(Tn(t.prototype),"destruct",this).call(this)}}])&&On(r.prototype,n),i&&On(r,i),t}();function jn(e){return(jn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Cn(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Rn(e,t){return!t||"object"!==jn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function In(e,t,r){return(In="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Ln(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function Ln(e){return(Ln=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Bn(e,t){return(Bn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Un=function(e){function t(e){var r,n=e.parent,i=e.x,o=e.y,a=e.level,s=e.name,u=void 0===s?a+" "+i+" "+o:s,c=e.sharedOptions;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=Rn(this,Ln(t).call(this,{parent:n,name:u,sharedOptions:c})))._level=a,r._x=i,r._y=o,r}var r,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Bn(e,t)}(t,Mn),r=t,(n=[{key:"destruct",value:function(){return this._level=void 0,this._x=void 0,this._y=void 0,In(Ln(t.prototype),"destruct",this).call(this)}},{key:"level",get:function(){return this._level}},{key:"x",get:function(){return this._x}},{key:"y",get:function(){return this._y}},{key:"maxLevel",get:function(){return this.sharedOptions.maxLevel}},{key:"minLevel",get:function(){return this.sharedOptions.minLevel}},{key:"camera",get:function(){return this.sharedOptions.camera}},{key:"expandable",get:function(){return In(Ln(t.prototype),"expandable",this)&&this.level<=this.maxLevel}}])&&Cn(r.prototype,n),i&&Cn(r,i),t}();function Dn(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Nn=function(){function e(t){var r=t.key,n=t.value,i=t.weight,o=void 0===i?100:i,a=t.gpuUsage,s=void 0===a?4194304:a,u=t.ramUsage,c=void 0===u?4194304:u;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._key=r,this._value=n,this._weight=o,this._gpuUsage=s,this._ramUsage=c,(isNaN(s)||s<=0)&&console.warn("GpuUsage Error",this._key)}var t,r,n;return t=e,(r=[{key:"destruct",value:function(){return this._key=void 0,this._value=void 0,this._weight=0,!0}},{key:"weight",get:function(){return this._weight}},{key:"gpuUsage",get:function(){return this._gpuUsage}},{key:"ramUsage",get:function(){return this._ramUsage}},{key:"value",get:function(){return this._value}},{key:"valid",get:function(){return console.warn("CacheEntry::valid not implemented."),!0}}])&&Dn(t.prototype,r),n&&Dn(t,n),e}();function zn(e){return(zn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Fn(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Vn(e,t){return!t||"object"!==zn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Wn(e,t,r){return(Wn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Gn(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function Gn(e){return(Gn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Hn(e,t){return(Hn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Kn=function(e){function t(e){var r,n=e.key,i=e.value,o=e.weight,a=void 0===o?100:o,s=e.gpuUsage,u=e.ramUsage,c=e.is404,l=void 0!==c&&c;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=Vn(this,Gn(t).call(this,{key:n,value:i,weight:a,gpuUsage:s,ramUsage:u})))._is404=l,r}var r,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Hn(e,t)}(t,Nn),r=t,(n=[{key:"destruct",value:function(){return this._value=void 0,Wn(Gn(t.prototype),"destruct",this).call(this)}},{key:"valid",get:function(){return this._value||this.is404}},{key:"is404",get:function(){return this._is404}}])&&Fn(r.prototype,n),i&&Fn(r,i),t}();var qn=document.createElement("canvas"),Yn=qn.getContext("2d");function Xn(e){return qn.width=e.width,qn.height=e.height,Yn.drawImage(e,0,0),Yn.getImageData(0,0,e.width,e.height)}function Zn(e,t,r,n,i,o,a){try{var s=e[o](a),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,i)}function Qn(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){var o=e.apply(t,r);function a(e){Zn(o,n,i,a,s,"next",e)}function s(e){Zn(o,n,i,a,s,"throw",e)}a(void 0)})}}function Jn(e){var t=e.textureUrl,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12e4;if(window)var n=window.URL||window.webkitURL;return H(new Promise(function(e,r){var i=new p.TextureLoader;function o(e){"msSaveOrOpenBlob"in navigator||n&&n.revokeObjectURL&&n.revokeObjectURL(t)}i.setCrossOrigin("anonymous"),i.withCredentials=!0,i.load(t,function(r){o(t),e(r)},function(e){},function(e){o(t),r(new Error("404"))})}),r)}function $n(e){return ei.apply(this,arguments)}function ei(){return(ei=Qn(regeneratorRuntime.mark(function e(t){var r,n,i,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(o in r={},n=[],i=function(e){var i=ti(t[e]).then(function(t){return r[e]=t,Promise.resolve()}).catch(function(t){return console.warn(t),r[e]=null,Promise.resolve()});n.push(i)},t)i(o);return e.abrupt("return",Promise.all(n).then(function(){return Promise.resolve(r)}));case 5:case"end":return e.stop()}},e)}))).apply(this,arguments)}function ti(e){return ri.apply(this,arguments)}function ri(){return(ri=Qn(regeneratorRuntime.mark(function e(t){var r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return window&&(r=window.URL||window.webkitURL),n=new p.TextureLoader,e.abrupt("return",new Promise(function(e,i){n.load(t,function(n){r&&r.revokeObjectURL(t),n.wrapS=n.wrapT=p.RepeatWrapping,e(n)},void 0,function(e){i(e)})}));case 3:case"end":return e.stop()}},e)}))).apply(this,arguments)}function ni(e){return ii.apply(this,arguments)}function ii(){return(ii=Qn(regeneratorRuntime.mark(function e(t){var r,n,i=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=i.length>1&&void 0!==i[1]?i[1]:2e4,n=new Promise(function(e,r){var n=new Image;n.crossOrigin="Anonymous",n.onload=function(){e(Xn(n))},n.onerror=function(){r(new Error("404"))},n.src=t}),e.abrupt("return",H(n,r));case 3:case"end":return e.stop()}},e)}))).apply(this,arguments)}function oi(e,t){return ai.apply(this,arguments)}function ai(){return(ai=Qn(regeneratorRuntime.mark(function e(t,r){var n,i,o=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>2&&void 0!==o[2]?o[2]:2e4,i=t.download(r),e.abrupt("return",H(i,n));case 3:case"end":return e.stop()}},e)}))).apply(this,arguments)}function si(e){return(si="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ui(e,t,r){return(ui=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var i=new(Function.bind.apply(e,n));return r&&mi(i,r.prototype),i}).apply(null,arguments)}function ci(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function li(e,t,r,n,i,o,a){try{var s=e[o](a),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,i)}function fi(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){var o=e.apply(t,r);function a(e){li(o,n,i,a,s,"next",e)}function s(e){li(o,n,i,a,s,"throw",e)}a(void 0)})}}function hi(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function pi(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function di(e,t){return!t||"object"!==si(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function vi(e,t,r){return(vi="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=yi(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function yi(e){return(yi=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function mi(e,t){return(mi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function gi(e){return e.level+"-"+e.x+"-"+e.y}var bi,_i,wi,xi,Ai,ki=function(e){function t(e){var r,n,i=e.parent,o=e.name,a=e.x,s=e.y,u=e.level,c=e.sharedOptions;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=di(this,yi(t).call(this,{parent:i,name:o,x:a,y:s,level:u,sharedOptions:c})))._geometry=void 0,n._material=void 0,n.tneighbors=[],n.bneighbors=[],n.lneighbors=[],n.rneighbors=[],n._mapResources=(hi(r={},n.baseMapName,{level:-1,x:0,y:0}),hi(r,n.demName,{level:-1,x:0,y:0}),r),n._cache=new Kn({key:n.resourceKey,value:{maps:{},geometry:{}},gpuUsage:262144,weight:1}),n.style={map:void 0,color:16777215,level:u,x:a,y:s},n}var r,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&mi(e,t)}(t,Un),r=t,(n=[{key:"destruct",value:function(){this._clearNeighbors(),delete this.sharedOptions.nodeMap[this.nodeID];var e=vi(yi(t.prototype),"destruct",this).call(this);return this._geometry&&this._geometry.dispose(),this._material&&this._material.dispose(),this.__wireframe&&(this.__wireframe.geometry.dispose(),this.__wireframe.material.dispose()),this._cache&&(this._cache=void 0),this._mapResources={},e}},{key:"downloading",value:function(){var e=fi(regeneratorRuntime.mark(function e(){var t,r,n,i,o,a,s,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.baseMapName,r=this.baseMapURL,this.sendDownloadRequest(t,r),this.showDem)if(2,this.level>=2){for(n=2,i=this;n--;)i=i.parent;o=i.demName,a=i.demURL,i.sendDownloadRequest(o,a)}else s=this.demName,u=this.demURL,this.sendDownloadRequest(s,u);return e.abrupt("return",Promise.resolve());case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"sendDownloadRequest",value:function(e,t){var r=this;if(!this.sharedOptions.planet.showPlanetTexture)return Promise.resolve();if(this.expired)return Promise.resolve();if(!t||0===t.length)return Promise.resolve();if(this.hasMap(e))return Promise.resolve();var n=this.sharedOptions.mapSettings[e]?this.sharedOptions.mapSettings[e].maxLevel:1/0,i=e===this.demName;if(!(this.level<=n))return Promise.resolve();var o=t;this.sharedOptions.dock.queue({dockKey:o,asyncAction:function(){return r.expired?Promise.resolve():(i?oi(r.sharedOptions.picDecoder,t,2e4):Jn({textureUrl:t},2e4)).then(function(t){return r.expired?Promise.resolve():(n=r.sharedOptions.mapSettings[e]?r.sharedOptions.mapSettings[e].maxLevel:1/0,r.level<=n&&r.onTextureDownloaded(e,t),Promise.resolve())}).catch(function(e){return"404"===e.message||"408"===e.message||console.warn(e),Promise.resolve()})}}).then(function(e){return Promise.resolve()}).catch(function(e){return"[Dock] abortPending"===e.message||"408"===e.message||console.error(e),Promise.resolve()})}},{key:"onTextureDownloaded",value:function(e,t){if(!this.expired){if(this.hasMap(e))return;this.setMap(e,t);var r={level:this.level,x:this.x,y:this.y};this.traverse(function(t){var n=t._getMapResource(e);return n||console.warn(t),n.level<r.level&&t.redigest(t._cache),!0})}}},{key:"cook",value:function(){var e=fi(regeneratorRuntime.mark(function e(t){var r,n,i,o=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.showDem&&(i=this.demName,n=this._findAncestorMapResource(i),r=this._getMapByResource(i,n)),e.abrupt("return",this.sharedOptions.loadWorker.requestMesh(this.level,this.x,this.y,{demImageData:r,demResource:n}).then(function(e){return o._cache.value.geometry=e,o._cache.value.gpuUsage=1048576,Promise.resolve(o._cache)}));case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"defaultCooked",value:function(){var e=fi(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Kn({key:this.resourceKey,value:{isPlaceHolder:!1},weight:1,gpuUsage:10,is404:this.is404}),console.warn("shouldnt reach here"),e.abrupt("return",Promise.resolve(t));case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"digest",value:function(e){this._cache=e,this.gpuUsage=e.gpuUsage;var t=e.value.geometry,r=t.position,n=t.index,i=t.boundingBox;this.boundingBox=new p.Box3(ui(p.Vector3,ci(i.min)),ui(p.Vector3,ci(i.max))),this._geometry=new p.BufferGeometry,this.showDem?this._demUpdate(!0):this._geometry.addAttribute("position",new p.BufferAttribute(r,3)),this._geometry.setIndex(new p.BufferAttribute(n,1)),this._material=new Yr({}),this._baseMapUpdate(!0);var o=new p.Object3D,a=new p.Mesh(this.geometry,this.material);return this.__wireframe=new p.Mesh(this.geometry,new p.MeshBasicMaterial({color:8755,wireframe:!0})),this.__wireframe.visible=this.showPlanetWireframe,o.add(a),o.add(this.__wireframe),o.name=this.resourceKey,a.name=this.resourceKey,this.__wireframe.name=this.resourceKey,this.__mesh=a,a.frustumCulled=!1,this.__wireframe.frustumCulled=!1,this.__mesh.frustumCulled=!1,o}},{key:"_checkNaN",value:function(e,t){var r=!0,n=0;e.forEach(function(e,t){isNaN(e)&&(n++,r=!1)}),r||console.log("invalid",t,this,n)}},{key:"redigest",value:function(e){this.content&&(this._demUpdate(!1),this._baseMapUpdate(!1))}},{key:"updateVisibility",value:function(){this.content&&(this.visibilityNeedsUpdate=!!this.isInScene||this.visibilityNeedsUpdate,this.content.visible=vi(yi(t.prototype),"updateVisibility",this).call(this))}},{key:"updateMap",value:function(){var e=this.baseMapName,t=this.baseMapURL;this._createMapResource(e,{level:-1,x:0,y:0}),this.redigest(this._cache),this.hasMap(e)||this.sendDownloadRequest(e,t)}},{key:"hasMap",value:function(e){return this._cache&&this._cache.value&&this._cache.value.maps&&this._cache.value.maps[e]}},{key:"getMap",value:function(e){if(this._cache&&this._cache.value&&this._cache.value.maps)return this._cache.value.maps[e];console.warn("Cache not ready")}},{key:"setMap",value:function(e,t){this._cache&&this._cache.value&&this._cache.value.maps||console.warn("Cache not ready"),this._cache.value.maps[e]=t}},{key:"_computeEstimatedBBox",value:function(){if(this.level>1){var e=wr({level:this.level,x:this.x,y:this.y}),t=new p.Vector3(1/0,1/0,1/0),r=new p.Vector3(-1/0,-1/0,-1/0);return e.forEach(function(e){t.min(e),r.max(e)}),new p.Box3(t,r)}return 1===this.level?new p.Box3(new p.Vector3(-Y,-Y,-Y),new p.Vector3(Y,Y,Y)):0===this.level?new p.Box3(new p.Vector3(-Y,-Y,-Y),new p.Vector3(Y,Y,Y)):(console.error("unknow bbox"),new p.Box3(new p.Vector3(0,0,0),new p.Vector3(0,0,0)))}},{key:"_getMapResource",value:function(e){var t=this._mapResources[e];return{level:t.level,x:t.x,y:t.y}}},{key:"_setMapResource",value:function(e,t){this._mapResources[e].level=t.level,this._mapResources[e].x=t.x,this._mapResources[e].y=t.y}},{key:"_createMapResource",value:function(e,t){this._mapResources[e]=t}},{key:"_getMapByResource",value:function(e,r){return r.level<0?e===this.demName?t.DEFAULT_DEM_IMAGEDATA:this.sharedOptions.solidColorTexture:this.sharedOptions.nodeMap[gi(r)].getMap(e)}},{key:"_demUpdate",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.showDem)return!1;var r=this.demName,n=this._findAncestorMapResource(r),i=this._getMapResource(r);if(!t&&i.level>=n.level)return!1;var o=this,a=this._getMapByResource(r,n);return a?this.sharedOptions.loadWorker.requestMesh(this.level,this.x,this.y,{demImageData:a,demResource:n}).then(function(t){if(!e.expired&&e._getMapResource(r).level<n.level){e._cache.value.geometry.position=t.position,e._cache.value.geometry.boundingBox=t.boundingBox,e._setMapResource(r,n),s();var i=t.boundingBox;e.boundingBox=new p.Box3(ui(p.Vector3,ci(i.min)),ui(p.Vector3,ci(i.max)))}}):console.error("No image data"),t&&s(),!0;function s(){var e=o._cache.value.geometry.position;void 0===o._geometry.getAttribute("position")?o._geometry.addAttribute("position",new p.BufferAttribute(e,3)):(o._geometry.getAttribute("position").array.set(e),o._geometry.getAttribute("position").needsUpdate=!0)}}},{key:"_baseMapUpdate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.baseMapName,r=this._findAncestorMapResource(t),n=this._getMapResource(t);if(!e&&n.level>=r.level)return!1;this._setMapResource(t,r);var i=this._getMapByResource(t,r),o=function(e){var t=e.level,r=e.x,n=e.y,i=e.mapResource,o=e.segment,a=void 0===o?_r:o,s=e.showDem;i.level<0&&(i={level:0,x:0,y:0});for(var u,c,l=[],f=[],h=Math.pow(2,t),p=Math.pow(2,i.level),d=0;d<=a;d++)u=xr(h,r,n,1-d/a,d/a),c=Ar(p,i.x,i.y,u.u,u.v),l.push(c.u),f.push(c.v);var v=0,y=(a+1)*(a+1)*2;s&&(y+=4*(a+1)*2);for(var m=new Float32Array(y),g=0;g<=a;g++)for(var b=0;b<=a;b++)m[v=2*((a+1)*g+b)]=l[b],m[v+1]=f[g];if(s){var _=v+2,w=0,x=0;for(x=0;x<=a;x++)m[_++]=l[x],m[_++]=f[w];for(w=a+1,x=0;x<=a;x++)m[_++]=l[x],m[_++]=f[w];for(x=0,w=0;w<=a;w++)m[_++]=l[x],m[_++]=f[w];for(x=a+1,w=0;w<=a;w++)m[_++]=l[x],m[_++]=f[w]}return m}({level:this.level,x:this.x,y:this.y,mapResource:r,showDem:this.showDem});this._material.map=i,this._material.needsUpdate=!0,e?this._geometry.addAttribute("uv",new p.BufferAttribute(o,2)):(this._geometry.attributes.uv.array.set(o),this._geometry.attributes.uv.needsUpdate=!0)}},{key:"_clearNeighbors",value:function(){this.tneighbors.length=0,this.bneighbors.length=0,this.lneighbors.length=0,this.rneighbors.length=0}},{key:"_findTopologyNeighbor",value:function(){this._clearNeighbors();var e,t=this.level,r=this.x,n=this.y,i=Math.pow(2,t);0!==n&&(this._nodeExist(t,r,n-1)?this._findNeighborInChildren(this.sharedOptions.nodeMap[gi({level:t,x:r,y:n-1})]):this._findNeighborInParent({level:t,x:r,y:n-1})),this.y!==i-1&&(this._nodeExist(t,r,n+1)?this._findNeighborInChildren(this.sharedOptions.nodeMap[gi({level:t,x:r,y:n+1})]):this._findNeighborInParent({level:t,x:r,y:n+1})),e={level:t,x:r-1>=0?r-1:r-1+i,y:n},this._nodeExist(e.level,e.x,e.y)?this._findNeighborInChildren(this.sharedOptions.nodeMap[gi(e)]):this._findNeighborInParent(e);var o=r+1<i?r+1:r+1-i;e.x!==o&&(e={level:t,x:o,y:n},this._nodeExist(e.level,e.x,e.y)?this._findNeighborInChildren(this.sharedOptions.nodeMap[gi(e)]):this._findNeighborInParent(e))}},{key:"_findNeighborInChildren",value:function(e){var t=this._isNeighbor(e);if(0===e.nodes.length)t.top&&this.tneighbors.push(e),t.bottom&&this.bneighbors.push(e),t.left&&this.lneighbors.push(e),t.right&&this.rneighbors.push(e);else if(t.isNeighbor)for(var r=0;r<e.nodes.length;++r)this._findNeighborInChildren(e.nodes[r])}},{key:"_findNeighborInParent",value:function(e){for(var t=e.level,r=e.x,n=e.y,i=this._getParent(t,r,n);null!==i;){if(this._nodeExist(i.level,i.x,i.y)){var o=this.sharedOptions.nodeMap[gi(i)],a=this._isNeighbor(i);if(a.top&&this.tneighbors.push(o),a.bottom&&this.bneighbors.push(o),a.left&&this.lneighbors.push(o),a.right&&this.rneighbors.push(o),a.isNeighbor)break}i=this._getParent(i.level,i.x,i.y)}}},{key:"_nodeExist",value:function(e,t,r){return!!this.sharedOptions.nodeMap[gi({level:e,x:t,y:r})]}},{key:"_getParent",value:function(e,t,r){return 0===e?null:{level:e-1,x:Math.floor(t/2),y:Math.floor(r/2)}}},{key:"_isNeighbor",value:function(e){var t={isNeighbor:!1},r=gi(e.level,e.x,e.y);if(this.nodeID===r)return t;var n=Math.pow(2,this.level),i=this.x/n,o=(this.x+1)/n,a=this.y/n,s=(this.y+1)/n,u=Math.pow(2,e.level),c=e.x/u,l=(e.x+1)/u,f=e.y/u,h=(e.y+1)/u;return h===a&&p(i,o,c,l)&&(t.top=!0,t.isNeighbor=!0),f===s&&p(i,o,c,l)&&(t.bottom=!0,t.isNeighbor=!0),l!==i&&l-1!==i||!p(a,s,f,h)||(t.left=!0,t.isNeighbor=!0),c!==o&&o-1!==c||!p(a,s,f,h)||(t.right=!0,t.isNeighbor=!0),t;function p(e,t,r,n){return!(t<=r||n<=e)}}},{key:"_findAncestorMapResource",value:function(e){return this.isRoot?this.hasMap(e)?{level:0,x:0,y:0}:{level:-1,x:0,y:0}:this.hasMap(e)?{level:this.level,x:this.x,y:this.y}:this.parent._findAncestorMapResource(e)}},{key:"resourceKey",get:function(){return"PlanetTile-"+this.nodeID}},{key:"baseMapName",get:function(){return this.sharedOptions.planet.wmtsTileURL.mapName}},{key:"baseMapURL",get:function(){return this.sharedOptions.planet.wmtsTileURL.url(this.level,this.x,this.y)}},{key:"demName",get:function(){return"RESERVER-ALTIZURE-DEM"}},{key:"demURL",get:function(){var e=this.level,t=this.x,r=this.y;return e<=8?"China"===N.countryName?"https://cdn-china.altizure.cn/public/bluemarble/dem20190819/".concat(e,"/").concat(t,"/").concat(r,".png"):"https://cloudfront.altizure.com/bluemarble/dem20190819/".concat(e,"/").concat(t,"/").concat(r,".png"):void 0}},{key:"nodeID",get:function(){return gi(this)}},{key:"planet",get:function(){return this.sharedOptions.planet}},{key:"estimationCoefficient",get:function(){return 1.2}},{key:"estimatedRootGpuUsage",get:function(){return 262144}},{key:"priorityRank",get:function(){return this.sharedOptions.priorityRank*Math.log(this.level+2)/2.302585092994046}},{key:"geometry",get:function(){return this._geometry}},{key:"material",get:function(){return this._material}},{key:"showDem",get:function(){return this.sharedOptions.planet.showDem}},{key:"showPlanetWireframe",get:function(){return this.sharedOptions.planet.showPlanetWireframe}}])&&pi(r.prototype,n),i&&pi(r,i),t}();ki.DEFAULT_DEM_IMAGEDATA=(bi=0,_i=1,wi=137,xi=256,Ai=256,qn.width=xi,qn.height=Ai,Yn.fillStyle="rgb(\n    ".concat(bi,",\n    ").concat(_i,",\n    ").concat(wi,")"),Yn.fillRect(0,0,xi,Ai),Yn.getImageData(0,0,xi,Ai));var Oi=ki,Si=null;function Pi(){var e;return Si||(e=new p.TextureLoader,Si=new Promise(function(t,r){e.load("../public/img/UV_Grid_Sm.jpg",function(e){e.wrapS=e.wrapT=p.RepeatWrapping,t(e)},void 0,function(e){r(e)})})),Si}function Ti(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:40,n=new Uint8Array(3);n[0]=e,n[1]=t,n[2]=r;var i=new p.DataTexture(n,1,1,p.RGBFormat);return i.needsUpdate=!0,i}function Ei(e){return(Ei="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Mi(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ji(e,t){return!t||"object"!==Ei(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ci(e,t,r,n){return(Ci="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(e,t,r,n){var i,o=Ii(e,t);if(o){if((i=Object.getOwnPropertyDescriptor(o,t)).set)return i.set.call(n,r),!0;if(!i.writable)return!1}if(i=Object.getOwnPropertyDescriptor(n,t)){if(!i.writable)return!1;i.value=r,Object.defineProperty(n,t,i)}else!function(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(n,t,r);return!0})(e,t,r,n)}function Ri(e,t,r){return(Ri="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=Ii(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function Ii(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Li(e)););return e}function Li(e){return(Li=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Bi(e,t){return(Bi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ui=function(e){function t(e){var r,n=e.earthEntity,i=e.scale;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=ji(this,Li(t).call(this,n));var o=function(e,t,r){for(var n=0,i=0,o=0,a=se(0,0,0),s=a.minX,u=a.minY,c=a.maxX,l=a.maxY,f=new Float32Array((r+3)*(r+1)*3),h=new Uint32Array((r+2)*r*6),d=new Float32Array((r+3)*(r+1)*2),v=(c-s)/r,y=(l-u)/r,m=Math.pow(2,0),g=Math.pow(2,n),b=1*g/m-i,_=0*g/m-o,w=1/r*g/m,x=[],A=[],k=[],O=[],S=0;S<=r;S++)x.push(c-S*v),A.push(u+S*y),k.push(b-S*w),O.push(_+S*w);var P=0,T=0,E=null,M=(e-1)*t;E=ve.wgs842Ecef(-90,0,M);for(var j=0;j<=r;j++)f[P]=E.x,f[P+1]=E.y,f[P+2]=E.z,P+=3,d[T]=b,d[T+1]=_,T+=2;for(var C=0;C<=r;C++)for(var R=0;R<=r;R++)E=ve.webMercator2Ecef(x[R],A[C],M),f[P]=E.x,f[P+1]=E.y,f[P+2]=E.z,P+=3,d[T]=k[R],d[T+1]=O[C],T+=2;E=ve.wgs842Ecef(90,0,M);for(var I=0;I<=r;I++)f[P]=E.x,f[P+1]=E.y,f[P+2]=E.z,P+=3,d[T]=b-r*w,d[T+1]=_+r*w,T+=2;for(var L=0,B=0;B<r+2;B++)for(var U=0;U<r;U++){var D=(r+1)*B+U,N=(r+1)*(B+1)+U,z=N+1,F=D+1;h[L++]=D,h[L++]=N,h[L++]=z,h[L++]=z,h[L++]=F,h[L++]=D}var V=new p.BufferGeometry;return V.addAttribute("position",new p.Float32BufferAttribute(f,3)),V.addAttribute("uv",new p.Float32BufferAttribute(d,2)),V.setIndex(new p.BufferAttribute(h,1)),V}($,i,128);return r.material=new qr,r.mesh=new p.Mesh(o,r.material),r.mesh.name="Atmosphere mesh",r.sceneNode.name="Atmosphere Class",r.sceneNode.add(r.mesh),r.height=0,r._speedPara=5,r}var r,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Bi(e,t)}(t,W),r=t,(n=[{key:"animate",value:function(e){if(this._lastTime&&this._speedPara>0){var r=(e.currentTime-this._lastTime)/1e3;this.material.uniforms.time.value+=r*this._speedPara}this._lastTime=e.currentTime,Ri(Li(t.prototype),"animate",this).call(this,e)}},{key:"destruct",value:function(){return this.sceneNode.remove(this.mesh),this.mesh.geometry.dispose(),this.mesh.material.map&&this.mesh.material.map.dispose(),this.mesh.material.dispose(),this.mesh=null,Ri(Li(t.prototype),"destruct",this).call(this)}},{key:"visible",get:function(){return Ri(Li(t.prototype),"visible",this)},set:function(e){this.sceneNode.visible=e,function(e,t,r,n,i){if(!Ci(e,t,r,n||e)&&i)throw new Error("failed to set property")}(Li(t.prototype),"visible",e,this,!0)}}])&&Mi(r.prototype,n),i&&Mi(r,i),t}();function Di(e){return(Di="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ni(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function zi(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Fi(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Vi(e,t,r,n){return(Vi="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(e,t,r,n){var i,o=Hi(e,t);if(o){if((i=Object.getOwnPropertyDescriptor(o,t)).set)return i.set.call(n,r),!0;if(!i.writable)return!1}if(i=Object.getOwnPropertyDescriptor(n,t)){if(!i.writable)return!1;i.value=r,Object.defineProperty(n,t,i)}else Wi(n,t,r);return!0})(e,t,r,n)}function Wi(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Gi(e,t,r){return(Gi="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=Hi(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function Hi(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Ki(e)););return e}function Ki(e){return(Ki=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function qi(e,t){return(qi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Yi=function(e){function t(e,r){var n,i=r.name,o=void 0===i?"PlanetEntity":i,a=r.forest,s=r.planet,u=Ni(r,["name","forest","planet"]);return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=function(e,t){return!t||"object"!==Di(t)&&"function"!=typeof t?Fi(e):t}(this,Ki(t).call(this,e,{name:o}))).sceneNode.name=o+" sceneNode",n.earthTreeOptions=u,n.planet=s,n._maxAnisotropy=u.maxAnisotropy,n.visible=n.planet.visible,n._useTexture=n.planet.showPlanetTexture,n.northCap=null,n.southCap=null,n.atmosphere=null,n._treeNode=new p.Object3D,n._treeNode.name="_treeNode",n.sceneNode.add(n._treeNode),n._tree=null,n._forest=a,n.planet.entity=Fi(n),n}var r,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&qi(e,t)}(t,Nt),r=t,(n=[{key:"destruct",value:function(){var e=!0;return this._tree&&(this._forest&&this._forest.remove(this._tree),e=this._tree.destruct()&&e,this._tree=null),this.atmosphere.destruct(),this.sceneNode.remove(this._treeNode),this.sceneNode.remove(this.northCap),this.sceneNode.remove(this.southCap),e=Gi(Ki(t.prototype),"destruct",this).call(this)&&e,this.earthTreeOptions=void 0,this.renderItems=void 0,this.atmosphere=void 0,this._treeNode=void 0,this._forest=void 0,y.disposeMesh(this.northCap),y.disposeMesh(this.southCap),this.northCap=void 0,this.southCap=void 0,this._solidColorTexture.dispose(),this._solidColorTexture=void 0,e}},{key:"import",value:function(){var e=this,t=this;return t._solidColorTexture=Ti(),t._tree=new pn(Oi,function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){Wi(e,t,r[t])})}return e}({sceneGraphRoot:t._treeNode,name:"Earth Tree",solidColorTexture:t._solidColorTexture,showBBox:!1,planet:this.planet},this.earthTreeOptions)),t._tree.visible=this.visible,this._forest&&this._forest.add(t._tree),t._tree.initialized.then(function(){return e.initUI()}).then(function(){return t.initOptionalItems()}).then(function(){return Promise.resolve(t)})}},{key:"initUI",value:function(){var e=this,t={polar:"south",imageUrl:"south"};return r({polar:"north",imageUrl:"north"}).then(function(n){return n.name="northCap",e.northCap=n,e.sceneNode.add(n),r(t)}).then(function(t){return t.name="southCap",e.southCap=t,e.sceneNode.add(t),Promise.resolve()}).then(function(){return e.atmosphere=new Ui({earthEntity:e,scale:Y}),Promise.resolve()}).catch(function(e){return console.warn("PlanetEntity initUI error:",e),Promise.resolve()});function r(t){for(var r,n=t.polar,i=t.imageUrl,o="north"===n,a=Math.pow(2,6),s=Q/2,u=-s,c=s,l=o?s:-s,f=ve.wgs842Ecef(o?90:-90,0,0),h=(c-u)/a,d=new Float32Array(9*a),v=new Float32Array(6*a),y=0;y<a;y++){d[9*y]=f.x,d[9*y+1]=f.y,d[9*y+2]=f.z,v[6*y]=.5,v[6*y+1]=.5;var m=o?y:(y+1)%a,g=ve.webMercator2Ecef(u+h*m,l,0);d[9*y+3]=g.x,d[9*y+4]=g.y,d[9*y+5]=g.z,v[6*y+2]=.5+.5*Math.cos(2*Math.PI*m/a),v[6*y+3]=.5+.5*Math.sin(2*Math.PI*m/a);var b=o?(y+1)%a:y,_=ve.webMercator2Ecef(u+h*b,l,0);d[9*y+6]=_.x,d[9*y+7]=_.y,d[9*y+8]=_.z,v[6*y+4]=.5+.5*Math.cos(2*Math.PI*b/a),v[6*y+5]=.5+.5*Math.sin(2*Math.PI*b/a)}var w=new p.BufferGeometry;return w.addAttribute("position",new p.BufferAttribute(d,3)),w.addAttribute("uv",new p.BufferAttribute(v,2)),function(t){return(n=t,new Promise(function(e,t){var r=null;r="north"===n?"data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAAAeAAD/7gAOQWRvYmUAZMAAAAAB/9sAhAAQCwsLDAsQDAwQFw8NDxcbFBAQFBsfFxcXFxcfHhcaGhoaFx4eIyUnJSMeLy8zMy8vQEBAQEBAQEBAQEBAQEBAAREPDxETERUSEhUUERQRFBoUFhYUGiYaGhwaGiYwIx4eHh4jMCsuJycnLis1NTAwNTVAQD9AQEBAQEBAQEBAQED/wAARCAIAAgADASIAAhEBAxEB/8QAdAABAQEBAQEBAQAAAAAAAAAAAAECAwQFBgcBAQEBAQEAAAAAAAAAAAAAAAABAgMEEAEBAAICAgIBBAIBBQAAAAAAARECITESA0FRBGEiMhNxBYGhwUIjBhEBAQEBAQEAAwEAAAAAAAAAAAERAjEhQVESA//aAAwDAQACEQMRAD8A9/qnu/3X5l9nsn/o1vT6s/1l9ms00/8AVrOH0Px/xPR+J6/HSTWTuxz/ADvZ7tfT5fjzynzW71vyMY+R/s/wfV+N6pdtvLHNr8d+f7dfZ7rdOZnh9H/cfkfk+d139lsver4vEvHz8PT/AJc5Ncu6VFtR0rmAAKIoqCiEY22Xa4c9qlrUhawtrNrNq4uTLHkTNqauLtblvSJ4t6xYlSy1rWYa4Z8pGkaSs3dm7ouOiVjzx2XfJo1lLamTIJSzgysuUWOWcVo9mmOYkvAqmeEvSS/CC5WVkzc4po1bglQnBpjS8JnKWqjfayOetrXlVGjhMog0YjOTyUarO2uWvKJ5QHK6UuuI3vtnpzxte2asSZMNYwzcopFTKXZBfJMoCmUBAAFAAAyA/p3t/wBlr6tNtvZ7L44fI0/+k/I9Ot00/fptb39Mfma6fmba6+y3TWfykfL/ANl6/wAb0ezx/F2u2uPn7TjiWsddWOf5v5m35Xs223mLl5VvPfaV6Mk+Rz9QFQRUFALwxtsDeYl2crul3S1cdNtpXPas3ZPJnWpC1nbbhLvm4LEqr6+XSas6Y1jXlSFa4iX2MeSzmLrOL/ZmJdk4hf0NXDJlBNVbys6YWUMaMpbwmVRrFJNsktTyuUVrabWdMSWOnlcM3blRi7cou11+lm2tnSaGUal1+kuPgVAWIJLlUFRqKzF+AxchOhUAyAnJhVyDOBbWbUIM1crwNOdjOHbETxiYa48q6eES6pYSsCiKiZXB4gmV7MLgES1rB4mD+l/7P8D8T0aX2+raZk/fMvxf5e+v9tmvOuX6P/6Db8bG+3p3vlt/KZfl7z21/jPm1n/T3EKcDq5iKgB0W4Y22TVNtnLbZbsxWbVkMmUTKNLWdtsRXOy2/olWGvNzXXOXONZBVymQFMoKmNcMcyqIpkAA5goCcAIuT5ZymTVx1ljG/aZwZyamLMWYrOLKLnM5FItAAAAAFQFFlW3hnmKaixcsy4b/AG1UTWpvw1Jou2utgrnOYl5a8eMRma7SpQxhLlrpLQSWnkcmKil2ymaYwZBi0/w34ZT+vCKzyuFxhYmFqLwuEw0i8JgBX6f/AH23489909FtxeXyP8tezffbe7bXOay3zMjj1dqANAzdsLa5bVLSF2ZtZtTLNrcis0yIqBQVEw0iCKACoAohkFAAABFAAADDPy0lBFAEMKoIqUBRAFAABAaQAGs8MZXKosbvTnlZuGJnnCbSzkvay/FRUlysSzHSwGuGbRAMhUgGblfJCQFsyi8gLCgIyRan+BX0M55EV1chFPgHPauVrpu5VmtREq1mstAiggCKAAYRUoAAAAC5QBRAFEyuQAACwARKoCKAAAAACoAogChkBEaQEKAKimAJlUAUCA3NZWbrhZcLa0yx+hJ9tSfKIpQAQ5akhQYo34xLJgHsBMujkpkTKVWN3Ouu3TlYjUYqYasTCVqJgvCliCIshQZFEVAAAAAAAQFAAAAiouQAAQVAAAAABFAAAAAAAAAAAioZBcJzFlbmssUc/JYzZ47YamE/Iq5Qio3MJdYnRlUTDWElXIpZhC2oC5S0Khj11nJaxltjHXLJnhm3kGqxtFtwzaixmmFEVmhQVApOQZqRqxEVDCiCAAAAgKAAAAABAVFSgAAAAIoCKAAAAAAgCgAAAIUAy3rthghBv2TNzGTKiEqoqgAAHABmRLtFmmbyv9UBz8k8nT+s/r4Sxdd9mZ26WOe3FdGG/hk03nybdiGWaqIomVTCKzaTJvMJrRWuMJr2RM/uBdkXZEEBM8igCAAAAAAAAAAAAAAAAAAAACooCAoIAAAAACI0gI18IsBFgfALBFAVAGliLVSrlfJgyqNXZm7VKiar1fDF7dJOHPZusRnBm5BloBMgUyhdaDWJtHL+OzprrszvptnIoxe8tW2RnOUGs5MJOFzgVKzW5zGbASVWY0gAgKAAAAAAAAAAAAAABgAUAAAABBUAAAABBUBRFBKp2AAAsAAVAFAlVFMCXgHq1vDNia7cNZjUYY2mGMum3LlZilWGUq4T5wy0SltSd4KDWtq7ViXDVssBnySb4vSS4q7TPMRV8v0XMsYiwgvwzhekyoYFEEwjSABFoIAAAAAAACEpYQFEUBUWAAoIKAgqACmARGqgCKgAAAAAAAAKAAAAYVYqJMrgURvXaeOIzrvi8vH6/dvO29fZdrb8M89zxq8PX5ZmSYrlrtw3rcN6zhvMdMZw7cbOW+uNgLPmI18M91FMI0nYM4JmNCKmCLgUEwoDOFBALABIUAAABMmQUAAVAEKoJSFTMBpWZeWoCqkaVKhWsJtqqazgs4ahUVhZ2l7UF26c46YyxeKBFSdqioKAgAGBUAABRFAVAFWVBUaLElUR48Lpbrf0FjlJ9dbXTWuvw5azMdJ1h0jnV0ty6byXX9XKN+WWolMXDMmK6w29fGTDXK3nCY5Z1/lXSxFSzhlus4AnIsLAQVLwAioAAiiKgAAJUnbSAozaeciDaMzY8jRqoZZ5UW0EQJw1KzkyaOmvLWcMa7yQ1zeaspjtpc1u4ctbhZs2zY3dY57S5xHTOYSZEc7ricsx03c2WoSm3IUGVKiKZVAAAAIoIoAAACgIqKINZ4ZawqV5L2ShHN1am1jpNrXKNRZWa7SrHOVuNxl116y66/ujnpZjCzMvDUZrHs9eLmMS84ei2Vx8MVLFlS8pVsxM/LPcRVUiAFBRErVSxBlcAioAAACC1kF8PJm+nZc2Nz2/Zg43TeJmzt2tlTGtTBiXhPKytTxhvIikvCWpKZRQTICzt0m3w5NSrKldosrnNmtdsVuVmx3nSxjTaVvqtMue/NwxZi4dd5nlz74RYIuMCKliLemcZFVBUEUAMAAAAUgsABcKiBeCAqyAo8axIri6KsqEWI6RuVzlXW8txmvRHSVz0sreZG5WLFsNbzippbstxKqOe85s+GJOcOvs6y56xmtRUawzRQFBKi1EGakjVjORVEECgAM2NICVmt2J4wGZtg7axqlnPDK4zjC2pazyCoZPlFBQEyZQTVbla8nKVY1qWPR6rh18+cV5ZvXWbZn6tysWO21Tw+Wc5dJyqOVvODHDW2uOWJeQhLxymGrEiKmBqxkABFAAAAFQBqCCotmScGQFyIWXCo8oK5OiLKAK1GYqwb12sddbby4x10vw3GLHSbWThJk1rfDTLGUkxTeY6JftBSwKKyq4KGspVwzv/GpVLtMds5n2wlZ/prHTM+y2fbl8lllxZip/RjpmfZmfbmH9GOoa/wAYrSIljWYzaDNiZ4aZqVdSzK44I1rhBzuJUv263TW8udlSqhVSioIIqrGVgjTetwxHTXFnLXLNdZ0TaxNeBtl11s2mHPx8dmvXcL/K5VGNyRvbTMZxhDU2Id8GMQVNiRPlqAxcykq7THKf4RVAAAAXKAKIqouVt4ZX4B5p0JRzbUAFWIQG466Ocb1uG4zXSrqx5NRplq4Z2n0lpNgJVNpxmJKDQCjOzHs/jW9o57z9tZvixyKO3r9c1n9vs6nUYk2tW4vp9WP3bd/Ea93q85mfyn/Vn1b32ezba/E4/R133xMTt25nN5z8MW3XiG/brz5T/lzlcOplx0l121/jCpreIZmW5WUpLL0b3j/LP8dp+pauNW4OE2vCbZ4ZtMazJ/yzbipdrMJtmmi+dXyzHPnOF+cJqqlLcM28pVgGftOUVoIKLlZsxmrklSx1m9dNOs1582ct/wBl8eGpWbHby54b0v24S7SZxw3N9rMycNzpmx38oWOWu2Zl01uWvWbGPCzbPwzds3D04ljzba3XfPwlmLKti/BmUvSKl5jGGkKEEEVRMqAAAqAKuUWRUeadDOVly5NmVLBQWIqjereXOVqVYzY3K35Ofwnk1qY3nK4wzq1dl1Mb1qbTF4Z8k22toOkS3DOaUFyz7P40lN8eFS+VYx6NdNvZJv1/3dvyddbed8Y61eadt32TbXx9nM+NvmJLMvP7Wy7rXpxNd8XK/B69PH17Z5zeKm20177+nSfOZvxn2s7Z+Hn2znjp0vstvPX0s8bHLvr+vG5MYm1kWbR18dfGYYvriSGs25vHwlt+a1rpYbafKYFsuuTfqMycYW88Cpt8FuP8mCyXkCcf5T/yMfqWZQTbuJ8teKfJViX4OfsphFJ0Xo+Fx8AJ9GF46EX4Jcak1/VcfCjeeHTS/tjlJmYb14mG4xW9P4x20mY4azjDrpthuM10025xT2aSnfJm/LTLhizYt5dNpO3LbthuBYTtb0DAiooACiAKIAq5ZUHlWXlJFjk23cWMg0iqgCxplYo3nhJ2mSLqY3lPJm1ZBGo3GZhctI0m/SZbkzMKMa1Nv40s8dl7/wAIOOeVrW2uv0vjrfhn+a1rGu+2ut1l4qOnhr9F01+jL+zY41OY63XX6Zus+kvNNXXbiHl9J4fRZYahnbK23CWs+RVAEUAARQERURRFQVRBAAEbi5YlF1G5WvJzlajUpXbXrLpry5yyR0045bjFdJwvDN+1y0yzteHLZvfKeOIlWMxYnyRFTbio1eWalBMiCtJlMmQaTJlYCGVrIOKyFgw2KiiACCiLFFEWKLFygMtZWVlY1BpvXPwxK3rtfhUTfW5zhM4jpdrhjyn0oxnJOF8tZelzr9JqmScr+2pIDNjLV7MIM22JnLVjFiLqVlpm8VBQ7EUAABAEBFARFUQAAAVFEI1KyLCuk2zXfW8PNHfS8OnNYsdtdskc5XTXpphZym/DUY9ijmLtPoZaSot6QolZaqIrItZQXLUrIK1blkAc85Exiqw0ogqKIAqoAqoKNCKIqxlYo1GpWFVHTMsc84p5YQqY1tMzM7SVJcLxRVi9JBQyGImEBmrWUVErScIM4WWLcJ4WglqJyqKFEFAEEARQABUUAAAARY667cOLUrUSu025ddN83DzeTfruOW5WbHqTeZjHnjDVvDbGOf6GG/GXlmosZQoipQTKKliYayAzzBqoioCVBnsIiKAgqiKAqKIqoKKACiAjULUyAs5axwzK1NlRE5KmbgG5cwykoouUtEAqKiKJhTKC+ML+jOUtFSpktTLKhlLUNFyIqKAAAAogCoAKAoEAiK1NqwuVlSx3024xW5eMOGrtLw6SsWOkvGEsyTpVRnxiYawzUol1Twa8vtLsipZGatrPIqUXCIqCpUGMjNWcstAAACixQEFRQFQUURQFQBQBABUWKyGi5MplMmq0lpazlNFyiZMpq4VKAM2o1ZlPGplWEXeTxRLmxNCKkmFFEAFEUAABUAVAAVBRSAI3LhrXbNc41rxWpUsenWtTFjlreGtb8OkrnXT4S65anSxUcLozY6783DF4uEsWM4xEasZsZaES1MooM3a5XKK52GWjDNVmVTgAABVRVQVFAAAABckQBQMguTLIqLlMgABUVMplMplNXGsiZAxQyfKjWszWt7rJidpt7NdZw5zO1zS2eJiTtdtcUkxVvKKztwkWzIgI3NcxnaeNCVFRYKAAAAAAoAAAg1GVWDtrtw1rtiuOta8m5WbHp02lb6rz+q4dfPnFblYsXeZ5c++HTap4fIMWMWN284TCKx4H9eWs4Wbcorlv6/pJHbGcudzLylmErkAy2mBcogAKKsSKIAAoAAAAAAAAACKAnJzU2uF165BJCxflKCFakS9pisi4RAxlf0QBWp0wsqwFnaazlfkHTWRj24wZZ25W+JJ9YlaJCstaCKAAAqAKgAKigAKhKsRYo3N66zbM/Vwb1uGuaxY75y6TlynRNrG9Zsa21xyxK662bTDn442sKRmxnWO10vjlzneEs+q1rGPbrZy663C7SbzBZsNyvEgOToHRQBUFGhIogAAqKAAAAAAAAAACYUAQKALNcrrM1rfaaa4X56lrne8JhNL8tfKetMWcrh0xKm8xDDWMJDa/RGRV7IKFmEXe5kwa/qCLg274IqJYy3WbEqgRUVBQEABRBQAAWAI1HTXFnLllZssqWPRrwOU3rpp1mtys46eu4Xu5c/LnhvW4uL20zY1nDPjLctWJnFKOdt13xW5cHt08pmdxz02zxe08X2PMA5OgAAfKwqiNIogAAACiAKIAoAAAIoAAAgKBLhjaXa8tmC/oSTCgDWuJMue212uPhrnCa6lGcF1w6zWN7aTxP5TXngnMpWWm5jHKXnplvSLPoWYF2ZVAX5S9gx8q1iJhFEUFQBABQEVAUBQIAlajc3uMObcaiV0047Xa5uYxK3ry1GW5tcL6+e3K3Fw6aXFX8s118cPNvPHd6+LHD3ac5i9ROa8YDi7ARQAVUQUQAAAAAFAABUAVAAVFAAAwAAZAAAAakjPs2k4ihmxf7LjDM6VNokxWPG5bkXxnZhrm1rvhbI5/LPi+tZtrVjM4XyWIp2hFFswl6bxnVgVAEVAEBUUBFQBUUADKorUZjUWI1GtbisStRqVLF3/dizt211l0/VxddNmozV13uvFdP5RjbWbTM7X15xitRmvAGV7cXYVFEAEAAAAAAABQAAAAAAABRFAAAAAAAyzjnLQUIBFBQgM7T4ZuuHRLMpmmuYt1wjPiz63rym3Ca3DW1lWBrU2IZVEARUARQAAAAABUBGosrDUWI1GsskaG5WpWI3OViN6bcu0mJl59eK9Ov8W+WK+bhcKOToiggAAAAAKIKAAAAAAAAAAAKgCgAAAAAAAAAKiwAAEvTle3W8sWYSkZWAkaqiC6ioCAAKAAAAAAAALKgI1lcsi6Y3l09blHTXaSNys10xy7ziOHrvy667NxivEA5OgAAAAAAAAAAAAAAAAAAAAKAAAAAAAAAAAAAAgCWKgMXhYtjPTLSgAAAAAAAAAAAAAAoIoAZayysqxHbSukuK46V0y6SsWOADDQAAAAAAAAAAAAAAKgAAAAAAKIoAAAAAAAACAACAqAAze2jCKyG0EUBMgpLk7QFEUAAAAAAFAAEUABUa1uHSXLjK15NSpYouCwGRUQAAAAAAAABQEUAEVAAAAAAAFQBQAAAAAEVABUAQQVcmQAAELGHSs4SxWb0jdjOExdGvHjLMjXlxgRiVUnbRFDKAKIoAAKIAEFABFFEUR//9k=":"data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAAAeAAD/7gAOQWRvYmUAZMAAAAAB/9sAhAAQCwsLDAsQDAwQFw8NDxcbFBAQFBsfFxcXFxcfHhcaGhoaFx4eIyUnJSMeLy8zMy8vQEBAQEBAQEBAQEBAQEBAAREPDxETERUSEhUUERQRFBoUFhYUGiYaGhwaGiYwIx4eHh4jMCsuJycnLis1NTAwNTVAQD9AQEBAQEBAQEBAQED/wAARCAIAAgADASIAAhEBAxEB/8QAggABAQEBAQEBAAAAAAAAAAAAAAECAwQFBgEBAQEBAAAAAAAAAAAAAAAAAAECAxABAQACAQQBAQMICAQHAQAAAAERAgMhMRIEQQVRExRhcbHRIlM0FTJygpKisiNzkaFCYvCBwVLCQzUzEQEBAQEBAQEAAAAAAAAAAAAAARECMSFB/9oADAMBAAIRAxEAPwD9ris+Vjeu0rXjKDOuzXeM+OF7A47cV8suHLpvrtmPbnqXXXbuDzcVtxl6PHMJpJ2bnQHn5fXm8w+d/LLx8t3j7FrO0liD4vNpya9mvS9nbXfx2r6O/DrtOzwbentOXy1B9S+PJx5c9OKy5c+LbbTXFdNeaZw1IlreLjDnvxXD0yyzLPJZNchr53JbpetdOCzbtXk9zmztZHb0OPfGaYa92ureEzhZmitdDGUsWIHjAAAFAAAAAAEIqIKACyrlgtBvyZu0+E7r4gnWp4t4UGJDbXMaysB4t7tx7ZdNOebdLXfk49dp1eXk9Wy51B3mL2quPDNpcV6ZjAMYalLE7A1kwzK0CVFpAErTAKAAEXAIqUgLhQBw1lldpsmISAtoiglhMqQAAAUBiyM2TLdjFBnbSOe3HPh2vVZIupjnr5w5NrdcO2JYl0hqY+Tv6223J5V9D19PHTGHaaa/Y1JPg1cZmrUjWIlFEAAAAAAACplcGAJS0wAigAAgItZBqLKgDSWpkBI0kaBOphTIM3SGK1agM9TLSXUEWVMANd0TKgJe5UsyB5C+JYAqSKCUyWIDcq4YlxXSA5LKvcxhQICAAACUFyuWQGmbqq5Biani2gJFBQIAGaAAAAAACZBpMGTIKJlMgomVyAAAAgGBKCpkwmAaRYuAYyspYSAuTJgknyBkMLgEMrgwBUw1WQLEarICpU6g3DDMq2gVILgFx0YsxWpU26gjWtZjQMS2NZylizsAYqVddooLBMoKBkDBQwCRTAAAoAIAAAAAAACgmFUGcGGkoJgVKAuEi5AwGUBciKgCKosS07IA1lmKgtRKZBcnczCbAvYtZtMguTKAFqS1qariAJhb0ICJhagGDCgIoUCJQAwZMoCrEsSA1YxjFbZ2BYGtWwElKlIDWqoAAKgAAAAAigAAAAAACglUsBDAWgCKAqKAISgplAAFBGkEErNbSwGZK1IswqiYSxUtQIqar3Bc4Z8lrOALcrEwuAVMFzFgLIWEUGMr3WwwDItSAhFsQGrGWspYAADMuK2xhqAuCTAAAKgAAAAAAAKAICooIAAAopQBDAZBMGFXAMrEqSg3hnC5QAFwCKJQUSNYAiUuydwAW9gTyE8asQMUjVTxUS1LSxZOgE7LOiCC25EigplDILKvdhrIFjLWWe4KYMKDMVrxTAM0XCWAYWRIuQLUydTAGSGFwoAAC4QAAQAFAEBUUBAAAUUQAQUEjUrFWUFrFbrIJMtQkKCiRQAUGWmMrkEpmi4AkWdBm3qDfRm3qW9EmAayvlGLmmAazKrMioCLIUEEqwFZrSWARUhQCCwBUJQaygAgoCYXAQDAlpFFBMgqVcs0Gp1LElaBkEBQAAEAAAAAQUFwLAQKgLYkitYBlmtJjIEpeq+J2AkwJkBS1CgzYsirQRnPVpj5BuGEXAJTC4S34BeixmRpAAoLEpkBmkKsBYVYzaCNRBRUVEFEUCKy1ACiUEyuWRRcmcJJSwGpSmpQQXBgEjXwi5BmmSpYDWSRmNyguGVyUEBcIISLgBLEaygArNUBYUEy1LlzpLYDoZZ8gF8kzkwuMAki24TKbARvHRiNygzhcLQGbCRqsgsMhgCUBAAAKZSgDMtqgtRUBciKAqKoAIAsAZajKwFKAJhZqGVFwlLsx5dQbhSVKCmUyk7gtRTAIsiYMguEwZWUDCXKylAXKEQVMqmAIZak6M2AsSxMrlQKZATB4rGgY8TDTNBclrFrWvUCdVusXszaCXoTZL1JrgFuzUZky0C5ZqXKgZWJglwC0BABMguCmTIJiRF7gM2rLlnbusvRUXIxaa7A38rEqZRWlZi5BoQBFgAokVREy1hnAJeqYbwYBnNjUPEAAAUnRroDF6s2OmOpYDEi4OxkFwRMmQKRUQXIiguUqZMqGEaliWASAAKhAWphUyCWEuCpJQatyli4KDM7t2dGcYq3boCXoSp3Aa6JlOtMA1lARFAFHO7yXq3a8XvTk8Ltp8A9ssrnyb4fO9H2+Ta+O718udp0VHTj5ZejtLHz+uvVvXnoPXZlcOenLLMr97KK1iJNeqTbJN+qDa4mEly1IDKW4aseXm5NptiA9OuzTy8e+3y76b5B0ShQFjKxRUW1AUMpkFqRMrKC1nOFtyzYC+RN8JhnaA3N289HKStAtSxqFBkXCYBYuEjU7AyKUGajSyAxi5bNklAsUSgGcJlO4LnKkKAvZJEoNZS1kBb2TFWNTGAYiVqzqSAzMtLiAghkiCgCsckuOjhdsy616bHPfSdweC+t47eWr1cGts/aTe4TTmkuFiOvJxSzo8u/Hdeseq8nRjbbXaKjw8ns7ccb9b25v0qe1weWl2nw8nBxbf0s4/IzfVj7et08cys77a46PHpvtrr42t6b23FXDXSc/jTb3ZqxtxXa9EvqZgPRxe3rv0dLprtcvn/c7ce3R69OT9jr3KO3hrhm/s049rsm8s61FehFQEMlIolpKtjINZS1FwApIoEhhYAM2NJQIUAMmUUDJUUEWUMAZMpSAqypUgN1lpmgGMo0CYVMqCLImFyBamEysBMLhamQS3Bk2iQFFgCAAKigAIDG86Ns2A4bcd26fa8947x7vfZ8uPJx+VyDN08tcuV12ldppvF21uFRjXWWYryb+pt97nXpq9WtsrpkR5567Xhiul3kc99/kHo4tZjq6WR5OPnzcO15cCxnn16Pm+xzbcfSPo7ck2jxe5wXbS7a9z8F9P3J08q9+/Lptpn4fG4eLWSftYv2PXpenhlIPrItQVKsCKFiYaATBhcmQRUyoCWlTGQWAAAAYXCAAABkMAVFwYBAWAsSrEoJlcs0lBrC4SVcglStVASRcL2TIFQMAlo1NSzAEEUAAAAABAAATCoBhnaNAOPhLW7rJCzDny8t10qo4clu22I1OG7fs1y4OXy5Osevl2xPKIseKf6fLh6dpLrmV5uXi22vlO9NeHmx3IL1mzvp47a2Xq4cmu0n5XPi5NpyYvZUZno73mu07PVr6lly9Gu2uGrczog6gCpRWQWVrLMiqJaZFx0BMrGflqAohaAIoAICwIAAAAILBFBCAoVKqAsMJnC5BMCymQSrKUAAAwsRQXyY2quHu/wfPf8As2/QBPa9X99x/wB6frX8X6v77j/v6/rflhB+q/F+r++4/wC/r+s/F+p++4/7+v635fTj35Nppx63fe9tZM1myy4vSzvAfqvxfq/vuP8Av6/rPxfqfvuP+/r+t+VAfr5ZtJdbmXtYPJ9K/gOL+1/mr1gAAJQoJlUjSozs53SbdK3tUkoOenBppbWrtrt+yzy7WRnj21zm9wdtOKfLO88ezX3kkeXl555Yphr0cfFrvOrny+vx69Z3deLeTWW/LPPt06A4cfJrNsbPXr47dnxfZ5Ntbbr3T1ff3lk2B94BFDAAqLlnKiqgCWKACKAkihaAmFAAcvb5/wAN6+/Njy8ZMT8tuAdB4L7nvcGn33s8Ot4vnwv7Wue2cpx+5794vxO/DreCzONbfOa/b1QfQV5PX96b+lfb5pNZrnMn5Lhz19n6ny6ffcXDpOO9dddrfKwHvHk0+o8W3qb+ztLrePpvp8zb7HKe19T+7/EfcafdY8vDN8/EH0Bz9f2NPZ4debj7bfF7y/YvNy6cPFty7/0dJmg2Pn6+z9T5NPvuPg0nHeuum1vnY6a+3y+x633vqaS8s2xvx7/GO/2KPXUjx+r7/Jz+1twb8f3d00ztL3m0smPzOvq+ztzc3sce2sk4dvGWfPfv/wAAenBI823t76+/p6vjPHbTyu3z8/qefb3/AHfxe3racWnlM3TyuPLX4sB9Jx4fZ4ue7zjz/p7eO2ZjrGPX5Pe23x7HFpppjvrc3Ljw+1z82nPeHj1+849/HWdpt170HsnLx7a3bXabTXvi5xhn1+fj9jjnLx58bmTPTs+Z9L25/Dnl1n3d22u22es2x2en6P8AwOn59v0oO/s+7wer4/fWzzzjEz2dpZZLOsvWV8vfin1D3+eXrx8Ol49b/wB1+f8Ajl6fpXNeT1Zpv/T4bePafm7A9jh7v8Hz/wBTb9Du4e9/B8/9Tb9Cj8ud+k7j2+jwXWz2NulnXj/WSW3IluTX1vpP0/8AC8f3vJP9fedf+2f+39bj9X+mfeZ9ngn+pOvJpP8Aqn2z8r3et7WvJpjk2k3nfPTLxfVPa5PT9zg5+Prrtrdd9fjaS5/9Syz0l18EfU+oenx83F/MPT68e3Xk0n/Tfm4/S+Wiv0n0r+A4v7X+avW8n0r+A4v7X+avWAABWLltLAZlXODGC4sVHPfb7Hl/HeHJ4bR6rq4cnq67bTbHUHTe+euY4zpXp11k0w57ceeyxKlvlriPPy8G1/aejSeN6u18dtewPnTl5ZjW9o9E389cXu1vx6157fCgzy+tbLcPJeCzbth9Lj5ptMU34tdp0B7wGWgAEpFAAFAAAAAAARQHk+q/wHL/AGf82r1ufscGvscO3DvbNdsZs79LkHL6h/Ac39U9T+A4v9ufodebh15uHbh2tmu0xbO68fFrx8OvDrbdddfGW98IPj667bfQ7j43zfzeT7HBtrtwce2v9G6zH/Bj1/V4uDg/DzO2lzny+cvN/K/GXTi9jl4+K/8A1y9OoOPrcvDpy+9zckz6/nPjymc34fTm+l45vLPCzMvxjDnxepwcXBfX11/07nyl+c/a838qmPu5z8s4L/8AXnpj7AT6Ln8Nvf8AovJbr+bEd/qPHpyepvryb/d6dLd8eXa/ZHS+txfh762s8eO6+PTvinF6/HxevPX/AKXHJZfL5l+0Hl4/W9y8et4/dzpZPHHHr2+HP6RNvP2rdvOXfHn28r1zXT+VyS6cfscunFe/HL0evg4OP1+OcXFMaz/nftoPHx//ALPL/tT/AOKfTtp+M93T5884/JnZ6562k9rb2pb57a+Nnxj/AMRx2+mcV335dN99OXfa7eetxZnvPzA58n/7XF/tX/5O3vep+I0m2l8efj68e/5fsPW9DTg5Nubbfbl5dpi77/Yxv9Nm292/Ec08rbibdJkG/R9z8RpdOSePPx9OTT/1cfpXf2v92t8H03j4Oec85N995mXysuczHXo3r6OmnHy6acm+v323ndpcWXPwDz/S/wD+Hs/7m36E9HmnB9JvLf8Ap8sfnz0ez1vU4/W4bxaW2bW3ba97a5X6bw31Z6vntOObeWemb/yB5PQ9X6hrwTk4uXXScv7dm2ub+hr1pzep9RvHz7Tb8TM+UmJ5R9TXWa6zXXpNZiT8kcvZ9Tj9i8e21uu3FfLXbXuDs4e9/B8/9Tb9Du4e9/B8/wDU2/Qo/NcM47y6/eXGmer60xiY7fGHxnXh9nk4b066/Ot7NcdZ6x1zr6jX1Li4uX1/V25N/CSWZ/8AKfqceHn4+afs3G3zre71e1623tehwyba6Tj2t3327a6zOa139ksTj5bGfpXH6/FyXXi9mcnnOvD064+XzPqXH6/H7e+vr3OneydtdvmRvl9vi4dL6/o510vTk57/AE+T832R4nJ0fpPpX8Bxf2v81et5PpX8Bxf2v81etQAQAASpexaijPVZMrhqCMb411cpct80tnRx0lNTHSa5rW08NKzxyy9Wua/sqPFvzbSs/wBOLvrrtXbh49fH8qaY8enJOHezf57Ov387ztT2vV+82l+xNeCeOPsJVfWARQAAAABQAABKCwpFoMrEqgAAAAAAAAIACoAoABgATAqWAZKkaBmVrLOOqiK4e9/B8/8AU2/Q7G2uu2t12mddpiy/MoPyI/Sfyr0P3X+Lb9Z/KvQ/df4tv1or83LZcy4s7WO3L7nscvFrw77/AOnr18Z0zfy/a+9/KvQ/df4tv1n8q9D91/i2/Wo/Nj9J/KvQ/df4tv1n8q9D91/i2/WgfSv4Di/tf5q9bPHx6cWk4+OeOmvSSNKACAlVATCYaMCMqlWKJesY8cOmGaDnvv4vPze1rNbPl158XV8n2v2Lm9k0XX28ctl7PZw+zM/nfDt+83/Yb15eTj2k2TVfpsTbTMeXbfx2w8/r/UdfGa7Pbprpz4wqPbUVBQAABQAAABUqpQSNMqACAoAAAAgAAAAAACiAKIoBQBFjNuF1ohRayCioCiKAAKAAAIAAAACVWaCNRMKAzY1WaqOe2kvd5vZ9Oc0w9G+Z1OPeXpTB8nX6d91tbJl5vb4N5c2Yfd3sm2Xk9vWctkwzivlacWt1znq9fq+7eHbxtNvQ8J5SvHzcdlz9hzKlr9YioqgAACgJlQAAWJSLQZUQFCAAACAAAAAAAAAAAAqKAAIljPy2zYCypSFBZVsYlw38AgAKAAAKAIAAAADLSAAAJhUBjbTLn93Zcx3qYUea6b2peC7PViLgHi24rJivDzetttez7W2krjvpMdjWXqRpKjSCKoIoCLEICggKAgAAAAAKCKAgAAAAAAAAKCKAgAAACYFQGbOrUqUgNIqAKgCiKAAigAAACKgCooICAUBRQAKl1yqxEJVSNCsgKAAIKABgQFQAAAAAAUBFBAAAAAAFAAAAAAAQAArMaSwEABQKAZEoKEAURQAEUAARTAEAoJUKAAKKAgohFRoZt6mUVpAAMiKKsRQAKggEAFQAABFQBYgoqKgAACgAAAAAAAAIAAAAjLSWARSRQQoAAoIACiKAAKACBREEUwKqAALEaggYE7AWLImWpcop2RaAM1osUQADICARFgKioAAAACAKKAAACKAAAAAAAAAAAgAAioAqKCUVAFiEBagAAAKgCgAAAgqUBAAjSKBgq/CUVKutRZqgbVItidgaMiAqAoKCDNWFSA0igIAAAAAoAAAAIqAoAAAAAAAAAAAgACCoCoAAAAAAAAACoooigESqlEQhjLQEMdSL8inwi1KCNeTK4QW1J1qYWAUynemMUFABVSKozU+Wqz8oNJlfhAAFAAAAAAAAAAAAAAAAAAAAAAQAAABBUAAAAABYCC1BRUaAAAQAJEWkAhQBUKAlixnLUQLWbWrEwCRfkkamARcGFBAFBj5bZoNQqarQQAAAAAAAAAAAAAAAAAAAAAAAQAAAAABBUAAAVAVQQFEUAAAyM3rUFq46HTBOoJFXCY6gXsQvSJKoNdEhUF6YROoDXRJOphYCWhsmQaElyoCWKlBI0xO7aiAAAgKmQBTKEBRAFAAAAAAAAAAAAAAAAAEAAEUBABQAFRUAAgKKlBMmEndoBe0XCVAT5DUDbqi1lRqKioJSFJQLFz0RAMphcAM5w6TZnxLAbylZigigAAAgAgqWqLCs5awCC4QFyuWVQXJlm0gNAAAKAAAAAACgCBUBQAAAEVAAAURoEwogGTCfK0EpFx0LEGs9Ge6y9GZeoCxWb3A+U+Wr2Zio0sTIil6pg7LM0EmVmtbkXMBnCYM9U22oATsmeoKWiYyBMtIuQQVAQMJlRcdGLG52TawEjcjMalQEw1lMgki4S3CTbILhcYIUAAABQAgArIKQgCgAiNVkFAAAAABBQAACpFSIKKz2oNFEoJ2axgW9QZTYvcvVYhOwvaIDXhiIu1Y65RWqS4JCg15M2sgLFJGoDFuOhGrhAWTAmTKi4Zq5EEjSRQSsVus2KM3aue21dLGfHIia7V08nPxwXIOsuWnLWunlEVLMsyYreYlmQalmBnGFgKAAAAQFFQAAAUABKqUEikABRBFEAAABFCkKRBpKZAChKBL1atZ+SgWZRZeiKGTafMK1J06iFMJMqipU7tVOwF1JCWqAlFBAsIBhcAomDC2s5BTKZEFAUSxMNAM4ZsdMJgHPFMbOmDOEHPGGpVsys0BJmq1jCYADBgAMGAAwuFGVhYSAUVMICgAYAASqCUAFQAAAAFEFgABUAwmVyC4Zrc7M/KiQwoCLAEf/2Q==";var i=new Image;i.src=r,i.onload=function(){var t=new p.Texture(i);t.needsUpdate=!0,e(t)}})).then(function(t){return r=t,e._maxAnisotropy&&(r.anisotropy=e._maxAnisotropy),Promise.resolve(r)});var n}(i).then(function(t){var r;if(e._useTexture)r=new Yr({map:t});else{var n=e._solidColorTexture;r=new Yr({map:n})}var i=new p.Mesh(w,r);return Promise.resolve(i)}).catch(function(e){console.warn("Loading logo failed.",e);var t=new p.Mesh(w);return Promise.resolve(t)})}}},{key:"initOptionalItems",value:function(){var e=this,t=[];if(this.planet&&(this._items=new p.Object3D,this.sceneNode.add(this._items),this.planet.showOrbitRing))var r=new Promise(function(n,i){for(var o=new p.Object3D,a=1.1*J,s=Math.PI/180,u=new p.LineBasicMaterial({linewidth:.5,color:7329264,transparent:!0,opacity:.4}),c=new p.Geometry,l=0;l<360;l++){var f=a*Math.cos(s*l),h=a*Math.sin(s*l);c.vertices.push(new p.Vector3(.985*f,0,.985*h)),c.vertices.push(new p.Vector3(f,0,h)),l%30==0?(c.vertices.push(new p.Vector3(.935*f,0,.935*h)),c.vertices.push(new p.Vector3(f,0,h)),c.vertices.push(new p.Vector3(.935*f,0,.935*h)),c.vertices.push(new p.Vector3(f,0,h))):l%5==0&&(c.vertices.push(new p.Vector3(.965*f,0,.965*h)),c.vertices.push(new p.Vector3(f,0,h)),c.vertices.push(new p.Vector3(.965*f,0,.965*h)),c.vertices.push(new p.Vector3(f,0,h)))}var d=new p.LineSegments(c,u),v=new p.LineSegments(c,u);v.rotation.x=Math.PI/2,o.add(d),o.add(v),e._items.add(o),n(),t.push(r)});return Promise.all(t)}},{key:"animate",value:function(e){this.updateVisibility(e),Gi(Ki(t.prototype),"animate",this).call(this,e)}},{key:"updateVisibility",value:function(e){var r=e.camera,n=e.cameraChanging;Gi(Ki(t.prototype),"updateVisibility",this).call(this,{camera:r}),this._tree&&n&&(this._tree._updateCameraPose({camera:r}),this._tree.updateVisibility())}},{key:"updatePlanetMap",value:function(e){this._tree&&this._tree.updatePlanetMap(e)}},{key:"changeMapMaxLevel",value:function(e){var t=e.level,r=e.name;this._tree&&this._tree.changeMapMaxLevel({level:t,name:r})}},{key:"updatePlanetWireframeVisibility",value:function(){this._tree&&this._tree.updatePlanetWireframeVisibility()}},{key:"visible",get:function(){return Gi(Ki(t.prototype),"visible",this)},set:function(e){!function(e,t,r,n,i){if(!Vi(e,t,r,n||e)&&i)throw new Error("failed to set property")}(Ki(t.prototype),"visible",e,this,!0),this.sceneNode.visible=e}},{key:"treeNode",get:function(){return this._treeNode}}])&&zi(r.prototype,n),i&&zi(r,i),t}();function Xi(e){return(Xi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Zi(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Qi(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function Ji(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function $i(e,t){return!t||"object"!==Xi(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function eo(e,t,r){return(eo="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=to(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function to(e){return(to=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ro(e,t){return(ro=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var no=function(e){function t(e,r){var n,i=r.isMobile,o=void 0!==i&&i,a=r.forest,s=Qi(r,["isMobile","forest"]);return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=$i(this,to(t).call(this,e))).MAX_LEVEL=o?15:18,n.forest=a,n.earthEntityOptions=s,n}var r,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ro(e,t)}(t,Mt),r=t,(n=[{key:"destruct",value:function(){var e=!0;return this.forest=null,e=eo(to(t.prototype),"destruct",this).call(this)&&e}},{key:"import",value:function(){return new Yi(this,function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){Zi(e,t,r[t])})}return e}({name:"PlanetEntity",forest:this.forest,maxLevel:this.MAX_LEVEL,minLevel:0},this.earthEntityOptions)).import()}},{key:"sceneUpdated",value:function(e){var t=e.camera;this.applyToChildren(function(e,t){e.sceneUpdated(t)},{camera:t})}}])&&Ji(r.prototype,n),i&&Ji(r,i),t}();function io(e){return(io="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function oo(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ao(e,t){return!t||"object"!==io(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function so(e,t,r){return(so="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=uo(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function uo(e){return(uo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function co(e,t){return(co=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var lo=function(e){function t(e,r){var n,i=r.name,o=void 0===i?"LodTreeEntity":i,a=r.forest;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=ao(this,uo(t).call(this,e,{name:o}))).name="LodTreeEntity",n._tree=null,n._forest=a,n}var r,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&co(e,t)}(t,Nt),r=t,(n=[{key:"destruct",value:function(){var e=so(uo(t.prototype),"destruct",this).call(this);return this.treeNode&&(this.treeNode.parent&&this.treeNode.parent.remove(this.treeNode),this._treeNode=void 0),this.tree&&(e=this.tree.destruct()&&e,this._tree=void 0),this._forest=void 0,e}},{key:"import",value:function(){return Promise.reject(new Error("Not implemented"))}},{key:"treeNode",get:function(){return this._treeNode}},{key:"tree",get:function(){return this._tree}},{key:"material",get:function(){if(this._tree)return this._tree.material;console.warn("Tree is not created, material not ready.")},set:function(e){this._tree?this._tree.material=e:console.warn("Tree is not ready.")}}])&&oo(r.prototype,n),i&&oo(r,i),t}();function fo(e){return(fo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ho(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function po(e,t){return!t||"object"!==fo(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function vo(e,t,r,n){return(vo="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(e,t,r,n){var i,o=mo(e,t);if(o){if((i=Object.getOwnPropertyDescriptor(o,t)).set)return i.set.call(n,r),!0;if(!i.writable)return!1}if(i=Object.getOwnPropertyDescriptor(n,t)){if(!i.writable)return!1;i.value=r,Object.defineProperty(n,t,i)}else!function(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(n,t,r);return!0})(e,t,r,n)}function yo(e,t,r){return(yo="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=mo(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function mo(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=go(e)););return e}function go(e){return(go=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function bo(e,t){return(bo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var _o=function(e){function t(e,r){var n,i=r.name,o=void 0===i?"ProjectEntity":i,a=r.forest,s=r.showBBox,u=r.position;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=po(this,go(t).call(this,e,{name:o})),void 0===u.alt&&(u.alt=0),n.name="ProjectEntity",n._tree=null,n._forest=a,n.showBBox=s,n._treeNode=new p.Object3D,n._treeNode.add(new p.AxesHelper(1e3)),n.displayHolder=new p.Object3D,n.displayHolder.add(n._treeNode),n.sceneNode.add(n.displayHolder),n.sceneNode.applyMatrix(function(){var e=ve.getENUSystem(u.lat,u.lng),t=e.east,r=e.up,n=e.north,i=e.origin;i.add(r.clone().multiplyScalar(u.alt));var o=new p.Matrix4;return o.makeBasis(t,n,r),o.setPosition(i),o}()),n}var r,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&bo(e,t)}(t,lo),r=t,(n=[{key:"destruct",value:function(){return this.sceneNode.remove(this.displayHolder),this.displayHolder.remove(this._treeNode),this._forest=void 0,yo(go(t.prototype),"destruct",this).call(this)}},{key:"import",value:function(){return Promise.reject(new Error("Not implemented"))}},{key:"visible",set:function(e){!function(e,t,r,n,i){if(!vo(e,t,r,n||e)&&i)throw new Error("failed to set property")}(go(t.prototype),"visible",e,this,!0),this._tree&&(this._tree.visible=e)},get:function(){return yo(go(t.prototype),"visible",this)}},{key:"treeNode",get:function(){return this._treeNode}},{key:"material",get:function(){if(this._tree)return this._tree.material;console.warn("Tree is not created, material not ready.")},set:function(e){this._tree?this._tree.material=e:console.warn("Tree is not ready.")}}])&&ho(r.prototype,n),i&&ho(r,i),t}(),wo={crop_pars_vertex:"uniform vec3 origin;\nuniform vec3 xDir;\nuniform vec3 yDir;\nuniform vec3 zDir;\nuniform vec3 minBound;\nuniform vec3 maxBound;\nvarying vec2 vMaskUv;",crop_vertex:"vec3 vori = position - origin;\nvec3 vViewPosition = vec3(dot(vori, xDir), dot(vori, yDir), dot(vori, zDir));\nvMaskUv = ((vViewPosition - minBound)/(maxBound - minBound)).xz;",crop_pars_fragment:"uniform sampler2D cropMask;\nvarying vec2 vMaskUv;",crop_fragment:"\nfloat os_val = texture2D(cropMask, vMaskUv).y;\nif(os_val < 0.05) {discard;}\n",projector_pars_vertex:"\n#ifdef PROJECTOR\n  // The model-view-projection matrix for the projector\n  // This matrix is used to calculate the texture coordinates for the vertex. \n  struct Projector {\n    mat4 videoProjectionMatrix;\n    mat4 localToVideo;\n    float projectorLogDepthBufferFC;\n    bool visible;\n    bool isVideo;\n    float alpha;\n  };\n\n  #ifdef VIDEO\n    uniform sampler2D videoTexture[MAX_COUNT];\n  #endif\n\n  uniform Projector projectors[MAX_COUNT];\n  uniform sampler2D depthTexture[MAX_COUNT];\n  uniform int count;\n\n  // varying vec3 transformedPosition;\n  // varying vec3 transformedNormal;\n  varying vec4 textureCoordProj[MAX_COUNT];\n\n  mat4 scaleBiasedMatrix = mat4(0.5, 0.0, 0.0, 0.0,\n    0.0, 0.5, 0.0, 0.0,\n    0.0, 0.0, 0.5, 0.0,\n    0.5, 0.5, 0.5, 1.0);\n\n  // #include <logdepthbuf_pars_vertex>\n\n  #ifdef USE_LOGDEPTHBUF\n    #ifdef USE_LOGDEPTHBUF_EXT\n      varying float videoFragDepth[MAX_COUNT];\n    #endif\n  #endif\n#endif\n",projector_vertex:"\n#ifdef PROJECTOR\n  #pragma unroll_loop\n  for ( int i = 0; i < MAX_COUNT; i ++ ) {\n    textureCoordProj[ i ] = projectors[ i ].visible ?\n    scaleBiasedMatrix * projectors[ i ].videoProjectionMatrix * projectors[ i ].localToVideo * vec4(position, 1.0) : textureCoordProj[ i ];\n  }\n  // #include <logdepthbuf_vertex>\n  #ifdef USE_LOGDEPTHBUF\n    #ifdef USE_LOGDEPTHBUF_EXT\n      #pragma unroll_loop\n      for ( int i = 0; i < MAX_COUNT; i ++ ) {\n        videoFragDepth[ i ] = projectors[ i ].visible ?\n        1.0 + (projectors[ i ].videoProjectionMatrix * projectors[ i ].localToVideo * vec4(position, 1.0)).w : videoFragDepth[ i ];\n      }\n    #endif\n  #endif\n#endif\n",projector_pars_fragment:"\n#ifdef PROJECTOR\n  struct Projector {\n    mat4 videoProjectionMatrix;\n    mat4 localToVideo;\n    float projectorLogDepthBufferFC;\n    bool visible;\n    bool isVideo;\n    float alpha;\n  };\n\n  #ifdef VIDEO\n    uniform sampler2D videoTexture[MAX_COUNT];\n  #endif\n  uniform Projector projectors[MAX_COUNT];\n  uniform sampler2D depthTexture[MAX_COUNT];\n  uniform int count;\n\n  // varying vec3 transformedPosition;\n  varying vec4 textureCoordProj[MAX_COUNT];\n\n  // #include <logdepthbuf_pars_fragment>\n  #ifdef USE_LOGDEPTHBUF\n    #ifdef USE_LOGDEPTHBUF_EXT\n      varying float videoFragDepth[MAX_COUNT];\n    #endif\n  #endif\n\n  bool inFustrum (vec4 texCoordProj) {\n    float videoY = texCoordProj.y / texCoordProj.w;\n    float videoX = texCoordProj.x / texCoordProj.w;\n    float videoZ = texCoordProj.z / texCoordProj.w;\n    float a = step(0.0, videoX) - step(1.0, videoX); // want 1.0 (inside range)\n    float b = step(0.0, videoY) - step(1.0, videoY); // want 1.0 (inside range)\n    float c = step(0.0, videoZ) - step(1.0, videoZ);\n\n    return (a == 1.0 && b == 1.0 && c == 1.0);\n  }\n  bool videoEffective (vec4 texCoordProj, sampler2D depthTex, float fragmentDepth) {\n    float bias = 0.01; // 0.05;\n    float depth = texture2DProj(depthTex, texCoordProj).x;\n    // depth = texture2D(depthTex, vec2(0.5, 0.5)).x;\n\n    float fragCoordZBiased = depth + bias;\n\n    float d = step(fragmentDepth, fragCoordZBiased);\n    return (d == 1.0);\n  }\n#endif\n",projector_fragment:"\n#ifdef PROJECTOR\n  float fragmentDepth;\n  bool useVideo;\n  bool videoInFustrum;\n  bool isVideo;\n  vec4 mapColor = color;\n  #ifdef VISIBILITY\n    bool notGreen = true;\n    float mixFactorRed = 0.3;\n    float mixFactorGreen = 0.3;\n  #endif\n  #ifdef VIDEO\n    vec4 videoTextureColor;\n  #endif\n  #pragma unroll_loop\n  for ( int i = 0; i < MAX_COUNT; i ++ ) {\n    // For perspective projection effect\n    fragmentDepth = projectors[ i ].visible ? textureCoordProj[ i ].z / textureCoordProj[ i ].w : fragmentDepth;\n    #if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n      fragmentDepth = projectors[ i ].visible ?\n      log2( videoFragDepth[ i ] ) * projectors[ i ].projectorLogDepthBufferFC * 0.5 : fragmentDepth;\n    #endif\n    videoInFustrum = projectors[ i ].visible ? inFustrum(textureCoordProj[ i ]) : false;\n    useVideo = videoInFustrum ? videoEffective(textureCoordProj[ i ], depthTexture[ i ], fragmentDepth) : false;\n    isVideo = projectors[ i ].isVideo;\n\n    #ifdef VISIBILITY\n      // more visible more green, more invisible more red\n      // don't change the color when not in fustrum (or projector invisible)\n      // if in fustrum but can't be seen, and it has been seen by other projector, don't change the color\n      // if in fustrum but can't be seen, and it hasn't been seen by other projector, mix color with red\n      // if in fustrum and can be seen first time, set color to normal (color may has been mix with red), then mix color with green\n      // if in fustrum and can be seen, mix color with green\n      color = !isVideo && notGreen && videoInFustrum ? mix(color, vec4(1.0, 0.0, 0.0, color.a), mixFactorRed) : color;\n      color = !isVideo && notGreen && useVideo ? mapColor : color;\n      color = !isVideo && useVideo ? mix(color, vec4(0.0, 1.0, 0.0, color.a), mixFactorGreen) : color;\n      notGreen = !isVideo && useVideo ? false : notGreen;\n    #endif\n    #ifdef VIDEO\n      useVideo = isVideo && projectors[ i ].visible && useVideo;\n      videoTextureColor = useVideo ? texture2DProj(videoTexture[ i ], textureCoordProj[ i ]) : videoTextureColor;\n      videoTextureColor.rgb = mix(mapColor.rgb, videoTextureColor.rgb, projectors[ i ].alpha);\n      videoTextureColor.a = mapColor.a;\n\n      color = useVideo ? videoTextureColor : color;\n    #endif\n  }\n#endif\n",visibility_fragment:"\n// For regular texture mapping\nvec4 mapColor = texture2D(map, textureCoord);\nvec4 color = mapColor;\nfloat mixFactorRed = 0.3;\nfloat mixFactorGreen = 0.3;\n\nfloat fragmentDepth;\nbool useVideo;\nbool videoInFustrum;\nbool notGreen = true;\n\n#pragma unroll_loop\nfor ( int i = 0; i < MAX_COUNT; i ++ ) {\n  // For perspective projection effect\n  fragmentDepth = projectors[ i ].visible ? textureCoordProj[ i ].z / textureCoordProj[ i ].w : fragmentDepth;\n  #if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n    fragmentDepth = projectors[ i ].visible ?\n    log2( videoFragDepth[ i ] ) * projectors[ i ].projectorLogDepthBufferFC * 0.5 : fragmentDepth;\n  #endif\n  videoInFustrum = projectors[ i ].visible ? inFustrum(textureCoordProj[ i ]) : false;\n  useVideo = videoInFustrum ? videoEffective(textureCoordProj[ i ], depthTexture[ i ], fragmentDepth) : false;\n  // more visible more green, more invisible more red\n  // don't change the color when not in fustrum (or projector invisible)\n  // if in fustrum but can't be seen, and it has been seen by other projector, don't change the color\n  // if in fustrum but can't be seen, and it hasn't been seen by other projector, mix color with red\n  // if in fustrum and can be seen first time, set color to normal (color may has been mix with red), then mix color with green\n  // if in fustrum and can be seen, mix color with green\n  color = notGreen && videoInFustrum ? mix(color, vec4(1.0, 0.0, 0.0, 1.0), mixFactorRed) : color;\n  color = notGreen && useVideo ? mapColor : color;\n  color = useVideo ? mix(color, vec4(0.0, 1.0, 0.0, 1.0), mixFactorGreen) : color;\n  notGreen = useVideo ? false : notGreen;\n}\n",video_fragment:"\n// For regular texture mapping\nvec4 color = texture2D(map, textureCoord);\n\nfloat fragmentDepth;\nbool useVideo;\nbool videoInFustrum;\nvec4 videoTextureColor;\n\n#pragma unroll_loop\nfor ( int i = 0; i < MAX_COUNT; i ++ ) {\n  // For perspective projection effect\n  fragmentDepth = projectors[ i ].visible ? textureCoordProj[ i ].z / textureCoordProj[ i ].w : fragmentDepth;\n  #if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n    fragmentDepth = projectors[ i ].visible ?\n    log2( videoFragDepth[ i ] ) * projectors[ i ].projectorLogDepthBufferFC * 0.5 : fragmentDepth;\n  #endif\n  videoInFustrum = projectors[ i ].visible ? inFustrum(textureCoordProj[ i ]) : false;\n  useVideo = videoInFustrum ?\n  videoEffective(textureCoordProj[ i ], depthTexture[ i ], fragmentDepth) : false;\n\n  videoTextureColor = projectors[ i ].visible ?\n  texture2DProj(videoTexture[ i ], textureCoordProj[ i ]) : videoTextureColor;\n\n  color = mix(color, videoTextureColor, float(useVideo));\n}\n",phong2_pars_vertex:"\n#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n  varying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n",phong2_vertex:"\n#include <uv_vertex>\n#include <uv2_vertex>\n#include <color_vertex>\n#include <beginnormal_vertex>\n#include <morphnormal_vertex>\n#include <skinbase_vertex>\n#include <skinnormal_vertex>\n#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n  vNormal = normalize( transformedNormal );\n#endif\n#include <begin_vertex>\n#include <morphtarget_vertex>\n#include <skinning_vertex>\n#include <displacementmap_vertex>\n#include <project_vertex>\n#include <logdepthbuf_vertex>\n#include <clipping_planes_vertex>\nvViewPosition = - mvPosition.xyz;\n#include <worldpos_vertex>\n#include <envmap_vertex>\n#include <shadowmap_vertex>\n#include <fog_vertex>\n",phong2_pars_fragment:"\n#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n",phong2_fragment:["\n  #include <clipping_planes_fragment>\n  vec4 diffuseColor = vec4( diffuse, opacity );\n  ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n  vec3 totalEmissiveRadiance = emissive;\n  #include <logdepthbuf_fragment>\n  #include <map_fragment>\n  #include <color_fragment>\n  #include <alphamap_fragment>\n  #include <alphatest_fragment>\n  #include <specularmap_fragment>\n  ","\n#ifdef FLAT_SHADED\n  // Workaround for Adreno/Nexus5 not able able to do dFdx( vViewPosition ) ...\n  vec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n  fdx = normalize(fdx);\n  vec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n  fdy = normalize(fdy);\n  vec3 normal = normalize( cross( fdx, fdy ) );\n#else\n  vec3 normal = normalize( vNormal );\n  #ifdef DOUBLE_SIDED\n    normal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n  #endif\n#endif\n","\n  #include <normal_fragment_maps>\n  #include <emissivemap_fragment>\n  #include <lights_phong_fragment>\n  ","\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\nIncidentLight directLight;\nvec3 irradiance;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n  PointLight pointLight;\n  float dotNL;\n  #pragma unroll_loop\n  for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n    pointLight = pointLights[ i ];\n    getPointDirectLightIrradiance( pointLight, geometry, directLight );\n    #ifdef USE_SHADOWMAP\n      directLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n    #endif\n    #ifdef TOON\n      irradiance = getGradientIrradiance( normal, normalize( pointLight.position + vViewPosition ) ) * directLight.color;\n    #else\n      dotNL = saturate( dot( normal, normalize( pointLight.position + vViewPosition ) ) );\n      irradiance = dotNL * directLight.color;\n    #endif\n    #ifndef PHYSICALLY_CORRECT_LIGHTS\n      irradiance *= PI;\n    #endif\n    reflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n    reflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n  }\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n  SpotLight spotLight;\n  #pragma unroll_loop\n  for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n    spotLight = spotLights[ i ];\n    getSpotDirectLightIrradiance( spotLight, geometry, directLight );\n    #ifdef USE_SHADOWMAP\n    directLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n    #endif\n    RE_Direct( directLight, geometry, material, reflectedLight );\n  }\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n  DirectionalLight directionalLight;\n  #pragma unroll_loop\n  for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n    directionalLight = directionalLights[ i ];\n    getDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n    #ifdef USE_SHADOWMAP\n    directLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n    #endif\n    RE_Direct( directLight, geometry, material, reflectedLight );\n  }\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n  RectAreaLight rectAreaLight;\n  #pragma unroll_loop\n  for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n    rectAreaLight = rectAreaLights[ i ];\n    RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n  }\n#endif\n#if defined( RE_IndirectDiffuse )\n  irradiance = getAmbientLightIrradiance( ambientLightColor );\n  #if ( NUM_HEMI_LIGHTS > 0 )\n    #pragma unroll_loop\n    for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n      irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n    }\n  #endif\n#endif\n#if defined( RE_IndirectSpecular )\n  vec3 radiance = vec3( 0.0 );\n  vec3 clearCoatRadiance = vec3( 0.0 );\n#endif\n","\n  #include <lights_fragment_maps>\n  #include <lights_fragment_end>\n  #include <aomap_fragment>\n  vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n  #include <envmap_fragment>\n  gl_FragColor = vec4( outgoingLight, diffuseColor.a );\n  #include <tonemapping_fragment>\n  #include <encodings_fragment>\n  #include <fog_fragment>\n  #include <premultiplied_alpha_fragment>\n  #include <dithering_fragment>  \n  "].join("\n"),basic2_pars_vertex:"\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n",basic2_vertex:"\n#include <uv_vertex>\n#include <uv2_vertex>\n#include <color_vertex>\n#include <skinbase_vertex>\n#ifdef USE_ENVMAP\n#include <beginnormal_vertex>\n#include <morphnormal_vertex>\n#include <skinnormal_vertex>\n#include <defaultnormal_vertex>\n#endif\n#include <begin_vertex>\n#include <morphtarget_vertex>\n#include <skinning_vertex>\n#include <project_vertex>\n#include <logdepthbuf_vertex>\n#include <worldpos_vertex>\n#include <clipping_planes_vertex>\n#include <envmap_vertex>\n#include <fog_vertex>\n",basic2_pars_fragment:"\nuniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n  varying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n\n#ifdef USE_ALPHAMAP\n  uniform sampler2D alphaMap;\n  uniform int alphaChannel;\n#endif\n\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n",basic2_fragment:"\n#include <clipping_planes_fragment>\nvec4 diffuseColor = vec4( diffuse, opacity );\n#include <logdepthbuf_fragment>\n#include <map_fragment>\n#include <color_fragment>\n\n#ifdef USE_ALPHAMAP\nvec4 alphaMapColor = texture2D( alphaMap, vUv );\nfloat alphaMapAlpha = alphaMapColor.g;\nalphaMapAlpha = alphaChannel == 0 ? alphaMapColor.r : alphaMapAlpha;\nalphaMapAlpha = alphaChannel == 1 ? alphaMapColor.g : alphaMapAlpha;\nalphaMapAlpha = alphaChannel == 2 ? alphaMapColor.b : alphaMapAlpha;\nalphaMapAlpha = alphaChannel == 3 ? alphaMapColor.a : alphaMapAlpha;\ndiffuseColor.a *= alphaMapAlpha;\n#endif\n\n#include <alphatest_fragment>\n#include <specularmap_fragment>\nReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n#ifdef USE_LIGHTMAP\nreflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n#else\nreflectedLight.indirectDiffuse += vec3( 1.0 );\n#endif\n#include <aomap_fragment>\nreflectedLight.indirectDiffuse *= diffuseColor.rgb;\nvec3 outgoingLight = reflectedLight.indirectDiffuse;\n#include <envmap_fragment>\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );\n#include <premultiplied_alpha_fragment>\n#include <tonemapping_fragment>\n#include <encodings_fragment>\n#include <fog_fragment>\n",physical2_pars_vertex:"\n#define PHYSICAL\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n  varying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n",physical2_vertex:"\n#include <uv_vertex>\n#include <uv2_vertex>\n#include <color_vertex>\n\n#include <beginnormal_vertex>\n#include <morphnormal_vertex>\n#include <skinbase_vertex>\n#include <skinnormal_vertex>\n#include <defaultnormal_vertex>\n\n#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\nvNormal = normalize( transformedNormal );\n\n#endif\n\n#include <begin_vertex>\n#include <morphtarget_vertex>\n#include <skinning_vertex>\n#include <displacementmap_vertex>\n#include <project_vertex>\n#include <logdepthbuf_vertex>\n#include <clipping_planes_vertex>\n\nvViewPosition = - mvPosition.xyz;\n\n#include <worldpos_vertex>\n#include <shadowmap_vertex>\n#include <fog_vertex>\n",physical2_pars_fragment:"\n#define PHYSICAL\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n\n#ifndef STANDARD\n  uniform float clearCoat;\n  uniform float clearCoatRoughness;\n#endif\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n  varying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n",physical2_fragment:"\n#include <clipping_planes_fragment>\n\nvec4 diffuseColor = vec4( diffuse, opacity );\nReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\nvec3 totalEmissiveRadiance = emissive;\n\n#include <logdepthbuf_fragment>\n#include <map_fragment>\n#include <color_fragment>\n#include <alphamap_fragment>\n#include <alphatest_fragment>\n#include <roughnessmap_fragment>\n#include <metalnessmap_fragment>\n#include <normal_fragment_begin>\n#include <normal_fragment_maps>\n#include <emissivemap_fragment>\n\n// accumulation\n#include <lights_physical_fragment>\n#include <lights_fragment_begin>\n#include <lights_fragment_maps>\n#include <lights_fragment_end>\n\n// modulation\n#include <aomap_fragment>\n\nvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n#include <tonemapping_fragment>\n#include <encodings_fragment>\n#include <fog_fragment>\n#include <premultiplied_alpha_fragment>\n#include <dithering_fragment>\n",hsbc_pars_fragment:"\nuniform vec4 hsbc;\nvec3 applyHue(vec3 aColor, float aHue)\n{\n    float angle = radians(aHue);\n    vec3 k = vec3(0.57735, 0.57735, 0.57735);\n    float cosAngle = cos(angle);\n    //Rodrigues' rotation formula\n    return aColor * cosAngle + cross(k, aColor) * sin(angle) + k * dot(k, aColor) * (1.0 - cosAngle);\n}\nvec4 applyHSBEffect(vec4 startColor, vec4 hsbc)\n{\n    float _Hue = 360.0 * hsbc.r;\n    float _Saturation = hsbc.g * 2.0;\n    float _Brightness = hsbc.b * 2.0 - 1.0;\n    float _Contrast = hsbc.a * 2.0;\n \n    vec4 outputColor = startColor;\n    outputColor.rgb = applyHue(outputColor.rgb, _Hue);\n    outputColor.rgb = (outputColor.rgb - 0.5) * (_Contrast) + 0.5;\n    outputColor.rgb = outputColor.rgb + _Brightness;        \n    vec3 intensity = outputColor.rgb * vec3(0.299,0.587,0.114);\n    outputColor.rgb = mix(intensity, outputColor.rgb, _Saturation);\n \n    return outputColor;\n}\n"},xo=1,Ao=2,ko=3,Oo=10,So=20,Po=30,To=41,Eo={uniforms:{test:{type:"float",value:233},cropMask:{type:"t",value:null},origin:{type:"v3",value:new p.Vector3},xDir:{type:"v3",value:new p.Vector3},yDir:{type:"v3",value:new p.Vector3},zDir:{type:"v3",value:new p.Vector3},minBound:{type:"v3",value:new p.Vector3},maxBound:{type:"v3",value:new p.Vector3}}},Mo={uniforms:p.UniformsUtils.merge([{projectors:{value:[]},depthTexture:{value:[]},count:{type:"i",value:0}},{videoTexture:{value:[]}}])},jo={uniforms:p.ShaderLib.phong.uniforms},Co={uniforms:p.UniformsUtils.merge([p.ShaderLib.basic.uniforms,{alphaChannel:{type:"i",value:1}}])},Ro={uniforms:p.ShaderLib.physical.uniforms},Io={uniforms:{hsbc:{type:"v4",value:[0,.5,.5,.5]}}},Lo={factory:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Po,i=[],o=[],a=[],s=[],u=[];return e===xo?(i.push(Co.uniforms),o.push(wo.basic2_pars_vertex),a.push(wo.basic2_vertex),s.push(wo.basic2_pars_fragment),u.push(wo.basic2_fragment)):e===Ao?(i.push(jo.uniforms),o.push(wo.phong2_pars_vertex),a.push(wo.phong2_vertex),s.push(wo.phong2_pars_fragment),u.push(wo.phong2_fragment)):e===ko?(i.push(Ro.uniforms),o.push(wo.physical2_pars_vertex),a.push(wo.physical2_vertex),s.push(wo.physical2_pars_fragment),u.push(wo.physical2_fragment)):(o.push("varying vec2 textureCoord;"),o.push(p.ShaderChunk.logdepthbuf_pars_vertex),a.push(p.ShaderChunk.begin_vertex),a.push(p.ShaderChunk.project_vertex),a.push("textureCoord = uv;"),a.push(p.ShaderChunk.logdepthbuf_vertex),s.push("uniform sampler2D map;"),s.push("varying vec2 textureCoord;"),s.push(p.ShaderChunk.logdepthbuf_pars_fragment),u.push(p.ShaderChunk.logdepthbuf_fragment),u.push("gl_FragColor = vec4(texture2D(map, textureCoord).xyz, 1.0);")),t===Oo&&(i.push(Eo.uniforms),o.push(wo.crop_pars_vertex),a.push(wo.crop_vertex),s.push(wo.crop_pars_fragment),u.push(wo.crop_fragment)),n===Po&&(i.push(Io.uniforms),s.push(wo.hsbc_pars_fragment),u.push("gl_FragColor = applyHSBEffect(gl_FragColor, hsbc);")),0!==r&&(i.push(Mo.uniforms),o.push(wo.projector_pars_vertex),a.push(wo.projector_vertex),s.push(wo.projector_pars_fragment),u.push("vec4 color = gl_FragColor;"),u.push(wo.projector_fragment),u.push("gl_FragColor = color;")),{uniforms:p.UniformsUtils.merge(i),vertexShader:o.join("\n")+"\nvoid main(){\n"+a.join("\n")+"\n}\n",fragmentShader:s.join("\n")+"\nvoid main(){\n"+u.join("\n")+"\n}\n"}},all:{uniforms:p.UniformsUtils.merge([Eo.uniforms,Mo.uniforms,jo.uniforms,Co.uniforms,Ro.uniforms,Io.uniforms])}},Bo=Lo.factory(0,Oo,0,Po),Uo=Lo.factory(0,0,So,Po),Do=Lo.factory(0,Oo,So,Po),No=Lo.factory(Ao,0,0,Po),zo=Lo.factory(xo,0,0,Po),Fo=Lo.factory(Ao,Oo,So,Po),Vo=Lo.factory(xo,Oo,So,Po),Wo={all:Lo.all,crop:Bo,projector:Uo,visibility:Uo,video:Uo,cropAndVideo:Do,phong2:No,basic2:zo,pcp:Fo,bcp:Vo};function Go(e){return(Go="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ho(e,t){return!t||"object"!==Go(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ko(e){return(Ko=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function qo(e,t){return(qo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Yo=function(e){function t(e){var r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=p.UniformsUtils.merge([{},Wo.phong2.uniforms]);return(r=Ho(this,Ko(t).call(this,{uniforms:n,vertexShader:Wo.phong2.vertexShader,fragmentShader:Wo.phong2.fragmentShader}))).fog=!0,r.lights=!0,r.isMeshPhongMaterial=!0,r.color=new p.Color(16777215),r.specular=new p.Color(1118481),r.shininess=30,r.map=null,r.lightMap=null,r.lightMapIntensity=1,r.aoMap=null,r.aoMapIntensity=1,r.emissive=new p.Color(0),r.emissiveIntensity=1,r.emissiveMap=null,r.bumpMap=null,r.bumpScale=1,r.normalMap=null,r.normalMapType=p.TangentSpaceNormalMap,r.normalScale=new p.Vector2(1,1),r.displacementMap=null,r.displacementScale=1,r.displacementBias=0,r.specularMap=null,r.alphaMap=null,r.envMap=null,r.combine=p.MultiplyOperation,r.reflectivity=1,r.refractionRatio=.98,r.wireframe=!1,r.wireframeLinewidth=1,r.wireframeLinecap="round",r.wireframeLinejoin="round",r.skinning=!1,r.morphTargets=!1,r.morphNormals=!1,r.setValues(e),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&qo(e,t)}(t,p["ShaderMaterial"]),t}();function Xo(e){return(Xo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Zo(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function Qo(e,t){return!t||"object"!==Xo(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Jo(e){return(Jo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function $o(e,t){return($o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ea=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.level,i=r.x,o=r.y,a=Zo(r,["level","x","y"]);!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var s=a.transparent,u=void 0!==s&&s,c=a.opacity,l=a.color,f=a.map,h=a.emissive,p=a.emissiveMap,d=a.specular,v=a.specularMap,y=a.shininess,m=a.flatShading,g=void 0!==m&&m;return(e=Qo(this,Jo(t).call(this,ir({transparent:u,opacity:c,color:l,map:f,emissive:h,emissiveMap:p,specular:d,specularMap:v,shininess:y,flatShading:g})))).level=n,e.x=i,e.y=o,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&$o(e,t)}(t,Yo),t}();function ta(e){return(ta="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ra(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function na(e,t){return!t||"object"!==ta(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ia(e,t,r){return(ia="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=oa(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function oa(e){return(oa=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function aa(e,t){return(aa=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var sa=function(e){function t(e,r){var n,i=r.sceneGraphRoot,o=r.name,a=void 0===o?"AltizureProjectTree":o,s=r.eventHandlers,u=r.debug,c=r.altizureApi,l=r.projInfo,f=r.countryName,h=r.showBBox,p=r.priorityRank,d=void 0===p?2:p,v=r.TreeMaterialType,y=void 0===v?dr:v,m=r.NodeMaterialType,g=void 0===m?l.model.isImported?ea:fr:m,b=r.loadWorker;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),c||console.warn("AltizureProjectTree altizureApi undefined.");var _=l.model.tiling.maxLevel,w=l.model.tiling.minLevel;(n=na(this,oa(t).call(this,e,{sceneGraphRoot:i,name:a,eventHandlers:s,debug:u,maxLevel:_,minLevel:w,showBBox:h,priorityRank:d,TreeMaterialType:y,NodeMaterialType:g})))._countryName=f,n._altizureApi=c,n.sharedOptions.maxLevel=_,n.sharedOptions.projInfo=l,n.sharedOptions.dataUrl=n.dataUrl,n.sharedOptions.treeMaterial=n.material,n.sharedOptions.loadWorker=b;var x={parent:null,x:0,y:0,level:0,sharedOptions:n.sharedOptions};return n.root=new n.Node(x),n.numOfNodes++,l.model.isImported&&(n.style.flatShading=!0),n}var r,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&aa(e,t)}(t,nr),r=t,(n=[{key:"destruct",value:function(){var e=!0;return e=ia(oa(t.prototype),"destruct",this).call(this)&&e,this._altizureApi=void 0,this.sharedOptions=void 0,e}},{key:"updateVisibility",value:function(){return ia(oa(t.prototype),"updateVisibility",this).call(this)}},{key:"altizureApi",get:function(){return this._altizureApi}},{key:"projInfo",get:function(){return this.sharedOptions.projInfo}},{key:"countryName",get:function(){return this._countryName}},{key:"basepath",get:function(){return this.projInfo.storage.basePath}},{key:"dataUrl",get:function(){var e=this.basepath;e&&e.length>0&&"/"===e[0]&&(console.warn("unusual url",e),e="https://www.altizure.com"+e);var t=e+"/web/";return Object.defineProperty(this,"dataUrl",{value:t,writable:!1,configurable:!0}),this.dataUrl}}])&&ra(r.prototype,n),i&&ra(r,i),t}();function ua(e){return(ua="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ca(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function la(e,t){return!t||"object"!==ua(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function fa(e,t,r){return(fa="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ha(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function ha(e){return(ha=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function pa(e,t){return(pa=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var da=function(e){function t(e){var r,n=e.key,i=e.value,o=e.weight,a=void 0===o?100:o,s=e.is404,u=void 0!==s&&s,c=e.gpuUsage,l=void 0===c?4096:c,f=e.ramUsage;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=la(this,ha(t).call(this,{key:n,value:i,weight:a,gpuUsage:l,ramUsage:f})))._is404=u,r}var r,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&pa(e,t)}(t,Nn),r=t,(n=[{key:"destruct",value:function(){return!!this.is404||(this._value.geometry.dispose(),this._value.material&&(xn(this._value.material),this._value.material=null),fa(ha(t.prototype),"destruct",this).call(this))}},{key:"valid",get:function(){return this.is404||this._value&&this._value.geometry}},{key:"is404",get:function(){return this._is404}}])&&ca(r.prototype,n),i&&ca(r,i),t}(),va={position:3,uv:2,color:3,normal:3};function ya(e){return(ya="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ma(e,t,r){return(ma=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var i=new(Function.bind.apply(e,n));return r&&Oa(i,r.prototype),i}).apply(null,arguments)}function ga(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function ba(e,t,r,n,i,o,a){try{var s=e[o](a),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,i)}function _a(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){var o=e.apply(t,r);function a(e){ba(o,n,i,a,s,"next",e)}function s(e){ba(o,n,i,a,s,"throw",e)}a(void 0)})}}function wa(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function xa(e,t){return!t||"object"!==ya(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Aa(e,t,r){return(Aa="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ka(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function ka(e){return(ka=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Oa(e,t){return(Oa=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Sa=function(e){function t(e){var r,n=e.parent,i=e.x,o=e.y,a=e.level,s=e.sharedOptions;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=xa(this,ka(t).call(this,{parent:n,x:i,y:o,level:a,sharedOptions:s}))).name=a+"_"+r.xId+"_"+r.yId,r._bbox=null,r._estimatedBBox=null,r.style={map:void 0,color:16777215},r.contentLoaded.then(function(){}),r}var r,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Oa(e,t)}(t,Un),r=t,(n=[{key:"destruct",value:function(){var e=Aa(ka(t.prototype),"destruct",this).call(this);return this.style=void 0,e}},{key:"downloading",value:function(){var e=_a(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._downloadAndDecode());case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"cook",value:function(){var e=_a(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._cookDownload(t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"defaultCooked",value:function(){var e=_a(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new da({key:this.resourceKey,value:{isPlaceHolder:!0},weight:1,gpuUsage:10,is404:this.is404}),e.abrupt("return",Promise.resolve(t));case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"digest",value:function(e){if(this.gpuUsage=e.gpuUsage,e.is404)return this.is404=e.is404,new p.Object3D;var t;this.geometry=e.value.geometry,this.style=e.value.material,this.geometry.index&&this.geometry.index.count>0?t=new p.Mesh(this.geometry,this.material):(this.geometry.index=null,t=new p.Points(this.geometry,this.material));var r=mr(this.geometry.attributes.position.array),n=r.max,i=r.min;return this.rangeHeight=new p.Vector2(i[2],n[2]),this.boundingBox=new p.Box3(ma(p.Vector3,ga(i)),ma(p.Vector3,ga(n))),t}},{key:"_prefetch",value:function(e){return function e(t,r){return 0!==r&&(t.isRoot||!t.parent.is404&&t.parent.loaded||e(t.parent,r--))}(this,e)}},{key:"_computeEstimatedBBox",value:function(){var e=this.projInfo.model.tiling,t=(e.maxBound.x-e.minBound.x)/e.xTiles,r=(e.maxBound.y-e.minBound.y)/e.yTiles,n=e.minBound.x+t*this.xId,i=e.minBound.x+t*(this.xId+this.levelBlockSize),o=e.minBound.y+r*this.yId,a=e.minBound.y+r*(this.yId+this.levelBlockSize),s=e.minBound.z,u=e.maxBound.z,c=new p.Box3(new p.Vector3(n,o,s),new p.Vector3(i,a,u)),l=(new p.Matrix4).makeBasis(e.xDir.clone().normalize(),e.yDir.clone().normalize(),e.zDir.clone().normalize()).setPosition(e.origin.clone());c.applyMatrix4(l);var f=this.estimatedRangeHeight;return f.x>c.min.z&&c.min.setZ(f.x),f.y<c.max.z&&c.max.setZ(f.y),c}},{key:"updateMaterial",value:function(){if(this.is404)return!0;if(this.loaded){var e=this._material;this._material=null,this.content.material=this.material,wn(e)}return!0}},{key:"_downloadAndDecode",value:function(){return this.loadWorker.load({resourceKey:this.resourceKey,timeout:3e4})}},{key:"_cookDownload",value:function(e){var t=this,r=e.geometry,n=e.images,i=e.materials,o=(e.bbox,[]),a={};for(var s in i)a[s]=o.length,i[s].name=s,o.push(i[s]);i=void 0,o=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"standard";return e instanceof Array?e.map(function(e){return gn(e,t)}):gn(e,t)}(o,"phong");var u=new p.BufferGeometry;for(var c in r.attributes)u.addAttribute(c,new p.BufferAttribute(r.attributes[c],va[c])),r.attributes[c]=void 0;return r.attributes=void 0,r.index&&(u.setIndex(new p.BufferAttribute(r.index,1)),r.index=void 0),r.groups.forEach(function(e){u.addGroup(e.start,e.count,a[e.materialName])}),r.groups=void 0,$n(n).then(function(e){n=void 0;var r=0;o.forEach(function(t){t.map&&(t.map=e[t.map],1022!==t.map.format&&console.warn("unknown texture format",t.map.format),r+=t.map.image.width*t.map.image.height);t.emissiveMap&&(t.emissiveMap=e[t.emissiveMap]),t.specularMap&&(t.specularMap=e[t.specularMap])});var i=4*(u.attributes.position?u.attributes.position.array.length:0)+4*(u.attributes.normal?u.attributes.normal.array.length:0)+4*(u.attributes.color?u.attributes.color.array.length:0)+4*(u.attributes.uv?u.attributes.uv.array.length:0)+4*(u.index?u.index.array.length:0)+4*r;"PTLOD"===t.modelType&&(i*=4);var a={geometry:u,material:o,matrix:(new p.Matrix4).identity()},s={key:t.resourceKey,value:a,weight:1,gpuUsage:i};return Promise.resolve(new da(s))})}},{key:"resourceKey",get:function(){var e=this.dataUrl+this.encryptName+".ab";return Object.defineProperty(this,"resourceKey",{value:e,writable:!1,configurable:!0}),this.resourceKey}},{key:"expandable",get:function(){return Aa(ka(t.prototype),"expandable",this)&&this.level<this.maxDisplayLevel&&this._prefetch(2)}},{key:"estimationCoefficient",get:function(){return 1.1}},{key:"rangeHeight",get:function(){return this._rangeHeight},set:function(e){!e||isNaN(e.x)||isNaN(e.y)?console.warn("Invalid rangeHeight",e):this._rangeHeight=(new p.Vector2).copy(e)}},{key:"estimatedRangeHeight",get:function(){if(this.rangeHeight)return this.rangeHeight;var e,t,r,n,i,o=this;return this.isRoot?(e=o.projInfo.model.tiling,t=e.zDir.clone().multiplyScalar(e.minBound.z).add(e.origin).z,r=e.zDir.clone().multiplyScalar(e.maxBound.z).add(e.origin).z,n=Math.min(t,r),i=Math.max(t,r),new p.Vector2(n,i)):this.parent.estimatedRangeHeight}},{key:"maxLevel",get:function(){return this.sharedOptions.maxLevel}},{key:"projInfo",get:function(){return this.sharedOptions.projInfo}},{key:"maxDisplayLevel",get:function(){return this.sharedOptions.projInfo.model.tiling.maxDisplayLevel}},{key:"modelType",get:function(){return this.sharedOptions&&this.projInfo&&this.projInfo.model.modelType?this.projInfo.model.modelType:"MESHLOD"}},{key:"loadWorker",get:function(){return this.sharedOptions.loadWorker}},{key:"dataUrl",get:function(){return this.sharedOptions.dataUrl}},{key:"levelBlockSize",get:function(){return Object.defineProperty(this,"levelBlockSize",{value:Math.pow(2,this.maxLevel-this.level),writable:!1,configurable:!0}),this.levelBlockSize}},{key:"xId",get:function(){return Object.defineProperty(this,"xId",{value:this.x*this.levelBlockSize,writable:!1,configurable:!0}),this.xId}},{key:"yId",get:function(){return Object.defineProperty(this,"yId",{value:this.y*this.levelBlockSize,writable:!1,configurable:!0}),this.yId}},{key:"versionControl",get:function(){return this.projInfo.storage.versionControl}},{key:"encryptName",get:function(){var e=this.versionControl,t=S()(this.name+e).toString(T.a);return Object.defineProperty(this,"encryptName",{value:t,writable:!1,configurable:!0}),this.encryptName}},{key:"material",get:function(){var e=this;if(!this._material)if(this.style instanceof Array){this._material=[];var t=this.style,r={},n=this;t.forEach(function(t){var i={style:t,tree:{style:r},geometry:n.geometry},o=e.sharedOptions.treeMaterial.generateTileMaterial(i);o.needsUpdate=!0,e._material.push(o)})}else this._material=this.sharedOptions.treeMaterial.generateTileMaterial(this),this._material.needsUpdate=!0;return this._material}}])&&wa(r.prototype,n),i&&wa(r,i),t}();Sa.stat={download:{time:0,count:0},processing:{time:0,count:0},cook:{time:0,count:0}};var Pa=Sa;var Ta=function e(t,r,n,i,o,a,s,u,c){var l,f,h;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.version=t,this.id=r,this.name=n,this.owner=i,this.views=o,this.date=a,this.storage=s,this.model=u,this.render=c,h=!1,(f="valid")in(l=this)?Object.defineProperty(l,f,{value:h,enumerable:!0,configurable:!0,writable:!0}):l[f]=h,this.valid=!0};function Ea(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Ma=function(){function e(t,r){var n,i,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.versionControl=t,this.cloudPath=r,o=void 0,(i="basePath")in(n=this)?Object.defineProperty(n,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[i]=o;var a=N.countryName;this.preferServer(a)}var t,r,n;return t=e,(r=[{key:"preferServer",value:function(e){var t=[];"China"===e?(t[0]="oss_sz",t[1]="s3",t[2]="oss_usw",t[3]="local"):(t[0]="s3",t[1]="oss_usw",t[2]="oss_sz",t[3]="local");for(var r,n=this.cloudPath,i=0;i<t.length;i++){for(var o=0;o<n.length;o++)if(n[o].key===t[i]){r=n[o].dataUrl;break}if(r)break}return r?this.basePath=r:console.error("preferredPath error",n,t),this}}])&&Ea(t.prototype,r),n&&Ea(t,n),e}();function ja(e){return(ja="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ca(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ra(e,t){return!t||"object"!==ja(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ia(e){return(Ia=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function La(e,t){return(La=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ba(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ua(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Da=function e(t,r,n,i,o,a,s){Ba(this,e),this.mercatorTransform=t,Ua(this,"min",void 0),Ua(this,"max",void 0),Ua(this,"position",void 0),this.position={lng:n,lat:r,alt:0},this.min={lng:o,lat:i},this.max={lng:s,lat:a}},Na=function(e){function t(e,r,n,i,o,a,s,u){var c;Ba(this,t),(c=Ra(this,Ia(t).call(this,r,n,i,o,a,s,u))).srs=e;var l=c.srsParserENU();return l&&(c.position=l),c}var r,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&La(e,t)}(t,Da),r=t,(n=[{key:"srsParserENU",value:function(){var e=this.srs;if("ENU:"===e.substring(0,4)){var t,r=e.indexOf(":")+1,n=e.indexOf(","),i=e.substring(r,n),o=n+1,a=e.indexOf(",",o),s="0";-1===a?t=e.substring(o):(t=e.substring(o,a),s=e.substring(a+1)),console.log(i,t,s);var u={lng:Number(t),lat:Number(i),alt:Number(s)};if(!isNaN(u.lat)&&!isNaN(u.lng))return u;console.error("wrong srs",e)}console.error("unknown srs",e)}}])&&Ca(r.prototype,n),i&&Ca(r,i),t}();function za(e){return(za="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Fa(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Va(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Wa(e,t,r){return t&&Va(e.prototype,t),r&&Va(e,r),e}function Ga(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Ha=function(){function e(t,r,n,i,o){Fa(this,e),this.modelType=t,this.isImported=r,this.tiling=n,this.gis=i,this.onLoadTrans=o,Ga(this,"objToModel",void 0),Ga(this,"modelToObj",void 0),Ga(this,"orthoInfo",void 0),Ga(this,"objToOldDisplay",void 0);var a=this.tiling.origin.clone();this.objToOldDisplay=this._objToOldDisplay(this.onLoadTrans,a),this.orthoInfo=this._orthoInfo(this.objToOldDisplay.clone()),this.objToModel=this._objToDisplay(this.objToOldDisplay.clone(),a),this.modelToObj=(new p.Matrix4).getInverse(this.objToModel)}return Wa(e,[{key:"_objToDisplay",value:function(e,t){var r=(new p.Euler).setFromRotationMatrix(e);return r.x-=1.5*Math.PI,(new p.Matrix4).multiply((new p.Matrix4).makeRotationFromEuler(r)).multiply((new p.Matrix4).makeTranslation(-t.x,-t.y,-t.z))}},{key:"_objToOldDisplay",value:function(e,t){var r=function(e){var t=new p.Matrix4;e instanceof Array?3===e.length?t.makeRotationX(Math.PI*e[0]).multiply((new p.Matrix4).makeRotationY(Math.PI*e[1])).multiply((new p.Matrix4).makeRotationZ(Math.PI*e[2])):16===e.length?t.set.apply(t,e):console.error("AltizureProjectInfo unrecognized onLoadTrans",e):"object"===za(e)&&void 0!==e.x&&void 0!==e.y&&void 0!==e.z&&t.makeRotationX(Math.PI*e.x).multiply((new p.Matrix4).makeRotationY(Math.PI*e.y)).multiply((new p.Matrix4).makeRotationZ(Math.PI*e.z));return t}(e),n=(new p.Matrix4).makeTranslation(-t.x,-t.y,-t.z);return r=r.multiply(n)}},{key:"_orthoInfo",value:function(e){var t=function(t){var r=t.minBound,i=t.maxBound,o=t.origin,a=t.xDir,s=t.yDir,u=t.zDir,c=new Array(8);c[0]=r.clone(),c[1]=new p.Vector3(r.x,i.y,r.z),c[2]=new p.Vector3(i.x,r.y,r.z),c[3]=new p.Vector3(i.x,i.y,r.z);for(var l=0;l<4;++l)c[l+4]=c[l].clone().setZ(i.z);for(var f=new Array(2),h=0;h<8;++h){var d=n(o,a,s,u,c[h]);d.applyMatrix4(e),0===h?(f[0]=d.clone(),f[1]=d.clone()):(f[0].x=Math.min(f[0].x,d.x),f[0].y=Math.min(f[0].y,d.y),f[0].z=Math.min(f[0].z,d.z),f[1].x=Math.max(f[1].x,d.x),f[1].y=Math.max(f[1].y,d.y),f[1].z=Math.max(f[1].z,d.z))}return f}(this.tiling),r=(new p.Matrix4).extractRotation(e).transpose();return{origin:this.tiling.origin.clone(),xDir:new p.Vector3(1,0,0).applyMatrix4(r),yDir:new p.Vector3(0,1,0).applyMatrix4(r),zDir:new p.Vector3(0,0,1).applyMatrix4(r),minBound:t[0],maxBound:t[1],width:t[1].x-t[0].x,height:t[1].z-t[0].z,area:(t[1].x-t[0].x)*(t[1].z-t[0].z)};function n(e,t,r,n,i){var o=t.clone().multiplyScalar(i.x),a=r.clone().multiplyScalar(i.y),s=n.clone().multiplyScalar(i.z);return e.clone().add(o).add(a).add(s)}}}]),e}(),Ka=function e(t,r,n,i,o){Fa(this,e),this.modelType=t,this.isImported=r,this.tiling=n,this.gis=i,this.model_transform=o,Ga(this,"objToModel",void 0),Ga(this,"modelToObj",void 0),Ga(this,"orthoInfo",void 0),this.objToModel=o.clone(),this.modelToObj=(new p.Matrix4).getInverse(o),this.orthoInfo={origin:this.tiling.origin.clone(),xDir:new p.Vector3(1,0,0).applyMatrix4(this.objToModel),yDir:new p.Vector3(0,1,0).applyMatrix4(this.objToModel),zDir:new p.Vector3(0,0,1).applyMatrix4(this.objToModel),minBound:this.tiling.minBound,maxBound:this.tiling.maxBound}},qa=function(){function e(t,r,n,i,o,a,s,u,c){Fa(this,e),this.xTiles=t,this.yTiles=r,this.zTiles=n,this.origin=i,this.xDir=o,this.yDir=a,this.zDir=s,this.maxBound=u,this.minBound=c,Ga(this,"maxLevel",void 0),Ga(this,"minLevel",void 0),Ga(this,"maxDisplayLevel",void 0),Ga(this,"minDisplayLevel",void 0),this.minLevel=0,this.maxLevel=this.getMaxLevel(this.xTiles,this.yTiles),this.minDisplayLevel=this.minLevel,this.maxDisplayLevel=this.maxLevel}return Wa(e,[{key:"getMaxLevel",value:function(e,t){for(var r=Math.max(e,t),n=0;r>1;)r/=2,n++;return n}}]),e}();var Ya=function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.annotations=t,this.initialCamPos=r};function Xa(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Za=function(){function e(t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.major=t,this.minor=r,this.patch=n}var t,r,n;return t=e,(r=[{key:"compatibleWith",value:function(e){return this.major===e.major&&!(this.minor<e.minor)}}])&&Xa(t.prototype,r),n&&Xa(t,n),e}();function Qa(e){var t=e.split(".").map(function(t){var r=Number(t);if(isNaN(r))throw console.error("Invalid Version",e),Error("Invalid Version");return r});return new Za(t[0],t[1],t[2])}function Ja(e,t,r,n,i,o,a){try{var s=e[o](a),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,i)}function $a(e){return es.apply(this,arguments)}function es(){var e;return e=regeneratorRuntime.mark(function e(t){var r,n=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.length>1&&void 0!==n[1]?n[1]:3e4,e.abrupt("return",_()({method:"get",url:t,timeout:r,responseType:"json"}).then(function(e){if(e.data.spec_version){var t=e.data,r=t.spec_version,n=t.model_transform,i=t.srs,o={specVersion:r,objToModel:(new p.Matrix4).set(n[0][0],n[0][1],n[0][2],n[0][3],n[1][0],n[1][1],n[1][2],n[1][3],n[2][0],n[2][1],n[2][2],n[2][3],n[3][0],n[3][1],n[3][2],n[3][3]),srs:i};return Promise.resolve(o)}return Promise.resolve(void 0)}).catch(function(e){return console.warn(e),Promise.resolve(void 0)}));case 2:case"end":return e.stop()}},e)}),(es=function(){var t=this,r=arguments;return new Promise(function(n,i){var o=e.apply(t,r);function a(e){Ja(o,n,i,a,s,"next",e)}function s(e){Ja(o,n,i,a,s,"throw",e)}a(void 0)})}).apply(this,arguments)}function ts(e,t,r,n,i,o,a){try{var s=e[o](a),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,i)}function rs(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){var o=e.apply(t,r);function a(e){ts(o,n,i,a,s,"next",e)}function s(e){ts(o,n,i,a,s,"throw",e)}a(void 0)})}}function ns(e){return e instanceof Array&&3===e.length?new p.Vector3(e[0],e[1],e[2]):e&&e.x&&e.y&&e.z?new p.Vector3(e.x,e.y,e.z):void console.error("objToVec3 invalid obj",e)}function is(e,t){return os.apply(this,arguments)}function os(){return(os=rs(regeneratorRuntime.mark(function e(t,r){var n,i,o,a,s,u,c,l,f,h,p,d,v,y,m,g,b,_,w,x,A,k,O,S,P,T,E,M,j,C,R,I,L,B,U,D,N,z,F,V,W,G,H;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.project({pid:r});case 2:return n=e.sent,i=n.id,o=n.name,a=n.owner,s=n.isImported,u=n.modelType,c=n.views,l=n.date,f=n.versionControl,h=n.cloudPath,p=n.geoInfo,d=n.annotations,v=n.modelTransform,"string"!=typeof f&&(f=""),y=p.mercatorTransform,m=p.minLat,g=p.minLong,b=p.maxLat,_=p.maxLong,w=p.centerLat,x=p.centerLong,A=v.origin,k=v.xDir,O=v.yDir,S=v.zDir,P=v.minBound,T=v.maxBound,E=v.xTiles,M=v.yTiles,j=v.zTiles,C=v.onLoadTrans,R=v.initialCamPos,I=new Ma(f,h),L=new Ya(d,R),B=new qa(E,M,j,ns(A),ns(k),ns(O),ns(S),ns(T),ns(P)),N=I.basePath,e.next=13,$a(N+"/web/info.txt");case 13:return(z=e.sent)?(V=z.specVersion,W=z.srs,G=z.objToModel,F=Qa(V),D=new Na(W,y,w,x,m,g,b,_),U=new Ka(u,s,B,D,G)):(F=new Za(0,0,0),D=new Da(y,w,x,m,g,b,_),U=new Ha(u,s,B,D,C)),H=new Ta(F,i,o,a,c,l,I,U,L),e.abrupt("return",Promise.resolve(H));case 17:case"end":return e.stop()}},e)}))).apply(this,arguments)}function as(e){return ss.apply(this,arguments)}function ss(){return(ss=rs(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new M({apiUrl:"https://api.altizure.com/graphql",key:"7MkQf8UggsPaadvrlKALspJWZejZAJOLHn3cnIy"}),e.abrupt("return",is(r,t));case 2:case"end":return e.stop()}},e)}))).apply(this,arguments)}function us(e){return(us="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function cs(e,t,r,n,i,o,a){try{var s=e[o](a),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,i)}function ls(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function fs(e,t){return!t||"object"!==us(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function hs(e,t,r){return(hs="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ps(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function ps(e){return(ps=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ds(e,t){return(ds=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var vs=function(e){function t(e,r){var n,i=r.name,o=r.forest,a=r.altizureApi,s=r.countryName,u=r.loadWorker,c=r.onTileDownloaded,l=r.pid,f=r.showBBox,h=r.position,p=void 0===h?{lng:114,lat:22.25,alt:0}:h;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=fs(this,ps(t).call(this,e,{name:i,forest:o,showBBox:f,position:p})))._altizureApi=a,n._countryName=s,n._loadWorker=u,n.onTileDownloaded=c,n._pid=l,n._projInfo={},n}var r,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ds(e,t)}(t,_o),r=t,(n=[{key:"destruct",value:function(){var e=!0;return this._tree&&(this._forest.remove(this._tree),e=this.tree.destruct()&&e,this._tree=void 0),hs(ps(t.prototype),"destruct",this).call(this)&&e}},{key:"import",value:function(){var e,t=(e=regeneratorRuntime.mark(function e(t){var r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this,n=t){e.next=7;break}return e.next=5,is(this.altizureApi,this.pid);case 5:n=e.sent,console.log(n);case 7:return r._projInfo=n,r.name=r._projInfo.name,e.abrupt("return",r._createTree(r._projInfo));case 10:case"end":return e.stop()}},e,this)}),function(){var t=this,r=arguments;return new Promise(function(n,i){var o=e.apply(t,r);function a(e){cs(o,n,i,a,s,"next",e)}function s(e){cs(o,n,i,a,s,"throw",e)}a(void 0)})});return function(e){return t.apply(this,arguments)}}()},{key:"_createTree",value:function(e){var t=this;if(!e||!e.valid)return Promise.reject(new Error("Invalid projInfo."));var r=this,n=this._treeNode,i=e.name,o=this.altizureApi,a=this._countryName,s=this.showBBox;return new Promise(function(u,c){r._tree=new sa(Pa,{sceneGraphRoot:n,name:i,eventHandlers:{onTileDownloaded:r.onTileDownloaded,onContentInitialized:function(){console.log(i+"initialized.",r),u(r)}},debug:!1,altizureApi:o,projInfo:e,countryName:a,showBBox:s,loadWorker:r._loadWorker}),r._tree.visible=r.visible,t._forest.add(r._tree)})}},{key:"altizureApi",get:function(){return this._altizureApi}},{key:"pid",get:function(){return this._pid}},{key:"projInfo",get:function(){return this._projInfo}}])&&ls(r.prototype,n),i&&ls(r,i),t}(),ys=r(5),ms=r.n(ys);function gs(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var bs=function(){function e(){var t=this,r=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).workerSize,n=void 0===r?2:r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.workerSize=n,this.listeners=new Map,this.workers=[],this.jobs=[];for(var i=function(e){t.workers.push(new ms.a),t.jobs.push(0),t.workers[e].onmessage=function(r){var n=r.data.resourceKey,i=r.data.status,o=r.data.payload;if(t.listeners.has(n)){var a=t.listeners.get(n);t.listeners.delete(n),a.forEach(function(e){var t=e.resolve,r=e.reject;200===i?t(o):r(o)})}else console.error("AltizureLoader",n);t.jobs[e]--},t.workers[e].onerror=function(e){console.error("AltizureLoader",e)}},o=0;o<this.workerSize;o++)i(o)}var t,r,n;return t=e,(r=[{key:"destruct",value:function(){return this.listeners.clear(),this.terminate()}},{key:"terminate",value:function(){var e=!0;if(this.workers&&this.workers.length>0)try{e=this.workers.reduce(function(e,t){return t.terminate()&&e},!0),this.workers=[],this.jobs=[]}catch(e){return console.error("AltizureLoader terminate failed",e),!1}return e}},{key:"load",value:function(e){var t=this,r=e.resourceKey,n=e.timeout,i=void 0===n?3e4:n;return new Promise(function(e,n){var o={resolve:e,reject:n};if(t.listeners.has(r)){t.listeners.get(r).push(o)}else{t.listeners.set(r,[o]);var a={resourceKey:r,timeout:i,modelType:"AltizureBinary"},s=t.jobs.reduce(function(e,t,r,n){return t<n[e]?r:e},0);t.jobs[s]++,t.workers[s].postMessage(a)}})}},{key:"numOfTasks",get:function(){return this.listeners.size}}])&&gs(t.prototype,r),n&&gs(t,n),e}();function _s(e){return(_s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ws(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function xs(e,t){return!t||"object"!==_s(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function As(e,t,r){return(As="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ks(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function ks(e){return(ks=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Os(e,t){return(Os=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ss=function(e){function t(e){var r,n=e.key,i=e.value,o=e.weight,a=void 0===o?100:o,s=e.gpuUsage,u=e.ramUsage,c=e.is404,l=void 0!==c&&c;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=xs(this,ks(t).call(this,{key:n,value:i,weight:a,gpuUsage:s,ramUsage:u})))._is404=l,r}var r,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Os(e,t)}(t,Nn),r=t,(n=[{key:"destruct",value:function(){this.is404||(this._value.geometry.dispose(),this._value.material&&(xn(this._value.material),this._value.material=null),this._value.nextLevelParams=null,this._value.subtree=null);return As(ks(t.prototype),"destruct",this).call(this)}},{key:"valid",get:function(){return this.is404||this._value}},{key:"is404",get:function(){return this._is404}}])&&ws(r.prototype,n),i&&ws(r,i),t}(),Ps=r(15),Ts=r.n(Ps);function Es(e){return(Es="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ms(e,t,r){return(Ms=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var i=new(Function.bind.apply(e,n));return r&&Ds(i,r.prototype),i}).apply(null,arguments)}function js(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Cs(e,t,r,n,i,o,a){try{var s=e[o](a),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,i)}function Rs(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){var o=e.apply(t,r);function a(e){Cs(o,n,i,a,s,"next",e)}function s(e){Cs(o,n,i,a,s,"throw",e)}a(void 0)})}}function Is(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ls(e,t){return!t||"object"!==Es(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Bs(e,t,r){return(Bs="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Us(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function Us(e){return(Us=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ds(e,t){return(Ds=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ns(e){return e.children&&0!==e.children.length?e.children.length>1?e:1===e.children.length?Ns(e.children[0]):void 0:e}function zs(e){var t=e.osgGeometry,r=e.groups,n=new p.BufferGeometry;return n.addAttribute("position",new p.BufferAttribute(t.Vertex,3)),n.setIndex(new p.BufferAttribute(t.Indices,1)),n.addAttribute("uv",new p.BufferAttribute(t.TexCoord0,2)),r.length>1&&r.forEach(function(e){n.addGroup(e.start,e.count,e.materialIndex)}),n}function Fs(e,t){return e.length>1?e.map(function(e){return r(e)}):r(e[0]);function r(e){var r=e.map_Kd;return!t[r]&&t[r+".jpg"]&&(r+=".jpg"),{map:t[r],color:16777215}}}var Vs=function(e){function t(e){var r,n=e.parent,i=e.name,o=e.fileDirectory,a=void 0===o?null:o,s=e.fileName,u=e.depth,c=e.estimatedBBox,l=e.subtree,f=void 0===l?null:l,h=e.sharedOptions;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=Ls(this,Us(t).call(this,{parent:n,name:i,sharedOptions:h})))._fileDirectory=a,r.fileName=s,c||console.warn(s," has no estBBox"),r._estimatedBBox=c,r._nextLevelParams=null,r._subtree=f,r.subtree){var d=Ns(r.subtree);d.children&&d.children.length>0?r._nextLevelParams=d.children.map(function(e){e=Ns(e);var t=r.completeUrl(e.url).fileName;return{fileDirectory:a,fileName:t,subtree:e,estimatedBBox:new p.Box3((new p.Vector3).copy(e.bbox.minBound),(new p.Vector3).copy(e.bbox.maxBound))}}):r._nextLevelParams=[]}else r.isRoot||console.warn("No OSG meta");return r._depth=u,r.style={map:void 0,color:16777215},r.contentLoaded.then(function(){}),r}var r,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ds(e,t)}(t,Mn),r=t,(n=[{key:"destruct",value:function(){var e=Bs(Us(t.prototype),"destruct",this).call(this);return this._subtree=void 0,this._nextLevelParams=void 0,e}},{key:"downloading",value:function(){var e=Rs(regeneratorRuntime.mark(function e(){var t,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.debug&&console.log("download"),t=this.resourceKey,r=this.TILE_DOWNLOAD_TIMEOUT,e.abrupt("return",this.loadWorker.load({resourceKey:t,timeout:r}));case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"cook",value:function(){var e=Rs(regeneratorRuntime.mark(function e(t){var r,n,i,o,a,s,u,c,l,f,h,d,v,y,m,g,b,_,w=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(l in r=0,n=t.osgGeometry,i=t.groups,o=t.materials,a=t.meta,s=t.images,u=t.bbox,c=0,s)c+=2*s[l].length;return f=zs({osgGeometry:n,groups:i}),e.next=12,$n(s);case 12:return h=e.sent,d=Fs(o,h),v=gr(f),y=An(d),r+=v+y,c+=v,m=new p.Box3(Ms(p.Vector3,js(u.min)),Ms(p.Vector3,js(u.max))),g=t.nextLevelParams.map(function(e){var t=w.completeUrl(e.fileName);return{fileDirectory:t.fileDirectory,fileName:t.fileName,estimatedBBox:new p.Box3(Ms(p.Vector3,js(e.estimatedBBox.min)),Ms(p.Vector3,js(e.estimatedBBox.max)))}}),b=null,a&&(b=a.tree.root),_={key:this.resourceKey,value:{geometry:f,material:d,nextLevelParams:g,subtree:b,bbox:m},weight:1,gpuUsage:r,ramUsage:c},e.abrupt("return",Promise.resolve(new Ss(_)));case 24:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"defaultCooked",value:function(){var e=Rs(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Ss({key:this.resourceKey,value:{isPlaceHolder:!0},weight:1,gpuUsage:10,ramUsage:1024,is404:this.is404}),e.abrupt("return",Promise.resolve(t));case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"digest",value:function(e){var t=this;if(this.gpuUsage=e.gpuUsage,e.is404)return this.is404=e.is404,new p.Object3D;if(this.geometry=e.value.geometry,this.style=e.value.material,this.boundingBox=e.value.bbox,e.value.subtree){this._subtree=e.value.subtree;var r=Ns(this.subtree);this._nextLevelParams=r.children.map(function(e){var r=Ns(e);r.children&&0!==r.children.length||(e=r);var n=t.completeUrl(e.url);return{fileDirectory:n.fileDirectory,fileName:n.fileName,subtree:e,estimatedBBox:new p.Box3((new p.Vector3).copy(e.bbox.minBound),(new p.Vector3).copy(e.bbox.maxBound))}})}else this._nextLevelParams||(this._nextLevelParams=e.value.nextLevelParams);return new p.Mesh(this.geometry,this.material)}},{key:"_computeEstimatedBBox",value:function(){return this._estimatedBBox}},{key:"spawn",value:function(){var e=this,r=this.depth+1;return this._nextLevelParams.forEach(function(n,i){var o={parent:e,name:n.fileName,fileDirectory:n.fileDirectory,fileName:n.fileName,depth:r,estimatedBBox:n.estimatedBBox,subtree:n.subtree,sharedOptions:e.sharedOptions};e.nodes[i]=new t(o)}),!0}},{key:"completeUrl",value:function(e){var t=this.resourceDirectory,r=Ts()(e),n=r.match(/(.*)[\/\\]/);return{fileDirectory:n?t+n[0]:t,fileName:r.replace(/^.*[\\\/]/,"")}}},{key:"updateMaterial",value:function(){if(this.is404)return!0;if(this.loaded){var e=this._material;this._material=null,this.content.material=this.material,wn(e)}return!0}},{key:"resourceKey",get:function(){var e;if(window.ActiveXObject||"ActiveXObject"in window){e=(this.resourceDirectory+this.fileName).split("/").reduce(function(e,t,r){return e+(0===r?encodeURIComponent(t):r<3||t.length>0&&"."!==t?"/"+encodeURIComponent(t):"")})}else{var t=new URL(this.resourceDirectory+this.fileName);e=t.origin+t.pathname.split("/").reduce(function(e,t){return e+(t.length>0?"/"+encodeURIComponent(t):"")},"")}return e}},{key:"resourceDirectory",get:function(){return this._fileDirectory?this._fileDirectory:this.sharedOptions.dataUrl}},{key:"tileName",get:function(){var e=this.fileName;return e=e.replace(/\.[^\/.]+$/,"")}},{key:"expandable",get:function(){return Bs(Us(t.prototype),"expandable",this)&&this.loaded&&null!==this._nextLevelParams&&this._nextLevelParams.length>0}},{key:"estimationCoefficient",get:function(){return 8}},{key:"maxGpuUsage",get:function(){return 17240734}},{key:"depth",get:function(){return this._depth}},{key:"level",get:function(){return this.depth}},{key:"spec",get:function(){return this.sharedOptions.spec}},{key:"debug",get:function(){return this.sharedOptions.debug}},{key:"TILE_DOWNLOAD_TIMEOUT",get:function(){return this.sharedOptions.TILE_DOWNLOAD_TIMEOUT}},{key:"loadWorker",get:function(){return this.sharedOptions.loadWorker}},{key:"subtree",get:function(){return this._subtree}},{key:"material",get:function(){var e=this;if(!this._material)if(this.style instanceof Array){this._material=[];var t=this.style,r={},n=this;t.forEach(function(t){var i={style:t,tree:{style:r},geometry:n.geometry},o=e.sharedOptions.treeMaterial.generateTileMaterial(i);o.needsUpdate=!0,e._material.push(o)})}else this._material=this.sharedOptions.treeMaterial.generateTileMaterial(this),this._material.needsUpdate=!0;return this._material}}])&&Is(r.prototype,n),i&&Is(r,i),t}();function Ws(e){return(Ws="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Gs(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Hs(e,t){return!t||"object"!==Ws(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ks(e,t,r){return(Ks="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=qs(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function qs(e){return(qs=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ys(e,t){return(Ys=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Xs=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Vs,n=arguments.length>1?arguments[1]:void 0,i=n.name,o=n.sceneGraphRoot,a=n.eventHandlers,s=n.maxLevel,u=void 0===s?24:s,c=n.minLevel,l=n.priorityRank,f=void 0===l?2:l,h=n.showBBox,d=n.debug,v=n.altizureApi,y=n.spec,m=n.projInfo,g=n.TreeMaterialType,b=void 0===g?dr:g,_=n.NodeMaterialType,w=void 0===_?fr:_,x=n.loadWorker;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),y=y||m,(e=Hs(this,qs(t).call(this,r,{name:i,sceneGraphRoot:o,eventHandlers:a,maxLevel:u,minLevel:c,priorityRank:f,showBBox:h,TreeMaterialType:b,NodeMaterialType:w,debug:d}))).spec=y,e._altizureApi=v,e.sharedOptions.spec=y,e.sharedOptions.TILE_DOWNLOAD_TIMEOUT=3e4,e.sharedOptions.loadWorker=x,e.sharedOptions.dataUrl=e.dataUrl,e.sharedOptions.treeMaterial=e.material;var A=new p.Box3(y.modelTransform.bbox.min,y.modelTransform.bbox.max),k={parent:null,name:"root",fileName:"root.ab",sharedOptions:e.sharedOptions,depth:0,estimatedBBox:A};return e.root=new e.Node(k),e}var r,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ys(e,t)}(t,Yt),r=t,(n=[{key:"destruct",value:function(){var e=!0;return e=Ks(qs(t.prototype),"destruct",this).call(this)&&e,this._altizureApi=void 0,this.spec=void 0,this.sharedOptions.spec=void 0,this.sharedOptions=void 0,e}},{key:"expand",value:function(e){return e.level>this.maxLevel?(console.warn("exceed max level",e.level,this.maxLevel),!1):e.nodes.length>0?(console.warn(e,"children exist"),!1):0!==e.nodes.length||e.spawn()}},{key:"basepath",get:function(){var e=[];"China"===this.countryName?(e[0]="oss_sz",e[1]="s3",e[2]="oss_usw",e[3]="local"):(e[0]="s3",e[1]="oss_usw",e[2]="oss_sz",e[3]="local");for(var t,r=e,n=this.spec.cloudPath,i=0;i<r.length;i++){for(var o=0;o<n.length;o++)if(n[o].key===r[i]){t=n[o].dataUrl;break}if(t)break}return t||console.error("preferredPath error",this.name,n,r),Object.defineProperty(this,"basepath",{value:t,writable:!1,configurable:!0}),this.basepath}},{key:"dataUrl",get:function(){var e=this.basepath+"/web/";return Object.defineProperty(this,"dataUrl",{value:e,writable:!1,configurable:!0}),this.dataUrl}},{key:"projInfo",get:function(){return this.spec}},{key:"altizureApi",get:function(){return this._altizureApi}}])&&Gs(r.prototype,n),i&&Gs(r,i),t}();function Zs(e){return(Zs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Qs(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Js(e,t){return!t||"object"!==Zs(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function $s(e,t,r){return($s="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=eu(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function eu(e){return(eu=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function tu(e,t){return(tu=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ru=function(e){function t(e,r){var n,i=r.name,o=r.forest,a=r.position,s=void 0===a?{lng:114,lat:22.25}:a,u=r.showBBox,c=r.spec,l=r.loadWorker,f=r.onTileDownloaded;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=Js(this,eu(t).call(this,e,{name:i,forest:o,position:s,showBBox:u}))).spec=c,n.loadWorker=l,n.onTileDownloaded=f;var h=c.modelTransform,p=h.position,d=h.quaternion,v=h.scale;return n.displayHolder.position.copy(p),n.displayHolder.quaternion.copy(d),n.displayHolder.scale.copy(v),n.displayHolder.updateMatrix(),n}var r,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&tu(e,t)}(t,_o),r=t,(n=[{key:"destruct",value:function(){var e=!0;return this._tree&&(this._forest.remove(this._tree),e=this.tree.destruct()&&e,this._tree=void 0),$s(eu(t.prototype),"destruct",this).call(this)&&e}},{key:"import",value:function(){var e=this.spec;return this._createTree(e)}},{key:"_createTree",value:function(e){if(!e||!e.valid)return Promise.reject(new Error("Invalid spec."));var t=this._treeNode,r=e.name,n=e.maxLevel,i=e.minLevel,o=this.showBBox,a={onTileDownloaded:this.onTileDownloaded};return this._tree=new Xs(Vs,{name:r,sceneGraphRoot:t,maxLevel:n,minLevel:i,showBBox:o,debug:!1,eventHandlers:a,spec:e,loadWorker:this.loadWorker}),this._tree.visible=this.visible,this._forest.add(this._tree),this._tree.initialized}},{key:"pid",get:function(){return this.spec.id}},{key:"projInfo",get:function(){return this.spec}}])&&Qs(r.prototype,n),i&&Qs(r,i),t}();function nu(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var iu=function(){function e(){var t=this,r=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).workerSize,n=void 0===r?6:r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.listeners=new Map,this.workerSize=n,this.workers=[],this.jobs=[];for(var i=function(e){t.workers.push(new ms.a),t.jobs.push(0),t.workers[e].onmessage=function(r){var n=r.data.resourceKey,i=r.data.status,o=r.data.payload;if(t.listeners.has(n)){var a=t.listeners.get(n);t.listeners.delete(n),a.forEach(function(e){var t=e.resolve,r=e.reject;if(0===i)r(new Error(o));else if(1===i)t(o);else{var n="uknown worker status";console.error(n,i),r(new Error(n))}})}else console.error("Worker cannot find callback for tile",n);t.jobs[e]--},t.workers[e].onerror=function(e){console.error("OSGLoader",e)}},o=0;o<this.workerSize;o++)i(o)}var t,r,n;return t=e,(r=[{key:"destruct",value:function(){return this.listeners.clear(),this.terminate()}},{key:"terminate",value:function(){var e=!0;if(this.workers&&this.workers.length>0)try{e=this.workers.reduce(function(e,t){return t.terminate()&&e},!0),this.workers=[],this.jobs=[]}catch(e){return console.error("LoadWorker terminate failed",e),!1}return e}},{key:"load",value:function(e){var t=this,r=e.resourceKey,n=e.timeout,i=void 0===n?3e4:n;return new Promise(function(e,n){var o={resolve:e,reject:n};if(t.listeners.has(r)){t.listeners.get(r).push(o)}else{t.listeners.set(r,[o]);var a={resourceKey:r,timeout:i,modelType:"OSG"},s=t.jobs.reduce(function(e,t,r,n){return t<n[e]?r:e},0);t.jobs[s]++,t.workers[s].postMessage(a)}})}}])&&nu(t.prototype,r),n&&nu(t,n),e}();function ou(e){return(ou="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function au(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function su(e,t){return!t||"object"!==ou(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function uu(e,t,r){return(uu="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=cu(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function cu(e){return(cu=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function lu(e,t){return(lu=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var fu=function(e){function t(e,r){var n,i=r.sceneGraphRoot,o=r.name,a=void 0===o?"DEMTree":o,s=r.eventHandlers,u=r.priorityRank,c=void 0===u?20:u,l=r.showBBox,f=r.debug,h=r.spec,p=(r.countryName,r.TreeMaterialType),d=void 0===p?dr:p,v=r.NodeMaterialType,y=void 0===v?fr:v;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=su(this,cu(t).call(this,e,{sceneGraphRoot:i,name:a,eventHandlers:s,debug:f,maxLevel:h.maxLevel,minLevel:h.minLevel,priorityRank:c,showBBox:l,TreeMaterialType:d,NodeMaterialType:y}))).sharedOptions.maxLevel=h.maxLevel,n.sharedOptions.spec=h,n.sharedOptions.treeMaterial=n.material,n.sharedOptions.rootSizeInMeter=n._computeDEMSize();var m={parent:null,x:h.rootNode.x,y:h.rootNode.y,level:h.rootNode.level,maxHeight:h.maxHeight,minHeight:h.minHeight,sharedOptions:n.sharedOptions};return n.root=new n.Node(m),n.numOfNodes++,n}var r,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&lu(e,t)}(t,nr),r=t,(n=[{key:"destruct",value:function(){var e=!0;return e=uu(cu(t.prototype),"destruct",this).call(this)&&e}},{key:"_computeDEMSize",value:function(){for(var e=this.sharedOptions.spec.rootNode,t=wr({level:e.level,x:e.x,y:e.y}),r=0,n=0;n<4;n++)r+=new p.Vector3(t[n].x,t[n].y,t[n].z).distanceTo(t[(n+1)%4]);return r/=4}},{key:"_computeDEMPosition",value:function(){var e=this.sharedOptions.spec.rootNode,t=se(e.level,e.x,e.y),r=t.minX,n=t.minY,i=t.maxX,o=t.maxY,a=ve.webMercator2Wgs84(r,n),s=a.latitude,u=a.longitude,c=ve.webMercator2Wgs84(i,o),l=c.latitude;return{lng:(u+c.longitude)/2,lat:(s+l)/2}}}])&&au(r.prototype,n),i&&au(r,i),t}();function hu(e,t,r,n,i,o,a){try{var s=e[o](a),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,i)}function pu(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){var o=e.apply(t,r);function a(e){hu(o,n,i,a,s,"next",e)}function s(e){hu(o,n,i,a,s,"throw",e)}a(void 0)})}}function du(e){return vu.apply(this,arguments)}function vu(){return(vu=pu(regeneratorRuntime.mark(function e(t){var r,n,i,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.demUrl,n=t.domUrl,i=Jn({textureUrl:r},15e3).catch(function(){return Promise.reject(new Error("404"))}),o=Jn({textureUrl:n},15e3).catch(function(){return Promise.resolve(Ti(0,0,0))}),e.abrupt("return",Promise.all([i,o]).catch(function(){return Promise.reject(new Error("404"))}));case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}function yu(e,t,r){return 6553.6*e+25.6*t+.1*r-1e4}function mu(e){return function(e){for(var t=[0,0,0],r=[255,255,255],n=e.data,i=0,o=0,a=0,s=0;s<e.width*e.height*4;s+=4)i=n[s],o=n[s+1],a=n[s+2],0===i&&0===o&&0===a||(i>t[0]?(t[0]=i,t[1]=o,t[2]=a):i===t[0]&&o>t[1]?(t[1]=o,t[2]=a):i===t[0]&&o===t[1]&&a>t[2]&&(t[2]=a),i<r[0]?(r[0]=i,r[1]=o,r[2]=a):i===r[0]&&o<r[1]?(r[1]=o,r[2]=a):i===r[0]&&o===r[1]&&a<r[2]&&(r[2]=a));return{max:t,min:r}}(function(e){var t=document.createElement("canvas");t.width=e.width,t.height=e.height;var r=t.getContext("2d");return r.drawImage(e,0,0),r.getImageData(0,0,e.width,e.height)}(e.image))}function gu(e){return(gu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function bu(e,t){return!t||"object"!==gu(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function _u(e){return(_u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function wu(e,t){return(wu=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var xu="\n#include <common>\nvarying vec2 vUv;\n// uniform mat3 uvTransform;\nuniform sampler2D displacementMap;\nuniform sampler2D map;\n\n#include <logdepthbuf_pars_vertex>\n\nvoid main() {\n  vUv = uv;\n  // vUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\n  vec3 objectNormal = vec3( normal );\n\n  vec3 transformed = vec3( position );\n  // vec4 terrianRGB = texture2D( map, vUv );\n  vec4 terrianRGB = texture2D( displacementMap, vUv );\n  float height = (terrianRGB.r * 256.0 * 256.0 + terrianRGB.g * 256.0 + terrianRGB.b) * 25.5 - 10000.0;\n  transformed += normalize( objectNormal ) * height;\n\n  vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\n  gl_Position = projectionMatrix * mvPosition;\n  \n  #include <logdepthbuf_vertex>\n}\n",Au="\nuniform vec3 diffuse;\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n\nvarying vec2 vUv;\nuniform sampler2D map;\n\n#include <logdepthbuf_pars_fragment>\nvoid main() {\n\n  #include <logdepthbuf_fragment>\n  vec4 texelColor = texture2D( map, vUv );\n  // texelColor = mapTexelToLinear( texelColor );\n\n  gl_FragColor = texelColor;\n  #include <dithering_fragment>\n}\n",ku=function(e){function t(e){var r,n=e.map,i=e.displacementMap;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=bu(this,_u(t).call(this))).uniforms={map:{type:"t",value:n},displacementMap:{type:"t",value:i}},r.vertexShader=xu,r.fragmentShader=Au,r.isTerrianMaterial=!0,r.color=new p.Color(16777215),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&wu(e,t)}(t,p["ShaderMaterial"]),t}();function Ou(e){return(Ou="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Su(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Pu(e,t){return!t||"object"!==Ou(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Tu(e,t,r){return(Tu="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Eu(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function Eu(e){return(Eu=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Mu(e,t){return(Mu=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ju,Cu=function(e){function t(e){var r,n=e.key,i=e.value,o=e.weight,a=void 0===o?100:o,s=e.gpuUsage,u=e.is404,c=void 0!==u&&u;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=Pu(this,Eu(t).call(this,{key:n,value:i,weight:a,gpuUsage:s})))._is404=c,r}var r,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Mu(e,t)}(t,Nn),r=t,(n=[{key:"destruct",value:function(){return this.is404||(this._value.dem&&this._value.dem.dispose(),this._value.dom&&this._value.dom.dispose()),Tu(Eu(t.prototype),"destruct",this).call(this)}},{key:"valid",get:function(){return this.is404||this._value}},{key:"is404",get:function(){return this._is404}}])&&Su(r.prototype,n),i&&Su(r,i),t}();function Ru(e){return(Ru="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Iu(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Lu(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Bu(e,t,r,n,i,o,a){try{var s=e[o](a),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,i)}function Uu(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){var o=e.apply(t,r);function a(e){Bu(o,n,i,a,s,"next",e)}function s(e){Bu(o,n,i,a,s,"throw",e)}a(void 0)})}}function Du(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Nu(e,t){return!t||"object"!==Ru(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function zu(e,t,r){return(zu="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Fu(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function Fu(e){return(Fu=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Vu(e,t){return(Vu=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Wu=(function(e,t,r,n,i){var o={};Object.keys(n).forEach(function(e){o[e]=n[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=r.slice().reverse().reduce(function(r,n){return n(e,t,r)||r},o),i&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(i):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(e,t,o),o=null)}((ju=function(e){function t(e){var r,n=e.parent,i=e.x,o=e.y,a=e.level,s=e.maxHeight,u=e.minHeight,c=e.sharedOptions;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=Nu(this,Fu(t).call(this,{parent:n,x:i,y:o,level:a,sharedOptions:c}))).name=a+"_"+r.x+"_"+r.y,!r.isRoot||isNaN(s)||isNaN(u)||(r.rangeHeight=new p.Vector2(u,s));var l=r.sizeInMeter/t.GEOMETREY_SIZE;r.contentHolder.applyMatrix((new p.Matrix4).makeScale(l,l,1));var f=new p.Vector2;r.rangeXY.getCenter(f);var h=(new p.Matrix4).makeTranslation(f.x,f.y,0);return r.shapeHolder.applyMatrix(h),r}var r,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Vu(e,t)}(t,Un),r=t,(n=[{key:"destruct",value:function(){var e=zu(Fu(t.prototype),"destruct",this).call(this);return this.style=void 0,this._material&&(wn(this._material),this._material=void 0),e}},{key:"downloading",value:function(){var e=Uu(regeneratorRuntime.mark(function e(t){var r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.demImageUrl,n=this.domImageUrl,e.abrupt("return",du({demUrl:r,domUrl:n}));case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"cook",value:function(){var e=Uu(regeneratorRuntime.mark(function e(t){var r,n,i,o,a,s,u,c,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=Lu(t,2),n=r[0],i=r[1],o=mu(n),a=o.max,s=o.min,u=yu.apply(void 0,Iu(s)),c=yu.apply(void 0,Iu(a)),l=4*(n.image.height*n.image.width+i.image.height*n.image.width),e.abrupt("return",Promise.resolve(new Cu({key:this.resourceKey,value:{dem:n,dom:i,minHeight:u,maxHeight:c},gpuUsage:l,weight:1})));case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"defaultCooked",value:function(){var e=Uu(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Cu({key:this.resourceKey,value:{isPlaceHolder:!0},weight:1,gpuUsage:10,is404:this.is404}),e.abrupt("return",Promise.resolve(t));case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"digest",value:function(e){if(this.gpuUsage=e.gpuUsage,e.is404)return this.is404=e.is404,new p.Object3D;var r=e.value.dem,n=e.value.dom,i=e.value.minHeight,o=e.value.maxHeight;this.rangeHeight=new p.Vector2(i,o);var a=this.level,s=this.x,u=this.y;this._material=new ku({displacementMap:r,map:n,level:a,x:s,y:u,flatShading:!1});var c=new p.Mesh(t.tileGeometry,this._material);return c.matrixAutoUpdate=!1,c}},{key:"_computeEstimatedBBox",value:function(){var e=this.rangeXY,t=this.estimatedRangeHeight;return new p.Box3(new p.Vector3(e.min.x,e.min.y,t.x),new p.Vector3(e.max.x,e.max.y,t.y))}},{key:"levelSizeInMeter",value:function(e){}},{key:"resourceKey",get:function(){var e=this.demImageUrl;return Object.defineProperty(this,"resourceKey",{value:e,writable:!1,configurable:!0}),this.resourceKey}},{key:"estimationCoefficient",get:function(){return 1.2}},{key:"estimatedRootGpuUsage",get:function(){return 524288}},{key:"sizeInMeter",get:function(){return this.rootSizeInMeter/Math.pow(2,this.level-this.sharedOptions.spec.rootNode.level)}},{key:"rootSizeInMeter",get:function(){return this.sharedOptions.rootSizeInMeter}},{key:"rangeXY",get:function(){var e=this.sizeInMeter,t=this.sharedOptions.spec.rootNode,r=this.rootSizeInMeter,n=t.x*r,i=(Math.pow(2,t.level)-t.y-1)*r,o=e,a=this.x*o,s=(Math.pow(2,this.level)-this.y-1)*o;return new p.Box2(new p.Vector2(-r/2-n+a,-r/2-i+s),new p.Vector2(o-r/2-n+a,o-r/2-i+s))}},{key:"rangeHeight",get:function(){return this._rangeHeight},set:function(e){if(!e||isNaN(e.x)||isNaN(e.y))console.warn("Invalid rangeHeight",e);else{this._rangeHeight=(new p.Vector2).copy(e);var t=this.rangeXY;this.boundingBox=new p.Box3(new p.Vector3(t.min.x,t.min.y,e.x),new p.Vector3(t.max.x,t.max.y,e.y))}}},{key:"estimatedRangeHeight",get:function(){return this.rangeHeight?this.rangeHeight:this.parent.estimatedRangeHeight}},{key:"demImageUrl",get:function(){var e="";return"function"==typeof this.sharedOptions.spec.demWmtsUrl?e=this.sharedOptions.spec.demWmtsUrl(this.level,this.x,this.y):"string"==typeof this.sharedOptions.spec.demWmtsUrl&&(e=this.sharedOptions.spec.demWmtsUrl.replace("{z}",this.level).replace("{x}",this.x).replace("{y}",this.y)),Object.defineProperty(this,"demImageUrl",{value:e,writable:!1,configurable:!0}),this.demImageUrl}},{key:"domImageUrl",get:function(){var e="";return"function"==typeof this.sharedOptions.spec.domWmtsUrl?e=this.sharedOptions.spec.domWmtsUrl(this.level,this.x,this.y):"string"==typeof this.sharedOptions.spec.domWmtsUrl&&(e=this.sharedOptions.spec.domWmtsUrl.replace("{z}",this.level).replace("{x}",this.x).replace("{y}",this.y)),Object.defineProperty(this,"domImageUrl",{value:e,writable:!1,configurable:!0}),this.domImageUrl}}])&&Du(r.prototype,n),i&&Du(r,i),t}()).prototype,"levelSizeInMeter",[me],Object.getOwnPropertyDescriptor(ju.prototype,"levelSizeInMeter"),ju.prototype),ju);Wu.GEOMETREY_SIZE=100,Wu.tileGeometry=new p.PlaneBufferGeometry(Wu.GEOMETREY_SIZE,Wu.GEOMETREY_SIZE,256,256);var Gu=Wu;function Hu(e){return(Hu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ku(e,t,r,n,i,o,a){try{var s=e[o](a),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,i)}function qu(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Yu(e,t){return!t||"object"!==Hu(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Xu(e,t,r){return(Xu="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Zu(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function Zu(e){return(Zu=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Qu(e,t){return(Qu=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ju=function(e){function t(e,r){var n,i=r.name,o=r.forest,a=r.position,s=void 0===a?{lng:114,lat:22.25}:a,u=r.showBBox,c=r.spec,l=r.loadWorker,f=r.onTileDownloaded;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=Yu(this,Zu(t).call(this,e,{name:i,forest:o,position:s,showBBox:u}))).spec=c,n.loadWorker=l,n.onTileDownloaded=f,n}var r,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Qu(e,t)}(t,_o),r=t,(n=[{key:"destruct",value:function(){return Xu(Zu(t.prototype),"destruct",this).call(this)}},{key:"import",value:function(){var e,t=(e=regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._createTree(this.spec));case 1:case"end":return e.stop()}},e,this)}),function(){var t=this,r=arguments;return new Promise(function(n,i){var o=e.apply(t,r);function a(e){Ku(o,n,i,a,s,"next",e)}function s(e){Ku(o,n,i,a,s,"throw",e)}a(void 0)})});return function(){return t.apply(this,arguments)}}()},{key:"_createTree",value:function(e){if(!e||!e.valid)return Promise.reject(new Error("Invalid spec."));var t=this._treeNode,r=e.name,n=e.maxLevel,i=e.minLevel,o=this.showBBox,a={onTileDownloaded:this.onTileDownloaded};return this._tree=new fu(Gu,{name:r,sceneGraphRoot:t,maxLevel:n,minLevel:i,showBBox:o,debug:!1,eventHandlers:a,spec:e,loadWorker:this.loadWorker}),this._tree.visible=this.visible,this._forest.add(this._tree),this._tree.initialized}}])&&qu(r.prototype,n),i&&qu(r,i),t}();function $u(e){return($u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ec(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function tc(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function rc(e,t){return!t||"object"!==$u(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function nc(e,t,r){return(nc="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ic(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function ic(e){return(ic=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function oc(e,t){return(oc=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ac=function(e){function t(e,r){r.isMobile;var n,i=r.forest,o=r.countryName,a=r.altizureApi,s=r.onTileDownloaded;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=rc(this,ic(t).call(this,e))).name="ProjectLayer",n.forest=i,n._countryName=o,n._altizureApi=a,n.onTileDownloaded=s,n}var r,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&oc(e,t)}(t,Mt),r=t,(n=[{key:"destruct",value:function(){var e=nc(ic(t.prototype),"destruct",this).call(this);return this._altizureBundleLoader&&(this._altizureBundleLoader.terminate(),this._altizureBundleLoader=null),this._osgBundleLoader&&(this._osgBundleLoader.terminate(),this._osgBundleLoader=null),e}},{key:"addEntity",value:function(e){return new _o(this,function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){ec(e,t,r[t])})}return e}({forest:this.forest},e)).import()}},{key:"addAltizure",value:function(e){var t=e.pid,r=e.projInfo,n=e.position,i=e.showBBox;return new vs(this,{forest:this.forest,pid:t,position:n,showBBox:i,altizureApi:this._altizureApi,countryName:this._countryName,loadWorker:this.altizureBundleLoader,onTileDownloaded:this.onTileDownloaded}).import(r)}},{key:"addOSG",value:function(e){var t=e.spec,r=e.position,n=e.showBBox;return new ru(this,{forest:this.forest,spec:t,position:r,showBBox:n,loadWorker:this.osgBundleLoader,onTileDownloaded:this.onTileDownloaded}).import()}},{key:"addDEM",value:function(e){var t=e.spec,r=e.position,n=e.showBBox,i=new Ju(this,{forest:this.forest,spec:t,position:r,showBBox:n,loadWorker:this.osgBundleLoader,onTileDownloaded:this.onTileDownloaded});return i.import().then(function(){return i})}},{key:"remove",value:function(){}},{key:"sceneUpdated",value:function(e){var t=e.camera;this.applyToChildren(function(e,t){e.sceneUpdated(t)},{camera:t})}},{key:"countryname",get:function(){return this._countryName}},{key:"altizureBundleLoader",get:function(){var e=new bs;return this._altizureBundleLoader=e,Object.defineProperty(this,"altizureBundleLoader",{value:e,writable:!1,configurable:!0}),this.altizureBundleLoader}},{key:"osgBundleLoader",get:function(){var e=new iu;return this._osgBundleLoader=e,Object.defineProperty(this,"osgBundleLoader",{value:e,writable:!1,configurable:!0}),this.osgBundleLoader}}])&&tc(r.prototype,n),i&&tc(r,i),t}(),sc=function(e){this.minNode=void 0,this.nodeCount=0,e&&(this.compare=e)};sc.prototype.clear=function(){this.minNode=void 0,this.nodeCount=0},sc.prototype.decreaseKey=function(e,t){if(void 0===e)throw new Error("Cannot decrease key of non-existent node");if(this.compare({key:t},{key:e.key})>0)throw new Error("New key is larger than old key");e.key=t;var r=e.parent;r&&this.compare(e,r)<0&&(cc(e,r,this.minNode,this.compare),lc(r,this.minNode,this.compare)),this.compare(e,this.minNode)<0&&(this.minNode=e)},sc.prototype.delete=function(e){var t=e.parent;t&&(cc(e,t,this.minNode,this.compare),lc(t,this.minNode,this.compare)),this.minNode=e,this.extractMinimum()},sc.prototype.extractMinimum=function(){var e=this.minNode;if(e){if(e.child){var t=e.child;do{t.parent=void 0,t=t.next}while(t!==e.child)}var r;e.next!==e&&(r=e.next),fc(e),this.nodeCount--,this.minNode=pc(r,e.child,this.compare),r&&(this.minNode=r,this.minNode=function(e,t){var r=[],n=new uc(e);for(;n.hasNext();){for(var i=n.next();r[i.degree];){if(t(i,r[i.degree])>0){var o=i;i=r[i.degree],r[i.degree]=o}hc(r[i.degree],i,t),r[i.degree]=void 0,i.degree++}r[i.degree]=i}e=void 0;for(var a=0;a<r.length;a++)r[a]&&(r[a].next=r[a],r[a].prev=r[a],e=pc(e,r[a],t));return e}(this.minNode,this.compare))}return e},sc.prototype.findMinimum=function(){return this.minNode},sc.prototype.insert=function(e,t){var r=new dc(e,t);return this.minNode=pc(this.minNode,r,this.compare),this.nodeCount++,r},sc.prototype.isEmpty=function(){return void 0===this.minNode},sc.prototype.size=function(){return this.isEmpty()?0:function e(t){var r=0;var n=t;do{r++,n.child&&(r+=e(n.child)),n=n.next}while(n!==t);return r}(this.minNode)},sc.prototype.union=function(e){this.minNode=pc(this.minNode,e.minNode,this.compare),this.nodeCount+=e.nodeCount},sc.prototype.compare=function(e,t){return e.key>t.key?1:e.key<t.key?-1:0};var uc=function(e){this.items=[];var t=e;do{this.items.push(t),t=t.next}while(e!==t)};function cc(e,t,r,n){return t.degree--,e.next===e?t.child=void 0:t.child=e.next,fc(e),r=pc(r,e,n),e.isMarked=!1,r}function lc(e,t,r){var n=e.parent;return n&&(e.isMarked?t=lc(n,t=cc(e,n,t,r),r):e.isMarked=!0),t}function fc(e){var t=e.prev,r=e.next;t.next=r,r.prev=t,e.next=e,e.prev=e}function hc(e,t,r){fc(e),t.child=pc(e,t.child,r),e.parent=t,e.isMarked=!1}function pc(e,t,r){if(e||t){if(!e)return t;if(!t)return e;var n=e.next;return e.next=t.next,e.next.prev=e,t.next=n,t.next.prev=t,r(e,t)<0?e:t}}function dc(e,t){this.key=e,this.value=t,this.prev=this,this.next=this,this.degree=0,this.parent=void 0,this.child=void 0,this.isMarked=void 0}uc.prototype.hasNext=function(){return this.items.length>0},uc.prototype.next=function(){return this.items.shift()};var vc=sc,yc=function(e){this.heap=new vc(e)};yc.prototype.constructor=yc,yc.prototype.enqueue=function(e,t){return this.heap.insert(e,t)},yc.prototype.dequeue=function(){return this.heap.extractMinimum()},yc.prototype.clear=function(){this.heap.clear()},yc.prototype.isEmpty=function(){return this.heap.isEmpty()};var mc=yc;function gc(e){return(gc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function bc(e){this.size=0,this.limit=e,this._keymap={}}bc.prototype.put=function(e,t){var r={key:e,value:t};if(this._keymap[e]=r,this.tail?(this.tail.newer=r,r.older=this.tail):this.head=r,this.tail=r,this.size===this.limit)return this.shift();this.size++},bc.prototype.shift=function(){var e=this.head;return e&&(this.head.newer?(this.head=this.head.newer,this.head.older=void 0):this.head=void 0,e.newer=e.older=void 0,delete this._keymap[e.key]),e},bc.prototype.get=function(e,t){var r=this._keymap[e];if(void 0!==r)return r===this.tail?t?r:r.value:(r.newer&&(r===this.head&&(this.head=r.newer),r.newer.older=r.older),r.older&&(r.older.newer=r.newer),r.newer=void 0,r.older=this.tail,this.tail&&(this.tail.newer=r),this.tail=r,t?r:r.value)},bc.prototype.find=function(e){return this._keymap[e]},bc.prototype.set=function(e,t){var r,n=this.get(e,!0);return n?(r=n.value,n.value=t):(r=this.put(e,t))&&(r=r.value),r},bc.prototype.remove=function(e){var t=this._keymap[e];if(t)return delete this._keymap[t.key],t.newer&&t.older?(t.older.newer=t.newer,t.newer.older=t.older):t.newer?(t.newer.older=void 0,this.head=t.newer):t.older?(t.older.newer=void 0,this.tail=t.older):this.head=this.tail=void 0,this.size--,t.value},bc.prototype.removeAll=function(){this.head=this.tail=void 0,this.size=0,this._keymap={}},"function"==typeof Object.keys?bc.prototype.keys=function(){return Object.keys(this._keymap)}:bc.prototype.keys=function(){var e=[];for(var t in this._keymap)e.push(t);return e},bc.prototype.forEach=function(e,t,r){var n;if(!0===t?(r=!0,t=void 0):"object"!==gc(t)&&(t=this),r)for(n=this.tail;n;)e.call(t,n.key,n.value,this),n=n.older;else for(n=this.head;n;)e.call(t,n.key,n.value,this),n=n.newer},bc.prototype.toJSON=function(){for(var e=[],t=this.head;t;)e.push({key:t.key.toJSON(),value:t.value.toJSON()}),t=t.newer;return e},bc.prototype.toString=function(){for(var e="",t=this.head;t;)e+=String(t.key)+":"+t.value,(t=t.newer)&&(e+=" < ");return e};var _c=bc;function wc(e){return(wc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function xc(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ac(e,t){return!t||"object"!==wc(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function kc(e,t,r){return(kc="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Oc(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function Oc(e){return(Oc=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Sc(e,t){return(Sc=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Pc=function(e){function t(e){var r,n=e.capacity,i=e.cacheGpuLimit,o=e.debug,a=void 0!==o&&o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=Ac(this,Oc(t).call(this,n))).capacity=n,r.cacheGpuLimit=i,r.currentCacheGpu=0,r.debug=a,r._stat={hit:0,miss:0},r}var r,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Sc(e,t)}(t,_c),r=t,(n=[{key:"destruct",value:function(){var e=this.clear();return this.capacity=0,e}},{key:"clear",value:function(){var e=!0;return(e=this.removeAll()&&e)||console.warn("ForestNodeCache clear failed"),this._stat.hit=0,this._stat.miss=0,e}},{key:"getTile",value:function(e){var t=e.resourceKey,r=this.get(t);if(void 0===r)this.debug&&console.log("miss"),this._stat.miss++;else{if(this.debug&&console.log("hit"),!r.valid)return console.error("ForestNodeCache provides invalid mesh",r),this.remove(t),void r.destruct();this._stat.hit++}return this.debug&&console.log("get",e.name,JSON.stringify(this.stat)),r}},{key:"putTile",value:function(e,t){if(t.valid){var r=e.resourceKey;if(this.get(r))return!1;for(this.put(r,t),this.currentCacheGpu+=t.gpuUsage,this.debug&&console.log("put",e.name,this.currentCacheGpu);this.currentCacheGpu>this.cacheGpuLimit;)this.shift();return!0}return console.warn("[ForestNodeCache] receives invalid tile."),!1}},{key:"shift",value:function(){var e=kc(Oc(t.prototype),"shift",this).call(this);return this.currentCacheGpu-=e.value.gpuUsage,e.value.destruct(),this.debug&&console.log("shift",e,this.currentCacheGpu),e}},{key:"removeAll",value:function(){for(var e=this.capacity+1;this.head&&e>=0;)this.shift(),e--;return kc(Oc(t.prototype),"removeAll",this).call(this),e>=0||(console.warn("cache removeAll error"),!1)}},{key:"_validateMesh",value:function(e){console.warn("deprecated.")}},{key:"stat",get:function(){return this._stat}},{key:"info",get:function(){return{stat:this.stat,size:this.size}}}])&&xc(r.prototype,n),i&&xc(r,i),t}();function Tc(e,t,r,n,i,o,a){try{var s=e[o](a),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,i)}function Ec(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){var o=e.apply(t,r);function a(e){Tc(o,n,i,a,s,"next",e)}function s(e){Tc(o,n,i,a,s,"throw",e)}a(void 0)})}}function Mc(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var jc=function(){function e(t){var r=t.capacity,n=t.debug,i=void 0!==n&&n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._capacity=r,this.debug=i,this._size=0,this.waitQueue=new Qr,this._taskMap=new Map,this.status="live"}var t,r,n;return t=e,(r=[{key:"destruct",value:function(){return this.waitQueue.clear(),this.waitQueue=null,this._capacity=0,this._size=0,this._taskMap.clear(),this._taskMap=null,this.status="dead",!0}},{key:"clear",value:function(){this.waitQueue.clear(),this._size=0,this._taskMap.clear()}},{key:"abortPending",value:function(){var e=Ec(regeneratorRuntime.mark(function e(){var t,r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(t=[];!this.waitQueue.isEmpty();)r=this.waitQueue.dequeue(),n=r.reject(new Error("[Dock] abortPending")),t.push(n);return e.abrupt("return",Promise.all(t));case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"fill",value:function(){for(var e=this.waitQueue,t=this,r=this.capacity-this.size;r>0&&!e.isEmpty();){var n=e.dequeue();this.act(n).then(function(){t._size--,t.fill()}).catch(function(e){console.error("Dock.add",e)}),r=this.capacity-this.size}}},{key:"act",value:function(){var e=Ec(regeneratorRuntime.mark(function e(t){var r,n,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._size++,r=t.func,n=t.resolve,i=t.reject,e.abrupt("return",H(r(),12e4).then(function(e){return n(e),Promise.resolve()}).catch(function(e){return i(e),Promise.resolve()}));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"queue",value:function(e){var t=this,r=e.resourceKey,n=null;if(this._taskMap.has(r)){var i=this._taskMap.get(r);i.tiles.add(e),n=i.task}else{var o=new Set;o.add(e);var a=new Promise(function(e,n){t.waitQueue.enqueue({func:u,resolve:function(n){return"live"===t.status&&t._taskMap.delete(r),e(n)},reject:function(e){return"live"===t.status&&t._taskMap.delete(r),n(e)}})});n=a;var s={task:a,tiles:o};this._taskMap.set(r,s),this.fill()}return n;function u(){var e=null,n=t._taskMap.get(r).tiles;return n.forEach(function(t){t.expired||(e=t)}),n.clear(),null===e?Promise.reject(new Error("[Dock] No active node")):t._downloadTask(e).then(function(t){return e.cook(t)})}}},{key:"_downloadTask",value:function(e,t){return this.debug&&console.log("_download",e.resourceKey),e.download()}},{key:"size",get:function(){return this._size}},{key:"capacity",get:function(){return this._capacity}},{key:"info",get:function(){return{capacity:this.capacity,size:this.size,queue:this.waitQueue.getLength()}}}])&&Mc(t.prototype,r),n&&Mc(t,n),e}();function Cc(e,t,r,n,i,o,a){try{var s=e[o](a),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,i)}function Rc(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Ic=function(){function e(t){var r=t.cacheCapacity,n=t.cacheGpuLimit,i=t.dockCapacity,o=t.debug,a=void 0!==o&&o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.debug=a,this.cache=new Pc({capacity:r,cacheGpuLimit:n,debug:a}),this.dock=new jc({capacity:i,debug:a}),this.status="working"}var t,r,n;return t=e,(r=[{key:"destruct",value:function(){this.status="destructing";var e=!0;return e=this.dock.destruct()&&e,(e=this.cache.destruct()&&e)||console.warn("ForestNodeRetriever destruct failed."),this.status="destructed",e}},{key:"abortPending",value:function(){var e,t=(e=regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.dock.abortPending());case 1:case"end":return e.stop()}},e,this)}),function(){var t=this,r=arguments;return new Promise(function(n,i){var o=e.apply(t,r);function a(e){Cc(o,n,i,a,s,"next",e)}function s(e){Cc(o,n,i,a,s,"throw",e)}a(void 0)})});return function(){return t.apply(this,arguments)}}()},{key:"clear",value:function(){var e=!0;return e=this.dock.clear()&&e,(e=this.cache.clear()&&e)||console.warn("ForestNodeRetriever clear failed."),e}},{key:"request",value:function(e){if("working"!==this.status)return console.warn("ForestNodeRetriever destructing",e.info,"request failed"),!1;var t=this,r=this.cache.getTile(e);return r?Promise.resolve(r):this.dock.queue(e).catch(function(t){return e.expired?Promise.resolve(void 0):"[Dock] abortPending"===t.message?Promise.reject(t):"404"===t.message?(e.is404=!0,e.defaultCooked()):"timeout"===t.message?Promise.reject(new Error("timeout")):"expired"===t.message?Promise.reject(t):(console.warn("unknown load error",t),Promise.reject(t))}).then(function(r){return void 0!==r&&t.cache.putTile(e,r),Promise.resolve(r)})}},{key:"info",get:function(){return{cache:this.cache.info,dock:this.dock.info}}}])&&Rc(t.prototype,r),n&&Rc(t,n),e}();function Lc(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Bc=function(){function e(t){var r=t.FOREST_CAPACITY,n=t.CACHE_CAPACITY,i=t.FOREST_GPU_RAM_LIMIT,o=void 0===i?751619276.8:i,a=t.CACHE_GPU_RAM_LIMIT,s=void 0===a?1073741824:a,u=t.FOREST_RAM_LIMIT,c=void 0===u?1073741824:u,l=t.MAX_DOWNLOAD_CONCURRENCY,f=t.MIN_AREA,h=t.MAX_LEVEL,p=t.trees,d=void 0===p?[]:p,v=t.name,y=void 0===v?"LodForest":v,m=t.debug,g=void 0!==m&&m;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name=y,this.FOREST_CAPACITY=r,this.MAX_DOWNLOAD_CONCURRENCY=l,this.MIN_AREA=f,this.MAX_LEVEL=h,this.trees=d,this._numOfNodes=0,this.CACHE_CAPACITY=n,this.CACHE_CAPACITY<this.FOREST_CAPACITY+10&&(this.CACHE_CAPACITY=this.FOREST_CAPACITY+Math.min(100,Math.max(.4*this.FOREST_CAPACITY,10)),console.warn("Cache is too small. Resized to",this.CACHE_CAPACITY));this.CACHE_GPU_RAM_LIMIT=Math.max(s,314572800),this.FOREST_GPU_RAM_LIMIT=Math.max(o,104857600),this.CACHE_GPU_RAM_LIMIT<this.FOREST_GPU_RAM_LIMIT+209715200&&(this.CACHE_GPU_RAM_LIMIT=(this.CACHE_GPU_RAM_LIMIT+this.FOREST_GPU_RAM_LIMIT)/2+104857600,this.FOREST_GPU_RAM_LIMIT=this.CACHE_GPU_RAM_LIMIT-209715200,console.warn("CACHE_GPU_RAM_LIMIT is too small, resized to",this.CACHE_GPU_RAM_LIMIT)),this.FOREST_RAM_LIMIT=c,this.retriever=new Ic({cacheCapacity:this.CACHE_CAPACITY,cacheGpuLimit:this.CACHE_GPU_RAM_LIMIT,dockCapacity:l,debug:g})}var t,r,n;return t=e,(r=[{key:"destruct",value:function(){var e=!0;return this.trees=[],e=e&&this.retriever.destruct(),this.retriever=null,e}},{key:"clear",value:function(){this.trees=[],this.retriever.clear()}},{key:"add",value:function(e){var t=this._indexOf(e);return-1===t?(this.trees.push(e),!0):(console.warn("tree already exists",e,t),!1)}},{key:"remove",value:function(e){var t=this._indexOf(e);return-1!==t&&(this.trees.splice(t,1),!0)}},{key:"applyToVisibleTrees",value:function(e,t){for(var r=!0,n=0;n<this.trees.length;n++)this.trees[n].visible&&(r=e(this.trees[n],t)&&r);return r}},{key:"sceneUpdated",value:function(e){var t=e.camera;if(0===this.trees.length)return!0;var r=this;return this._preUpdateTree({camera:t}).then(G(10)).then(function(){return r._updateTree({camera:t})}).then(G(10)).then(function(){return r._retrieveTiles()}).catch(function(e){return console.error(e),Promise.resolve()})}},{key:"_preUpdateTree",value:function(e){var t=this,r=e.camera;return new Promise(function(e,n){var i=t.applyToVisibleTrees(function(e){return!e.preSceneUpdate||e.preSceneUpdate({camera:r})});i?e(i):n(i)})}},{key:"_updateTree",value:function(e){var t=e.camera,r=this;return new Promise(function(e,n){r.__updateTree({camera:t})?e():n(new Error("LodForest::_updateTree"))})}},{key:"__updateTree",value:function(e){e.camera;var t=!0,r=new mc(function(e,t){return t.key-e.key}),n=0,i=0,o=this.FOREST_GPU_RAM_LIMIT,a=0;this.applyToVisibleTrees(function(e){t=e.traverse(e.root,function(e){return e.needsPrune=!0,!0})&&t;var n=e.root,i=d(n),o={node:n,tree:e};r.enqueue(i,o),a++,v(n)});do{if(a>=this.FOREST_CAPACITY){0;break}if(i>=o||n>.9*o){0;break}var s=r.dequeue();if(void 0===s){0;break}var u=s.key,c=s.value.node,l=s.value.tree;if(u<this.MIN_AREA){0;break}if(c.needsPrune=!1,c.level<this.MAX_LEVEL&&c.level<l.maxLevel&&c.expandable){0===c.nodes.length&&(t=l.expand(c)&&t);for(var f=0;f<c.nodes.length;f++){var h=c.nodes[f];h.needsPrune=!0,v(h);var p=d(h);p>=this.MIN_AREA&&r.enqueue(p,{tree:l,node:h})}a+=c.nodes.length,this._numOfNodes=a}}while(!r.isEmpty());return r.clear(),r=void 0,this.applyToVisibleTrees(function(e){t=e.traverse(e.root,function(t){return!t.needsPrune||e.prune(t)})&&t}),t;function d(e){var t=e.screenArea;return e.ssArea=t,t}function v(e){var t=e.estimatedGpuUsage;isNaN(t)?console.warn("gpuUsage",t):(i+=t,e.isInScene&&(n+=t))}}},{key:"_retrieveTiles",value:function(){var e=this.retriever.abortPending(),t=this,r=new mc(function(e,t){return t.key-e.key}),n=new mc(function(e,t){return t.key-e.key});this.applyToVisibleTrees(function(e){var t=e.root.ssArea,i={tree:e,node:e.root};r.enqueue(t,i),n.enqueue(t,i)});for(var i=[];!r.isEmpty();){var o=r.dequeue(),a=p(o.value.tree,o.value.node);i.push(a)}for(;!n.isEmpty();)for(var s=n.dequeue(),u=s.value.tree,c=s.value.node.nodes,l=0;l<c.length;l++){var f=c[l],h=p(u,f);i.push(h),n.enqueue(f.ssArea,{tree:u,node:f})}return e.then(function(){return Promise.all(i)});function p(e,r){return t.retriever.request(r).then(function(t){if(!r.expired){if(!r.loaded){var n=r.digest(t);r.onContentLoaded(n),r.displayByload(),e.flags.modelInitialized||e._onContentInitialized()}return Promise.resolve()}return Promise.resolve()}).catch(function(e){return"[Dock] abortPending"===e.message||"timeout"===e.message||"expired"===e.message||console.warn("[Network unstable] LodForest._retrieveTiles",e),Promise.resolve()})}}},{key:"_indexOf",value:function(e){return(Array.prototype.indexOf?function(e,t){return e.indexOf(t)}:function(e,t){for(var r=0;r<e.length;r++)if(e[r]===t)return r;return-1})(this.trees,e)}},{key:"size",get:function(){return this._numOfNodes}},{key:"gpuMaxUsage",get:function(){for(var e=0,t=0;t<this.trees.length;t++)e+=this.trees[t].gpuMaxUsage;return e}}])&&Lc(t.prototype,r),n&&Lc(t,n),e}();function Uc(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Dc(e,t){return t.toString(e)}function Nc(e,t,r){return Dc(t,parseInt(r,e))}var zc=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,n;return t=e,n=[{key:"getBlueMarbleCNImageUrl",value:function(e,t,r){return"https://cdn-china.altizure.cn/bluemarble/wtb200401/"+e+"/"+t+"/"+r+".jpg"}},{key:"getBlueMarbleImageUrl",value:function(e,t,r){return"https://cloudfront.altizure.com/bluemarble/wtb200401/"+e+"/"+t+"/"+r+".jpg"}},{key:"getOSMImageUrl",value:function(e,t,r){return"http://"+["a","b","c"][(e+r+t)%3]+".tile.openstreetmap.org/"+e+"/"+t+"/"+r+".png"}},{key:"getBingImageUrl",value:function(e,t,r){var n,i=r,o=Dc(2,t),a=Dc(2,i),s=o.length-a.length;if(s>0)for(n=0;n<s;n++)a="0"+a;else if(s<0)for(s=-s,n=0;n<s;n++)o="0"+o;var u="";for(n=0;n<a.length;n++){u+=a[n]+o[n]}var c=Nc(2,4,u);if(c.length<e)for(s=e-c.length,n=0;n<s;n++)c="0"+c;return"//ecn.t"+(e+r+t)%8+".tiles.virtualearth.net/tiles/h"+c+".jpeg?g=1239&mkt=en-us"}},{key:"getCartoImageUrl",value:function(e,t,r){return"http://cartodb-basemaps-c.global.ssl.fastly.net/light_all/"+e+"/"+t+"/"+r+".png"}},{key:"getCartoDarkImageUrl",value:function(e,t,r){return"https://"+["1","2","3","4","5","6","7","8","9","0"][(e+r+t+2)%10]+".basemaps.cartocdn.com/dark_all/"+e+"/"+t+"/"+r+".png"}},{key:"getGoogleCNImageUrl",value:function(e,t,r){return"http://mt"+["0","1","2","3"][(e+r+t)%4]+".google.cn/vt/lyrs=s&x="+t+"&y="+r+"&z="+e}},{key:"getGoogleImageUrl",value:function(e,t,r){return"https://mts"+["1","2","3","0"][(e+r+t)%4]+".google.com/vt/lyrs=s&x="+t+"&y="+r+"&z="+e}},{key:"getGoogleTerrainImageUrl",value:function(e,t,r){return"https://mts"+["1","2","3","0"][(e+r+t)%4]+".google.com/vt/lyrs=p&x="+t+"&y="+r+"&z="+e}},{key:"getGaodeImageUrl",value:function(e,t,r){return"https://wprd0"+["1","2","3","4"][(e+r+t)%4]+".is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=6&x="+t+"&y="+r+"&z="+e}},{key:"getTencentImageUrl",value:function(e,t,r){var n=["0","1","2","3"][(e+r+t)%4],i=t,o=Math.pow(2,e)-1-r;return"http://p"+n+".map.gtimg.com/sateTiles/"+e+"/"+Math.floor(i/16)+"/"+Math.floor(o/16)+"/"+i+"_"+o+".jpg?version=117"}},{key:"getOpenCycleImageUrl",value:function(e,t,r){return"https://"+["a","b","c"][(e+r+t)%3]+".tile.opencyclemap.org/cycle/"+e+"/"+t+"/"+r+".png"}},{key:"getGoogleMoonImageUrl",value:function(e,t,r){return"https://crossorigin.me/http://mw"+["1","2"][(e+(r=Math.pow(2,e)-1-r)+t)%2]+".google.com/mw-planetary/lunar/lunarmaps_v1/clem_bw/"+e+"/"+t+"/"+r+".jpg"}},{key:"getGoogleMoonApolloImageUrl",value:function(e,t,r){return"https://mw"+["1","2"][(e+(r=Math.pow(2,e)-1-r)+t)%2]+".google.com/mw-planetary/lunar/lunarmaps_v1/apollo/"+e+"/"+t+"/"+r+".jpg"}},{key:"getHiriseMarsVisibleImageUrl",value:function(e,t,r){return r=Math.pow(2,e)-1-r,"https://crossorigin.me/http://gmaps-bkup.uahirise.org/mars/visible/".concat(e,"/").concat(t,"/").concat(r,".jpg")}},{key:"getNasaMarsTrekImageUrl",value:function(e,t,r){return"https://trektiles.jpl.nasa.gov/trektiles/Mars/EQ/Mars_Viking_MDIM21_ClrMosaic_global_232m/1.0.0//default/default028mm/".concat(e,"/").concat(r,"/").concat(t,".png")}},{key:"getNasaMoonTrekImageUrl",value:function(e,t,r){return"https://moontrek.jpl.nasa.gov/trektiles/Moon/EQ/LRO_WAC_Mosaic_Global_303ppd_v02/1.0.0//default/default028mm/".concat(e,"/").concat(r,"/").concat(t,".jpg?api_key=29i0fx486NeK5hQx7Z3AIiNBwEcJV2fJypTet3WW")}},{key:"getEsriLunarImageUrl",value:function(e,t,r){return"https://crossorigin.me/https://webgis2.wr.usgs.gov/Lunar_Global_GIS/ESRI.ArcGIS.ADF.Web.DataSources.ArcGISServer.TileHandler.ashx?tile=c2d7c76d558f4dfb8ffde861c9229b2e&level=".concat(e,"&column=").concat(t,"&row=").concat(r)}},{key:"getEsriTerrainImageUrl",value:function(e,t,r){return"https://server.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer/tile/".concat(e,"/").concat(r,"/").concat(t)}}],(r=null)&&Uc(t.prototype,r),n&&Uc(t,n),e}();function Fc(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Vc(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Wc=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Vc(this,"_URLGenerator",void 0),Vc(this,"mapName",void 0);var n=e.maps.get(t);if(n)return console.warn("Re-definition of map ".concat(t,".")),n;this.mapName=t,"string"==typeof r?this._URLGenerator=this._predefinedURL(r):"function"==typeof r?this._URLGenerator=r:"boolean"==typeof r?this._URLGenerator=this._predefinedURL("earth"):console.error("Uknown uri",r),e.maps.set(this.mapName,this)}var t,r,n;return t=e,(r=[{key:"url",value:function(e,t,r){return this._URLGenerator(e,t,r)}},{key:"_predefinedURL",value:function(e){return"earth"===e||"default"===e?function(e,t,r){return"China"===N.countryName?e<=8?zc.getBlueMarbleCNImageUrl(e,t,r):zc.getGoogleCNImageUrl(e,t,r):e<=8?zc.getBlueMarbleImageUrl(e,t,r):zc.getGoogleImageUrl(e,t,r)}:"Carto"===e?zc.getCartoImageUrl:"Carto-Dark"===e?zc.getCartoDarkImageUrl:"Google-Terrain"===e?zc.getGoogleTerrainImageUrl:(console.error("unknow uri",e),function(){return""})}}])&&Fc(t.prototype,r),n&&Fc(t,n),e}();function Gc(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Hc(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}Vc(Wc,"maps",new Map);var Kc=function(){function e(t,r,n,i){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:20,a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],s=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.showPlanetTexture=r,this.showOrbitRing=n,Hc(this,"_entity",void 0),Hc(this,"_wmtsTileURL",void 0),Hc(this,"_mapMaxLevel",void 0),Hc(this,"_visible",void 0),Hc(this,"_showDem",void 0),Hc(this,"_showPlanetWireframe",void 0),this._wmtsTileURL=i,this._mapMaxLevel=o,this._visible=t,this._showDem=a,this._showPlanetWireframe=s}var t,r,n;return t=e,(r=[{key:"entity",set:function(e){this._entity=e,this.visible=this.visible,this.mapMaxLevel=this.mapMaxLevel},get:function(){return this._entity}},{key:"wmtsTileURL",get:function(){return this._wmtsTileURL},set:function(e){e.mapName!==this.wmtsTileURL.mapName&&(this._wmtsTileURL=e,this.entity&&this.entity.updatePlanetMap())}},{key:"basemapName",get:function(){return this.wmtsTileURL.mapName}},{key:"visible",get:function(){return this._visible},set:function(e){this._visible=e,this.entity&&(this.entity.visible=e)}},{key:"mapMaxLevel",get:function(){return this._mapMaxLevel},set:function(e){this._mapMaxLevel=e,this.entity&&this.entity.changeMapMaxLevel({level:e,name:this.basemapName})}},{key:"showDem",get:function(){return this._showDem},set:function(e){console.warn("Under development.")}},{key:"showPlanetWireframe",get:function(){return this._showPlanetWireframe},set:function(e){this._showPlanetWireframe=e,this.entity&&this.entity.updatePlanetWireframeVisibility()}}])&&Gc(t.prototype,r),n&&Gc(t,n),e}();function qc(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Yc(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Xc(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Zc,Qc=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.transparent,i=void 0!==n&&n,o=r.opacity,a=void 0===o?.8:o,s=r.color,u=void 0===s?2565927:s,c=r.image;qc(this,e),Xc(this,"_renderer",void 0),Xc(this,"_transparent",void 0),Xc(this,"_opacity",void 0),Xc(this,"_color",void 0),Xc(this,"_image",void 0),this._renderer=t,this._transparent=i,this._opacity=a,this._color=u,this._image=c}var t,r,n;return t=e,(r=[{key:"transparent",get:function(){return this._transparent}},{key:"opacity",get:function(){return this._opacity}},{key:"color",get:function(){return this._color}},{key:"image",get:function(){return this._image}}])&&Yc(t.prototype,r),n&&Yc(t,n),e}(),Jc=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.planet,n=void 0===r?"earth":r,i=t.earthUseTexture,o=void 0===i||i,a=t.showOrbitRing,s=void 0!==a&&a,u=t.showDem,c=void 0===u||u,l=t.showPlanetWireframe,f=void 0===l||l,h=t.mapMaxLevel,p=void 0===h?20:h,d=t.quality,v=void 0===d?60:d,y=t.background,m=t.earth,g=t.tileBox,b=void 0!==g&&g;qc(this,e),Xc(this,"planet",void 0),Xc(this,"quality",void 0),Xc(this,"background",void 0),this.background=new Qc(y),this.planet="boolean"==typeof n?new Kc(n,o,s,new Wc("engine-init-map","default"),p,c,f):new Kc(!0,o,s,new Wc("engine-init-map",n),p,c,f),this.quality=Math.max(1,v),b&&console.warn("tileBox deprecated."),void 0!==m&&console.warn("earth deprecated.")};function $c(e){return($c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function el(e,t,r,n,i,o,a){try{var s=e[o](a),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,i)}function tl(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function rl(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function nl(e,t,r){return(nl="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=il(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function il(e){return(il=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ol(e,t){return(ol=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function al(e,t,r,n,i){var o={};return Object.keys(n).forEach(function(e){o[e]=n[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=r.slice().reverse().reduce(function(r,n){return n(e,t,r)||r},o),i&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(i):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(e,t,o),o=null),o}var sl=(al((Zc=function(e){function t(e){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n.HOST,o=n.api,a=n.camera,s=void 0===a?{poseTo:{lat:22.335836,lng:114.263885,alt:1e7,north:6.6,tilt:60,up:0}}:a,u=n.renderItems,c=void 0===u?{}:u,l=n.eventHandlers,f=void 0===l?{}:l,h=(n.develop,n.debug),d=void 0!==h&&h;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var v=c.background;r=function(e,t){return!t||"object"!==$c(t)&&"function"!=typeof t?rl(e):t}(this,il(t).call(this,e,{HOST:i,api:o,background:v,debug:d}));var y=rl(r);return r._renderItems=new Jc(c),r._type="EarthViewer",window.viewer=rl(r),r.ecefNode=new W(null),r.ecefNode.sceneNode.name="ecefNode",r.ecefNode.sceneNode.matrixAutoUpdate=!1,r.initialized=function(){y.scene.add(y.ecefNode.sceneNode),y._welcomeMesh=new p.Mesh(new p.SphereBufferGeometry(1,32,32),new p.MeshBasicMaterial({wireframe:!0})),y._welcomeMesh.name="welcomeMesh",y.ecefNode.sceneNode.add(y._welcomeMesh);var e=y.ecefNode,t=N.ISMOBILE,r=Math.max(y.renderItems.quality/60,.1),n={FOREST_CAPACITY:(t?140:250)*r,CACHE_CAPACITY:(t?280:300)*r,FOREST_GPU_RAM_LIMIT:(t?536870912:858993459.2)*r,CACHE_GPU_RAM_LIMIT:(t?805306368:1288490188.8)*r,MAX_DOWNLOAD_CONCURRENCY:t?3:7,MIN_AREA:(t?.011:.01)/r,MAX_LEVEL:t?15:19,trees:[],name:"EarthViewer Forest",debug:!1};return y.forest=new Bc(n),y.countryName.then(function(e){return Promise.all([i({countryName:e}),o({countryName:e})])}).then(function(){return Promise.resolve(y)});function i(r){var n=r.countryName;return y.layers.planet=new no(e,{isMobile:t,forest:y.forest,eventHandlers:{onContentInitialized:function(){f.onContentInitialized&&f.onContentInitialized(),y.ecefNode.sceneNode.remove(y._welcomeMesh)}},planet:y.renderItems.planet,maxAnisotropy:y.renderer.capabilities.getMaxAnisotropy(),fullScene:!0,countryName:n}),y.layers.planet.import()}function o(r){var n=r.countryName;return y.layers.project=new ac(e,{isMobile:t,forest:y.forest,countryName:n,altizureApi:y.altizureApi,onTileDownloaded:function(){y.updateScene()}}),Promise.resolve()}}(),y.__updateSceneTimed=K(y._updateScene,1500),y.__cameraChangingDebounce=q(function(){y._cameraChanging=!1},1e3),r.openning=function(){return y.control=new kt({camera:y.camera,openning:{poseTo:s.poseTo},handlers:void 0,ecefNode:y.ecefNode,layers:y.layers,domElement:y.renderer.domElement,showAnchor:!1}),y.control._putAnchor(),y.control._updateNearFar(),y.updateScene(),y.control.addEventListener("onCameraChange",function(){y._cameraChanging=!0,y.updateScene(),y.__cameraChangingDebounce()}),window.addEventListener("resize",function(){y.resize()},!1),s.flyTo?y.initialized.then(function(){return y.control.flyToPose(s.flyTo,s.time)}):y.initialized}(),r}var r,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ol(e,t)}(t,F),r=t,(n=[{key:"destruct",value:function(){var e=!0;return this.control&&(this.control.destruct(),this.control=void 0),e=this.ecefNode.destruct()&&e,this.forest&&(e=this.forest.destruct()&&e),e=nl(il(t.prototype),"destruct",this).call(this)&&e,y.disposeMesh(this._welcomeMesh),this._welcomeMesh=void 0,this._renderItems=void 0,window.viewer=void 0,this.ecefNode=void 0,this.initialized=void 0,this.openning=void 0,this.__updateScene=void 0,this._spotLights=void 0,e}},{key:"animate",value:function(){var e=Date.now()/1e3,r={camera:this.camera,currentTime:e,cameraChanging:this._cameraChanging};this.ecefNode&&this.ecefNode.animate(r),nl(il(t.prototype),"animate",this).call(this)}},{key:"updateVisibility",value:function(){return this.updateScene()}},{key:"updateScene",value:function(e){if(!function(e){var t=e.camera;if(isNaN(t.far)||isNaN(t.near))return!1;return!0}({camera:this.camera}))return!1;e?this._updateScene():this.__updateSceneTimed()}},{key:"_updateScene",value:function(){for(var e in this.layers)this.layers[e]&&this.layers[e].sceneUpdated({camera:this.camera});this.forest.sceneUpdated({camera:this.camera})}},{key:"_updateFrustum",value:function(e){}},{key:"addAltizureProject",value:function(){var e,t=(e=regeneratorRuntime.mark(function e(t){var r,n,i,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.projInfo,n=t.pid,i=t.position,o=t.showBBox,e.abrupt("return",this.initialized.then(function(e){return e.layers.project.addAltizure({pid:n,projInfo:r,position:i,showBBox:o})}).catch(function(e){return console.warn("Failed to add Altizure project",n,e),Promise.resolve()}));case 2:case"end":return e.stop()}},e,this)}),function(){var t=this,r=arguments;return new Promise(function(n,i){var o=e.apply(t,r);function a(e){el(o,n,i,a,s,"next",e)}function s(e){el(o,n,i,a,s,"throw",e)}a(void 0)})});return function(e){return t.apply(this,arguments)}}()},{key:"addOSGProject",value:function(e){var t=e.spec,r=e.position,n=e.showBBox;return this.initialized.then(function(e){return e.layers.project.addOSG({spec:t,position:r,showBBox:n})}).catch(function(e){return console.warn("Failed to add OSG project",e),Promise.resolve()})}},{key:"addDEMProject",value:function(e){var t=e.spec,r=e.position,n=e.showBBox;return this.initialized.then(function(e){return e.layers.project.addDEM({spec:t,position:r,showBBox:n})}).catch(function(e){return console.warn("Failed to add DEM project",e),Promise.resolve()})}},{key:"scale",get:function(){return 1}},{key:"resolution",get:function(){return 1}},{key:"earthNode",get:function(){return this.ecefNode}},{key:"renderItems",get:function(){return this._renderItems}},{key:"spotLights",get:function(){return this._spotLights}}])&&tl(r.prototype,n),i&&tl(r,i),t}()).prototype,"scale",[ye],Object.getOwnPropertyDescriptor(Zc.prototype,"scale"),Zc.prototype),al(Zc.prototype,"resolution",[ye],Object.getOwnPropertyDescriptor(Zc.prototype,"resolution"),Zc.prototype),al(Zc.prototype,"earthNode",[ye],Object.getOwnPropertyDescriptor(Zc.prototype,"earthNode"),Zc.prototype),Zc);function ul(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var cl=function(){function e(t){var r,n,i,o,a,s=t.id,u=t.cloudPath,c=t.name,l=void 0===c?"unknown":c,f=t.owner,h=void 0===f?"unknown":f,d=t.version,v=void 0===d?{major:0,minor:0,patch:0}:d,y=t.salt,m=void 0===y?"":y,g=t.maxLevel,b=void 0===g?20:g,_=t.minLevel,w=void 0===_?0:_,x=t.geoInfo,A=t.modelTransform;function k(e){var t=e.x,r=e.y,n=e.z;return new p.Vector3(t,r,n)}!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=s,this.cloudPath=u,this.name=l,this.owner=h,this.version=v,this.salt=m,this.maxLevel=b,this.minLevel=w,x=or({center:{geo:{lng:0,lat:0,alt:0},xyz:{x:0,y:0,z:0},epsg:"unknown"}},x),this.geoInfo={center:{geo:x.center.geo,xyz:k(x.center.xyz),epsg:x.center.epsg}},A=or({bbox:{max:{x:1,y:1,z:1},min:{x:-1,y:-1,z:-1}},scale:{x:1,y:1,z:1},position:{x:0,y:0,z:0},quaternion:{x:0,y:0,z:0,w:1}},A),this.modelTransform={bbox:{max:k(A.bbox.max),min:k(A.bbox.min)},scale:k(A.scale),position:k(A.position),quaternion:(r=A.quaternion,n=r.x,i=r.y,o=r.z,a=r.w,new p.Quaternion(n,i,o,a))}}var t,r,n;return t=e,(r=[{key:"destruct",value:function(){return!0}},{key:"validate",value:function(){return!!this.id&&!!this.cloudPath}},{key:"valid",get:function(){return this.validate()}},{key:"dataPath",get:function(){console.error("deprecated")}},{key:"rootFileName",get:function(){console.error("deprecated")}}])&&ul(t.prototype,r),n&&ul(t,n),e}();function ll(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var fl=function(){function e(t){var r=t.name,n=void 0===r?"unknown":r,i=t.maxLevel,o=void 0===i?10:i,a=t.minLevel,s=void 0===a?0:a,u=t.demWmtsUrl,c=t.domWmtsUrl,l=t.maxHeight,f=t.minHeight,h=t.rootNode;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name=n,this.maxLevel=o,this.minLevel=s,this.demWmtsUrl=u,this.domWmtsUrl=c,this.maxHeight=l,this.minHeight=f,this.rootNode=h}var t,r,n;return t=e,(r=[{key:"valid",get:function(){return!("function"!=typeof this.demWmtsUrl&&"string"!=typeof this.demWmtsUrl||isNaN(this.maxHeight)||isNaN(this.minHeight))}}])&&ll(t.prototype,r),n&&ll(t,n),e}();function hl(e){return(hl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function pl(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function dl(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function vl(e,t){return!t||"object"!==hl(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function yl(e){return(yl=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ml(e,t){return(ml=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var gl=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.tree,i=r.Type,o=void 0===i?ea:i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=vl(this,yl(t).call(this,n,o)))._tree=n,e._Type=o,e}var r,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ml(e,t)}(t,dr),r=t,(n=[{key:"generateTileMaterial",value:function(e){var t=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){pl(e,t,r[t])})}return e}({},e.style,this.tree.style);return e.geometry.computeVertexNormals(),new this.Type(t)}}])&&dl(r.prototype,n),i&&dl(r,i),t}();function bl(e){return(bl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _l(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function wl(e,t){return!t||"object"!==bl(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function xl(e){return(xl=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Al(e,t){return(Al=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var kl=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.level,i=r.x,o=r.y,a=_l(r,["level","x","y"]);return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),a=Object.assign({},a,{emissive:new p.Color(.6,.6,.6),metalness:.5,emissiveIntensity:1}),(e=wl(this,xl(t).call(this,a))).level=n,e.x=i,e.y=o,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Al(e,t)}(t,p["MeshPhysicalMaterial"]),t}();function Ol(e){return(Ol="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Sl(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function Pl(e,t){return!t||"object"!==Ol(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Tl(e){return(Tl=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function El(e,t){return(El=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ml=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.level,i=r.x,o=r.y,a=Sl(r,["level","x","y"]);!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var s=a.map,u=a.size;void 0===u&&(u=2);var c=p.VertexColors;return(e=Pl(this,Tl(t).call(this,ir({map:s,size:u,sizeAttenuation:!1,vertexColors:c})))).level=n,e.x=i,e.y=o,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&El(e,t)}(t,p["PointsMaterial"]),t}();function jl(e){return(jl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Cl(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function Rl(e,t){return!t||"object"!==jl(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Il(e){return(Il=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ll(e,t){return(Ll=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Bl=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.level,i=r.x,o=r.y;Cl(r,["level","x","y"]);return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=Rl(this,Il(t).call(this,{color:8947848,specular:6710886,shininess:30,flatShading:!0}))).level=n,e.x=i,e.y=o,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ll(e,t)}(t,Yo),t}();function Ul(e){return(Ul="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Dl(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function Nl(e,t){return!t||"object"!==Ul(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function zl(e){return(zl=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Fl(e,t){return(Fl=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Vl=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.level,i=r.x,o=r.y;Dl(r,["level","x","y"]);return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=Nl(this,zl(t).call(this,{color:12303291,wireframe:!0}))).level=n,e.x=i,e.y=o,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Fl(e,t)}(t,p["MeshBasicMaterial"]),t}();function Wl(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Gl=function(){function e(t){var r=t.camera,n=t.target,i=t.parent,o=t.sceneGraphRoot,a=t.offlineRenderer;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.camera=r,this.parent=i,this.sceneGraphRoot=o,this.offlineRenderer=a,this._target=n,this.ID=this.camera.uuid,this.sceneGraphRoot.add(this.camera),this.camera.updateProjectionMatrix(),this.camera.updateMatrix(),this.camera.updateMatrixWorld(),this.depthTexture=new p.DataTexture(new Float32Array([0,0,0]),1,1,p.RGBFormat,p.FloatType,p.UVMapping),this.localToVideo=(new p.Matrix4).getInverse(this.camera.matrix),this.videoProjectionMatrix=this.camera.projectionMatrix,this.projectorLogDepthBufferFC=2/(Math.log(1+this.camera.far)/Math.LN2),this.visible=!0}var t,r,n;return t=e,(r=[{key:"updateDepthTexture",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1024,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1024;this.camera.updateProjectionMatrix(),this.camera.updateMatrix(),this.camera.updateMatrixWorld();var r=this.offlineRenderer.renderDepthSnapshot(this.camera,[this.sceneGraphRoot],e,t,{side:p.DoubleSide});this.depthTexture&&this.depthTexture.dispose&&this.depthTexture.dispose();for(var n=new Float32Array(3*e*t),i=0;i<r.length;++i){var o=3*i,a=r[i];n[o]=a,n[o+1]=a,n[o+2]=a}this.depthTexture.image={data:n,width:e,height:t},this.depthTexture.needsUpdate=!0}},{key:"destruct",value:function(){return this.sceneGraphRoot.remove(this.camera),this.depthTexture&&this.depthTexture.dispose&&(this.depthTexture.dispose(),this.depthTexture=null),this.camera=null,this.parent=null,this.sceneGraphRoot=null,!0}},{key:"lookAt",value:function(e,t,r){e&&this.camera.position.set(e.x,e.y,e.z),t&&this.camera.up.set(t.x,t.y,t.z),r&&(this._target=r,this.camera.matrix.setPosition(this.camera.position).lookAt(this.camera.position,new p.Vector3(r.x,r.y,r.z),this.camera.up)),this.camera.matrix.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.localToVideo.copy((new p.Matrix4).getInverse(this.camera.matrix))}},{key:"near",get:function(){return this.camera.near},set:function(e){this.camera.near=e,this.camera.updateProjectionMatrix()}},{key:"far",get:function(){return this.camera.far},set:function(e){this.camera.far=e,this.camera.updateProjectionMatrix(),this.projectorLogDepthBufferFC=2/(Math.log(1+this.camera.far)/Math.LN2)}},{key:"position",get:function(){return this.camera.position.clone()},set:function(e){var t=e.x,r=e.y,n=e.z;this.lookAt(new p.Vector3(t,r,n),this.up,this.target)}},{key:"up",get:function(){return this.camera.up.clone()},set:function(e){var t=e.x,r=e.y,n=e.z;this.lookAt(this.position,new p.Vector3(t,r,n),this.target)}},{key:"target",get:function(){return this._target},set:function(e){this.lookAt(void 0,void 0,e)}}])&&Wl(t.prototype,r),n&&Wl(t,n),e}();function Hl(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Kl=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.renderer=t,this.normalTarget=new p.WebGLRenderTarget,this.normalTarget.texture.format=p.RGBAFormat,this.normalTarget.texture.minFilter=p.NearestFilter,this.normalTarget.texture.magFilter=p.NearestFilter,this.normalTarget.texture.generateMipmaps=!1,this.scene=new p.Scene,this.depthShaderMaterial=new p.ShaderMaterial({uniforms:{logDepthBufFC:{type:"f",value:1}},vertexShader:"\n      #ifdef USE_LOGDEPTHBUF\n        #ifdef USE_LOGDEPTHBUF_EXT\n          varying float vFragDepth;\n        #else\n          uniform float logDepthBufFC;\n        #endif\n      #endif\n      void main() {\n        vec3 transformed = vec3( position );\n        vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\n        gl_Position = projectionMatrix * mvPosition;\n        #ifdef USE_LOGDEPTHBUF\n          #ifdef USE_LOGDEPTHBUF_EXT\n            vFragDepth = 1.0 + gl_Position.w;\n          #else\n            gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n            gl_Position.z *= gl_Position.w;\n          #endif\n        #endif\n      }",fragmentShader:"\n      float shift_right(float v, float amt) {\n        v = floor(v) + 0.5;\n        return floor(v / exp2(amt));\n      }\n      float shift_left(float v, float amt) {\n        return floor(v * exp2(amt) + 0.5);\n      }\n      float mask_last(float v, float bits) {\n        return mod(v, shift_left(1.0, bits));\n      }\n      float extract_bits(float num, float from, float to) {\n        from = floor(from + 0.5);\n        to = floor(to + 0.5);\n        return mask_last(shift_right(num, from), to - from);\n      }\n      vec4 encode_float(float val) {\n        if (val == 0.0)\n          return vec4(0, 0, 0, 0);\n        float sign = val > 0.0 ? 0.0 : 1.0;\n        val = abs(val);\n        float exponent = floor(log2(val));\n        float biased_exponent = exponent + 127.0;\n        float fraction = ((val / exp2(exponent)) - 1.0) * 8388608.0;\n        \n        float t = biased_exponent / 2.0;\n        float last_bit_of_biased_exponent = fract(t) * 2.0;\n        float remaining_bits_of_biased_exponent = floor(t);\n        \n        float byte4 = extract_bits(fraction, 0.0, 8.0) / 255.0;\n        float byte3 = extract_bits(fraction, 8.0, 16.0) / 255.0;\n        float byte2 = (last_bit_of_biased_exponent * 128.0 + extract_bits(fraction, 16.0, 23.0)) / 255.0;\n        float byte1 = (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;\n        return vec4(byte4, byte3, byte2, byte1);\n      }\n      #if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n        uniform float logDepthBufFC;\n        varying float vFragDepth;\n      #endif\n      void main() {\n        #if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n          float depth = log2( vFragDepth ) * logDepthBufFC * 0.5;\n          gl_FragDepthEXT = depth;\n          gl_FragColor = encode_float(depth);\n        #else\n          gl_FragColor = encode_float(gl_FragCoord.z);\n        #endif\n      }"})}var t,r,n;return t=e,(r=[{key:"destruct",value:function(){return this.normalTarget.texture.dispose(),this.normalTarget.dispose(),this.depthShaderMaterial.dispose(),this.normalTarget.texture=null,this.normalTarget=null,this.scene=null,this.depthShaderMaterial=null,!0}},{key:"renderColorSnapshot",value:function(e,t,r,n){this.scene.overrideMaterial=void 0,this.normalTarget.setSize(r,n),this.scene.children=t;var i=this.renderer.getClearColor(),o=this.renderer.getClearAlpha();this.renderer.setClearColor(16777215,0),this.renderer.render(this.scene,e,this.normalTarget,!0),this.renderer.setClearColor(i,o);var a=new Uint8Array(4*r*n);return this.renderer.readRenderTargetPixels(this.normalTarget,0,0,r,n,a),this.scene.children=[],y.clearRenderListRenferenceToMesh(this.renderer.renderLists.get(this.scene,e)),a}},{key:"renderDepthSnapshot",value:function(e,t,r,n,i){var o={side:this.depthShaderMaterial.side};i&&void 0!==i.side&&(this.depthShaderMaterial.side=i.side),this.scene.overrideMaterial=this.depthShaderMaterial,this.scene.overrideMaterial.uniforms.logDepthBufFC.value=2/(Math.log(e.far+1)/Math.LN2),this.normalTarget.setSize(r,n),this.scene.children=t;var a=this.renderer.getClearColor(),s=this.renderer.getClearAlpha();this.renderer.setClearColor(new p.Color(0,0,128/255),63/255),this.renderer.render(this.scene,e,this.normalTarget),this.renderer.setClearColor(a,s);var u=new Uint8Array(4*r*n);this.renderer.readRenderTargetPixels(this.normalTarget,0,0,r,n,u);var c=new Float32Array(u.buffer);return this.scene.children=[],this.depthShaderMaterial.side=o.side,y.clearRenderListRenferenceToMesh(this.renderer.renderLists.get(this.scene,e)),c}}])&&Hl(t.prototype,r),n&&Hl(t,n),e}();function ql(e){return(ql="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Yl(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Xl(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Zl(e,t){return!t||"object"!==ql(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ql(e,t,r){return(Ql="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Jl(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function Jl(e){return(Jl=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function $l(e,t){return($l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ef=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.tree,i=r.Type;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),e=Zl(this,Jl(t).call(this,{tree:n,Type:i}));var o=p.UniformsUtils.merge([{},Wo.visibility.uniforms]);return e._sharedUniforms=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){Yl(e,t,r[t])})}return e}({},e._sharedUniforms,o),t.offlineRenderer?(e.renderer=t.offlineRenderer.renderer,e.offlineRenderer=t.offlineRenderer):(e.renderer=new p.WebGLRenderer({antialias:!0,premultipliedAlpha:!1,alpha:!1,logarithmicDepthBuffer:!1}),e.renderer.setClearColor(new p.Color(.15294117647058825,.15294117647058825,.15294117647058825),void 0),e.renderer.setPixelRatio(1),e.renderer.setSize(1024,1024),e.renderer.context.getExtension("OES_standard_derivatives"),e.renderer.name="Projector renderer",e.offlineRenderer=new Kl(e.renderer),t.offlineRenderer=e.offlineRenderer),e}var r,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&$l(e,t)}(t,dr),r=t,(n=[{key:"destruct",value:function(){var e=!0;return this.clearProjectors(),this.offlineRenderer=null,this.renderer=null,e=Ql(Jl(t.prototype),"destruct",this).call(this)&&e}},{key:"generateTileMaterial",value:function(e){var t={map:e.style.map,sharedUniforms:this._sharedUniforms};return new this.Type(t)}},{key:"addProjector",value:function(e){var t=e.options,r=e.ProjectorType,n=new(void 0===r?Gl:r)(t),i=this;return void 0!==n.vdom&&n.vdom.readyState<2&&(n.visible=!1,n.vdom.addEventListener("loadeddata",function(){n.vdom.readyState>=2&&(n.visible=!0)})),i._sharedUniforms.projectors.value.push(n),i._sharedUniforms.depthTexture.value.push(n.depthTexture),i._sharedUniforms.count.value+=1,n}},{key:"getProjectorIndex",value:function(e){if(!e)return-1;for(var t=-1,r=0;r<this.projectors.length;++r)if(this.projectors[r].ID===e.ID){t=r;break}return t}},{key:"clearProjectors",value:function(){this._sharedUniforms.count.value=0;var e=this._sharedUniforms.projectors.value.map(function(e){return e});this._sharedUniforms.projectors.value.splice(0,this._sharedUniforms.projectors.value.length),this._sharedUniforms.depthTexture.value.splice(0,this._sharedUniforms.depthTexture.value.length),this._sharedUniforms.videoTexture.value.splice(0,this._sharedUniforms.videoTexture.value.length),e.map(function(e){e.destruct()})}},{key:"removeProjectorByIndex",value:function(e){var t=this._sharedUniforms.projectors.value[e];t&&(this._sharedUniforms.count.value-=1,this._sharedUniforms.projectors.value.splice(e,1),this._sharedUniforms.depthTexture.value.splice(e,1),t.destruct())}},{key:"_updateMaterials",value:function(){this.tree.traverse(this.tree.root,function(e){if(e&&e.content&&e.content.material){var t=e.content.material;if(Array.isArray(t))for(var r=0;r<t.length;++r)t[r].update&&t[r].update();else t.update&&t.update()}})}},{key:"projectors",get:function(){return this._sharedUniforms.projectors.value}}])&&Xl(r.prototype,n),i&&Xl(r,i),t}();ef.offlineRenderer=null;var tf=ef;function rf(e){return(rf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function nf(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function of(e,t){return!t||"object"!==rf(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function af(e,t,r){return(af="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=sf(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function sf(e){return(sf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function uf(e,t){return(uf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var cf=function(e){function t(e){var r,n=e.fov,i=e.aspect,o=e.near,a=e.far,s=e.position,u=e.up,c=e.target,l=e.projectorTreeMaterial,f=e.offlineRenderer,h=e.sceneGraphRoot,d=e.videoSrcUrl,v=e.type,y=e.videoDom;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var m=new p.PerspectiveCamera(n,i,o,a);return m.position.set(s.x,s.y,s.z),m.up.set(u.x,u.y,u.z),m.lookAt(new p.Vector3(c.x,c.y,c.z)),m.updateProjectionMatrix(),m.updateMatrix(),m.updateMatrixWorld(),(r=of(this,sf(t).call(this,{camera:m,parent:l,sceneGraphRoot:h,offlineRenderer:f})))._target=c,d?(r.vdom=document.createElement("video"),r.vdom.id=d,r.vdom.loop="true",r.vdom.autoplay="true",r.vdom.muted="true",r.vdom.preload="metadata",r.vdom.crossOrigin="anonymous",r.vdom.style="display:none",r.vsrc=document.createElement("source"),r.vsrc.src=d,r.vsrc.type=v,r.vdom.appendChild(r.vsrc),r.vdom.load(),r.vdom.play(),r._videoPath=d,r._videoType=v):y&&(r.vdom=y,y.hasChildNodes()&&"SOURCE"===y.children[0].tagName&&(r.vsrc=y.children[0]),console.log("video",r.vdom)),r.videoTexture=new p.VideoTexture(r.vdom),r.videoTexture.minFilter=r.videoTexture.magFilter=p.LinearFilter,r.videoTexture.format=p.RGBFormat,r.isVideo=!0,r.alpha=1,r}var r,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&uf(e,t)}(t,Gl),r=t,(n=[{key:"destruct",value:function(){return this.videoTexture.dispose(),this.videoTexture=null,this.vdom.pause(),this.vdom.removeAttribute("src"),this.vsrc&&(this.vdom.removeChild(this.vsrc),this.vsrc.removeAttribute("src")),this.vdom.load(),this.vdom=null,this.vsrc=null,af(sf(t.prototype),"destruct",this).call(this)}},{key:"playVideo",value:function(){return this.vdom.play()}},{key:"fov",get:function(){return this.camera.fov},set:function(e){this.camera.fov=e,this.camera.updateProjectionMatrix()}},{key:"aspect",get:function(){return this.camera.aspect},set:function(e){this.camera.aspect=e,this.camera.updateProjectionMatrix()}}])&&nf(r.prototype,n),i&&nf(r,i),t}();function lf(e){return(lf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ff(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function hf(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function pf(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function df(e,t){return!t||"object"!==lf(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function vf(e){return(vf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function yf(e,t){return(yf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var mf=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.level,i=r.x,o=r.y,a=r.sharedUniforms,s=r.map,u=(r.color,r.transparent),c=void 0!==u&&u,l=hf(r,["level","x","y","sharedUniforms","map","color","transparent"]);return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=df(this,vf(t).call(this,l))).level=n,e.x=i,e.y=o,e.uniforms=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){ff(e,t,r[t])})}return e}({map:{type:"t",value:s}},a),e.update(),e.transparent=c,e}var r,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&yf(e,t)}(t,p["ShaderMaterial"]),r=t,(n=[{key:"update",value:function(){var e=this.uniforms.count.value,t=Wo.video.vertexShader.slice(),r=Wo.video.fragmentShader.slice();e>=1&&(t="#define PROJECTOR\n#define VIDEO\n"+(t=t.replace(/MAX_COUNT/g,e)),r="#define PROJECTOR\n#define VIDEO\n"+(r=r.replace(/MAX_COUNT/g,e))),this.vertexShader=t,this.fragmentShader=r,this.needsUpdate=!0}}])&&pf(r.prototype,n),i&&pf(r,i),t}();function gf(e){return(gf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function bf(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _f(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function wf(e,t){return!t||"object"!==gf(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function xf(e,t,r){return(xf="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Af(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function Af(e){return(Af=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function kf(e,t){return(kf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Of=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.tree,i=r.Type,o=void 0===i?mf:i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),e=wf(this,Af(t).call(this,{tree:n,Type:o}));var a=p.UniformsUtils.merge([{},Wo.video.uniforms]);return e._sharedUniforms=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){bf(e,t,r[t])})}return e}({},e._sharedUniforms,a),e}var r,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&kf(e,t)}(t,tf),r=t,(n=[{key:"destruct",value:function(){var e=!0;return this.clearProjectors(),e=xf(Af(t.prototype),"destruct",this).call(this)&&e}},{key:"addProjector",value:function(e){var r=e.fov,n=e.aspect,i=e.near,o=e.far,a=e.position,s=e.up,u=e.target,c=e.videoSrcUrl,l=e.type,f=e.videoDom,h=xf(Af(t.prototype),"addProjector",this).call(this,{options:{fov:r,aspect:n,near:i,far:o,position:a,up:s,target:u,offlineRenderer:this.offlineRenderer,sceneGraphRoot:this.tree.sceneGraphRoot,videoSrcUrl:c,type:l,videoDom:f,projectorTreeMaterial:this},ProjectorType:cf});return this._sharedUniforms.videoTexture.value.push(h.videoTexture),this._updateMaterials(),h}},{key:"addVisibility",value:function(e){var r=e.fov,n=e.aspect,i=e.near,o=e.far,a=e.position,s=e.up,u=e.target,c=new p.PerspectiveCamera(r,n,i,o);c.position.set(a.x,a.y,a.z),c.up.set(s.x,s.y,s.z),c.lookAt(new p.Vector3(u.x,u.y,u.z));var l=xf(Af(t.prototype),"addProjector",this).call(this,{options:{target:u,camera:c,offlineRenderer:this.offlineRenderer,sceneGraphRoot:this.tree.sceneGraphRoot,parent:this}});return this._sharedUniforms.videoTexture.value.push(l.videoTexture),this._updateMaterials(),l}},{key:"removeProjectorByIndex",value:function(e){var t=this._sharedUniforms.projectors.value[e];t&&(this._sharedUniforms.count.value-=1,this._sharedUniforms.projectors.value.splice(e,1),this._sharedUniforms.depthTexture.value.splice(e,1),this._sharedUniforms.videoTexture.value.splice(e,1),t.destruct(),this._updateMaterials())}},{key:"clearProjectors",value:function(){xf(Af(t.prototype),"clearProjectors",this).call(this),this._sharedUniforms.videoTexture.value.splice(0,this._sharedUniforms.videoTexture.value.length),this._updateMaterials()}}])&&_f(r.prototype,n),i&&_f(r,i),t}();function Sf(e){return(Sf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Pf(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Tf(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function Ef(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Mf(e,t){return!t||"object"!==Sf(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function jf(e){return(jf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Cf(e,t){return(Cf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Rf=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.level,i=r.x,o=r.y,a=r.map,s=r.sharedUniforms,u=Tf(r,["level","x","y","map","sharedUniforms"]);return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=Mf(this,jf(t).call(this,u))).level=n,e.x=i,e.y=o,e.uniforms=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){Pf(e,t,r[t])})}return e}({map:{ype:"t",value:a}},s),e.vertexShader=Wo.crop.vertexShader,e.fragmentShader=Wo.crop.fragmentShader,e}var r,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Cf(e,t)}(t,p["ShaderMaterial"]),r=t,(n=[{key:"update",value:function(){this.needsUpdate=!0}}])&&Ef(r.prototype,n),i&&Ef(r,i),t}(),If=r(10),Lf=r.n(If),Bf=3e4;function Uf(e){var t=e.api,r=e.pid,n=e.type,i=e.debug,o=void 0!==i&&i;switch(n){case"crop":return function(e){var t=e.api,r=e.pid,n=e.debug;return t?t.cropMask({pid:r,timeout:Bf}).then(function(e){var t=0;n&&(t=Date.now());var r=Lf.a.unpackToImage(e.maskInfos[0]),i=e.maskInfos[0].height;return n&&console.log("decode time",Date.now()-t),e=void 0,Promise.resolve({image:r,maskSize:i})}):Promise.reject(new Error("No api"))}({api:t,pid:r,debug:o});case"water":return function(e){var t=e.api,r=e.pid,n=e.debug;return t?t.waterMask({pid:r,timeout:Bf}).then(function(e){if(null===e)return Promise.reject(new Error("No water exists."));var t=0;n&&(t=Date.now());var r=e.maskInfos.map(function(e){var t=e.level,r=e.alpha,n=e.wave,i=e.speed,o=void 0===i?.5:i,a=e.color,s=e.polyNum,u=e.width,c=e.height;return{image:Lf.a.unpackToImage(e),level:t,alpha:r,wave:n,speed:o,color:a,polyNum:s,width:u,height:c}});return n&&console.log("decode time",Date.now()-t),e=void 0,Promise.resolve(r)}):Promise.reject(new Error("No api"))}({api:t,pid:r,debug:o});default:var a="Uknown mask type"+n;return console.warn(a),Promise.reject(new Error(a))}}function Df(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Nf=function(){function e(t){var r=t.maskSize,n=void 0===r?4:r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._maskSize=n,this.canvas=document.createElement("canvas"),this.canvas.width=this.maskSize,this.canvas.height=this.maskSize,this.canvas.id="ProjectBooleanMask";var i=this.canvas.getContext("2d");i.fillStyle="#fff",i.fillRect(0,0,n,n),this.needsUpdate=!0}var t,r,n;return t=e,(r=[{key:"destruct",value:function(){return this.canvas=void 0,!0}},{key:"paintPolygon",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#000",r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=this.canvas.getContext("2d"),i=e.length;if(!(i<3)){n.fillStyle=t,n.strokeStyle="#0f0",n.beginPath();var o=this.maskSize;r||(n.moveTo(0,0),n.lineTo(0,o),n.lineTo(o,o),n.lineTo(o,0),n.closePath());var a=e.map(function(e){var t=e.u,r=e.v;return{x:Math.floor(t*o),y:o-Math.floor(r*o)}}),s=a[--i];for(n.moveTo(s.x,s.y);i--;)n.lineTo(a[i].x,a[i].y);return n.closePath(),r?n.fill():n.fill("evenodd"),this.needsUpdate=!0,!0}}},{key:"clear",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"#0f0";return this.paintPolygon([{u:0,v:0},{u:0,v:1},{u:1,v:1},{u:1,v:0},{u:0,v:0}],e)}},{key:"packMask",value:function(){for(var e=this.maskSize,t=this.imageData,r=e,n=e,i=[],o=!0,a=0,s=1;s<t.length;)o===t[s]<12.75?(a+=1,s+=4):(i.push(a),a=0,o=!o);return a>0&&i.push(a),{width:r,height:n,data:i}}},{key:"maskSize",get:function(){return this._maskSize},set:function(e){e!==this.maskSize&&(this.canvas.width=e,this.canvas.height=e,this._maskSize=e)}},{key:"imageData",get:function(){return this.canvas.getContext("2d").getImageData(0,0,this.canvas.width,this.canvas.height).data},set:function(e){var t=e.uint8,r=e.maskSize;this.maskSize=r;var n=new ImageData(t,r,r);this.canvas.getContext("2d").putImageData(n,0,0),this.needsUpdate=!0}},{key:"texture",get:function(){if(this.needsUpdate){this._texture&&this._texture.dispose();var e=new Uint8Array(this.imageData,1);this._texture=new p.DataTexture(e,this.maskSize,this.maskSize,p.RGBAFormat,p.UnsignedByteType),this._texture.needsUpdate=!0}return this.needsUpdate=!1,this._texture}}])&&Df(t.prototype,r),n&&Df(t,n),e}();function zf(e){return(zf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ff(e,t,r,n,i,o,a){try{var s=e[o](a),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,i)}function Vf(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Wf(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Gf(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Hf(e,t,r){return(Hf="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Kf(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function Kf(e){return(Kf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function qf(e,t){return(qf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Yf=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.tree,i=r.Type,o=void 0===i?Rf:i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t){return!t||"object"!==zf(t)&&"function"!=typeof t?Gf(e):t}(this,Kf(t).call(this,{tree:n,Type:o})))._cropMask=new Nf({maskSize:1024});var a=p.UniformsUtils.merge([{},Wo.crop.uniforms]);e._sharedUniforms=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){Vf(e,t,r[t])})}return e}({},e._sharedUniforms,a),e._sharedUniforms.cropMask.value=e._cropMask.texture;var s=Gf(e);return e.initialized=new Promise(function(e,t){s._onInitSuccess=e,s._onInitFail=t}),e}var r,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&qf(e,t)}(t,dr),r=t,(n=[{key:"destruct",value:function(){return this._cropMask.destruct(),Hf(Kf(t.prototype),"destruct",this).call(this)}},{key:"loadCropMask",value:function(){var e,t=(e=regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this,e.abrupt("return",Uf({api:this.altizureApi,pid:this.PID,type:"crop"}).then(function(e){return t._onInitSuccess(t),t._updateCropMask({uint8:e.image.rgba,maskSize:e.maskSize}),t._updateOrthoInfo(),Promise.resolve(t)}).catch(function(e){return t._onInitFail(e),Promise.reject(e)}));case 2:case"end":return e.stop()}},e,this)}),function(){var t=this,r=arguments;return new Promise(function(n,i){var o=e.apply(t,r);function a(e){Ff(o,n,i,a,s,"next",e)}function s(e){Ff(o,n,i,a,s,"throw",e)}a(void 0)})});return function(){return t.apply(this,arguments)}}()},{key:"_updateCropMask",value:function(e){var t=e.uint8,r=e.maskSize;return this._cropMask.imageData={uint8:t,maskSize:r},this._sharedUniforms.cropMask.value&&this._sharedUniforms.cropMask.value.dispose(),this._sharedUniforms.cropMask.value=this._cropMask.texture,!0}},{key:"refreshMask",value:function(){return this._updateOrthoInfo(),this._sharedUniforms.cropMask.value!==this._cropMask.texture&&(this._sharedUniforms.cropMask.value.dispose(),this._sharedUniforms.cropMask.value=this._cropMask.texture),!0}},{key:"generateTileMaterial",value:function(e){var t=e.style,r={level:t.level,x:t.x,y:t.y,map:t.map,sharedUniforms:this._sharedUniforms};return new this.Type(r)}},{key:"_updateOrthoInfo",value:function(){var e=this.tree.projInfo.orthoInfo(this.tree.projInfo.modelTransform.objToOldDisplay);return this._sharedUniforms.origin.value=e.origin,this._sharedUniforms.xDir.value=e.xDir,this._sharedUniforms.yDir.value=e.yDir,this._sharedUniforms.zDir.value=e.zDir,this._sharedUniforms.minBound.value=e.minBound,this._sharedUniforms.maxBound.value=e.maxBound,!0}},{key:"altizureApi",get:function(){return this.tree.altizureApi}},{key:"PID",get:function(){return this.tree.projInfo.id}}])&&Wf(r.prototype,n),i&&Wf(r,i),t}();function Xf(e){return(Xf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Zf(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Qf(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function Jf(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function $f(e,t){return!t||"object"!==Xf(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function eh(e){return(eh=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function th(e,t){return(th=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var rh=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.level,i=r.x,o=r.y,a=r.sharedUniforms,s=r.transparent,u=void 0!==s&&s,c=Qf(r,["level","x","y","sharedUniforms","transparent"]);!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var l=c.map;return l||console.warn("no map"),(e=$f(this,eh(t).call(this))).level=n,e.x=i,e.y=o,e.uniforms=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){Zf(e,t,r[t])})}return e}({map:{value:l}},a),e.update(),e.transparent=u,e}var r,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&th(e,t)}(t,p["ShaderMaterial"]),r=t,(n=[{key:"update",value:function(){var e=this.uniforms.count.value,t=Wo.visibility.vertexShader.slice(),r=Wo.visibility.fragmentShader.slice();e>=1&&(t="#define PROJECTOR\n#define VISIBILITY\n"+(t=t.replace(/MAX_COUNT/g,e)),r="#define PROJECTOR\n#define VISIBILITY\n"+(r=r.replace(/MAX_COUNT/g,e))),this.vertexShader=t,this.fragmentShader=r,this.needsUpdate=!0}}])&&Jf(r.prototype,n),i&&Jf(r,i),t}();function nh(e){return(nh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ih(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function oh(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ah(e,t){return!t||"object"!==nh(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function sh(e,t,r){return(sh="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=uh(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function uh(e){return(uh=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ch(e,t){return(ch=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var lh=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.tree,i=r.Type,o=void 0===i?rh:i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=ah(this,uh(t).call(this,n,o)))._tree=n,e._Type=o,e}var r,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ch(e,t)}(t,tf),r=t,(n=[{key:"destruct",value:function(){return this._tree=void 0,this._Type=void 0,!0}},{key:"updateMaterial",value:function(){return this.tree.traverse(this.tree.root,function(e){return e.updateMaterial(),!0})}},{key:"generateTileMaterial",value:function(e){var t=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){ih(e,t,r[t])})}return e}({sharedUniforms:this._sharedUniforms},e.style,this.tree.style);return e.geometry.computeVertexNormals(),new this.Type(t)}},{key:"addProjector",value:function(e){var r=e.fov,n=e.aspect,i=e.near,o=e.far,a=e.position,s=e.up,u=e.target,c=new p.PerspectiveCamera(r,n,i,o);c.position.set(a.x,a.y,a.z),c.up.set(s.x,s.y,s.z),c.lookAt(new p.Vector3(u.x,u.y,u.z));var l=sh(uh(t.prototype),"addProjector",this).call(this,{options:{target:u,camera:c,offlineRenderer:this.offlineRenderer,sceneGraphRoot:this.tree.sceneGraphRoot,parent:this}});return this._updateMaterials(),l}},{key:"removeProjectorByIndex",value:function(e){sh(uh(t.prototype),"removeProjectorByIndex",this).call(this,e),this._updateMaterials()}},{key:"clearProjectors",value:function(){sh(uh(t.prototype),"clearProjectors",this).call(this),this._updateMaterials()}}])&&oh(r.prototype,n),i&&oh(r,i),t}();function fh(e){return(fh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function hh(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function ph(e,t){return!t||"object"!==fh(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function dh(e){return(dh=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function vh(e,t){return(vh=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var yh=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.level,i=r.x,o=r.y,a=hh(r,["level","x","y"]);!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var s=a.map;return s||console.warn("no map"),(e=ph(this,dh(t).call(this,{map:s,color:new p.Color(1,1,1),lights:!0,shininess:0,specular:new p.Color(0,0,0)}))).level=n,e.x=i,e.y=o,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&vh(e,t)}(t,Yo),t}();function mh(e){return(mh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function gh(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function bh(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function _h(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function wh(e,t){return!t||"object"!==mh(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function xh(e){return(xh=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ah(e,t){return(Ah=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var kh=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.level,i=r.x,o=r.y,a=r.map,s=r.sharedUniforms,u=bh(r,["level","x","y","map","sharedUniforms"]);return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=wh(this,xh(t).call(this,u))).level=n,e.x=i,e.y=o,e.uniforms=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){gh(e,t,r[t])})}return e}({map:{type:"t",value:a}},s),e.update(),e}var r,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ah(e,t)}(t,p["ShaderMaterial"]),r=t,(n=[{key:"update",value:function(){var e=this.uniforms.count.value,t=Wo.cropAndVideo.vertexShader.slice(),r=Wo.cropAndVideo.fragmentShader.slice();e>=1&&(t="#define PROJECTOR\n#define VIDEO\n#define VISIBILITY\n"+(t=t.replace(/MAX_COUNT/g,e)),r="#define PROJECTOR\n#define VIDEO\n#define VISIBILITY\n"+(r=r.replace(/MAX_COUNT/g,e))),this.vertexShader=t,this.fragmentShader=r,this.needsUpdate=!0}}])&&_h(r.prototype,n),i&&_h(r,i),t}();function Oh(e){return(Oh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Sh(e,t,r,n,i,o,a){try{var s=e[o](a),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,i)}function Ph(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){Th(e,t,r[t])})}return e}function Th(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Eh(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Mh(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function jh(e,t,r){return(jh="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Ch(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function Ch(e){return(Ch=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Rh(e,t){return(Rh=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ih=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.tree,i=r.Type,o=void 0===i?kh:i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t){return!t||"object"!==Oh(t)&&"function"!=typeof t?Mh(e):t}(this,Ch(t).call(this,{tree:n,Type:o})))._cropMask=new Nf({maskSize:1024});var a=p.UniformsUtils.merge([{},Wo.crop.uniforms]);a.cropMask.value=e._cropMask.texture,e._sharedUniforms=Ph({},e._sharedUniforms,a);var s=Mh(e);return e.initialized=new Promise(function(e,t){s._onInitSuccess=e,s._onInitFail=t}),e}var r,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Rh(e,t)}(t,Of),r=t,(n=[{key:"destruct",value:function(){return this._cropMask.destruct(),jh(Ch(t.prototype),"destruct",this).call(this)}},{key:"generateTileMaterial",value:function(e){var t=e.style,r={level:t.level,x:t.x,y:t.y,map:t.map,sharedUniforms:Ph({},this._sharedUniforms,this._projectorUniforms)};return new this.Type(r)}},{key:"loadCropMask",value:function(){var e,t=(e=regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this,e.abrupt("return",Uf({api:this.altizureApi,pid:this.PID,type:"crop"}).then(function(e){return t._onInitSuccess(t),t._updateCropMask({uint8:e.image.rgba,maskSize:e.maskSize}),t._updateOrthoInfo(),Promise.resolve(t)}).catch(function(e){return t._onInitFail(e),Promise.reject(e)}));case 2:case"end":return e.stop()}},e,this)}),function(){var t=this,r=arguments;return new Promise(function(n,i){var o=e.apply(t,r);function a(e){Sh(o,n,i,a,s,"next",e)}function s(e){Sh(o,n,i,a,s,"throw",e)}a(void 0)})});return function(){return t.apply(this,arguments)}}()},{key:"_updateCropMask",value:function(e){var t=e.uint8,r=e.maskSize;return this._cropMask.imageData={uint8:t,maskSize:r},this._sharedUniforms.cropMask.value&&this._sharedUniforms.cropMask.value.dispose(),this._sharedUniforms.cropMask.value=this._cropMask.texture,!0}},{key:"refreshMask",value:function(){return this._updateOrthoInfo(),this._sharedUniforms.cropMask.value!==this._cropMask.texture&&(this._sharedUniforms.cropMask.value.dispose(),this._sharedUniforms.cropMask.value=this._cropMask.texture),!0}},{key:"_updateOrthoInfo",value:function(){var e=this.tree.projInfo.orthoInfo(this.tree.projInfo.modelTransform.objToOldDisplay);return this._sharedUniforms.origin.value=e.origin,this._sharedUniforms.xDir.value=e.xDir,this._sharedUniforms.yDir.value=e.yDir,this._sharedUniforms.zDir.value=e.zDir,this._sharedUniforms.minBound.value=e.minBound,this._sharedUniforms.maxBound.value=e.maxBound,!0}},{key:"altizureApi",get:function(){return this.tree.altizureApi}},{key:"PID",get:function(){return this.tree.projInfo.id}}])&&Eh(r.prototype,n),i&&Eh(r,i),t}();function Lh(e){return(Lh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Bh(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Uh(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function Dh(e,t){return!t||"object"!==Lh(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Nh(e){return(Nh=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function zh(e,t){return(zh=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Fh=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.level,i=r.x,o=r.y,a=r.map,s=(r.color,r.emissive,r.shininess,r.specular,r.specularMap,r.contourLineUniforms),u=Uh(r,["level","x","y","map","color","emissive","shininess","specular","specularMap","contourLineUniforms"]);return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=Dh(this,Nh(t).call(this,u))).level=n,e.x=i,e.y=o,e.uniforms=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){Bh(e,t,r[t])})}return e}({map:{value:a}},s),e.transparent=!0,e.vertexShader=Vh,e.fragmentShader=Wh,e.extensions.derivatives=!0,e.depthWrite=!0,e.side=p.DoubleSide,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&zh(e,t)}(t,p["ShaderMaterial"]),t}(),Vh=["varying vec3 localPosition;","varying float slope;","varying vec2 vUv;","varying vec3 vPosition;","#include <logdepthbuf_pars_vertex>","void main() {","vUv = uv;","localPosition = position;","slope = abs(normalize(normal).z);","vec4 inPosition = vec4(position, 1.0);","vec3 transformed = vec3( position );","vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );","gl_Position = projectionMatrix * mvPosition;","vPosition = (modelViewMatrix * inPosition).xyz;","#include <logdepthbuf_vertex>","}"].join("\n"),Wh=["varying vec3 localPosition;","varying float slope;","varying vec2 vUv;","varying vec3 vPosition;","uniform vec3 color;","uniform float heightInterval;","uniform float lineWidth;","uniform float mapAlpha;","uniform float distanceLimit;","uniform float worldToMeters;","uniform sampler2D map;","#include <logdepthbuf_pars_fragment>","void main() {","#include <logdepthbuf_fragment>","float distanceInMeters = worldToMeters * length(cameraPosition - vPosition);","float multiply = distanceInMeters / distanceLimit + 1.0;","multiply = multiply > 3.0 ? clamp(6.0 - multiply, 0.0, 3.0) : multiply;","float adaptedHeightInterval = heightInterval;","float adaptedLineWidth = min(lineWidth * multiply, heightInterval);","float f = abs(2.0 * fract(localPosition.z / adaptedHeightInterval) - 1.0);","float df = fwidth(localPosition.z / adaptedHeightInterval);","float fLimit0 = adaptedLineWidth * (1.0 + slope);","float fLimit1 = df * min(adaptedLineWidth, 10.0);","float fLimit = min(fLimit0, fLimit1);","float lineMix = f < fLimit ? f / fLimit : 1.0;","vec4 lineColor = vec4(color, 1.0);","vec4 mapColor = texture2D(map, vUv);","mapColor.a = mapAlpha;","gl_FragColor = mix(lineColor, mapColor, lineMix);","}"].join("\n"),Gh=Fh;function Hh(e){return(Hh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Kh(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function qh(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Yh(e,t){return!t||"object"!==Hh(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Xh(e,t,r){return(Xh="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Zh(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function Zh(e){return(Zh=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Qh(e,t){return(Qh=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Jh=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.tree,i=r.Type,o=void 0===i?Gh:i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=Yh(this,Zh(t).call(this,{tree:n,Type:o})))._contourLineUniforms={heightInterval:{type:"f",value:20},color:{type:"v3",value:new p.Color(16777215)},lineWidth:{type:"f",value:2},mapAlpha:{type:"f",value:.4},distanceLimit:{type:"f",value:3200},worldToMeters:{type:"f",value:1}},e}var r,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Qh(e,t)}(t,dr),r=t,(n=[{key:"generateTileMaterial",value:function(e){e.geometry.computeVertexNormals();var t=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){Kh(e,t,r[t])})}return e}({contourLineUniforms:this._contourLineUniforms},e.style);return new this.Type(t)}},{key:"destruct",value:function(){return Xh(Zh(t.prototype),"destruct",this).call(this)}},{key:"color",set:function(e){this._contourLineUniforms.color.value=new p.Color(e)},get:function(){return this._contourLineUniforms.color.value}},{key:"heightInterval",set:function(e){this._contourLineUniforms.heightInterval.value=e},get:function(){return this._contourLineUniforms.heightInterval.value}},{key:"lineWidth",set:function(e){this._contourLineUniforms.lineWidth.value=e},get:function(){return this._contourLineUniforms.lineWidth.value}},{key:"mapAlpha",set:function(e){this._contourLineUniforms.mapAlpha.value=e},get:function(){return this._contourLineUniforms.mapAlpha.value}}])&&qh(r.prototype,n),i&&qh(r,i),t}();function $h(e){return($h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ep(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function tp(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function rp(e,t){return!t||"object"!==$h(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function np(e){return(np=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ip(e,t){return(ip=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var op={factory:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=Lo.factory(e,t,r,n),o=p.ShaderMaterial,a=e===Ao||e===ko,s=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.level,o=r.x,s=r.y,u=r.map,c=r.sharedUniforms,l=tp(r,["level","x","y","map","sharedUniforms"]);return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=rp(this,np(t).call(this,l))).level=n,e.x=o,e.y=s,e.uniforms=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){ep(e,t,r[t])})}return e}({},e.uniforms,c,{map:{type:"t",value:u}}),e.vertexShader=i.vertexShader,e.fragmentShader=i.fragmentShader,e.defines.USE_MAP="",e.lights=a,e.needsUpdate=!0,e.update&&e.update(),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ip(e,t)}(t,o),t}();return 0!==r&&(s.prototype.update=function(){var e=this.uniforms.count.value,t=i.vertexShader.slice(),r=i.fragmentShader.slice();e>=1&&(t="#define PROJECTOR\n#define VIDEO\n#define VISIBILITY\n"+(t=t.replace(/MAX_COUNT/g,e)),r="#define PROJECTOR\n#define VIDEO\n#define VISIBILITY\n"+(r=r.replace(/MAX_COUNT/g,e))),this.vertexShader=t,this.fragmentShader=r,this.needsUpdate=!0}),s}};function ap(e){return(ap="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function sp(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function up(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function cp(e,t){return!t||"object"!==ap(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function lp(e,t,r){return(lp="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=fp(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function fp(e){return(fp=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function hp(e,t){return(hp=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var pp=[xo,Ao,ko,40,To];function dp(e){return pp.includes(e)}function vp(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Oo,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:So,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Po;return op.factory(e,t,r,n)}var yp=function(e){function t(e){var r,n=e.renderMode,i=void 0===n?xo:n,o=e.tree;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=vp(i=dp(i)?i:xo);return(r=cp(this,fp(t).call(this,{tree:o,Type:a})))._sharedUniforms=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){sp(e,t,r[t])})}return e}({},p.UniformsUtils.merge([Wo.all.uniforms]),r._sharedUniforms),r._renderMode=i,r._values={},r}var r,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&hp(e,t)}(t,Ih),r=t,(n=[{key:"generateTileMaterial",value:function(e){[Ao,ko,To].includes(this.renderMode)&&e.geometry.computeVertexNormals();var r=lp(fp(t.prototype),"generateTileMaterial",this).call(this,e);return function(e,t){for(var r in t)r in e&&(e[r]=t[r],e.needsUpdate=!0)}(r,this._values),r}},{key:"setValues",value:function(e){var t={},r=!1;for(var n in e)n in this._sharedUniforms?this._sharedUniforms[n].value=e[n]:(t[n]=e[n],this._values[n]=e[n],r=!0);function i(e,t){for(var r in t)r in e&&(e[r]=t[r],e.needsUpdate=!0)}r&&this.tree.traverse(this.tree.root,function(e){e&&e.content&&e.content.material&&(Array.isArray(e.content.material)?e.content.material.map(function(e){i(e,t)}):i(e.content.material,t))})}},{key:"renderMode",set:function(e){if(dp(e)){if(this._renderMode!==e)if(this._renderMode=e,40!==e&&e!==To){this.setValues({defines:{USE_MAP:""},wireframe:!1,flatShading:!1,diffuse:new p.Color(16777215)});var t=vp(e);this.Type=t}else if(40===e){this.setValues({defines:{USE_MAP:""},wireframe:!0});var r=vp(xo);this.Type=r}else if(e===To){this.setValues({defines:{},wireframe:!1,diffuse:new p.Color(10066329),emissive:new p.Color(0),flatShading:!0,metalness:0,roughness:1});var n=vp(ko);this.Type=n}}else console.warn("[AltizureTreeMaterial] invalid input renderMode",e)},get:function(){return this._renderMode}}])&&up(r.prototype,n),i&&up(r,i),t}();function mp(e){return(mp="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function gp(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function bp(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function _p(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function wp(e,t){return!t||"object"!==mp(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function xp(e){return(xp=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ap(e,t){return(Ap=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var kp=function(e){function t(e){var r,n=e.sharedUniforms,i=e.level,o=e.x,a=e.y,s=bp(e,["sharedUniforms","level","x","y"]);return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=wp(this,xp(t).call(this,s))).level=i,r.x=o,r.y=a,r.uniforms=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){gp(e,t,r[t])})}return e}({},r.uniforms,n),r.update(),r}var r,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ap(e,t)}(t,Yo),r=t,(n=[{key:"update",value:function(){var e=this.uniforms.count.value,t=Wo.pcp.vertexShader.slice(),r=Wo.pcp.fragmentShader.slice();e>=1&&(t="#define PROJECTOR\n#define VIDEO\n#define VISIBILITY\n"+(t=t.replace(/MAX_COUNT/g,e)),r="#define PROJECTOR\n#define VIDEO\n#define VISIBILITY\n"+(r=r.replace(/MAX_COUNT/g,e))),this.vertexShader=t,this.fragmentShader=r,this.needsUpdate=!0}}])&&_p(r.prototype,n),i&&_p(r,i),t}();function Op(e){return(Op="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Sp(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Pp(e,t){return!t||"object"!==Op(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Tp(e){return(Tp=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ep(e,t){return(Ep=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Mp=function(e){function t(e){var r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=p.UniformsUtils.merge([{},Wo.basic2.uniforms]);return void 0!==e.alphaChannel&&(n.alphaChannel.value=e.alphaChannel),(r=Pp(this,Tp(t).call(this,{uniforms:n,vertexShader:jp,fragmentShader:Cp}))).isMeshBasicMaterial=!0,r.color=new p.Color(16777215),r.map=null,r.lightMap=null,r.lightMapIntensity=1,r.aoMap=null,r.aoMapIntensity=1,r.specularMap=null,r.alphaMap=null,r.envMap=null,r.combine=p.MultiplyOperation,r.reflectivity=1,r.refractionRatio=.98,r.wireframe=!1,r.wireframeLinewidth=1,r.wireframeLinecap="round",r.wireframeLinejoin="round",r.skinning=!1,r.morphTargets=!1,r.lights=!1,r._useGeometryInstance=!1,r.setValues(e),r}var r,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ep(e,t)}(t,p["ShaderMaterial"]),r=t,(n=[{key:"alphaChannel",set:function(e){0===e||1===e||2===e||3===e?this.uniforms.alphaChannel.value=e:console.warn("only 0, 1, 2, 3 are valid values")},get:function(){return this.uniforms.alphaChannel.value}}])&&Sp(r.prototype,n),i&&Sp(r,i),t}(),jp=Wo.basic2.vertexShader,Cp=Wo.basic2.fragmentShader,Rp=Mp;function Ip(e){return(Ip="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Lp(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Bp(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function Up(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Dp(e,t){return!t||"object"!==Ip(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Np(e){return(Np=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function zp(e,t){return(zp=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Fp=function(e){function t(e){var r,n=e.sharedUniforms,i=e.level,o=e.x,a=e.y,s=Bp(e,["sharedUniforms","level","x","y"]);return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=Dp(this,Np(t).call(this,s))).level=i,r.x=o,r.y=a,r.uniforms=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){Lp(e,t,r[t])})}return e}({},r.uniforms,n),r.update(),r}var r,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&zp(e,t)}(t,Rp),r=t,(n=[{key:"update",value:function(){var e=this.uniforms.count.value,t=Wo.bcp.vertexShader.slice(),r=Wo.bcp.fragmentShader.slice();e>=1&&(t="#define PROJECTOR\n#define VIDEO\n#define VISIBILITY\n"+(t=t.replace(/MAX_COUNT/g,e)),r="#define PROJECTOR\n#define VIDEO\n#define VISIBILITY\n"+(r=r.replace(/MAX_COUNT/g,e))),this.vertexShader=t,this.fragmentShader=r,this.needsUpdate=!0}}])&&Up(r.prototype,n),i&&Up(r,i),t}();function Vp(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Wp(e){return(Wp="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Gp(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Hp=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.spec_version=new Za(0,0,0),this.id=null,this.name=null,this.owner={},this.owner.id=null,this.owner.name=null,this.isImported=null,this.modelType=null,this.views=null,this.date=null,this.versionControl=null,this.cloudPath=null,this.geoInfo={},this.modelTransform={},this.modelTransform.origin=null,this.modelTransform.xDir=null,this.modelTransform.yDir=null,this.modelTransform.zDir=null,this.modelTransform.minBound=null,this.modelTransform.maxBound=null,this.modelTransform.xTiles=null,this.modelTransform.yTiles=null,this.modelTransform.zTiles=null,this.modelTransform.objToOldDisplay=null,this.modelTransform.initialCamPos=null,t&&(this.processProjectInfo(t),this.validate()),r&&(this.processInfoTxt(r),this.validate())}var t,r,n;return t=e,(r=[{key:"destruct",value:function(){return this.id=null,this.name=null,this.owner.id=null,this.owner.name=null,this.owner={},this.isImported=null,this.modelType=null,this.views=null,this.date=null,this.versionControl=null,this.cloudPath=null,this.geoInfo.autoAligned=null,this.geoInfo.minLat=null,this.geoInfo.minLong=null,this.geoInfo.maxLat=null,this.geoInfo.maxLong=null,this.geoInfo.centerLat=null,this.geoInfo.centerLong=null,this.geoInfo={},this.modelTransform.origin=null,this.modelTransform.xDir=null,this.modelTransform.yDir=null,this.modelTransform.zDir=null,this.modelTransform.minBound=null,this.modelTransform.maxBound=null,this.modelTransform.xTiles=null,this.modelTransform.yTiles=null,this.modelTransform.zTiles=null,this.modelTransform.objToOldDisplay=null,this.modelTransform.lengthUnitToMeter=null,this.modelTransform.initialCamPos=null,this.modelTransform={},!0}},{key:"validate",value:function(){for(var e=["id","name","owner","isImported","views","date","versionControl","cloudPath","geoInfo","modelTransform"],t=0;t<e.length;t++)if(null===this[e[t]]||void 0===this[e[t]])return console.error("invalid info[",e[t],"]=",this[e[t]]),!1;e=Object.keys(this.owner);for(var r=0;r<e.length;r++)if(null===this.owner[e[r]]||void 0===this.owner[e[r]])return console.error("invalid info.owner[",e[r],"]=",this[e[r]]),!1;e=Object.keys(this.modelTransform);for(var n=0;n<e.length;n++)if(null===this.modelTransform[e[n]]||void 0===this.modelTransform[e[n]])return console.error("invalid info.modelTransform[",e[n],"]=",this[e[n]]),!1;if(this.cloudPath.length<=0)return console.error("Invalid cloudPath",this.cloudPath),!1;if(this.geoInfo&&!isNaN(this.geoInfo.maxLat)&&!isNaN(this.geoInfo.minLat)&&!isNaN(this.geoInfo.maxLong)&&!isNaN(this.geoInfo.minLong)){var i=Math.max(Math.abs(this.geoInfo.maxLat-this.geoInfo.minLat),Math.abs(this.geoInfo.maxLong-this.geoInfo.minLong));if(i>2)return console.warn("Unusual large(",i,") project ",this.name,this.id),!1}return!0}},{key:"processProjectInfo",value:function(e){this.id=e.id,this.name=e.name,this.owner=e.owner,this.isImported=e.isImported,this.modelType=e.modelType||"MESHLOD",this.views=e.views,this.date=e.date,this.versionControl=null===e.versionControl?"":e.versionControl,this.cloudPath=e.cloudPath,this.basepath=this._computePreferredPath();var t=e.modelTransform;t.lengthUnitToMeter=1,this.modelTransform={origin:n(t.origin),xDir:n(t.xDir),yDir:n(t.yDir),zDir:n(t.zDir),maxBound:n(t.maxBound),minBound:n(t.minBound),xTiles:t.xTiles,yTiles:t.yTiles,zTiles:t.zTiles,lengthUnitToMeter:"undefined"===t.lengthUnitToMeter?1:t.lengthUnitToMeter,objToOldDisplay:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;(isNaN(r)||r<=0)&&(console.warn("lengthUnitToMeter",r),r=1);var n=function(e){var t=new p.Matrix4;e instanceof Array?3===e.length?t.makeRotationX(Math.PI*e[0]).multiply((new p.Matrix4).makeRotationY(Math.PI*e[1])).multiply((new p.Matrix4).makeRotationZ(Math.PI*e[2])):16===e.length?t.set.apply(t,e):console.error("AltizureProjectInfo unrecognized onLoadTrans",e):"object"===Wp(e)&&void 0!==e.x&&void 0!==e.y&&void 0!==e.z&&t.makeRotationX(Math.PI*e.x).multiply((new p.Matrix4).makeRotationY(Math.PI*e.y)).multiply((new p.Matrix4).makeRotationZ(Math.PI*e.z));return t}(e),i=(new p.Matrix4).makeTranslation(-t[0],-t[1],-t[2]),o=(new p.Matrix4).makeScale(r,r,r);return n=n.multiply(i).multiply(o)}(t.onLoadTrans,t.origin,t.lengthUnitToMeter),initialCamPos:{cameraPos:n(t.initialCamPos.cameraPos),centerPos:n(t.initialCamPos.centerPos)}},this.modelTransform.objToDisplay=function(e,t,r){var n=(new p.Euler).setFromRotationMatrix(e);return n.x-=1.5*Math.PI,(new p.Matrix4).multiply((new p.Matrix4).makeRotationFromEuler(n)).multiply((new p.Matrix4).makeTranslation(-t.x*r,-t.y*r,-t.z*r)).multiply((new p.Matrix4).makeScale(r,r,r))}(this.modelTransform.objToOldDisplay,this.modelTransform.origin,this.modelTransform.lengthUnitToMeter),this.modelTransform.bbox={min:this.modelTransform.minBound.clone().add(this.modelTransform.origin),max:this.modelTransform.maxBound.clone().add(this.modelTransform.origin)};var r=e.geoInfo;return r instanceof Object?this.geoInfo={autoAligned:r.autoAligned,manualAligned:r.manualAligned,centerLat:r.centerLat,centerLong:r.centerLong,maxLat:r.maxLat,minLat:r.minLat,maxLong:r.maxLong,minLong:r.minLong,transformed:r.transformed}:this.geoInfo={},null!==this.geoInfo.centerLat&&void 0!==this.geoInfo.centerLat||(this.geoInfo.centerLat=2.8125),null!==this.geoInfo.centerLong&&void 0!==this.geoInfo.centerLong||(this.geoInfo.centerLong=2.8125),this.minLevel=0,this.maxLevel=function(e,t){var r=Math.max(e,t),n=0;for(;r>1;)r/=2,n++;return n}(t.xTiles,t.yTiles),this.minDisplayLevel=0,this.maxDisplayLevel=this.maxLevel,this;function n(e){return e instanceof Array&&3===e.length?new p.Vector3(e[0],e[1],e[2]):e&&e.x&&e.y&&e.z?new p.Vector3(e.x,e.y,e.z):void console.error("objToVec3 invalid obj",e)}}},{key:"processInfoTxt",value:function(e){this.modelType=e.model_type,this.spec_version=e.spec_version,this.srs=e.srs,this.modelType.objToDisplay=e.model_transform.clone()}},{key:"orthoInfo",value:function(e){var t=function(t){var r=t.minBound,i=t.maxBound,o=t.origin,a=t.xDir,s=t.yDir,u=t.zDir,c=new Array(8);c[0]=r.clone(),c[1]=new p.Vector3(r.x,i.y,r.z),c[2]=new p.Vector3(i.x,r.y,r.z),c[3]=new p.Vector3(i.x,i.y,r.z);for(var l=0;l<4;++l)c[l+4]=c[l].clone().setZ(i.z);for(var f=new Array(2),h=0;h<8;++h){var d=n(o,a,s,u,c[h]);d.applyMatrix4(e),0===h?(f[0]=d.clone(),f[1]=d.clone()):(f[0].x=Math.min(f[0].x,d.x),f[0].y=Math.min(f[0].y,d.y),f[0].z=Math.min(f[0].z,d.z),f[1].x=Math.max(f[1].x,d.x),f[1].y=Math.max(f[1].y,d.y),f[1].z=Math.max(f[1].z,d.z))}return f}(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){Vp(e,t,r[t])})}return e}({},this.modelTransform)),r=(new p.Matrix4).extractRotation(e).transpose();return{origin:this.modelTransform.origin.clone(),xDir:new p.Vector3(1,0,0).applyMatrix4(r),yDir:new p.Vector3(0,1,0).applyMatrix4(r),zDir:new p.Vector3(0,0,1).applyMatrix4(r),minBound:t[0],maxBound:t[1],width:t[1].x-t[0].x,height:t[1].z-t[0].z,area:(t[1].x-t[0].x)*(t[1].z-t[0].z)};function n(e,t,r,n,i){var o=t.clone().multiplyScalar(i.x),a=r.clone().multiplyScalar(i.y),s=n.clone().multiplyScalar(i.z);return e.clone().add(o).add(a).add(s)}}},{key:"_computePreferredPath",value:function(){var e=[];"China"===N.countryName?(e[0]="oss_sz",e[1]="s3",e[2]="oss_usw",e[3]="local"):(e[0]="s3",e[1]="oss_usw",e[2]="oss_sz",e[3]="local");for(var t,r=this.cloudPath,n=0;n<e.length;n++){for(var i=0;i<r.length;i++)if(r[i].key===e[n]){t=r[i].dataUrl;break}if(t)break}return t||console.error("preferredPath error",this.name,r,e),t}},{key:"valid",get:function(){return this.validate()}}])&&Gp(t.prototype,r),n&&Gp(t,n),e}();function Kp(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var qp=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.promiseFn=t.promiseFn,this.timer=t.timer,this.timeout=t.timeout,void 0!==t.promiseFn&&void 0!==this.timer&&void 0!==this.timeout?(this.processingTask=null,this.deferredTask=null,this.debug=t.debug||!1,this._running=null):console.error("RefreshQueue invalid construction.",t)}var t,r,n;return t=e,(r=[{key:"add",value:function(e){var t=this;null===this.processingTask?(this.processingTask=e,null!==this._running?this._running.then(function(){t._running=t._run()}):this._running=this._run()):null===this.deferredTask?this.deferredTask=e:null!==this.deferredTask?this.deferredTask=e:console.warn("RefreshQueue.add(): unknown condition")}},{key:"_run",value:function(){var e=this.debug;if(null===this.processingTask)return e&&console.log("no processingTask"),this._running=null,Promise.resolve();var t,r,n=this;return(t=this.promiseFn(this.processingTask),r=n.timeout,Promise.race([t,new Promise(function(e,t){setTimeout(function(){t(new Error("Refresh task time out "+r))},r)})])).catch(function(t){return e&&console.warn("refresh task failed:",n.processingTask,t),Promise.resolve()}).then(function(){return n.processingTask=n.deferredTask,n.deferredTask=null,e=n.timer,new Promise(function(t,r){setTimeout(function(){t()},e)});var e}).then(function(){return n._run()})}}])&&Kp(t.prototype,r),n&&Kp(t,n),e}();r.d(t,"HyperViewer",function(){return F}),r.d(t,"EarthViewer",function(){return sl}),r.d(t,"SessionEnv",function(){return n}),r.d(t,"LodForest",function(){return Bc}),r.d(t,"HyperNode",function(){return W}),r.d(t,"HyperEntity",function(){return Nt}),r.d(t,"HyperLayer",function(){return Mt}),r.d(t,"AltizureProjectTile",function(){return Pa}),r.d(t,"AltizureProjectTree",function(){return sa}),r.d(t,"AltizureLoader",function(){return bs}),r.d(t,"OSGSpec",function(){return cl}),r.d(t,"OSGTree",function(){return Xs}),r.d(t,"OSGTile",function(){return Vs}),r.d(t,"OSGLoader",function(){return iu}),r.d(t,"QuadLodNode",function(){return Un}),r.d(t,"QuadLodTree",function(){return nr}),r.d(t,"DEMSpec",function(){return fl}),r.d(t,"DEMTree",function(){return fu}),r.d(t,"DEMTile",function(){return Gu}),r.d(t,"CoordinateSystems",function(){return s}),r.d(t,"PlanetConstants",function(){return o}),r.d(t,"PlanetMath",function(){return a}),r.d(t,"TreeMaterial",function(){return dr}),r.d(t,"ProjectorTreeMaterial",function(){return Of}),r.d(t,"ContourLineTreeMaterial",function(){return Jh}),r.d(t,"TileBasicMaterial",function(){return fr}),r.d(t,"PhongTreeMaterial",function(){return gl}),r.d(t,"TilePhongMaterial",function(){return ea}),r.d(t,"TilePhysicalMaterial",function(){return kl}),r.d(t,"TilePointsMaterial",function(){return Ml}),r.d(t,"VideoMaterial",function(){return mf}),r.d(t,"CropTreeMaterial",function(){return Yf}),r.d(t,"CropTileMaterial",function(){return Rf}),r.d(t,"PCTreeMaterial",function(){return Ih}),r.d(t,"AltizureTreeMaterial",function(){return yp}),r.d(t,"TileFlatMaterial",function(){return Bl}),r.d(t,"TileWireframeMaterial",function(){return Vl}),r.d(t,"VisibilityTreeMaterial",function(){return lh}),r.d(t,"VisibilityTileMaterial",function(){return yh}),r.d(t,"VisibilityTileMaterial2",function(){return rh}),r.d(t,"ContourLineMaterial",function(){return Gh}),r.d(t,"PCTileMaterial",function(){return kh}),r.d(t,"presetTexture",function(){return l}),r.d(t,"MaskLoader",function(){return f}),r.d(t,"OfflineRendererClass",function(){return Kl}),r.d(t,"ProjectBooleanMask",function(){return Nf}),r.d(t,"MeshBasicMaterial2",function(){return Rp}),r.d(t,"BPCTileMaterial",function(){return Fp}),r.d(t,"PPCTileMaterial",function(){return kp}),r.d(t,"BASIC",function(){return xo}),r.d(t,"PHONG",function(){return Ao}),r.d(t,"PBR",function(){return ko}),r.d(t,"WIREFRAME",function(){return 40}),r.d(t,"FLAT",function(){return To}),r.d(t,"AltizureApi",function(){return M}),r.d(t,"AltizureProjectInfo",function(){return Hp}),r.d(t,"RefreshQueue",function(){return qp}),r.d(t,"BrowserCapatibility",function(){return B}),r.d(t,"EventUtil",function(){return i}),r.d(t,"LoadUtil",function(){return c}),r.d(t,"HtmlHelper",function(){return v}),r.d(t,"FunctionUtil",function(){return y}),r.d(t,"MsgDecorators",function(){return u}),r.d(t,"PlanetRenderItems",function(){return Jc}),r.d(t,"EarthWmtsTileURL",function(){return Wc}),r.d(t,"altizureSpecLoader",function(){return is}),r.d(t,"mockSpecLoader",function(){return as}),r(22),console.log(h.description,h.version)}])});